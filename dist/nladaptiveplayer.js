!function(t,e){for(var i in e)t[i]=e[i]}(window,function(i){var n={};function r(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=i,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="dist/",r(r.s=144)}([function(t,e,i){var g=i(2),m=i(19),v=i(12),y=i(13),b=i(20),_="prototype",T=function(t,e,i){var n,r,a,s,o=t&T.F,l=t&T.G,u=t&T.S,h=t&T.P,c=t&T.B,d=l?g:u?g[e]||(g[e]={}):(g[e]||{})[_],f=l?m:m[e]||(m[e]={}),p=f[_]||(f[_]={});for(n in l&&(i=e),i)a=((r=!o&&d&&void 0!==d[n])?d:i)[n],s=c&&r?b(a,g):h&&"function"==typeof a?b(Function.call,a):a,d&&y(d,n,a,t&T.U),f[n]!=a&&v(f,n,s),h&&p[n]!=a&&(p[n]=a)};g.core=m,T.F=1,T.G=2,T.S=4,T.P=8,T.B=16,T.W=32,T.U=64,T.R=128,t.exports=T},function(t,e,i){var n=i(4);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var n=i(59)("wks"),r=i(36),a=i(2).Symbol,s="function"==typeof a;(t.exports=function(t){return n[t]||(n[t]=s&&a[t]||(s?a:r)("Symbol."+t))}).store=n},function(t,e,i){t.exports=!i(3)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(1),r=i(105),a=i(23),s=Object.defineProperty;e.f=i(6)?Object.defineProperty:function(t,e,i){if(n(t),e=a(e,!0),n(i),r)try{return s(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var n=i(25),r=Math.min;t.exports=function(t){return 0<t?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(24);t.exports=function(t){return Object(n(t))}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AdaptivePlayer=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();i(145);var a=i(348),o=i(34),l=P(i(74)),u=P(i(56)),h=i(103),c=P(i(104)),s=i(28),d=P(i(141)),f=L(i(140)),p=P(i(57)),g=L(i(352)),m=i(353),v=i(45),y=i(354),b=i(355),_=i(356),T=i(357),E=i(46),S=L(i(360)),w=L(i(366)),k=L(i(368)),A=L(i(376));function L(t){return t&&t.__esModule?t:{default:t}}function P(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function C(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var x=e.AdaptivePlayer=function(t){function s(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var i=C(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return i._video=t,i._player=null,i._config={},i._url="",i._loaded=!1,i._autoPlayStatusEventSent=!1,i._logger=new h.LogUtil,i._logger.setLogLevel(E.Settings.DEFAULT_LOG_LEVEL),i._statisticManager=new y.StatisticManager(i._video,i),i._statisticManager.setErrorCallback(function(){this.stop({triggerPlayEndEvent:!1})}.bind(i),{level:15,url:""}),i._video?(i._video.addEventListener("volumechange",i._onVolumeChange.bind(i)),i._videoautoplay=t.autoplay,s.ActionReason=m.StateManager.ActionReason,i._stateManager=new m.StateManager(i,function(t,e,i){this.dispatchEvent(new o.FakeEvent(s.EventType.StateChange,{oldState:t,newState:e,details:{oldState:t,newState:e,from:i.from||i.reason||""}}))}.bind(i)),i._cuepointManager=new b.CuepointManager(i),i._clearID3AfterSeek=!1,i._multiViewsManager=new _.MultiviewsManager(i),i._config=u.mergeObject({},E.Settings.BASE_CONFIG),i._debugPanel=new T.DebugPanel(i,E.Settings.DEBUG_PANEL_REFRESH_INTERVAL),i._emptyAdvertisementList=[],E.Settings.DISABLE_CONTEXT_MENU&&i._video.addEventListener("contextmenu",function(t){t.preventDefault()},!1),i._logger.print(s.LogLevel.INFO,"AdaptivePlayer","["+s.version+"] Instance created! "),i):C(i,{error:"Invaild video object!"})}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(s,a.FakeEventTarget),r(s,[{key:"destroy",value:function(){return this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","destroy called!"),function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0}(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"destroy",this).call(this),this._video.removeEventListener("volumechange",this._onVolumeChange.bind(this)),this.stop({triggerPlayEndEvent:!0}).then(function(){this._stateManager&&this._stateManager.destroy()}.bind(this)).then(function(){this._eventManager&&this._eventManager.destroy()}.bind(this)).then(function(){this._statisticManager&&this._statisticManager.stop()}.bind(this)).then(function(){this._debugPanel&&this._debugPanel.destroy.bind()}.bind(this)).then(function(){this._player&&this._player.destroy&&this._player.destroy()}.bind(this)).then(function(){this._debugPanel=null,this._eventManager=null,this._stateManager=null,this._player=null,this._loaded=!1,this._statisticManager=null,this._multiViewsManager=null,this._cuepointManager=null}.bind(this))}},{key:"nativeCanPlay",value:function(){return{m3u8:d.canPlayNative(this._video,"m3u8"),mpd:d.canPlayNative(this._video,"mpd")}}},{key:"configure",value:function(t){this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","configure called!"),"object"===(void 0===t?"undefined":n(t))&&(this._config=u.mergeObject(t,E.Settings.BASE_CONFIG)),this._config.preferredAudioLanguage=g.default.toISO6391(this._config.preferredAudioLanguage),this._config.preferredTextLanguage=g.default.toISO6391(this._config.preferredTextLanguage);var e=this._statisticManager.getErrorConfig();t.errorReportLevel?e.level=t.errorReportLevel:e.level=s.ErrorReportLevel.All}},{key:"load",value:function(t,e,i){this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","Load "+t+(void 0!==e?", startTime="+e:"")+(void 0!==i?", streamType="+i:"")),this._url=t,"number"==typeof e&&(isNaN(e)?e=null:0===e&&(e=E.Settings.SMALL_GAP_TO_START)),this._loaded=!1,this._video.autoplay=this._videoautoplay,this._pauseAfterSeek=!1,this._lastDuration=0,this._oneTimeSeek=!1,this._oneTimeAutoPlay=!0,this._firstPlayAfterMetadataLoaded=!1,this._isInSeeking=!1,this._autoPlayStatusEventSent=!1,this._statisticManager.reset(t),this._stateManager.reset({reason:m.StateManager.ActionReason.START}),this._multiViewsManager.setSyncViews([]),this._debugPanel.reset(),this._cuepointManager.cleanup(),this._emptyAdvertisementList=[];var n=l.detectPlayerType(t,i,!!this._config.drm);if(n===s.PlayerType.UNKNOWN)return this._logger.print(s.LogLevel.ERROR,"AdaptivePlayer","Probe url failed"),void this._statisticManager.reportUnsupportedSchema(t);if(n!==s.PlayerType.NATIVE&&!c.probePlatformSupport()||n===s.PlayerType.WEBRTC&&!c.probeWebRTCSupport())return this._logger.print(s.LogLevel.ERROR,"AdaptivePlayer","Type "+n+" is not supported."),void this._statisticManager.reportUnsupported();if(this._config.appendXPLAYForStitching&&n===s.PlayerType.SHAKA&&-1===this._url.indexOf("x-play=")){var r=c.generateUUID();this._url+=-1===this._url.indexOf("?")?"?":"&",this._url+="x-play="+r}(function(){return this._eventManager&&this._eventManager.destroy(),this._player?n!==this._player.type?this._player.destroy().then(function(){this._player=this._createPlayer(n)}.bind(this)):this._player.unload():(this._player=this._createPlayer(n),Promise.resolve())}).bind(this)().then(function(){return null===this._player||null===this._video?(this._logger.print(s.LogLevel.ERROR,"AdaptivePlayer","player not created successfully or already destroyed"),void(this._statisticManager&&this._statisticManager.reportNativeVideoError("player not created successfully or already destroyed"))):(this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","current player type="+this._player.type+", next player type="+n),this._eventManager=new v.EventManager,this._eventManager.listen(this._video,"error",this._onVideoError.bind(this)),this._eventManager.listen(this._video,"timeupdate",this._onTimeUpdate.bind(this)),this._eventManager.listen(this._video,"ratechange",this._onRateChange.bind(this)),this._eventManager.listen(this._video,"progress",this._onProgress.bind(this)),this._eventManager.listen(this._video,"resize",this._onResize.bind(this)),this._eventManager.listen(this._video,"ended",function(){this._onEnded({reason:m.StateManager.ActionReason.COMPLETE})}.bind(this)),this._video.textTracks&&(this._eventManager.listen(this._video.textTracks,"addtrack",this._onTextTracksChanged.bind(this)),this._eventManager.listen(this._video.textTracks,"removetrack",this._onTextTracksChanged.bind(this)),this._eventManager.listen(this._video,"addtrack",this._onTextTracksChanged.bind(this)),this._eventManager.listen(this._video,"removetrack",this._onTextTracksChanged.bind(this))),["seeking","seeked","pause","play","canplay","canplaythrough","playing","loadedmetadata","loadstart","durationchange"].forEach(function(t){this._eventManager.listen(this._video,t,this._onVideoEvent.bind(this))}.bind(this)),this._player.configure(this._config),this._startLoadTime=new Date,this._player.load(this._url,e).catch(function(t){this._logger.print(s.LogLevel.ERROR,"AdaptivePlayer","Load failed! msg="+t.message),this._statisticManager.reportNativeVideoError(t.message,s.ErrorCode.Generic_Error)}.bind(this)))}.bind(this))}},{key:"deviceId",value:function(){return this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","deviceId called!"),c.getDeviceId()}},{key:"isLive",value:function(){return!!this._player&&this._player.isLive()}},{key:"gotoLive",value:function(){this._player&&this._player.isLive()&&(this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","gotoLive called!"),this._player.gotoLive())}},{key:"play",value:function(){if(this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","play called!"),this._video){var t=this._video.play();null!=t&&t.then(function(){this._autoPlayStatusEventSent||(this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","auto play started!"),this.dispatchEvent(new o.FakeEvent(s.EventType.AutoPlayStatus,{details:{autoplay:!0}}))),this._autoPlayStatusEventSent=!0}.bind(this)).catch(function(){this._autoPlayStatusEventSent||(this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","auto play prevented!"),this.dispatchEvent(new o.FakeEvent(s.EventType.AutoPlayStatus,{details:{autoplay:!1}}))),this._autoPlayStatusEventSent=!0}.bind(this)),this._video.autoplay=this._videoautoplay,this._pauseAfterSeek=!1}}},{key:"pause",value:function(){this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","pause called!"),this._video&&(this._video.pause(),this._video.autoplay=!1,this._pauseAfterSeek=!0)}},{key:"stop",value:function(t){return this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","stop called!"),this._url="",this.getState()===s.State.IDLE?(this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","skip stop call on state idle"),Promise.resolve()):(this._debugPanel&&this._debugPanel.reset(),this._cuepointManager&&this._cuepointManager.cleanup(),this._stateManager&&this._stateManager.reset({reason:m.StateManager.ActionReason.ABORT}),this._statisticManager&&this._statisticManager.stop(),this._eventManager&&this._eventManager.destroy(),this._player?this._player.unload().then(function(){return(null==t||null==t.triggerPlayEndEvent||t&&t.triggerPlayEndEvent)&&this._onEnded({reason:m.StateManager.ActionReason.ABORT}),Promise.resolve()}.bind(this)):Promise.resolve().then(function(){return(null==t||null==t.triggerPlayEndEvent||t&&t.triggerPlayEndEvent)&&this._onEnded({reason:m.StateManager.ActionReason.ABORT}),Promise.resolve()}.bind(this)))}},{key:"setAdaption",value:function(t){this._player&&this._player.setAdaptation(t)}},{key:"setAdaptation",value:function(t){this._player&&this._player.setAdaptation(t)}},{key:"selectTrack",value:function(t,e){this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","selectTrack called, track={"+t.id+", "+t.name+"}"+(null==e?"":", optClearBuffer="+e)),this._player&&t&&this._player.selectTrack(t,null==e||!!e)}},{key:"hideAllTextTracks",value:function(){for(var t=this._video.textTracks,e=0;e<t.length;e++){var i=t[e];this._player.type===s.PlayerType.SHAKA&&"Shaka Player TextTrack"===i.label?this._player.setTextTrackVisibility(!1):"disabled"!==i.mode&&(i.mode="hidden")}}},{key:"videoTracks",value:function(){return this._player?this._player.videoTracks():[]}},{key:"audioTracks",value:function(){return this._player?this._player.audioTracks():[]}},{key:"textTracks",value:function(){return this._player?this._player.textTracks():[]}},{key:"ccTracks",value:function(){return this._player?this._player.ccTracks():[]}},{key:"addCuepoints",value:function(t){if(this._cuepointManager)return this._cuepointManager.addCuepoints(t)}},{key:"removeCuepoint",value:function(t,e){if(this._cuepointManager)return this._cuepointManager.removeCuepoint(t,e)}},{key:"getCuepoints",value:function(){if(this._cuepointManager)return this._cuepointManager.getCuepoints()}},{key:"removeAllCuepoints",value:function(){if(this._cuepointManager)return this._cuepointManager.removeAllCuepoints()}},{key:"getThumbnailStreams",value:function(){this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","getThumbnailStreams");var t=[];return this._player&&this._player.getThumbnailStreams&&(this._player.type===s.PlayerType.SHAKA||this._player.type===s.PlayerType.HLSJS||this._player.type===s.PlayerType.NATIVE)?(this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","getThumbnailStreams result:"),(t=this._player.getThumbnailStreams())&&t.forEach(function(t){this._logger.print(s.LogLevel.WARING,"AdaptivePlayer","id-width-height: "+t.id+"-"+t.width+"-"+t.height)}.bind(this))):this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","Failed to get thumbnail streams"),t}},{key:"getThumbnailStreamImages",value:function(t,e,i){this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","getThumbnailStreamImages: id="+t+" time="+e),this._player&&this._player.getThumbnailStreamImages&&(this._player.type===s.PlayerType.SHAKA||this._player.type===s.PlayerType.HLSJS||this._player.type===s.PlayerType.NATIVE)?this._player.getThumbnailStreamImages(t,e,i):this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","Failed to get thumbnail")}},{key:"setLogLevel",value:function(t){this._logger.setLogLevel(t)}},{key:"setSynchronizedViews",value:function(t){this._multiViewsManager.setSyncViews(t)}},{key:"getState",value:function(){return this._stateManager?this._stateManager.getState():s.State.IDLE}},{key:"getConfigure",value:function(){return this._config}},{key:"getConfigurations",value:function(){return this._config}},{key:"getStats",value:function(){var t={currentTime:"",duration:"",videoWidth:"",videoHeight:"",muted:"",volume:0,isLive:!1,droppedFrameCount:"",totalVideoFrames:"",readyState:"",buffered:"",bufferingTime:0,playbackRate:"",bytesLoaded:[],state:"",url:"",bandwidth:"",bitrate:"",switchInfo:"",switchHistory:NaN,isAutoSwitch:"",livePointOffest:-1};if(!this._player||!this._video)return t;var e={droppedFrameCount:0,totalVideoFrames:0};if(2<=this._video.readyState)if(HTMLVideoElement.prototype.getVideoPlaybackQuality){var i=this._video.getVideoPlaybackQuality();e.droppedFrameCount=i.droppedVideoFrames,e.totalVideoFrames=i.totalVideoFrames}else"number"==typeof this._video.webkitDroppedFrameCount&&(e.droppedFrameCount=this._video.webkitDroppedFrameCount,e.totalVideoFrames=this._video.webkitDecodedFrameCount);var n=this._player.getStats(),r="";return n&&n.switchInfo&&(r=n.switchInfo.fromAdaptation?"Auto: ":"Manual: ",n.switchInfo.from?r+="["+n.switchInfo.from/1e3+"] -> [":r+="[...] -> [",n.switchInfo.to?r+=n.switchInfo.to/1e3+"]":r+="...]"),{currentTime:this.currentTime,duration:this.duration,videoWidth:this._video.videoWidth,videoHeight:this._video.videoHeight,muted:this._video.muted,volume:this._video.volume,isLive:this.isLive(),url:this._url,totalVideoFrames:e.totalVideoFrames,droppedFrameCount:e.droppedFrameCount,readyState:this._video.readyState,buffered:this._video.buffered,playbackRate:this._video.playbackRate,state:this.getState(),bufferingTime:this._stateManager.getBufferingTime()/1e3,bytesLoaded:n.bytesLoaded,bandwidth:n.bandwidth,bitrate:n.bitrate,switchInfo:r,switchHistory:n.switchHistory,isAutoSwitch:n.isAutoSwitch,livePointOffest:n.livePointOffest}}},{key:"normalizeCurrentTime",value:function(){this._player&&""!==this._url&&this._player.type===s.PlayerType.HLSJS&&this._player.setNormalizeCurrentTime()}},{key:"getNormalizeCurrentTime",value:function(){return this._player&&""!==this._url?this._player.type===s.PlayerType.HLSJS?this._player.getNormalizeCurrentTime():this._player.currentTime:0}},{key:"clearWrongCues",value:function(){this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","Clear wrong cues of all text tracks during slate");for(var t=this._video.textTracks,e=t.length-1;0<=e;e--)if(("subtitles"===t[e].kind||"captions"===t[e].kind)&&"showing"===t[e].mode){if(t[e].mode="hidden",t[e].activeCues)for(var i=t[e].activeCues.length-1;0<=i;i--){var n=t[e].activeCues[i];this._logger.print(s.LogLevel.WARING,"AdaptivePlayer","Clear wrong active cue: ["+n.startTime+","|n.endTime+"]"),t[e].removeCue(n)}if(t[e].cues)for(var r=t[e].cues.length-1;0<=r;r--){var a=t[e].cues[r];a.startTime<this.currentTime&&a.endTime>=this.currentTime&&(this._logger.print(s.LogLevel.WARING,"AdaptivePlayer","Clear wrong cue: ["+a.startTime+","|a.endTime+"]"),t[e].removeCue(a))}t[e].mode="showing"}}},{key:"_createPlayer",value:function(t){return t===s.PlayerType.NATIVE?new k.default(this._video,this):t===s.PlayerType.SHAKA?new S.default(this._video,this):t===s.PlayerType.HLSJS?new w.default(this._video,this):t===s.PlayerType.WEBRTC?new A.default(this._video,this):(this._logger.print(s.LogLevel.ERROR,"AdaptivePlayer","Failed to create player with type="+t),null)}},{key:"_onTimeUpdate",value:function(t){var e={currentTime:this.currentTime,duration:this.duration,buffered:this.buffered};this._cuepointManager&&this._cuepointManager.onTimeUpdate(e),this._emptyAdvertisementList.sort(function(t,e){return t.time-e.time});for(var i=0;i<this._emptyAdvertisementList.length;i++){var n=this._emptyAdvertisementList[i];if(n.time<=this.currentTime&&n.time>=this.currentTime-1)n.urls.forEach(function(t){this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","+++ Posted beacon: "+t),p.sendWithIframe(t)}.bind(this)),this._emptyAdvertisementList.splice(i,1),i--;else if(n.time>this.currentTime)break}this._player&&this._player._onTimeUpdate&&this._player._onTimeUpdate(e),this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","Fired TimeUpdate: "+t+"["+JSON.stringify(e)+"]"),this.dispatchEvent(new o.FakeEvent(s.EventType.TimeUpdate,{currentTime:this.currentTime,duration:this.duration,buffered:this.buffered,details:e}))}},{key:"_onRateChange",value:function(t){this.dispatchEvent(new o.FakeEvent(s.EventType.RateChange,{details:{rate:t.target.playbackRate}})),this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","Fired RateChange: [playbackRate = "+t.target.playbackRate+"]"),("IE"===this.browserType||"Edge"===this.browserType)&&!this.isLive()&&0===this._video.playbackRate&&this._video.duration-this._video.currentTime<=1&&setTimeout(function(){this._stateManager.reset({reason:m.StateManager.ActionReason.ABORT}),this._video.pause(),this._onEnded({reason:m.StateManager.ActionReason.ABORT})}.bind(this),1e3)}},{key:"_onProgress",value:function(t){this.dispatchEvent(new o.FakeEvent(s.EventType.Progress,{details:{timeStamp:t.timeStamp,eventPhase:t.eventPhase}})),this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","Fired Progress: "+t)}},{key:"_onResize",value:function(t){this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","resize triggered"),this._player&&this._player.notifyProfileChanged&&this._player.notifyProfileChanged({videoWidth:t.target.videoWidth,videoHeight:t.target.videoHeight})}},{key:"_onVolumeChange",value:function(t){var e={muted:t.target.muted,volume:t.target.volume};this.dispatchEvent(new o.FakeEvent(s.EventType.VolumeChange,{details:e})),this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","Fired VolumeChange: "+t+"["+JSON.stringify(e)+"]")}},{key:"_onTextTracksChanged",value:function(t){this._player.type===s.PlayerType.HLSJS&&(this.dispatchEvent(new o.FakeEvent(s.EventType.TrackChange,{details:{type:s.Kind.TEXT,track:this.textTracks()}})),this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","Fired TrackChange: ["+t.track.kind+" / "+t.track.label+"]"))}},{key:"_onEnded",value:function(t){this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","Fired PlayEnd "+JSON.stringify(t)),this.dispatchEvent(new o.FakeEvent(s.EventType.PlayEnd,{details:t}))}},{key:"_onVideoEvent",value:function(t){var e="";switch(t.type){case"durationchange":if(t.target.duration-this._lastDuration<=.5)return;this._lastDuration=t.target.duration,e=Math.round(1e3*t.target.duration);break;case"loadedmetadata":e="duration:"+t.target.duration+"/videoWidth:"+t.target.videoWidth+"/videoHeight:"+t.target.videoHeight,this._oneTimeSeek=!0,this._firstPlayAfterMetadataLoaded=!0,this._oneTimeAutoPlay=!0;break;case"canplay":if(this._firstPlayAfterMetadataLoaded){this._firstPlayAfterMetadataLoaded=!1,this._endLoadTime=new Date,this._loaded=!0;var i={loadTime:this._endLoadTime-this._startLoadTime,details:{loadTime:this._endLoadTime-this._startLoadTime}};this.dispatchEvent(new o.FakeEvent(s.EventType.PlayStart,i)),this._player.notifyPlayStarted(),this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","Fired PlayStart: ["+JSON.stringify(i)+"]")}try{this._oneTimeSeek&&0===this._video.currentTime&&0<this._video.buffered.length&&(this._video.currentTime=this._video.buffered.start(0)+E.Settings.SMALL_GAP_TO_START,this._clearID3AfterSeek=!1,this._oneTimeSeek=!1)}catch(t){this._logger.print(s.LogLevel.WARNING,"AdaptivePlayer","seek to buffer start exception: "+t)}this._statisticManager.stopLoadWatchDog(),this._pauseAfterSeek?this._pauseAfterSeek=!1:this._video.autoplay&&this._oneTimeAutoPlay&&(this._oneTimeAutoPlay=!1,this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","work-around of Firefox 55 live stream paused after start play"),this.play());break;case"canplaythrough":break;case"seeking":this._isInSeeking||(this._statisticManager&&this._statisticManager.startSeekWatchDog(),this._isInSeeking=!0);break;case"seeked":this._clearID3AfterSeek&&this._cuepointManager.clearID3(),this._statisticManager&&this._statisticManager.stopSeekWatchDog(),this._isInSeeking=!1;try{0===this._video.currentTime&&0<this._video.buffered.length&&0!==this._video.buffered.start(0)&&(this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","Do jump to buffered.start( "+this._video.buffered.start(0)+") when seek to "+this._video.currentTime),this._video.currentTime=this._video.buffered.start(0)+E.Settings.SMALL_GAP_TO_START)}catch(t){this._logger.print(s.LogLevel.WARNING,"AdaptivePlayer","seek to buffer start exception: "+t)}}this.dispatchEvent(t),this.dispatchEvent(new o.FakeEvent(s.EventType.StreamingEvent,{details:{data:{from:"AdaptivePlayer",data:{type:t.type}}}})),this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","Fired streaming event: "+t.type+"["+e+"]")}},{key:"_onVideoError",value:function(t){if(t.target.error&&1!==t.target.error.code){var e=t.target.error.msExtendedCode;e&&(e<0&&(e+=Math.pow(2,32)),e=e.toString(16));var i=s.ErrorCode.Playback_Generic_Error;if("error"===t.type){var n="",r=t.currentTarget.error,a=l.getExtension(this._url);switch(r.code){case r.MEDIA_ERR_DECODE:n="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",i=s.ErrorCode.Incompatible_Codecs_Error;break;case r.MEDIA_ERR_SRC_NOT_SUPPORTED:n="The video could not be loaded, because the server or network failed",i=s.ErrorCode.Get_Primary_Manifest_Failed+(this._player._basic_externalParser_403_found?s.ErrorDetailedCode.Cookie_Reject_Error:s.ErrorDetailedCode.Connect_Failed),this._player._basic_externalParser_403_found=!1,("webm"===a&&""===t.target.canPlayType('video/webm; codecs="vp8, vorbis"')||"ogg"===a&&""===t.target.canPlayType('video/ogg; codecs="theora"'))&&(n="The video could not be loaded, because the format is not supported",i=s.ErrorCode.Incompatible_Codecs_Error);break;case r.MEDIA_ERR_NETWORK:i=s.ErrorCode.Get_Primary_Manifest_Failed+s.ErrorDetailedCode.Connect_Failed,n="A network error caused the video download to fail part-way"}n+=", playback position: "+(this.currentTime?this.currentTime:Math.round(1e3*t.target.currentTime))+(e?" extendCode: "+e:" "),this._statisticManager.reportNativeVideoError(n,i),this.stop({triggerPlayEndEvent:!1}),this._logger.print(s.LogLevel.ERROR,"AdaptivePlayer","Fired streaming error: "+n)}}}},{key:"_onAdvertisement",value:function(t){this._logger.print(s.LogLevel.TRACE,"AdaptivePlayer","_onAdvertisement"),t&&(this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","_onAdvertisement: "+JSON.stringify(t)),"ADSTART"===t.type||"ADEND"===t.type?this.dispatchEvent(new o.FakeEvent(s.EventType.AdEvent,{start:this.currentTime,data:t,details:t})):"ADPOST"===t.type&&t.data.urls.forEach(function(t){this._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","+++ Posted beacon: "+t.url),p.sendWithIframe(t.url)}.bind(this)))}},{key:"_onEmptyAdvertisement",value:function(i){var t=this;if(i)for(var e=function(e){!1===t._emptyAdvertisementList.some(function(t){return t.time===i[e].time})&&(t._emptyAdvertisementList.push(i[e]),t._logger.print(s.LogLevel.DEBUG,"AdaptivePlayer","Add empty advertisement: "+JSON.stringify(i[e])))},n=0;n<i.length;n++)e(n)}},{key:"_onAdRangesUpdate",value:function(t){if(t){var e={type:s.AD.RANGE_EVENT,data:t};this.dispatchEvent(new o.FakeEvent(s.EventType.AdEvent,{start:this.currentTime,details:e,data:e}))}}},{key:"sampleDuration",get:function(){return this._player&&""!==this._url?this._player.sampleDuration:0}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:0},set:function(t){this._logger.print(s.LogLevel.INFO,"AdaptivePlayer","Seek to "+t),(null==t||t<=0)&&(t=E.Settings.SMALL_GAP_TO_START),this._stateManager&&this._stateManager.notifyUserSeek(),this._player&&(this._player.currentTime=t,this._clearID3AfterSeek=!0)}},{key:"duration",get:function(){return this.isLive()?1/0:this._video.duration}},{key:"streamType",get:function(){return this._player?this._player.streamType:s.StreamType.UNKNOWN}},{key:"playerType",get:function(){return this._player?this._player.type:s.PlayerType.UNKNOWN}},{key:"buffered",get:function(){return this._video.buffered}},{key:"muted",get:function(){return this._video.muted},set:function(t){this._video.muted=t}},{key:"volume",get:function(){return this._video.volume},set:function(t){this._video.volume=t}},{key:"src",get:function(){return this._video.src},set:function(t){this._video.src=t}},{key:"playbackRate",get:function(){return this._video.playbackRate},set:function(t){this._video.muted=1!==t,this._video.playbackRate=t}},{key:"readyState",get:function(){return this._video.readyState}}],[{key:"support",value:function(t){return S.default.support(t)}}]),s}();x.version="v3.0.1.20190416.e12be1ef",x.coreVersion="shaka-player: "+S.default.version+", hls.js: "+w.default.version+", basic: "+k.default.version+", webrtc: "+A.default.version,x.PlayerType={SHAKA:"shaka",HLSJS:"hls.js",NATIVE:"native",WEBRTC:"nlwebrtc",UNKNOWN:"unknown"},x.StreamType={HTTP_VIDEO:"HTTP",DASH:"DASH",HLS:"HLS",WEBRTC:"WEBRTC",UNKNOWN:"UNKNOWN"},x.Kind={VIDEO:"VIDEO",AUDIO:"AUDIO",TEXT:"TEXT",UNKNOWN:"UNKNOWN"},x.ErrorCode=s.NLError.Code,x.ErrorDetailedCode=s.NLError.NetworkDetailCode,x.ErrorReportLevel=s.NLError.SeverityLevel,x.LogLevel=h.LogUtil.LogLevel,x.OS=(new f.default).getOS(),x.browserType="iOS"===x.OS.name?"Mobile Safari":(new f.default).getBrowser().name,x.EventType=v.EventManager.EventType,x.State=m.StateManager.State,x.AD={START_EVENT:"ADSTART",END_EVENT:"ADEND",RANGE_EVENT:"ADRANGES",DEFAULT_CLICK:"defaultClick",TRACK_CLICK:"trackClick"}},function(t,e,i){var n=i(7),r=i(35);t.exports=i(6)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var a=i(2),s=i(12),o=i(15),l=i(36)("src"),n="toString",r=Function[n],u=(""+r).split(n);i(19).inspectSource=function(t){return r.call(t)},(t.exports=function(t,e,i,n){var r="function"==typeof i;r&&(o(i,"name")||s(i,"name",e)),t[e]!==i&&(r&&(o(i,l)||s(i,l,t[e]?""+t[e]:u.join(String(e)))),t===a?t[e]=i:n?t[e]?t[e]=i:s(t,e,i):(delete t[e],s(t,e,i)))})(Function.prototype,n,function(){return"function"==typeof this&&this[l]||r.call(this)})},function(t,e,i){var n=i(0),r=i(3),s=i(24),o=/"/g,a=function(t,e,i,n){var r=String(s(t)),a="<"+e;return""!==i&&(a+=" "+i+'="'+String(n).replace(o,"&quot;")+'"'),a+">"+r+"</"+e+">"};t.exports=function(e,t){var i={};i[e]=t(a),n(n.P+n.F*r(function(){var t=""[e]('"');return t!==t.toLowerCase()||3<t.split('"').length}),"String",i)}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){var n=i(53),r=i(24);t.exports=function(t){return n(r(t))}},function(t,e,i){var n=i(54),r=i(35),a=i(16),s=i(23),o=i(15),l=i(105),u=Object.getOwnPropertyDescriptor;e.f=i(6)?u:function(t,e){if(t=a(t),e=s(e,!0),l)try{return u(t,e)}catch(t){}if(o(t,e))return r(!n.f.call(t,e),t[e])}},function(t,e,i){var n=i(15),r=i(9),a=i(79)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e){var i=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=i)},function(t,e,i){var a=i(10);t.exports=function(n,r,t){if(a(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,e){return n.call(r,t,e)};case 3:return function(t,e,i){return n.call(r,t,e,i)}}return function(){return n.apply(r,arguments)}}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){"use strict";var n=i(3);t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e,i){var r=i(4);t.exports=function(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?n:i)(t)}},function(t,e,i){var r=i(0),a=i(19),s=i(3);t.exports=function(t,e){var i=(a.Object||{})[t]||Object[t],n={};n[t]=e(i),r(r.S+r.F*s(function(){i(1)}),"Object",n)}},function(t,e,i){var b=i(20),_=i(53),T=i(9),E=i(8),n=i(96);t.exports=function(c,t){var d=1==c,f=2==c,p=3==c,g=4==c,m=6==c,v=5==c||m,y=t||n;return function(t,e,i){for(var n,r,a=T(t),s=_(a),o=b(e,i,3),l=E(s.length),u=0,h=d?y(t,l):f?y(t,0):void 0;u<l;u++)if((v||u in s)&&(r=o(n=s[u],u,a),c))if(d)h[u]=r;else if(r)switch(c){case 3:return!0;case 5:return n;case 6:return u;case 2:h.push(n)}else if(g)return!1;return m?-1:p||g?g:h}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();var r=e.NLError=function(){function l(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),this.code=0,this.level=l.SeverityLevel.All,this.message="",this.nativeMessage="",this.url="",this.httpCode=0,this.nativeCode=0}return n(l,[{key:"isValid",value:function(){return this.code>=l.Code.Device_Related_Error}},{key:"clone",value:function(e,t,i,n){if(this.code=e,this.level=t,this.url=i,this.nativeMessage=n,"number"==typeof e){var r=e%1e3;400<=r&&r<600&&(this.httpCode=r)}var a=l.ErrorCodeString().filter(function(t){if(e>=t.value&&e<t.value+1e3)return!0}).pop();a&&a.name&&(this.message=a.name.replace(/_/g," "))}},{key:"toJSON",value:function(){return{errorCode:this.code,errorLevel:this.level,errorUrl:this.url,errorNativeMessage:this.nativeMessage,errorMsg:this.message,errorHttpCode:this.httpCode,errorNativeCode:this.nativeCode}}},{key:"compare",value:function(t){return this.errorLevel===t.errorLevel&&this.code===t.code&&this.url===t.url&&this.nativeMessage===t.nativeMessage}}],[{key:"create",value:function(e,t,i,n,r){var a=new l;if(a.code=e,a.level=t,a.url=i,a.nativeMessage=n,a.nativeCode=r,"number"==typeof e){var s=e%1e3;400<=s&&s<600&&(a.httpCode=s)}var o=l.ErrorCodeString().filter(function(t){if(e>=t.value&&e<t.value+1e3)return!0}).pop();return o&&o.name&&(a.message=o.name.replace(/_/g," ")),a}}]),l}();r.SeverityLevel={None:0,Fatal:1,Error:2,Warning:3,Info:4,All:15},r.Code={Device_Related_Error:1e4,Incompatible_Codecs_Error:10005,DRM_Not_Supported:10031,DRM_Init_Failed:10032,Platform_Not_Supported:10040,Manifest_Related_Error:2e4,Manifest_Not_For_LTE:20001,Get_Primary_Manifest_Failed:21e3,Get_Single_Bitrate_Manifest_Failed:22e3,KeyOrLicense_Related_Error:3e4,Get_Key_License_Failed:31e3,DRM_Module_Error:32e3,DRM_Module_Error_License_Expired:32001,Chunk_Related_Error:4e4,Get_Chunk_Failed:41e3,Generic_Error:5e4,Start_Playback_Timeout:51e3,Seek_Timeout:52e3,Playback_Generic_Error:53e3},r.ErrorCodeString=function(){var t=[];for(var e in r.Code)r.Code.hasOwnProperty(e)&&t.push({name:e,value:r.Code[e]});return t},r.NetworkDetailCode={Connect_Failed:1,Timeout:2,Security_Error:51,Cookie_Reject_Error:403,Http_Error:404,Manifest_Not_Changed:600,Content_Error:800},r.Basic={M3U8:{MANIFEST_LOAD_ERROR:{code:6010,message:"Failed to load manifest."},MANIFEST_PARSING_ERROR:{code:6020,message:"Failed to parse manifest."},GET_PLAYHEADTIME_FAILED:{code:6030,message:"Failed to get HLS play head time. (Maybe VOD?)"},GET_THUMBNAIL_FAILED:{code:6040,message:"Failed to parse thumbnail manifest."},GET_VTT_FAILED:{code:6050,message:"Failed to get image list."},PARSE_VTT_FAILED:{code:6060,message:"Failed to parse image list."}},DRM:{NOT_SUPPORTED:{code:5e3,message:"DRM not supported"},INVALID_PARAMS:{code:5010,message:"Invalid or missing parameters."},KEY_SESSION_CREATE_ERROR:{code:5020,message:"MediaKey session cannot be created."},KEY_ERROR:{code:5021,message:"MediaKey session error."},CERTIFICATE_ERROR:{code:5030,message:"Certificate error."},CERTIFICATE_OVERFLOW_ERROR:{code:5031,message:"Certificate overflow."},LICENSE_ERROR:{code:5040,message:"License error."}}}},function(t,e,i){"use strict";if(i(6)){var v=i(32),y=i(2),b=i(3),_=i(0),T=i(70),n=i(102),d=i(20),E=i(42),r=i(35),S=i(12),a=i(44),s=i(25),w=i(8),k=i(131),o=i(38),l=i(23),u=i(15),A=i(55),L=i(4),f=i(9),p=i(93),P=i(39),C=i(18),x=i(40).f,g=i(95),h=i(36),c=i(5),m=i(27),I=i(60),R=i(67),D=i(98),N=i(49),O=i(64),M=i(41),U=i(97),F=i(121),B=i(7),G=i(17),j=B.f,H=G.f,V=y.RangeError,W=y.TypeError,z=y.Uint8Array,K="ArrayBuffer",Y="Shared"+K,X="BYTES_PER_ELEMENT",q="prototype",Z=Array[q],Q=n.ArrayBuffer,J=n.DataView,$=m(0),tt=m(2),et=m(3),it=m(4),nt=m(5),rt=m(6),at=I(!0),st=I(!1),ot=D.values,lt=D.keys,ut=D.entries,ht=Z.lastIndexOf,ct=Z.reduce,dt=Z.reduceRight,ft=Z.join,pt=Z.sort,gt=Z.slice,mt=Z.toString,vt=Z.toLocaleString,yt=c("iterator"),bt=c("toStringTag"),_t=h("typed_constructor"),Tt=h("def_constructor"),Et=T.CONSTR,St=T.TYPED,wt=T.VIEW,kt="Wrong length!",At=m(1,function(t,e){return It(R(t,t[Tt]),e)}),Lt=b(function(){return 1===new z(new Uint16Array([1]).buffer)[0]}),Pt=!!z&&!!z[q].set&&b(function(){new z(1).set({})}),Ct=function(t,e){var i=s(t);if(i<0||i%e)throw V("Wrong offset!");return i},xt=function(t){if(L(t)&&St in t)return t;throw W(t+" is not a typed array!")},It=function(t,e){if(!(L(t)&&_t in t))throw W("It is not a typed array constructor!");return new t(e)},Rt=function(t,e){return Dt(R(t,t[Tt]),e)},Dt=function(t,e){for(var i=0,n=e.length,r=It(t,n);i<n;)r[i]=e[i++];return r},Nt=function(t,e,i){j(t,e,{get:function(){return this._d[i]}})},Ot=function(t){var e,i,n,r,a,s,o=f(t),l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,c=g(o);if(null!=c&&!p(c)){for(s=c.call(o),n=[],e=0;!(a=s.next()).done;e++)n.push(a.value);o=n}for(h&&2<l&&(u=d(u,arguments[2],2)),e=0,i=w(o.length),r=It(this,i);e<i;e++)r[e]=h?u(o[e],e):o[e];return r},Mt=function(){for(var t=0,e=arguments.length,i=It(this,e);t<e;)i[t]=arguments[t++];return i},Ut=!!z&&b(function(){vt.call(new z(1))}),Ft=function(){return vt.apply(Ut?gt.call(xt(this)):xt(this),arguments)},Bt={copyWithin:function(t,e){return F.call(xt(this),t,e,2<arguments.length?arguments[2]:void 0)},every:function(t){return it(xt(this),t,1<arguments.length?arguments[1]:void 0)},fill:function(t){return U.apply(xt(this),arguments)},filter:function(t){return Rt(this,tt(xt(this),t,1<arguments.length?arguments[1]:void 0))},find:function(t){return nt(xt(this),t,1<arguments.length?arguments[1]:void 0)},findIndex:function(t){return rt(xt(this),t,1<arguments.length?arguments[1]:void 0)},forEach:function(t){$(xt(this),t,1<arguments.length?arguments[1]:void 0)},indexOf:function(t){return st(xt(this),t,1<arguments.length?arguments[1]:void 0)},includes:function(t){return at(xt(this),t,1<arguments.length?arguments[1]:void 0)},join:function(t){return ft.apply(xt(this),arguments)},lastIndexOf:function(t){return ht.apply(xt(this),arguments)},map:function(t){return At(xt(this),t,1<arguments.length?arguments[1]:void 0)},reduce:function(t){return ct.apply(xt(this),arguments)},reduceRight:function(t){return dt.apply(xt(this),arguments)},reverse:function(){for(var t,e=this,i=xt(e).length,n=Math.floor(i/2),r=0;r<n;)t=e[r],e[r++]=e[--i],e[i]=t;return e},some:function(t){return et(xt(this),t,1<arguments.length?arguments[1]:void 0)},sort:function(t){return pt.call(xt(this),t)},subarray:function(t,e){var i=xt(this),n=i.length,r=o(t,n);return new(R(i,i[Tt]))(i.buffer,i.byteOffset+r*i.BYTES_PER_ELEMENT,w((void 0===e?n:o(e,n))-r))}},Gt=function(t,e){return Rt(this,gt.call(xt(this),t,e))},jt=function(t){xt(this);var e=Ct(arguments[1],1),i=this.length,n=f(t),r=w(n.length),a=0;if(i<r+e)throw V(kt);for(;a<r;)this[e+a]=n[a++]},Ht={entries:function(){return ut.call(xt(this))},keys:function(){return lt.call(xt(this))},values:function(){return ot.call(xt(this))}},Vt=function(t,e){return L(t)&&t[St]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Wt=function(t,e){return Vt(t,e=l(e,!0))?r(2,t[e]):H(t,e)},zt=function(t,e,i){return!(Vt(t,e=l(e,!0))&&L(i)&&u(i,"value"))||u(i,"get")||u(i,"set")||i.configurable||u(i,"writable")&&!i.writable||u(i,"enumerable")&&!i.enumerable?j(t,e,i):(t[e]=i.value,t)};Et||(G.f=Wt,B.f=zt),_(_.S+_.F*!Et,"Object",{getOwnPropertyDescriptor:Wt,defineProperty:zt}),b(function(){mt.call({})})&&(mt=vt=function(){return ft.call(this)});var Kt=a({},Bt);a(Kt,Ht),S(Kt,yt,Ht.values),a(Kt,{slice:Gt,set:jt,constructor:function(){},toString:mt,toLocaleString:Ft}),Nt(Kt,"buffer","b"),Nt(Kt,"byteOffset","o"),Nt(Kt,"byteLength","l"),Nt(Kt,"length","e"),j(Kt,bt,{get:function(){return this[St]}}),t.exports=function(t,c,e,a){var d=t+((a=!!a)?"Clamped":"")+"Array",i="get"+t,s="set"+t,f=y[d],o=f||{},n=f&&C(f),r=!f||!T.ABV,l={},u=f&&f[q],p=function(t,r){j(t,r,{get:function(){return t=r,(e=this._d).v[i](t*c+e.o,Lt);var t,e},set:function(t){return e=r,i=t,n=this._d,a&&(i=(i=Math.round(i))<0?0:255<i?255:255&i),void n.v[s](e*c+n.o,i,Lt);var e,i,n},enumerable:!0})};r?(f=e(function(t,e,i,n){E(t,f,d,"_d");var r,a,s,o,l=0,u=0;if(L(e)){if(!(e instanceof Q||(o=A(e))==K||o==Y))return St in e?Dt(f,e):Ot.call(f,e);r=e,u=Ct(i,c);var h=e.byteLength;if(void 0===n){if(h%c)throw V(kt);if((a=h-u)<0)throw V(kt)}else if(h<(a=w(n)*c)+u)throw V(kt);s=a/c}else s=k(e),r=new Q(a=s*c);for(S(t,"_d",{b:r,o:u,l:a,e:s,v:new J(r)});l<s;)p(t,l++)}),u=f[q]=P(Kt),S(u,"constructor",f)):b(function(){f(1)})&&b(function(){new f(-1)})&&O(function(t){new f,new f(null),new f(1.5),new f(t)},!0)||(f=e(function(t,e,i,n){var r;return E(t,f,d),L(e)?e instanceof Q||(r=A(e))==K||r==Y?void 0!==n?new o(e,Ct(i,c),n):void 0!==i?new o(e,Ct(i,c)):new o(e):St in e?Dt(f,e):Ot.call(f,e):new o(k(e))}),$(n!==Function.prototype?x(o).concat(x(n)):x(o),function(t){t in f||S(f,t,o[t])}),f[q]=u,v||(u.constructor=f));var h=u[yt],g=!!h&&("values"==h.name||null==h.name),m=Ht.values;S(f,_t,!0),S(u,St,d),S(u,wt,!0),S(u,Tt,f),(a?new f(1)[bt]==d:bt in u)||j(u,bt,{get:function(){return d}}),l[d]=f,_(_.G+_.W+_.F*(f!=o),l),_(_.S,d,{BYTES_PER_ELEMENT:c}),_(_.S+_.F*b(function(){o.of.call(f,1)}),d,{from:Ot,of:Mt}),X in u||S(u,X,c),_(_.P,d,Bt),M(d),_(_.P+_.F*Pt,d,{set:jt}),_(_.P+_.F*!g,d,Ht),v||u.toString==mt||(u.toString=mt),_(_.P+_.F*b(function(){new f(1).slice()}),d,{slice:Gt}),_(_.P+_.F*(b(function(){return[1,2].toLocaleString()!=new f([1,2]).toLocaleString()})||!b(function(){u.toLocaleString.call([1,2])})),d,{toLocaleString:Ft}),N[d]=g?h:m,v||g||S(u,yt,m)}}else t.exports=function(){}},function(t,e,i){var a=i(126),n=i(0),r=i(59)("metadata"),s=r.store||(r.store=new(i(129))),o=function(t,e,i){var n=s.get(t);if(!n){if(!i)return;s.set(t,n=new a)}var r=n.get(e);if(!r){if(!i)return;n.set(e,r=new a)}return r};t.exports={store:s,map:o,has:function(t,e,i){var n=o(e,i,!1);return void 0!==n&&n.has(t)},get:function(t,e,i){var n=o(e,i,!1);return void 0===n?void 0:n.get(t)},set:function(t,e,i,n){o(i,n,!0).set(t,e)},keys:function(t,e){var i=o(t,e,!1),n=[];return i&&i.forEach(function(t,e){n.push(e)}),n},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){n(n.S,"Reflect",t)}}},function(t,e,i){var n=i(36)("meta"),r=i(4),a=i(15),s=i(7).f,o=0,l=Object.isExtensible||function(){return!0},u=!i(3)(function(){return l(Object.preventExtensions({}))}),h=function(t){s(t,n,{value:{i:"O"+ ++o,w:{}}})},c=t.exports={KEY:n,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,n)){if(!l(t))return"F";if(!e)return"E";h(t)}return t[n].i},getWeak:function(t,e){if(!a(t,n)){if(!l(t))return!0;if(!e)return!1;h(t)}return t[n].w},onFreeze:function(t){return u&&c.NEED&&l(t)&&!a(t,n)&&h(t),t}}},function(t,e){t.exports=!1},function(t,e,i){var n=i(5)("unscopables"),r=Array.prototype;null==r[n]&&i(12)(r,n,{}),t.exports=function(t){r[n][t]=!0}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();e.FakeEvent=function(){function r(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var i=e||{};for(var n in i)this[n]=i[n];this.bubbles=!1,this.cancelable=!1,this.defaultPrevented=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.currentTarget=null,this.target=null,this.stopped=!1}return n(r,[{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.stopped=!0}},{key:"stopPropagation",value:function(){}}]),r}()},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e,i){var n=i(107),r=i(80);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var n=i(25),r=Math.max,a=Math.min;t.exports=function(t,e){return(t=n(t))<0?r(t+e,0):a(t,e)}},function(t,e,n){var r=n(1),a=n(108),s=n(80),o=n(79)("IE_PROTO"),l=function(){},u="prototype",h=function(){var t,e=n(77)("iframe"),i=s.length;for(e.style.display="none",n(81).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),h=t.F;i--;)delete h[u][s[i]];return h()};t.exports=Object.create||function(t,e){var i;return null!==t?(l[u]=r(t),i=new l,l[u]=null,i[o]=t):i=h(),void 0===e?i:a(i,e)}},function(t,e,i){var n=i(107),r=i(80).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,r)}},function(t,e,i){"use strict";var n=i(2),r=i(7),a=i(6),s=i(5)("species");t.exports=function(t){var e=n[t];a&&e&&!e[s]&&r.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var d=i(20),f=i(119),p=i(93),g=i(1),m=i(8),v=i(95),y={},b={};(e=t.exports=function(t,e,i,n,r){var a,s,o,l,u=r?function(){return t}:v(t),h=d(i,n,e?2:1),c=0;if("function"!=typeof u)throw TypeError(t+" is not iterable!");if(p(u)){for(a=m(t.length);c<a;c++)if((l=e?h(g(s=t[c])[0],s[1]):h(t[c]))===y||l===b)return l}else for(o=u.call(t);!(s=o.next()).done;)if((l=f(o,h,s.value,e))===y||l===b)return l}).BREAK=y,e.RETURN=b},function(t,e,i){var r=i(13);t.exports=function(t,e,i){for(var n in e)r(t,n,e[n],i);return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventManager=void 0;var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),n=i(139);function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=e.EventManager=function(){function t(){a(this,t),this.bindingMap_=new n.MultiMap}return r(t,[{key:"destroy",value:function(){return this.removeAll(),this.bindingMap_=null,Promise.resolve()}},{key:"listen",value:function(t,e,i){var n=new o(t,e,i);try{this.bindingMap_.push(e,n)}catch(t){}}},{key:"unlisten",value:function(t,e){if(null!==this.bindingMap_&&0!==this.bindingMap_.length)for(var i=this.bindingMap_.get(e)||[],n=0;n<i.length;++n){var r=i[n];r.target===t&&(r.unlisten(),this.bindingMap_.remove(e,r))}}},{key:"removeAll",value:function(){try{for(var t=this.bindingMap_.getAll(),e=0;e<t.length;++e)t[e].unlisten();this.bindingMap_.clear()}catch(t){}}}]),t}(),o=function(){function n(t,e,i){a(this,n),this.target=t,this.type=e,this.listener=i;try{this.target.addEventListener(e,i,!1)}catch(t){}}return r(n,[{key:"unlisten",value:function(){this.target&&(this.target.removeEventListener(this.type,this.listener,!1),this.target=null,this.listener=null)}}]),n}();s.EventType={PlayStart:"playStart",PlayEnd:"playEnd",Error:"error",StateChange:"stateChange",ProfileChange:"profileChange",VolumeChange:"volumeChange",TrackChange:"trackChange",TimeUpdate:"timeUpdate",Progress:"progress",RateChange:"rateChange",SeekRangeChange:"seekRangeChange",StreamingEvent:"streaming",ID3Event:"id3",AdEvent:"advertisement",AutoPlayStatus:"autoplaystatus"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={BASE_CONFIG:{withCredentialsFragmentPattern:["/nlds/","/nldsu/","/nlds_vod/","/nldsu_vod/"],streaming:{neulionGapDealing:!(e.Settings=void 0),safeEdgeEndSize:.1,safeEdgeBeginSize:.02,ignoreTextStreamFailures:!0,jumpLargeGaps:!0},preferredAudioLanguage:"",preferredTextLanguage:"",useExternalM3U8Parser:!0,appendXPLAYForStitching:!1,enableLTEmode:!1,dashCC:!0,closedCaption:{label:"English(CC)",language:"en"},debugConfig:{gapTolerance:{firefox:.02,ie:.02,edge:.02,chrome:.03,safari:.1,others:.02}}},SMALL_GAP_TO_START:.01,DEFAULT_LOG_LEVEL:i(103).LogUtil.LogLevel.DEBUG,DISABLE_CONTEXT_MENU:!0,DEBUG_PANEL:{REFRESH_INTERVAL:1e3,ACTIVATE_AREA:1/8,DATA_BUFFER_SIZE:3e5,HOTKEYS:{ctrl:!1,alt:!0,shift:!1}},WEBRTCPLAYER:{DEFAULT_ICE_SERVERS:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]}],WS_NORMAL_CLOSE:3001},BASICPLAYER:{USE_EXTERNAL_M3U8_PARSER:!0},DASHPLAYER:{DEFAULT_SUBTITLE_TRACK_NAME:"Shaka Player TextTrack",SEGMENT_URI_ARRAY_LENGTH:20},LOG_HIGHLIGHTED:{}};e.Settings=n},function(t,e,i){var n=i(7).f,r=i(15),a=i(5)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,a)&&n(t,a,{configurable:!0,value:e})}},function(t,e,i){var s=i(0),n=i(24),o=i(3),l=i(83),r="["+l+"]",a=RegExp("^"+r+r+"*"),u=RegExp(r+r+"*$"),h=function(t,e,i){var n={},r=o(function(){return!!l[t]()||"​"!="​"[t]()}),a=n[t]=r?e(c):l[t];i&&(n[i]=a),s(s.P+s.F*r,"String",n)},c=h.trim=function(t,e){return t=String(n(t)),1&e&&(t=t.replace(a,"")),2&e&&(t=t.replace(u,"")),t};t.exports=h},function(t,e){t.exports={}},function(t,e,i){var n=i(4);t.exports=function(t,e){if(!n(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),r=i(46),a=i(103);e.Logger=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._logger=t,this._logEnabled=!0,this._logHighlighted=!1,r.Settings.LOG_HIGHLIGHTED&&"boolean"==typeof r.Settings.LOG_HIGHLIGHTED[this.constructor.name]&&this.enableHighlight(r.Settings.LOG_HIGHLIGHTED[this.constructor.name])}return n(e,[{key:"setLogLevel",value:function(t){this._logger.setLogLevel(t)}},{key:"enableLogger",value:function(t){this._logEnabled=!!t}},{key:"print",value:function(t,e,i){this._logEnabled&&this._logger.print(this._logHighlighted?a.LogUtil.LogLevel.HIGHLIGHTED:t,e,i)}},{key:"enableHighlight",value:function(t){this._logHighlighted=!!t,this._logEnabled=this._logHighlighted}}]),e}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toDateString=function(t){var e=new Date(1e3*t);return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},e.formatSeconds=function(t){var e=new Date(1970,0,1);return e.setSeconds(t),e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},e.formatBytes=function(t,e){if(0===t)return"0 Byte";var i=e||2,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(i))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]},e.utf8ArrayToStr=function(t){var e=void 0,i=void 0,n=void 0,r="",a=t.length,s=0;for(;s<a;)switch((e=t[s++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(e);break;case 12:case 13:i=t[s++],r+=String.fromCharCode((31&e)<<6|63&i);break;case 14:i=t[s++],n=t[s++],r+=String.fromCharCode((15&e)<<12|(63&i)<<6|(63&n)<<0)}return r},e.hexStringToArray=function(t){var e=[];for(;2<=t.length;)e.push(parseInt(t.substring(0,2),16)),t=t.substring(2,t.length);return e},e.base64EncodeUint8Array=function(t){var e=void 0;if("string"==typeof t)e=t;else if(t instanceof ArrayBuffer)e=String.fromCharCode.apply(null,new Uint8Array(t));else{if(!(t instanceof Uint8Array))return"";e=String.fromCharCode.apply(null,t)}return window.btoa(e)},e.base64DecodeUint8Array=function(t){for(var e=window.atob(t),i=e.length,n=new Uint8Array(new ArrayBuffer(i)),r=0;r<i;r++)n[r]=e.charCodeAt(r);return n},e.stringToArray=function(t){for(var e=new ArrayBuffer(2*t.length),i=new Uint16Array(e),n=0,r=t.length;n<r;n++)i[n]=t.charCodeAt(n);return i},e.arrayToString=function(t){var e=new Uint16Array(t.buffer);return String.fromCharCode.apply(null,e)},e.endsWith=function(t,e,i){(null==i||i>t.length)&&(i=t.length);return t.substring(i-e.length,i)===e}},function(t,e,i){var n=i(21);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){var r=i(21),a=i(5)("toStringTag"),s="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),a))?i:s?r(e):"Object"==(n=r(e))&&"function"==typeof e.callee?"Arguments":n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.mergeObject=function(t,e){var i={};for(var n in t)i[n]=t[n];for(var r in e)null==i[r]&&(i[r]=e[r]);return i},e.isEmpty=function(t){if(null==t)return!0;if(0<t.length)return!1;if(0===t.length)return!0;if("object"!==(void 0===t?"undefined":n(t)))return!0;for(var e in t)if(r.call(t,e))return!1;return!0},e.getKeyByValue=function(t,e){for(var i in t)if(t[i]===e)return i;return""},e.find=function(t,e,i){if(!t||t.length<=0)return null;for(var n=t.length,r=0;r<n;r++)if(t[r][e]===i)return t[r];return null};var r=Object.prototype.hasOwnProperty},function(t,e,i){"use strict";function n(t,e){return e=e||"",t?n(--t,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+e):e}Object.defineProperty(e,"__esModule",{value:!0}),e.createXHR=function(s){var t="";"string"==typeof s&&(t=s,s={});s.url=s.url||t,s.responseType=s.responseType||"",s.method=s.method||"GET",s.params=s.params||null;var o=null,e=new Promise(function(e,i){var t=s.responseType,n=s.url,r=s.method;if((o=new XMLHttpRequest).responseType=t,o.addEventListener("load",function(t){200<=o.status&&o.status<=299?e(o.response):i(o.status)},!1),o.addEventListener("error",function(){i(o.status)},!1),o.open(r,n,!0),s.headers)for(var a in s.headers)o.setRequestHeader(a,s.headers[a])});return e.getXHR=function(){return o},e.abort=function(){o.abort()},o.send(s.params),e},e.sendWithIframe=function(t){var e="url_iframe_"+n(16),i=document.getElementById(e);i||((i=document.createElement("iframe")).style.display="none",i.id=e,document.body.appendChild(i));i.src=t,i.attachEvent?i.attachEvent("onload",function(){i.parentNode.removeChild(i)}):i.onload=function(){i.parentNode.removeChild(i)}},e.sendWithScript=function(t){var e="url_script_"+n(16),i=document.getElementById(e);i||(i=document.createElement("script"),document.body.appendChild(i));i.src=t,i.attachEvent?i.attachEvent("onload",function(){i.parentNode.removeChild(i)}):i.onload=function(){i.parentNode.removeChild(i)}},e.createXHREx=function(s,o){var t="";"string"==typeof s&&(t=s,s={});s.url=s.url||t,s.responseType=s.responseType||"",s.method=s.method||"GET",s.params=s.params||null;var l=null,e=new Promise(function(e,i){var t=s.responseType,n=s.url,r=s.method;if((l=new XMLHttpRequest).responseType=t,l.addEventListener("load",function(t){200<=l.status&&l.status<=299?e({response:l.response,userdata:o}):i({response:l.status,userdata:o})},!1),l.addEventListener("error",function(){i({response:l.status,userdata:o})},!1),l.open(r,n,!0),s.headers)for(var a in s.headers)l.setRequestHeader(a,s.headers[a])});return e.getXHR=function(){return l},e.abort=function(){l.abort()},l.send(s.params),e}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n=i(19),r=i(2),a="__core-js_shared__",s=r[a]||(r[a]={});(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:n.version,mode:i(32)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var l=i(16),u=i(8),h=i(38);t.exports=function(o){return function(t,e,i){var n,r=l(t),a=u(r.length),s=h(i,a);if(o&&e!=e){for(;s<a;)if((n=r[s++])!=n)return!0}else for(;s<a;s++)if((o||s in r)&&r[s]===e)return o||s||0;return!o&&-1}}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var n=i(21);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,i){var n=i(4),r=i(21),a=i(5)("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[a])?!!e:"RegExp"==r(t))}},function(t,e,i){var a=i(5)("iterator"),s=!1;try{var n=[7][a]();n.return=function(){s=!0},Array.from(n,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!s)return!1;var i=!1;try{var n=[7],r=n[a]();r.next=function(){return{done:i=!0}},n[a]=function(){return r},t(n)}catch(t){}return i}},function(t,e,i){"use strict";var n=i(1);t.exports=function(){var t=n(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,i){"use strict";var o=i(12),l=i(13),u=i(3),h=i(24),c=i(5);t.exports=function(e,t,i){var n=c(e),r=i(h,n,""[e]),a=r[0],s=r[1];u(function(){var t={};return t[n]=function(){return 7},7!=""[e](t)})&&(l(String.prototype,e,a),o(RegExp.prototype,n,2==t?function(t,e){return s.call(t,this,e)}:function(t){return s.call(t,this)}))}},function(t,e,i){var r=i(1),a=i(10),s=i(5)("species");t.exports=function(t,e){var i,n=r(t).constructor;return void 0===n||null==(i=r(n)[s])?e:a(i)}},function(t,e,i){var n=i(2).navigator;t.exports=n&&n.userAgent||""},function(t,e,i){"use strict";var v=i(2),y=i(0),b=i(13),_=i(44),T=i(31),E=i(43),S=i(42),w=i(4),k=i(3),A=i(64),L=i(47),P=i(84);t.exports=function(n,t,e,i,r,a){var s=v[n],o=s,l=r?"set":"add",u=o&&o.prototype,h={},c=function(t){var i=u[t];b(u,t,"delete"==t?function(t){return!(a&&!w(t))&&i.call(this,0===t?0:t)}:"has"==t?function(t){return!(a&&!w(t))&&i.call(this,0===t?0:t)}:"get"==t?function(t){return a&&!w(t)?void 0:i.call(this,0===t?0:t)}:"add"==t?function(t){return i.call(this,0===t?0:t),this}:function(t,e){return i.call(this,0===t?0:t,e),this})};if("function"==typeof o&&(a||u.forEach&&!k(function(){(new o).entries().next()}))){var d=new o,f=d[l](a?{}:-0,1)!=d,p=k(function(){d.has(1)}),g=A(function(t){new o(t)}),m=!a&&k(function(){for(var t=new o,e=5;e--;)t[l](e,e);return!t.has(-0)});g||(((o=t(function(t,e){S(t,o,n);var i=P(new s,t,o);return null!=e&&E(e,r,i[l],i),i})).prototype=u).constructor=o),(p||m)&&(c("delete"),c("has"),r&&c("get")),(m||f)&&c(l),a&&u.clear&&delete u.clear}else o=i.getConstructor(t,n,r,l),_(o.prototype,e),T.NEED=!0;return L(o,n),h[n]=o,y(y.G+y.W+y.F*(o!=s),h),a||i.setStrong(o,n,r),o}},function(t,e,i){for(var n,r=i(2),a=i(12),s=i(36),o=s("typed_array"),l=s("view"),u=!(!r.ArrayBuffer||!r.DataView),h=u,c=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");c<9;)(n=r[d[c++]])?(a(n.prototype,o,!0),a(n.prototype,l,!0)):h=!1;t.exports={ABV:u,CONSTR:h,TYPED:o,VIEW:l}},function(t,e,i){"use strict";t.exports=i(32)||!i(3)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete i(2)[t]})},function(t,e,i){"use strict";var n=i(0);t.exports=function(t){n(n.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,i){"use strict";var n=i(0),s=i(10),o=i(20),l=i(43);t.exports=function(t){n(n.S,t,{from:function(t){var e,i,n,r,a=arguments[1];return s(this),(e=void 0!==a)&&s(a),null==t?new this:(i=[],e?(n=0,r=o(a,arguments[2],2),l(t,!1,function(t){i.push(r(t,n++))})):l(t,!1,i.push,i),new this(i))}})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.validateURL=o,e.isAbsoluteUrl=function(t){return"string"==typeof t&&a.default.isWebUri(t)},e.getPath=function(t){var e=t.split("?")[0];return e.substr(0,e.lastIndexOf("/")+1)},e.getExtension=l,e.detectPlayerType=function(t,e,i){if(null==t||""===t||!o(t))return s.AdaptivePlayer.PlayerType.UNKNOWN;{if(void 0===e){if(-1!==t.indexOf("ws://")||-1!==t.indexOf("wss://"))return s.AdaptivePlayer.PlayerType.WEBRTC;var n=l(t);return"m3u8"===n||"m3u"===n?i&&"Safari"===s.AdaptivePlayer.browserType||"Mobile Safari"===s.AdaptivePlayer.browserType?s.AdaptivePlayer.PlayerType.NATIVE:s.AdaptivePlayer.PlayerType.HLSJS:"mpd"===n?s.AdaptivePlayer.PlayerType.SHAKA:"mp4"===n||"webm"===n||"ogg"===n?s.AdaptivePlayer.PlayerType.NATIVE:s.AdaptivePlayer.PlayerType.UNKNOWN}switch(e){case s.AdaptivePlayer.Protocol.HTTP:return s.AdaptivePlayer.PlayerType.NATIVE;case s.AdaptivePlayer.Protocol.WEBRTC:return s.AdaptivePlayer.PlayerType.WEBRTC;case s.AdaptivePlayer.Protocol.DASH:return s.AdaptivePlayer.PlayerType.SHAKA;case s.AdaptivePlayer.Protocol.HLS:return"Safari"===s.AdaptivePlayer.browserType||"Mobile Safari"===s.AdaptivePlayer.browserType?s.AdaptivePlayer.PlayerType.NATIVE:s.AdaptivePlayer.PlayerType.HLSJS;default:return s.AdaptivePlayer.PlayerType.UNKNOWN}}};var n,r=i(349),a=(n=r)&&n.__esModule?n:{default:n},s=i(11);function o(t){return a.default.isWebUri(t)}function l(t){if(!t)return"";var e=t.split("?")[0].split(".");return 1===e.length||""===e[0]&&2===e.length?"":e.pop().toLowerCase()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerBase=void 0;var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=i(34),s=i(11),o=i(51);e.PlayerBase=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e._logger));return i._video=t,i._eventHandler=e,i._cuepointManager=e._cuepointManager,i._statisticManager=e._statisticManager,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,o.Logger),r(n,[{key:"destroy",value:function(){}},{key:"configure",value:function(t){}},{key:"load",value:function(t,e){}},{key:"unload",value:function(){}},{key:"gotoLive",value:function(){}},{key:"selectTrack",value:function(t){}},{key:"setAdaptation",value:function(t){}},{key:"getStats",value:function(){return{bytesLoaded:NaN,bandwidth:NaN,bitrate:NaN,switchInfo:NaN,switchHistory:NaN,isAutoSwitch:!0,livePointOffest:-1}}},{key:"isLive",value:function(){}},{key:"videoTracks",value:function(){return[]}},{key:"audioTracks",value:function(){return[]}},{key:"textTracks",value:function(){return[]}},{key:"ccTracks",value:function(){return[]}},{key:"getThumbnailStreams",value:function(){}},{key:"getThumbnailStreamImages",value:function(){}},{key:"notifyProfileChanged",value:function(t){if(0!==t.videoHeight&&0!==t.videoWidth){var e={videoWidth:t.videoWidth,videoHeight:t.videoHeight,details:{videoWidth:t.videoWidth,videoHeight:t.videoHeight}};this._eventHandler.dispatchEvent(new a.FakeEvent(s.AdaptivePlayer.EventType.ProfileChange,e)),this.print(s.AdaptivePlayer.LogLevel.DEBUG,"PlayerBase","Fired ProfileChange: "+JSON.stringify(e))}}},{key:"notifyPlayStarted",value:function(){}},{key:"currentTime",get:function(){},set:function(t){}},{key:"sampleDuration",get:function(){return 0}}]),n}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NLTrack=void 0;var n,r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=i(11),o=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(56)),a=i(362),l=(n=a)&&n.__esModule?n:{default:n};e.NLTrack=function(){function a(t,e,i,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this._base=e,this._player=n.player,this._type=i,this.kind=t,this.active=!1,i===s.AdaptivePlayer.PlayerType.SHAKA)("VIDEO"===t||"AUDIO"===t||"TEXT"===t&&n.flag)&&(this.active=e.active),this.language=l.default.toISO6392(e.language)||"Unknown",this.id=e.id||"",this.name=e.displayName||l.default.getName(e.language),this.bandwidth=e.videoBandwidth||e.bandwidth||0,t===s.AdaptivePlayer.Kind.VIDEO&&(this.width=e.width,this.height=e.height);else if(i===s.AdaptivePlayer.PlayerType.HLSJS)this.language=e.lang||e.language||"Unknown",this.name=e.name||e.label||e.language||"Unknown",this.id=n.id,this.bandwidth=e.bitrate||"",(t===s.AdaptivePlayer.Kind.VIDEO&&(n.currentLevel===n.id||1===n.levels.length)||t===s.AdaptivePlayer.Kind.AUDIO&&n.audioTrack===n.id||t===s.AdaptivePlayer.Kind.TEXT&&n.subtitleTrack===n.id)&&(this.active=!0),t===s.AdaptivePlayer.Kind.VIDEO&&null!=e.height&&null!=e.width&&(this.width=e.width,this.height=e.height);else if(i===s.AdaptivePlayer.PlayerType.NATIVE)if(this.language=e.language,this.name=e.label||e.language||"Unknown",this.id="CC1"===this.name?"cc1":n.id,t===s.AdaptivePlayer.Kind.VIDEO||t===s.AdaptivePlayer.Kind.AUDIO)e.enabled&&(this.active=!0);else{if(!o.isEmpty(n.ccInfos))for(var r in n.ccInfos){this.language=n.ccInfos[r].lang,this.name=n.ccInfos[r].name;break}"showing"===e.mode&&(this.active=!0)}else i===s.AdaptivePlayer.PlayerType.WEBRTC&&(this.bandwidth=e||0,0===n.id&&(this.active=!0))}return r(a,[{key:"select",value:function(t){this._player.selectTrack(this,!!t)}},{key:"base",get:function(){return this._base}},{key:"type",get:function(){return this._type}}]),a}()},function(t,e,i){var n=i(4),r=i(2).document,a=n(r)&&n(r.createElement);t.exports=function(t){return a?r.createElement(t):{}}},function(t,e,i){var n=i(2),r=i(19),a=i(32),s=i(106),o=i(7).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=a?{}:n.Symbol||{});"_"==t.charAt(0)||t in e||o(e,t,{value:s.f(t)})}},function(t,e,i){var n=i(59)("keys"),r=i(36);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var n=i(2).document;t.exports=n&&n.documentElement},function(t,e,r){var i=r(4),n=r(1),a=function(t,e){if(n(t),!i(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,i,n){try{(n=r(20)(Function.call,r(17).f(Object.prototype,"__proto__").set,2))(t,[]),i=!(t instanceof Array)}catch(t){i=!0}return function(t,e){return a(t,e),i?t.__proto__=e:n(t,e),t}}({},!1):void 0),check:a}},function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,e,i){var a=i(4),s=i(82).set;t.exports=function(t,e,i){var n,r=e.constructor;return r!==i&&"function"==typeof r&&(n=r.prototype)!==i.prototype&&a(n)&&s&&s(t,n),t}},function(t,e,i){"use strict";var r=i(25),a=i(24);t.exports=function(t){var e=String(a(this)),i="",n=r(t);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;0<n;(n>>>=1)&&(e+=e))1&n&&(i+=e);return i}},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e){var i=Math.expm1;t.exports=!i||22025.465794806718<i(10)||i(10)<22025.465794806718||-2e-17!=i(-2e-17)?function(t){return 0==(t=+t)?t:-1e-6<t&&t<1e-6?t+t*t/2:Math.exp(t)-1}:i},function(t,e,i){var l=i(25),u=i(24);t.exports=function(o){return function(t,e){var i,n,r=String(u(t)),a=l(e),s=r.length;return a<0||s<=a?o?"":void 0:(i=r.charCodeAt(a))<55296||56319<i||a+1===s||(n=r.charCodeAt(a+1))<56320||57343<n?o?r.charAt(a):i:o?r.slice(a,a+2):n-56320+(i-55296<<10)+65536}}},function(t,e,i){"use strict";var b=i(32),_=i(0),T=i(13),E=i(12),S=i(49),w=i(90),k=i(47),A=i(18),L=i(5)("iterator"),P=!([].keys&&"next"in[].keys()),C="values",x=function(){return this};t.exports=function(t,e,i,n,r,a,s){w(i,e,n);var o,l,u,h=function(t){if(!P&&t in p)return p[t];switch(t){case"keys":case C:return function(){return new i(this,t)}}return function(){return new i(this,t)}},c=e+" Iterator",d=r==C,f=!1,p=t.prototype,g=p[L]||p["@@iterator"]||r&&p[r],m=g||h(r),v=r?d?h("entries"):m:void 0,y="Array"==e&&p.entries||g;if(y&&(u=A(y.call(new t)))!==Object.prototype&&u.next&&(k(u,c,!0),b||"function"==typeof u[L]||E(u,L,x)),d&&g&&g.name!==C&&(f=!0,m=function(){return g.call(this)}),b&&!s||!P&&!f&&p[L]||E(p,L,m),S[e]=m,S[c]=x,r)if(o={values:d?m:h(C),keys:a?m:h("keys"),entries:v},s)for(l in o)l in p||T(p,l,o[l]);else _(_.P+_.F*(P||f),e,o);return o}},function(t,e,i){"use strict";var n=i(39),r=i(35),a=i(47),s={};i(12)(s,i(5)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(s,{next:r(1,i)}),a(t,e+" Iterator")}},function(t,e,i){var n=i(63),r=i(24);t.exports=function(t,e,i){if(n(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(r(t))}},function(t,e,i){var n=i(5)("match");t.exports=function(e){var i=/./;try{"/./"[e](i)}catch(t){try{return i[n]=!1,!"/./"[e](i)}catch(t){}}return!0}},function(t,e,i){var n=i(49),r=i(5)("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||a[r]===t)}},function(t,e,i){"use strict";var n=i(7),r=i(35);t.exports=function(t,e,i){e in t?n.f(t,e,r(0,i)):t[e]=i}},function(t,e,i){var n=i(55),r=i(5)("iterator"),a=i(49);t.exports=i(19).getIteratorMethod=function(t){if(null!=t)return t[r]||t["@@iterator"]||a[n(t)]}},function(t,e,i){var n=i(238);t.exports=function(t,e){return new(n(t))(e)}},function(t,e,i){"use strict";var o=i(9),l=i(38),u=i(8);t.exports=function(t){for(var e=o(this),i=u(e.length),n=arguments.length,r=l(1<n?arguments[1]:void 0,i),a=2<n?arguments[2]:void 0,s=void 0===a?i:l(a,i);r<s;)e[r++]=t;return e}},function(t,e,i){"use strict";var n=i(33),r=i(122),a=i(49),s=i(16);t.exports=i(89)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),a.Arguments=a.Array,n("keys"),n("values"),n("entries")},function(t,e,i){var n,r,a,s=i(20),o=i(112),l=i(81),u=i(77),h=i(2),c=h.process,d=h.setImmediate,f=h.clearImmediate,p=h.MessageChannel,g=h.Dispatch,m=0,v={},y="onreadystatechange",b=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},_=function(t){b.call(t.data)};d&&f||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return v[++m]=function(){o("function"==typeof t?t:Function(t),e)},n(m),m},f=function(t){delete v[t]},"process"==i(21)(c)?n=function(t){c.nextTick(s(b,t,1))}:g&&g.now?n=function(t){g.now(s(b,t,1))}:p?(a=(r=new p).port2,r.port1.onmessage=_,n=s(a.postMessage,a,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(n=function(t){h.postMessage(t+"","*")},h.addEventListener("message",_,!1)):n=y in u("script")?function(t){l.appendChild(u("script"))[y]=function(){l.removeChild(this),b.call(t)}}:function(t){setTimeout(s(b,t,1),0)}),t.exports={set:d,clear:f}},function(t,e,i){var o=i(2),l=i(99).set,u=o.MutationObserver||o.WebKitMutationObserver,h=o.process,c=o.Promise,d="process"==i(21)(h);t.exports=function(){var i,n,r,t=function(){var t,e;for(d&&(t=h.domain)&&t.exit();i;){e=i.fn,i=i.next;try{e()}catch(t){throw i?r():n=void 0,t}}n=void 0,t&&t.enter()};if(d)r=function(){h.nextTick(t)};else if(!u||o.navigator&&o.navigator.standalone)if(c&&c.resolve){var e=c.resolve(void 0);r=function(){e.then(t)}}else r=function(){l.call(o,t)};else{var a=!0,s=document.createTextNode("");new u(t).observe(s,{characterData:!0}),r=function(){s.data=a=!a}}return function(t){var e={fn:t,next:void 0};n&&(n.next=e),i||(i=e,r()),n=e}}},function(t,e,i){"use strict";var r=i(10);function n(t){var i,n;this.promise=new t(function(t,e){if(void 0!==i||void 0!==n)throw TypeError("Bad Promise constructor");i=t,n=e}),this.resolve=r(i),this.reject=r(n)}t.exports.f=function(t){return new n(t)}},function(t,e,i){"use strict";var n=i(2),r=i(6),a=i(32),s=i(70),o=i(12),l=i(44),u=i(3),h=i(42),c=i(25),d=i(8),f=i(131),p=i(40).f,g=i(7).f,m=i(97),v=i(47),y="ArrayBuffer",b="DataView",_="prototype",T="Wrong index!",E=n[y],S=n[b],w=n.Math,k=n.RangeError,A=n.Infinity,L=E,P=w.abs,C=w.pow,x=w.floor,I=w.log,R=w.LN2,D="byteLength",N="byteOffset",O=r?"_b":"buffer",M=r?"_l":D,U=r?"_o":N;function F(t,e,i){var n,r,a,s=new Array(i),o=8*i-e-1,l=(1<<o)-1,u=l>>1,h=23===e?C(2,-24)-C(2,-77):0,c=0,d=t<0||0===t&&1/t<0?1:0;for((t=P(t))!=t||t===A?(r=t!=t?1:0,n=l):(n=x(I(t)/R),t*(a=C(2,-n))<1&&(n--,a*=2),2<=(t+=1<=n+u?h/a:h*C(2,1-u))*a&&(n++,a/=2),l<=n+u?(r=0,n=l):1<=n+u?(r=(t*a-1)*C(2,e),n+=u):(r=t*C(2,u-1)*C(2,e),n=0));8<=e;s[c++]=255&r,r/=256,e-=8);for(n=n<<e|r,o+=e;0<o;s[c++]=255&n,n/=256,o-=8);return s[--c]|=128*d,s}function B(t,e,i){var n,r=8*i-e-1,a=(1<<r)-1,s=a>>1,o=r-7,l=i-1,u=t[l--],h=127&u;for(u>>=7;0<o;h=256*h+t[l],l--,o-=8);for(n=h&(1<<-o)-1,h>>=-o,o+=e;0<o;n=256*n+t[l],l--,o-=8);if(0===h)h=1-s;else{if(h===a)return n?NaN:u?-A:A;n+=C(2,e),h-=s}return(u?-1:1)*n*C(2,h-e)}function G(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function j(t){return[255&t]}function H(t){return[255&t,t>>8&255]}function V(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function W(t){return F(t,52,8)}function z(t){return F(t,23,4)}function K(t,e,i){g(t[_],e,{get:function(){return this[i]}})}function Y(t,e,i,n){var r=f(+i);if(r+e>t[M])throw k(T);var a=t[O]._b,s=r+t[U],o=a.slice(s,s+e);return n?o:o.reverse()}function X(t,e,i,n,r,a){var s=f(+i);if(s+e>t[M])throw k(T);for(var o=t[O]._b,l=s+t[U],u=n(+r),h=0;h<e;h++)o[l+h]=u[a?h:e-h-1]}if(s.ABV){if(!u(function(){E(1)})||!u(function(){new E(-1)})||u(function(){return new E,new E(1.5),new E(NaN),E.name!=y})){for(var q,Z=(E=function(t){return h(this,E),new L(f(t))})[_]=L[_],Q=p(L),J=0;Q.length>J;)(q=Q[J++])in E||o(E,q,L[q]);a||(Z.constructor=E)}var $=new S(new E(2)),tt=S[_].setInt8;$.setInt8(0,2147483648),$.setInt8(1,2147483649),!$.getInt8(0)&&$.getInt8(1)||l(S[_],{setInt8:function(t,e){tt.call(this,t,e<<24>>24)},setUint8:function(t,e){tt.call(this,t,e<<24>>24)}},!0)}else E=function(t){h(this,E,y);var e=f(t);this._b=m.call(new Array(e),0),this[M]=e},S=function(t,e,i){h(this,S,b),h(t,E,b);var n=t[M],r=c(e);if(r<0||n<r)throw k("Wrong offset!");if(n<r+(i=void 0===i?n-r:d(i)))throw k("Wrong length!");this[O]=t,this[U]=r,this[M]=i},r&&(K(E,D,"_l"),K(S,"buffer","_b"),K(S,D,"_l"),K(S,N,"_o")),l(S[_],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var e=Y(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Y(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return B(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return B(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){X(this,1,t,j,e)},setUint8:function(t,e){X(this,1,t,j,e)},setInt16:function(t,e){X(this,2,t,H,e,arguments[2])},setUint16:function(t,e){X(this,2,t,H,e,arguments[2])},setInt32:function(t,e){X(this,4,t,V,e,arguments[2])},setUint32:function(t,e){X(this,4,t,V,e,arguments[2])},setFloat32:function(t,e){X(this,4,t,z,e,arguments[2])},setFloat64:function(t,e){X(this,8,t,W,e,arguments[2])}});v(E,y),v(S,b),o(S[_],s.VIEW,!0),e[y]=E,e[b]=S},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();var a=null;(e.LogUtil=function(){function r(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),a||(a=this),this._level=r.LogLevel.INFO,a}return n(r,[{key:"print",value:function(t,e,i){if(!(t<this._level)){var n="["+(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")+"] "+e+": "+i;switch(t){case r.LogLevel.TRACE:n="[TRACE] "+n,console.trace(n);break;case r.LogLevel.DEBUG:n="[DEBUG] "+n,console.debug(n);break;case r.LogLevel.INFO:n="[INFO] "+n,console.info(n);break;case r.LogLevel.WARNING:n="[WARNING] "+n,console.warn(n);break;case r.LogLevel.ERROR:n="[ERROR] "+n,console.error(n);break;case r.LogLevel.HIGHLIGHTED:n="[HIGHLIGHTED] "+n,console.log(n)}}}},{key:"setLogLevel",value:function(t){this._level=t}}]),r}()).LogLevel={TRACE:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,HIGHLIGHTED:99}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.probePlatformSupport=function(){window.MediaSource=window.MediaSource||window.WebKitMediaSource;var t=!(!window.MediaSource||"function"!=typeof window.MediaSource.isTypeSupported||!window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')),e=(new a.default).getBrowser(),i="IE"!==e.name||"IE"===e.name&&11<=e.major;return t&&i},e.probeWebRTCSupport=function(){var e=!1;return["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(t){e||t in window&&(e=!0)}),e},e.generateUUID=s,e.getDeviceId=function(){var t=s();if(function(){var t="test";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}}()){var e=localStorage.getItem("deviceId");e?t=e:localStorage.setItem("deviceId",t)}return t};var n,r=i(140),a=(n=r)&&n.__esModule?n:{default:n};function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}},function(t,e,i){t.exports=!i(6)&&!i(3)(function(){return 7!=Object.defineProperty(i(77)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){e.f=i(5)},function(t,e,i){var s=i(15),o=i(16),l=i(60)(!1),u=i(79)("IE_PROTO");t.exports=function(t,e){var i,n=o(t),r=0,a=[];for(i in n)i!=u&&s(n,i)&&a.push(i);for(;e.length>r;)s(n,i=e[r++])&&(~l(a,i)||a.push(i));return a}},function(t,e,i){var s=i(7),o=i(1),l=i(37);t.exports=i(6)?Object.defineProperties:function(t,e){o(t);for(var i,n=l(e),r=n.length,a=0;a<r;)s.f(t,i=n[a++],e[i]);return t}},function(t,e,i){var n=i(16),r=i(40).f,a={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return s&&"[object Window]"==a.call(t)?function(t){try{return r(t)}catch(t){return s.slice()}}(t):r(n(t))}},function(t,e,i){"use strict";var d=i(37),f=i(61),p=i(54),g=i(9),m=i(53),r=Object.assign;t.exports=!r||i(3)(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=r({},t)[i]||Object.keys(r({},e)).join("")!=n})?function(t,e){for(var i=g(t),n=arguments.length,r=1,a=f.f,s=p.f;r<n;)for(var o,l=m(arguments[r++]),u=a?d(l).concat(a(l)):d(l),h=u.length,c=0;c<h;)s.call(l,o=u[c++])&&(i[o]=l[o]);return i}:r},function(t,e,i){"use strict";var a=i(10),s=i(4),o=i(112),l=[].slice,u={};t.exports=Function.bind||function(e){var i=a(this),n=l.call(arguments,1),r=function(){var t=n.concat(l.call(arguments));return this instanceof r?function(t,e,i){if(!(e in u)){for(var n=[],r=0;r<e;r++)n[r]="a["+r+"]";u[e]=Function("F,a","return new F("+n.join(",")+")")}return u[e](t,i)}(i,t.length,t):o(i,t,e)};return s(i.prototype)&&(r.prototype=i.prototype),r}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var n=i(2).parseInt,r=i(48).trim,a=i(83),s=/^[-+]?0[xX]/;t.exports=8!==n(a+"08")||22!==n(a+"0x16")?function(t,e){var i=r(String(t),3);return n(i,e>>>0||(s.test(i)?16:10))}:n},function(t,e,i){var n=i(2).parseFloat,r=i(48).trim;t.exports=1/n(i(83)+"-0")!=-1/0?function(t){var e=r(String(t),3),i=n(e);return 0===i&&"-"==e.charAt(0)?-0:i}:n},function(t,e,i){var n=i(21);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=n(t))throw TypeError(e);return+t}},function(t,e,i){var n=i(4),r=Math.floor;t.exports=function(t){return!n(t)&&isFinite(t)&&r(t)===t}},function(t,e){t.exports=Math.log1p||function(t){return-1e-8<(t=+t)&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,i){var a=i(86),n=Math.pow,s=n(2,-52),o=n(2,-23),l=n(2,127)*(2-o),u=n(2,-126);t.exports=Math.fround||function(t){var e,i,n=Math.abs(t),r=a(t);return n<u?r*(n/u/o+1/s-1/s)*u*o:l<(i=(e=(1+o/s)*n)-(e-n))||i!=i?r*(1/0):r*i}},function(t,e,i){var a=i(1);t.exports=function(e,t,i,n){try{return n?t(a(i)[0],i[1]):t(i)}catch(t){var r=e.return;throw void 0!==r&&a(r.call(e)),t}}},function(t,e,i){var h=i(10),c=i(9),d=i(53),f=i(8);t.exports=function(t,e,i,n,r){h(e);var a=c(t),s=d(a),o=f(a.length),l=r?o-1:0,u=r?-1:1;if(i<2)for(;;){if(l in s){n=s[l],l+=u;break}if(l+=u,r?l<0:o<=l)throw TypeError("Reduce of empty array with no initial value")}for(;r?0<=l:l<o;l+=u)l in s&&(n=e(n,s[l],l,a));return n}},function(t,e,i){"use strict";var u=i(9),h=i(38),c=i(8);t.exports=[].copyWithin||function(t,e){var i=u(this),n=c(i.length),r=h(t,n),a=h(e,n),s=2<arguments.length?arguments[2]:void 0,o=Math.min((void 0===s?n:h(s,n))-a,n-r),l=1;for(a<r&&r<a+o&&(l=-1,a+=o-1,r+=o-1);0<o--;)a in i?i[r]=i[a]:delete i[r],r+=l,a+=l;return i}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){i(6)&&"g"!=/./g.flags&&i(7).f(RegExp.prototype,"flags",{configurable:!0,get:i(65)})},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,i){var n=i(1),r=i(4),a=i(101);t.exports=function(t,e){if(n(t),r(e)&&e.constructor===t)return e;var i=a.f(t);return(0,i.resolve)(e),i.promise}},function(t,e,i){"use strict";var n=i(127),r=i(50);t.exports=i(69)("Map",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{get:function(t){var e=n.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return n.def(r(this,"Map"),0===t?0:t,e)}},n,!0)},function(t,e,i){"use strict";var s=i(7).f,o=i(39),l=i(44),u=i(20),h=i(42),c=i(43),n=i(89),r=i(122),a=i(41),d=i(6),f=i(31).fastKey,p=i(50),g=d?"_s":"size",m=function(t,e){var i,n=f(e);if("F"!==n)return t._i[n];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,a,i,n){var r=t(function(t,e){h(t,r,a,"_i"),t._t=a,t._i=o(null),t._f=void 0,t._l=void 0,t[g]=0,null!=e&&c(e,i,t[n],t)});return l(r.prototype,{clear:function(){for(var t=p(this,a),e=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete e[i.i];t._f=t._l=void 0,t[g]=0},delete:function(t){var e=p(this,a),i=m(e,t);if(i){var n=i.n,r=i.p;delete e._i[i.i],i.r=!0,r&&(r.n=n),n&&(n.p=r),e._f==i&&(e._f=n),e._l==i&&(e._l=r),e[g]--}return!!i},forEach:function(t){p(this,a);for(var e,i=u(t,1<arguments.length?arguments[1]:void 0,3);e=e?e.n:this._f;)for(i(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!m(p(this,a),t)}}),d&&s(r.prototype,"size",{get:function(){return p(this,a)[g]}}),r},def:function(t,e,i){var n,r,a=m(t,e);return a?a.v=i:(t._l=a={i:r=f(e,!0),k:e,v:i,p:n=t._l,n:void 0,r:!1},t._f||(t._f=a),n&&(n.n=a),t[g]++,"F"!==r&&(t._i[r]=a)),t},getEntry:m,setStrong:function(t,i,e){n(t,i,function(t,e){this._t=p(t,i),this._k=e,this._l=void 0},function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?r(0,"keys"==e?i.k:"values"==e?i.v:[i.k,i.v]):(t._t=void 0,r(1))},e?"entries":"values",!e,!0),a(i)}}},function(t,e,i){"use strict";var n=i(127),r=i(50);t.exports=i(69)("Set",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return n.def(r(this,"Set"),t=0===t?0:t,t)}},n)},function(t,e,i){"use strict";var a,n=i(27)(0),s=i(13),r=i(31),o=i(110),l=i(130),u=i(4),h=i(3),c=i(50),d="WeakMap",f=r.getWeak,p=Object.isExtensible,g=l.ufstore,m={},v=function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},y={get:function(t){if(u(t)){var e=f(t);return!0===e?g(c(this,d)).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(c(this,d),t,e)}},b=t.exports=i(69)(d,v,y,l,!0,!0);h(function(){return 7!=(new b).set((Object.freeze||Object)(m),7).get(m)})&&(o((a=l.getConstructor(v,d)).prototype,y),r.NEED=!0,n(["delete","has","get","set"],function(n){var t=b.prototype,r=t[n];s(t,n,function(t,e){if(!u(t)||p(t))return r.call(this,t,e);this._f||(this._f=new a);var i=this._f[n](t,e);return"set"==n?this:i})}))},function(t,e,i){"use strict";var s=i(44),o=i(31).getWeak,r=i(1),l=i(4),u=i(42),h=i(43),n=i(27),c=i(15),d=i(50),a=n(5),f=n(6),p=0,g=function(t){return t._l||(t._l=new m)},m=function(){this.a=[]},v=function(t,e){return a(t.a,function(t){return t[0]===e})};m.prototype={get:function(t){var e=v(this,t);if(e)return e[1]},has:function(t){return!!v(this,t)},set:function(t,e){var i=v(this,t);i?i[1]=e:this.a.push([t,e])},delete:function(e){var t=f(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},t.exports={getConstructor:function(t,i,n,r){var a=t(function(t,e){u(t,a,i,"_i"),t._t=i,t._i=p++,t._l=void 0,null!=e&&h(e,n,t[r],t)});return s(a.prototype,{delete:function(t){if(!l(t))return!1;var e=o(t);return!0===e?g(d(this,i)).delete(t):e&&c(e,this._i)&&delete e[this._i]},has:function(t){if(!l(t))return!1;var e=o(t);return!0===e?g(d(this,i)).has(t):e&&c(e,this._i)}}),a},def:function(t,e,i){var n=o(r(e),!0);return!0===n?g(t).set(e,i):n[t._i]=i,t},ufstore:g}},function(t,e,i){var n=i(25),r=i(8);t.exports=function(t){if(void 0===t)return 0;var e=n(t),i=r(e);if(e!==i)throw RangeError("Wrong length!");return i}},function(t,e,i){var n=i(40),r=i(61),a=i(1),s=i(2).Reflect;t.exports=s&&s.ownKeys||function(t){var e=n.f(a(t)),i=r.f;return i?e.concat(i(t)):e}},function(t,e,i){"use strict";var p=i(62),g=i(4),m=i(8),v=i(20),y=i(5)("isConcatSpreadable");t.exports=function t(e,i,n,r,a,s,o,l){for(var u,h,c=a,d=0,f=!!o&&v(o,l,3);d<r;){if(d in n){if(u=f?f(n[d],d,i):n[d],h=!1,g(u)&&(h=void 0!==(h=u[y])?!!h:p(u)),h&&0<s)c=t(e,i,u,m(u.length),c,s-1)-1;else{if(9007199254740991<=c)throw TypeError();e[c]=u}c++}d++}return c}},function(t,e,i){var h=i(8),c=i(85),d=i(24);t.exports=function(t,e,i,n){var r=String(d(t)),a=r.length,s=void 0===i?" ":String(i),o=h(e);if(o<=a||""==s)return r;var l=o-a,u=c.call(s,Math.ceil(l/s.length));return u.length>l&&(u=u.slice(0,l)),n?u+r:r+u}},function(t,e,i){var l=i(37),u=i(16),h=i(54).f;t.exports=function(o){return function(t){for(var e,i=u(t),n=l(i),r=n.length,a=0,s=[];a<r;)h.call(i,e=n[a++])&&s.push(o?[e,i[e]]:i[e]);return s}}},function(t,e,i){var n=i(55),r=i(137);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){var n=i(43);t.exports=function(t,e){var i=[];return n(t,!1,i.push,i,e),i}},function(t,e){t.exports=Math.scale||function(t,e,i,n,r){return 0===arguments.length||t!=t||e!=e||i!=i||n!=n||r!=r?NaN:t===1/0||t===-1/0?t:(t-e)*(r-n)/(i-e)+n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();e.MultiMap=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map_={}}return n(t,[{key:"push",value:function(t,e){this.map_.hasOwnProperty(t)?this.map_[t].push(e):this.map_[t]=[e]}},{key:"set",value:function(t,e){this.map_[t]=e}},{key:"has",value:function(t){return this.map_.hasOwnProperty(t)}},{key:"get",value:function(t){var e=this.map_[t];return e?e.slice():null}},{key:"getAll",value:function(){var t=[];for(var e in this.map_)t.push.apply(t,this.map_[e]);return t}},{key:"remove",value:function(t,e){var i=this.map_[t];if(i)for(var n=0;n<i.length;++n)i[n]===e&&(i.splice(n,1),--n)}},{key:"keys",value:function(){var t=[];for(var e in this.map_)t.push(e);return t}},{key:"clear",value:function(){this.map_={}}}]),t}()},function(E,S,w){var k;!function(r,c){"use strict";var d="function",t="undefined",e="model",i="name",n="type",a="vendor",s="version",o="architecture",l="console",u="mobile",h="tablet",f="smarttv",p="wearable",g={extend:function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2==0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:c},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},m={rgx:function(t,e){for(var i,n,r,a,s,o,l=0;l<e.length&&!s;){var u=e[l],h=e[l+1];for(i=n=0;i<u.length&&!s;)if(s=u[i++].exec(t))for(r=0;r<h.length;r++)o=s[++n],"object"==typeof(a=h[r])&&0<a.length?2==a.length?typeof a[1]==d?this[a[0]]=a[1].call(this,o):this[a[0]]=a[1]:3==a.length?typeof a[1]!==d||a[1].exec&&a[1].test?this[a[0]]=o?o.replace(a[1],a[2]):c:this[a[0]]=o?a[1].call(this,o,a[2]):c:4==a.length&&(this[a[0]]=o?a[3].call(this,o.replace(a[1],a[2])):c):this[a]=o||c;l+=2}},str:function(t,e){for(var i in e)if("object"==typeof e[i]&&0<e[i].length){for(var n=0;n<e[i].length;n++)if(g.has(e[i][n],t))return"?"===i?c:i}else if(g.has(e[i],t))return"?"===i?c:i;return t}},v={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[i,s],[/(opios)[\/\s]+([\w\.]+)/i],[[i,"Opera Mini"],s],[/\s(opr)\/([\w\.]+)/i],[[i,"Opera"],s],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[i,s],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[i,"IE"],s],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[i,"Edge"],s],[/(yabrowser)\/([\w\.]+)/i],[[i,"Yandex"],s],[/(puffin)\/([\w\.]+)/i],[[i,"Puffin"],s],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[i,"UCBrowser"],s],[/(comodo_dragon)\/([\w\.]+)/i],[[i,/_/g," "],s],[/(micromessenger)\/([\w\.]+)/i],[[i,"WeChat"],s],[/(qqbrowserlite)\/([\w\.]+)/i],[i,s],[/(QQ)\/([\d\.]+)/i],[i,s],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[i,s],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[i,s],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[i,s],[/(MetaSr)[\/\s]?([\w\.]+)/i],[i],[/(LBBROWSER)/i],[i],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[s,[i,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[s,[i,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[s,[i,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[i,/(.+)/,"$1 WebView"],s],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[i,/(.+(?:g|us))(.+)/,"$1 $2"],s],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[s,[i,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[i,s],[/(dolfin)\/([\w\.]+)/i],[[i,"Dolphin"],s],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[i,"Chrome"],s],[/(coast)\/([\w\.]+)/i],[[i,"Opera Coast"],s],[/fxios\/([\w\.-]+)/i],[s,[i,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[s,[i,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[s,i],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[i,"GSA"],s],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[i,[s,m.str,v.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[i,s],[/(navigator|netscape)\/([\w\.-]+)/i],[[i,"Netscape"],s],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[i,s]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[o,"amd64"]],[/(ia32(?=;))/i],[[o,g.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[o,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[o,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[o,/ower/,"",g.lowerize]],[/(sun4\w)[;\)]/i],[[o,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[o,g.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[e,a,[n,h]],[/applecoremedia\/[\w\.]+ \((ipad)/],[e,[a,"Apple"],[n,h]],[/(apple\s{0,1}tv)/i],[[e,"Apple TV"],[a,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[a,e,[n,h]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[e,[a,"Amazon"],[n,h]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[e,m.str,v.device.amazon.model],[a,"Amazon"],[n,u]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[e,a,[n,u]],[/\((ip[honed|\s\w*]+);/i],[e,[a,"Apple"],[n,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[a,e,[n,u]],[/\(bb10;\s(\w+)/i],[e,[a,"BlackBerry"],[n,u]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[e,[a,"Asus"],[n,h]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[a,"Sony"],[e,"Xperia Tablet"],[n,h]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[e,[a,"Sony"],[n,u]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[a,e,[n,l]],[/android.+;\s(shield)\sbuild/i],[e,[a,"Nvidia"],[n,l]],[/(playstation\s[34portablevi]+)/i],[e,[a,"Sony"],[n,l]],[/(sprint\s(\w+))/i],[[a,m.str,v.device.sprint.vendor],[e,m.str,v.device.sprint.model],[n,u]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[a,e,[n,h]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[a,[e,/_/g," "],[n,u]],[/(nexus\s9)/i],[e,[a,"HTC"],[n,h]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[e,[a,"Huawei"],[n,u]],[/(microsoft);\s(lumia[\s\w]+)/i],[a,e,[n,u]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[e,[a,"Microsoft"],[n,l]],[/(kin\.[onetw]{3})/i],[[e,/\./g," "],[a,"Microsoft"],[n,u]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[e,[a,"Motorola"],[n,u]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[e,[a,"Motorola"],[n,h]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[a,g.trim],[e,g.trim],[n,f]],[/hbbtv.+maple;(\d+)/i],[[e,/^/,"SmartTV"],[a,"Samsung"],[n,f]],[/\(dtv[\);].+(aquos)/i],[e,[a,"Sharp"],[n,f]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[a,"Samsung"],e,[n,h]],[/smart-tv.+(samsung)/i],[a,[n,f],e],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[a,"Samsung"],e,[n,u]],[/sie-(\w*)/i],[e,[a,"Siemens"],[n,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[a,"Nokia"],e,[n,u]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[e,[a,"Acer"],[n,h]],[/android.+([vl]k\-?\d{3})\s+build/i],[e,[a,"LG"],[n,h]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[a,"LG"],e,[n,h]],[/(lg) netcast\.tv/i],[a,e,[n,f]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[e,[a,"LG"],[n,u]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[e,[a,"Lenovo"],[n,h]],[/linux;.+((jolla));/i],[a,e,[n,u]],[/((pebble))app\/[\d\.]+\s/i],[a,e,[n,p]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[a,e,[n,u]],[/crkey/i],[[e,"Chromecast"],[a,"Google"]],[/android.+;\s(glass)\s\d/i],[e,[a,"Google"],[n,p]],[/android.+;\s(pixel c)\s/i],[e,[a,"Google"],[n,h]],[/android.+;\s(pixel xl|pixel)\s/i],[e,[a,"Google"],[n,u]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[e,/_/g," "],[a,"Xiaomi"],[n,u]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[e,/_/g," "],[a,"Xiaomi"],[n,h]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[e,[a,"Meizu"],[n,h]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[e,[a,"OnePlus"],[n,u]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[e,[a,"RCA"],[n,h]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[e,[a,"Dell"],[n,h]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[e,[a,"Verizon"],[n,h]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[a,"Barnes & Noble"],e,[n,h]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[e,[a,"NuVision"],[n,h]],[/android.+;\s(k88)\sbuild/i],[e,[a,"ZTE"],[n,h]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[e,[a,"Swiss"],[n,u]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[e,[a,"Swiss"],[n,h]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[e,[a,"Zeki"],[n,h]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[a,"Dragon Touch"],e,[n,h]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[e,[a,"Insignia"],[n,h]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[e,[a,"NextBook"],[n,h]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[a,"Voice"],e,[n,u]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[a,"LvTel"],e,[n,u]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[e,[a,"Envizen"],[n,h]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[a,e,[n,h]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[e,[a,"MachSpeed"],[n,h]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[a,e,[n,h]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[e,[a,"Rotor"],[n,h]],[/android.+(KS(.+))\s+build/i],[e,[a,"Amazon"],[n,h]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[a,e,[n,h]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[n,g.lowerize],a,e],[/(android[\w\.\s\-]{0,9});.+build/i],[e,[a,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[s,[i,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,s],[/rv\:([\w\.]{1,9}).+(gecko)/i],[s,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,s],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[s,m.str,v.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[s,m.str,v.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],s],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[i,s],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[i,"Symbian"],s],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],s],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[i,s],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],s],[/(sunos)\s?([\w\.\d]*)/i],[[i,"Solaris"],s],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[i,s],[/(haiku)\s(\w+)/i],[i,s],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[s,/_/g,"."],[i,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[i,"Mac OS"],[s,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[i,s]]},b=function(t,e){if("object"==typeof t&&(e=t,t=c),!(this instanceof b))return new b(t,e).getResult();var i=t||(r&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:""),n=e?g.extend(y,e):y;return this.getBrowser=function(){var t={name:c,version:c};return m.rgx.call(t,i,n.browser),t.major=g.major(t.version),t},this.getCPU=function(){var t={architecture:c};return m.rgx.call(t,i,n.cpu),t},this.getDevice=function(){var t={vendor:c,model:c,type:c};return m.rgx.call(t,i,n.device),t},this.getEngine=function(){var t={name:c,version:c};return m.rgx.call(t,i,n.engine),t},this.getOS=function(){var t={name:c,version:c};return m.rgx.call(t,i,n.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this};b.VERSION="0.7.18",b.BROWSER={NAME:i,MAJOR:"major",VERSION:s},b.CPU={ARCHITECTURE:o},b.DEVICE={MODEL:e,VENDOR:a,TYPE:n,CONSOLE:l,MOBILE:u,SMARTTV:f,TABLET:h,WEARABLE:p,EMBEDDED:"embedded"},b.ENGINE={NAME:i,VERSION:s},b.OS={NAME:i,VERSION:s},typeof S!==t?(typeof E!==t&&E.exports&&(S=E.exports=b),S.UAParser=b):w(351)?(k=function(){return b}.call(S,w,S,E))===c||(E.exports=k):r&&(r.UAParser=b);var _=r&&(r.jQuery||r.Zepto);if(typeof _!==t){var T=new b;_.ua=T.getResult(),_.ua.get=function(){return T.getUA()},_.ua.set=function(t){T.setUA(t);var e=T.getResult();for(var i in e)_.ua[i]=e[i]}}}("object"==typeof window?window:this)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return"ogg"===t?"video/ogg":"mp4"===t?"video/mp4":"webm"===t?"video/webm":"m3u8"===t?"application/vnd.apple.mpegurl":"mpd"===t?"application/dash+xml":""};e.extensionToCanPlayType=r,e.canPlayNative=function(t,e){var i=r(e),n=t.canPlayType(i);return"maybe"===n||"probably"===n},e.getHashNameOfTrack=function(t){var e="";return e+=""!==t.kind?t.kind+"_":"",e+=""!==t.language?t.language+"_":"",e+=""!==t.label?t.label:""}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ID3=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(52));e.ID3=function(){function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this._dict={},this._hasTimeStamp=!1;var e=0,i=void 0,n=void 0,r=void 0,a=void 0,s=void 0,o=void 0,l=void 0;do{if(o=this._readUTF(t,e,3),e+=3,"ID3"===o)e+=3,i=127&t[e++],n=127&t[e++],r=127&t[e++],a=127&t[e++],s=e+((i<<21)+(n<<14)+(r<<7)+a),this._parseID3Frames(t,e,s),e=s;else{if("3DI"!==o)return void((l=e-=3)&&(this._hasTimeStamp,this._length=l,this._payload=t.subarray(0,l)));e+=7,e=s}}while(e<s)}return n(u,[{key:"_readUTF",value:function(t,e,i){for(var n="",r=e,a=e+i;n+=String.fromCharCode(t[r++]),r<a;);return n}},{key:"_getFrameSize",value:function(t,e){var i=0;return i=(127&t[e])<<21,i|=(127&t[e+1])<<14,i|=(127&t[e+2])<<7,i|=127&t[e+3]}},{key:"_decodeTextFrame",value:function(t,e,i,n){if(n<2)return null;if("TXXX"!==i)return{info:"",data:s.utf8ArrayToStr(t.subarray(e+1))};var r=1,a=s.utf8ArrayToStr(t.subarray(e+r));return r+=a.length+1,{info:a,data:s.utf8ArrayToStr(t.subarray(e+r))}}},{key:"_decodeURLFrame",value:function(t,e,i,n){if("WXXX"!==i)return{info:"",data:s.utf8ArrayToStr(t.data)};if(n<2)return null;var r=1,a=s.utf8ArrayToStr(t.subarray(e+r));return r+=a.length+1,{info:a,data:s.utf8ArrayToStr(t.subarray(e+r))}}},{key:"_parseID3Frames",value:function(t,e,i){var n=void 0,r=void 0;if(e+8<=i)switch(n=this._readUTF(t,e,4),e+=4,this._dict.key=n){case"GEOB":if(e+=7,"application/xml"===this._readUTF(t,e,15)&&(e+=15,e+=1,"substitution.plist"===this._readUTF(t,e,18))){e+=18,e+=2;var a=this._readUTF(t,e,i-e);e+=i-e;var s=(new DOMParser).parseFromString(a,"application/xml");if(1<s.getElementsByTagName("dict").length){for(var o=s.getElementsByTagName("dict")[1].childNodes,l=[],u=0;u<o.length;u++)1===o[u].nodeType&&o[u].nodeName&&l.push({node:o[u].nodeName,value:o[u].textContent.trim()});for(var h=0;h<l.length;h++){var c=h++;this._dict[l[c].value]=l[h].value}}}break;case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this._readUTF(t,e,44)){e+=44,e+=4;var d=1&t[e++];this._hasTimeStamp=!0,r=((t[e++]<<23)+(t[e++]<<15)+(t[e++]<<7)+t[e++])/45,d&&(r+=4294967296),r=Math.round(r),this._dict.info=r,this._dict.type="transportStreamTimestamp"}else this._dict.info=this._readUTF(t,e,i-e-2),this._dict.type="data";break;default:var f=this._getFrameSize(t,e),p=null;"T"===n[0]&&20<i?p=this._decodeTextFrame(t,20,n,f):"W"===n[0]&&20<i?p=this._decodeURLFrame(t,20,n,f):this._dict.info="Unknown",null!==p&&!1===this._freeWheelIAB(n,p)&&(this._dict.info=p.info,this._dict.data=p.data)}}},{key:"_freeWheelIAB",value:function(t,e){var i=!1;if("TIT2"===t||"TIT3"===t){var n=new RegExp(".*(fw_(.*)_(firstQuartile|midPoint|thirdQuartile|complete|defaultImpression|default))").exec(e.data);n&&(this._dict.id=n[2],this._dict.adType=n[3],this._dict.value=n[0],i=!0)}return i}},{key:"dict",value:function(){return this._dict}}]),u}()},function(t,e,i){"use strict";function l(t,e){for(var i=null,n=t.length-1;0<=n;n--)if(null===t[n].end&&e>=t[n].begin||null!==t[n].end&&e>=t[n].begin&&e<=t[n].end){i=t[n];break}return i}Object.defineProperty(e,"__esModule",{value:!0}),e.absTimeToRelTime=function(t,e,i){t<i?t=i:0<e.length&&t>e[e.length-1].end&&(t=e[e.length-1].end);for(var n=t,r=0,a=0;a<e.length;a++){if(0!==a&&(r+=e[a].begin-e[a-1].end),t>=e[a].begin&&t<=e[a].end){n=t-r-i;break}if(t<e[a].begin){n=e[a].begin-r-i;break}if(0!==a){if(t>e[a-1].end&&t<e[a].begin){n=e[a].begin-r-i;break}if(a===e.length-1&&t>e[a].end){n=e[a].end-r-i;break}}}return n},e.relTimeToAbsTime=function(t,e,i){for(var n=t,r=0,a=0;a<e.length;a++){0!==a&&(r+=e[a].begin-e[a-1].end);var s=e[a].begin-r-i,o=e[a].end-r-i;if(s<=t&&t<=o){n=t+r+i;break}if(t<s){n=s+r+i;break}if(0!==a){var l=r-(e[a].begin-e[a-1].end),u=e[a-1].end-l-i;if(u<t&&t<s){n=s+r+i;break}if(a===e.length-1&&o<t){n=o+r+i;break}}}return n},e.getAbsSafeTime=function(t,e,i){var n=t;if(e&&0<e.length){if(t<=e[0].begin)return n=e[0].begin;if(t>=e[e.length-1].end)return n=e[e.length-1].end,i&&(n=Math.min(i,n)),n;for(var r=0;r<e.length;r++){var a=e[r].begin;if(0!==r&&(a=e[r-1].end),a<=t&&t<=e[r].begin){n=e[r].begin;break}if(t>e[r].begin&&t<=e[r].end)break}}return n},e.vacancyTime=function(t,e){for(var i=!0,n=0;n<e.length;n++)if(t>=e[n].begin&&t<=e[n].end){i=!1;break}return i},e.mergeProgrameTime=function(t,e,i,n){var r=e,a=t.timeRanges;if(t.targetDuration=i||0,0<r.length)for(var s=0;s<r.length;s++){0!==s||t.init||(t.init=!0,t.absStart=r[s].begin);var o=l(t.timeRanges,r[s].begin);null===o?(o={begin:r[s].begin,end:r[s].end},a.push(o)):o.end<r[s].end&&(o.end=r[s].end),0===s&&(t.curAbsStart=r[s].begin),s===r.length-1&&(t.curAbsEnd=r[r.length-1].end)}else t.curAbsEnd=n}},function(t,e,i){t.exports=i(11)},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void(t&&t._babelPolyfill||i(146))}).call(this,i(58))},function(t,e,i){"use strict";(function(t){if(i(147),i(344),i(345),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;function e(t,e,i){t[e]||Object.defineProperty(t,e,{writable:!0,configurable:!0,value:i})}e(String.prototype,"padLeft","".padStart),e(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&e(Array,t,Function.call.bind([][t]))})}).call(this,i(58))},function(t,e,i){i(148),i(150),i(151),i(152),i(153),i(154),i(155),i(156),i(157),i(158),i(159),i(160),i(161),i(162),i(163),i(164),i(166),i(167),i(168),i(169),i(170),i(171),i(172),i(173),i(174),i(175),i(176),i(177),i(178),i(179),i(180),i(181),i(182),i(183),i(184),i(185),i(186),i(187),i(188),i(189),i(190),i(191),i(192),i(193),i(194),i(195),i(196),i(197),i(198),i(199),i(200),i(201),i(202),i(203),i(204),i(205),i(206),i(207),i(208),i(209),i(210),i(211),i(212),i(213),i(214),i(215),i(216),i(217),i(218),i(219),i(220),i(221),i(222),i(223),i(224),i(225),i(226),i(228),i(229),i(231),i(232),i(233),i(234),i(235),i(236),i(237),i(239),i(240),i(241),i(242),i(243),i(244),i(245),i(246),i(247),i(248),i(249),i(250),i(251),i(98),i(252),i(253),i(123),i(254),i(255),i(256),i(257),i(258),i(126),i(128),i(129),i(259),i(260),i(261),i(262),i(263),i(264),i(265),i(266),i(267),i(268),i(269),i(270),i(271),i(272),i(273),i(274),i(275),i(276),i(277),i(278),i(279),i(280),i(281),i(282),i(283),i(284),i(285),i(286),i(287),i(288),i(289),i(290),i(291),i(292),i(293),i(294),i(295),i(296),i(297),i(298),i(299),i(300),i(301),i(302),i(303),i(304),i(305),i(306),i(307),i(308),i(309),i(310),i(311),i(312),i(313),i(314),i(315),i(316),i(317),i(318),i(319),i(320),i(321),i(322),i(323),i(324),i(325),i(326),i(327),i(328),i(329),i(330),i(331),i(332),i(333),i(334),i(335),i(336),i(337),i(338),i(339),i(340),i(341),i(342),i(343),t.exports=i(19)},function(t,e,i){"use strict";var n=i(2),s=i(15),r=i(6),a=i(0),o=i(13),l=i(31).KEY,u=i(3),h=i(59),c=i(47),d=i(36),f=i(5),p=i(106),g=i(78),m=i(149),v=i(62),y=i(1),b=i(4),_=i(16),T=i(23),E=i(35),S=i(39),w=i(109),k=i(17),A=i(7),L=i(37),P=k.f,C=A.f,x=w.f,I=n.Symbol,R=n.JSON,D=R&&R.stringify,N="prototype",O=f("_hidden"),M=f("toPrimitive"),U={}.propertyIsEnumerable,F=h("symbol-registry"),B=h("symbols"),G=h("op-symbols"),j=Object[N],H="function"==typeof I,V=n.QObject,W=!V||!V[N]||!V[N].findChild,z=r&&u(function(){return 7!=S(C({},"a",{get:function(){return C(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=P(j,e);n&&delete j[e],C(t,e,i),n&&t!==j&&C(j,e,n)}:C,K=function(t){var e=B[t]=S(I[N]);return e._k=t,e},Y=H&&"symbol"==typeof I.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof I},X=function(t,e,i){return t===j&&X(G,e,i),y(t),e=T(e,!0),y(i),s(B,e)?(i.enumerable?(s(t,O)&&t[O][e]&&(t[O][e]=!1),i=S(i,{enumerable:E(0,!1)})):(s(t,O)||C(t,O,E(1,{})),t[O][e]=!0),z(t,e,i)):C(t,e,i)},q=function(t,e){y(t);for(var i,n=m(e=_(e)),r=0,a=n.length;r<a;)X(t,i=n[r++],e[i]);return t},Z=function(t){var e=U.call(this,t=T(t,!0));return!(this===j&&s(B,t)&&!s(G,t))&&(!(e||!s(this,t)||!s(B,t)||s(this,O)&&this[O][t])||e)},Q=function(t,e){if(t=_(t),e=T(e,!0),t!==j||!s(B,e)||s(G,e)){var i=P(t,e);return!i||!s(B,e)||s(t,O)&&t[O][e]||(i.enumerable=!0),i}},J=function(t){for(var e,i=x(_(t)),n=[],r=0;i.length>r;)s(B,e=i[r++])||e==O||e==l||n.push(e);return n},$=function(t){for(var e,i=t===j,n=x(i?G:_(t)),r=[],a=0;n.length>a;)!s(B,e=n[a++])||i&&!s(j,e)||r.push(B[e]);return r};H||(o((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=d(0<arguments.length?arguments[0]:void 0),i=function(t){this===j&&i.call(G,t),s(this,O)&&s(this[O],e)&&(this[O][e]=!1),z(this,e,E(1,t))};return r&&W&&z(j,e,{configurable:!0,set:i}),K(e)})[N],"toString",function(){return this._k}),k.f=Q,A.f=X,i(40).f=w.f=J,i(54).f=Z,i(61).f=$,r&&!i(32)&&o(j,"propertyIsEnumerable",Z,!0),p.f=function(t){return K(f(t))}),a(a.G+a.W+a.F*!H,{Symbol:I});for(var tt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;tt.length>et;)f(tt[et++]);for(var it=L(f.store),nt=0;it.length>nt;)g(it[nt++]);a(a.S+a.F*!H,"Symbol",{for:function(t){return s(F,t+="")?F[t]:F[t]=I(t)},keyFor:function(t){if(!Y(t))throw TypeError(t+" is not a symbol!");for(var e in F)if(F[e]===t)return e},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!H,"Object",{create:function(t,e){return void 0===e?S(t):q(S(t),e)},defineProperty:X,defineProperties:q,getOwnPropertyDescriptor:Q,getOwnPropertyNames:J,getOwnPropertySymbols:$}),R&&a(a.S+a.F*(!H||u(function(){var t=I();return"[null]"!=D([t])||"{}"!=D({a:t})||"{}"!=D(Object(t))})),"JSON",{stringify:function(t){for(var e,i,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);if(i=e=n[1],(b(e)||void 0!==t)&&!Y(t))return v(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!Y(e))return e}),n[1]=e,D.apply(R,n)}}),I[N][M]||i(12)(I[N],M,I[N].valueOf),c(I,"Symbol"),c(Math,"Math",!0),c(n.JSON,"JSON",!0)},function(t,e,i){var o=i(37),l=i(61),u=i(54);t.exports=function(t){var e=o(t),i=l.f;if(i)for(var n,r=i(t),a=u.f,s=0;r.length>s;)a.call(t,n=r[s++])&&e.push(n);return e}},function(t,e,i){var n=i(0);n(n.S,"Object",{create:i(39)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(6),"Object",{defineProperty:i(7).f})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(6),"Object",{defineProperties:i(108)})},function(t,e,i){var n=i(16),r=i(17).f;i(26)("getOwnPropertyDescriptor",function(){return function(t,e){return r(n(t),e)}})},function(t,e,i){var n=i(9),r=i(18);i(26)("getPrototypeOf",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(9),r=i(37);i(26)("keys",function(){return function(t){return r(n(t))}})},function(t,e,i){i(26)("getOwnPropertyNames",function(){return i(109).f})},function(t,e,i){var n=i(4),r=i(31).onFreeze;i(26)("freeze",function(e){return function(t){return e&&n(t)?e(r(t)):t}})},function(t,e,i){var n=i(4),r=i(31).onFreeze;i(26)("seal",function(e){return function(t){return e&&n(t)?e(r(t)):t}})},function(t,e,i){var n=i(4),r=i(31).onFreeze;i(26)("preventExtensions",function(e){return function(t){return e&&n(t)?e(r(t)):t}})},function(t,e,i){var n=i(4);i(26)("isFrozen",function(e){return function(t){return!n(t)||!!e&&e(t)}})},function(t,e,i){var n=i(4);i(26)("isSealed",function(e){return function(t){return!n(t)||!!e&&e(t)}})},function(t,e,i){var n=i(4);i(26)("isExtensible",function(e){return function(t){return!!n(t)&&(!e||e(t))}})},function(t,e,i){var n=i(0);n(n.S+n.F,"Object",{assign:i(110)})},function(t,e,i){var n=i(0);n(n.S,"Object",{is:i(165)})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,i){var n=i(0);n(n.S,"Object",{setPrototypeOf:i(82).set})},function(t,e,i){"use strict";var n=i(55),r={};r[i(5)("toStringTag")]="z",r+""!="[object z]"&&i(13)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(t,e,i){var n=i(0);n(n.P,"Function",{bind:i(111)})},function(t,e,i){var n=i(7).f,r=Function.prototype,a=/^\s*function ([^ (]*)/;"name"in r||i(6)&&n(r,"name",{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(t){return""}}})},function(t,e,i){"use strict";var n=i(4),r=i(18),a=i(5)("hasInstance"),s=Function.prototype;a in s||i(7).f(s,a,{value:function(t){if("function"!=typeof this||!n(t))return!1;if(!n(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,i){var n=i(0),r=i(113);n(n.G+n.F*(parseInt!=r),{parseInt:r})},function(t,e,i){var n=i(0),r=i(114);n(n.G+n.F*(parseFloat!=r),{parseFloat:r})},function(t,e,i){"use strict";var n=i(2),r=i(15),a=i(21),s=i(84),h=i(23),o=i(3),l=i(40).f,u=i(17).f,c=i(7).f,d=i(48).trim,f="Number",p=n[f],g=p,m=p.prototype,v=a(i(39)(m))==f,y="trim"in String.prototype,b=function(t){var e=h(t,!1);if("string"==typeof e&&2<e.length){var i,n,r,a=(e=y?e.trim():d(e,3)).charCodeAt(0);if(43===a||45===a){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===a){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var s,o=e.slice(2),l=0,u=o.length;l<u;l++)if((s=o.charCodeAt(l))<48||r<s)return NaN;return parseInt(o,n)}}return+e};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof p&&(v?o(function(){m.valueOf.call(i)}):a(i)!=f)?s(new g(b(e)),i,p):b(e)};for(var _,T=i(6)?l(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),E=0;T.length>E;E++)r(g,_=T[E])&&!r(p,_)&&c(p,_,u(g,_));(p.prototype=m).constructor=p,i(13)(n,f,p)}},function(t,e,i){"use strict";var n=i(0),u=i(25),h=i(115),c=i(85),r=1..toFixed,a=Math.floor,s=[0,0,0,0,0,0],d="Number.toFixed: incorrect invocation!",f=function(t,e){for(var i=-1,n=e;++i<6;)n+=t*s[i],s[i]=n%1e7,n=a(n/1e7)},p=function(t){for(var e=6,i=0;0<=--e;)i+=s[e],s[e]=a(i/t),i=i%t*1e7},g=function(){for(var t=6,e="";0<=--t;)if(""!==e||0===t||0!==s[t]){var i=String(s[t]);e=""===e?i:e+c.call("0",7-i.length)+i}return e},m=function(t,e,i){return 0===e?i:e%2==1?m(t,e-1,i*t):m(t*t,e/2,i)};n(n.P+n.F*(!!r&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(3)(function(){r.call({})})),"Number",{toFixed:function(t){var e,i,n,r,a=h(this,d),s=u(t),o="",l="0";if(s<0||20<s)throw RangeError(d);if(a!=a)return"NaN";if(a<=-1e21||1e21<=a)return String(a);if(a<0&&(o="-",a=-a),1e-21<a)if(i=(e=function(t){for(var e=0,i=t;4096<=i;)e+=12,i/=4096;for(;2<=i;)e+=1,i/=2;return e}(a*m(2,69,1))-69)<0?a*m(2,-e,1):a/m(2,e,1),i*=4503599627370496,0<(e=52-e)){for(f(0,i),n=s;7<=n;)f(1e7,0),n-=7;for(f(m(10,n,1),0),n=e-1;23<=n;)p(1<<23),n-=23;p(1<<n),f(1,1),p(2),l=g()}else f(0,i),f(1<<-e,0),l=g()+c.call("0",s);return l=0<s?o+((r=l.length)<=s?"0."+c.call("0",s-r)+l:l.slice(0,r-s)+"."+l.slice(r-s)):o+l}})},function(t,e,i){"use strict";var n=i(0),r=i(3),a=i(115),s=1..toPrecision;n(n.P+n.F*(r(function(){return"1"!==s.call(1,void 0)})||!r(function(){s.call({})})),"Number",{toPrecision:function(t){var e=a(this,"Number#toPrecision: incorrect invocation!");return void 0===t?s.call(e):s.call(e,t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,i){var n=i(0),r=i(2).isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{isInteger:i(116)})},function(t,e,i){var n=i(0);n(n.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,i){var n=i(0),r=i(116),a=Math.abs;n(n.S,"Number",{isSafeInteger:function(t){return r(t)&&a(t)<=9007199254740991}})},function(t,e,i){var n=i(0);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,i){var n=i(0);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,i){var n=i(0),r=i(114);n(n.S+n.F*(Number.parseFloat!=r),"Number",{parseFloat:r})},function(t,e,i){var n=i(0),r=i(113);n(n.S+n.F*(Number.parseInt!=r),"Number",{parseInt:r})},function(t,e,i){var n=i(0),r=i(117),a=Math.sqrt,s=Math.acosh;n(n.S+n.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:94906265.62425156<t?Math.log(t)+Math.LN2:r(t-1+a(t-1)*a(t+1))}})},function(t,e,i){var n=i(0),r=Math.asinh;n(n.S+n.F*!(r&&0<1/r(0)),"Math",{asinh:function t(e){return isFinite(e=+e)&&0!=e?e<0?-t(-e):Math.log(e+Math.sqrt(e*e+1)):e}})},function(t,e,i){var n=i(0),r=Math.atanh;n(n.S+n.F*!(r&&1/r(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,i){var n=i(0),r=i(86);n(n.S,"Math",{cbrt:function(t){return r(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,i){var n=i(0),r=Math.exp;n(n.S,"Math",{cosh:function(t){return(r(t=+t)+r(-t))/2}})},function(t,e,i){var n=i(0),r=i(87);n(n.S+n.F*(r!=Math.expm1),"Math",{expm1:r})},function(t,e,i){var n=i(0);n(n.S,"Math",{fround:i(118)})},function(t,e,i){var n=i(0),l=Math.abs;n(n.S,"Math",{hypot:function(t,e){for(var i,n,r=0,a=0,s=arguments.length,o=0;a<s;)o<(i=l(arguments[a++]))?(r=r*(n=o/i)*n+1,o=i):r+=0<i?(n=i/o)*n:i;return o===1/0?1/0:o*Math.sqrt(r)}})},function(t,e,i){var n=i(0),r=Math.imul;n(n.S+n.F*i(3)(function(){return-5!=r(4294967295,5)||2!=r.length}),"Math",{imul:function(t,e){var i=65535,n=+t,r=+e,a=i&n,s=i&r;return 0|a*s+((i&n>>>16)*s+a*(i&r>>>16)<<16>>>0)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log1p:i(117)})},function(t,e,i){var n=i(0);n(n.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,i){var n=i(0);n(n.S,"Math",{sign:i(86)})},function(t,e,i){var n=i(0),r=i(87),a=Math.exp;n(n.S+n.F*i(3)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(r(t)-r(-t))/2:(a(t-1)-a(-t-1))*(Math.E/2)}})},function(t,e,i){var n=i(0),r=i(87),a=Math.exp;n(n.S,"Math",{tanh:function(t){var e=r(t=+t),i=r(-t);return e==1/0?1:i==1/0?-1:(e-i)/(a(t)+a(-t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{trunc:function(t){return(0<t?Math.floor:Math.ceil)(t)}})},function(t,e,i){var n=i(0),a=i(38),s=String.fromCharCode,r=String.fromCodePoint;n(n.S+n.F*(!!r&&1!=r.length),"String",{fromCodePoint:function(t){for(var e,i=[],n=arguments.length,r=0;r<n;){if(e=+arguments[r++],a(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?s(e):s(55296+((e-=65536)>>10),e%1024+56320))}return i.join("")}})},function(t,e,i){var n=i(0),s=i(16),o=i(8);n(n.S,"String",{raw:function(t){for(var e=s(t.raw),i=o(e.length),n=arguments.length,r=[],a=0;a<i;)r.push(String(e[a++])),a<n&&r.push(String(arguments[a]));return r.join("")}})},function(t,e,i){"use strict";i(48)("trim",function(t){return function(){return t(this,3)}})},function(t,e,i){"use strict";var n=i(88)(!0);i(89)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){"use strict";var n=i(0),r=i(88)(!1);n(n.P,"String",{codePointAt:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),s=i(8),o=i(91),l="endsWith",u=""[l];n(n.P+n.F*i(92)(l),"String",{endsWith:function(t){var e=o(this,t,l),i=1<arguments.length?arguments[1]:void 0,n=s(e.length),r=void 0===i?n:Math.min(s(i),n),a=String(t);return u?u.call(e,a,r):e.slice(r-a.length,r)===a}})},function(t,e,i){"use strict";var n=i(0),r=i(91),a="includes";n(n.P+n.F*i(92)(a),"String",{includes:function(t){return!!~r(this,t,a).indexOf(t,1<arguments.length?arguments[1]:void 0)}})},function(t,e,i){var n=i(0);n(n.P,"String",{repeat:i(85)})},function(t,e,i){"use strict";var n=i(0),r=i(8),a=i(91),s="startsWith",o=""[s];n(n.P+n.F*i(92)(s),"String",{startsWith:function(t){var e=a(this,t,s),i=r(Math.min(1<arguments.length?arguments[1]:void 0,e.length)),n=String(t);return o?o.call(e,n,i):e.slice(i,i+n.length)===n}})},function(t,e,i){"use strict";i(14)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},function(t,e,i){"use strict";i(14)("big",function(t){return function(){return t(this,"big","","")}})},function(t,e,i){"use strict";i(14)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,e,i){"use strict";i(14)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,e,i){"use strict";i(14)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,e,i){"use strict";i(14)("fontcolor",function(e){return function(t){return e(this,"font","color",t)}})},function(t,e,i){"use strict";i(14)("fontsize",function(e){return function(t){return e(this,"font","size",t)}})},function(t,e,i){"use strict";i(14)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,e,i){"use strict";i(14)("link",function(e){return function(t){return e(this,"a","href",t)}})},function(t,e,i){"use strict";i(14)("small",function(t){return function(){return t(this,"small","","")}})},function(t,e,i){"use strict";i(14)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,e,i){"use strict";i(14)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,e,i){"use strict";i(14)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,e,i){var n=i(0);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,i){"use strict";var n=i(0),r=i(9),a=i(23);n(n.P+n.F*i(3)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=r(this),i=a(e);return"number"!=typeof i||isFinite(i)?e.toISOString():null}})},function(t,e,i){var n=i(0),r=i(227);n(n.P+n.F*(Date.prototype.toISOString!==r),"Date",{toISOString:r})},function(t,e,i){"use strict";var n=i(3),r=Date.prototype.getTime,a=Date.prototype.toISOString,s=function(t){return 9<t?t:"0"+t};t.exports=n(function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-5e13-1))})||!n(function(){a.call(new Date(NaN))})?function(){if(!isFinite(r.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),n=e<0?"-":9999<e?"+":"";return n+("00000"+Math.abs(e)).slice(n?-6:-4)+"-"+s(t.getUTCMonth()+1)+"-"+s(t.getUTCDate())+"T"+s(t.getUTCHours())+":"+s(t.getUTCMinutes())+":"+s(t.getUTCSeconds())+"."+(99<i?i:"0"+s(i))+"Z"}:a},function(t,e,i){var n=Date.prototype,r="Invalid Date",a="toString",s=n[a],o=n.getTime;new Date(NaN)+""!=r&&i(13)(n,a,function(){var t=o.call(this);return t==t?s.call(this):r})},function(t,e,i){var n=i(5)("toPrimitive"),r=Date.prototype;n in r||i(12)(r,n,i(230))},function(t,e,i){"use strict";var n=i(1),r=i(23);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return r(n(this),"number"!=t)}},function(t,e,i){var n=i(0);n(n.S,"Array",{isArray:i(62)})},function(t,e,i){"use strict";var d=i(20),n=i(0),f=i(9),p=i(119),g=i(93),m=i(8),v=i(94),y=i(95);n(n.S+n.F*!i(64)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,n,r,a=f(t),s="function"==typeof this?this:Array,o=arguments.length,l=1<o?arguments[1]:void 0,u=void 0!==l,h=0,c=y(a);if(u&&(l=d(l,2<o?arguments[2]:void 0,2)),null==c||s==Array&&g(c))for(i=new s(e=m(a.length));h<e;h++)v(i,h,u?l(a[h],h):a[h]);else for(r=c.call(a),i=new s;!(n=r.next()).done;h++)v(i,h,u?p(r,l,[n.value,h],!0):n.value);return i.length=h,i}})},function(t,e,i){"use strict";var n=i(0),r=i(94);n(n.S+n.F*i(3)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);t<e;)r(i,t,arguments[t++]);return i.length=e,i}})},function(t,e,i){"use strict";var n=i(0),r=i(16),a=[].join;n(n.P+n.F*(i(53)!=Object||!i(22)(a)),"Array",{join:function(t){return a.call(r(this),void 0===t?",":t)}})},function(t,e,i){"use strict";var n=i(0),r=i(81),u=i(21),h=i(38),c=i(8),d=[].slice;n(n.P+n.F*i(3)(function(){r&&d.call(r)}),"Array",{slice:function(t,e){var i=c(this.length),n=u(this);if(e=void 0===e?i:e,"Array"==n)return d.call(this,t,e);for(var r=h(t,i),a=h(e,i),s=c(a-r),o=new Array(s),l=0;l<s;l++)o[l]="String"==n?this.charAt(r+l):this[r+l];return o}})},function(t,e,i){"use strict";var n=i(0),r=i(10),a=i(9),s=i(3),o=[].sort,l=[1,2,3];n(n.P+n.F*(s(function(){l.sort(void 0)})||!s(function(){l.sort(null)})||!i(22)(o)),"Array",{sort:function(t){return void 0===t?o.call(a(this)):o.call(a(this),r(t))}})},function(t,e,i){"use strict";var n=i(0),r=i(27)(0),a=i(22)([].forEach,!0);n(n.P+n.F*!a,"Array",{forEach:function(t){return r(this,t,arguments[1])}})},function(t,e,i){var n=i(4),r=i(62),a=i(5)("species");t.exports=function(t){var e;return r(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!r(e.prototype)||(e=void 0),n(e)&&null===(e=e[a])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){"use strict";var n=i(0),r=i(27)(1);n(n.P+n.F*!i(22)([].map,!0),"Array",{map:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(27)(2);n(n.P+n.F*!i(22)([].filter,!0),"Array",{filter:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(27)(3);n(n.P+n.F*!i(22)([].some,!0),"Array",{some:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(27)(4);n(n.P+n.F*!i(22)([].every,!0),"Array",{every:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(120);n(n.P+n.F*!i(22)([].reduce,!0),"Array",{reduce:function(t){return r(this,t,arguments.length,arguments[1],!1)}})},function(t,e,i){"use strict";var n=i(0),r=i(120);n(n.P+n.F*!i(22)([].reduceRight,!0),"Array",{reduceRight:function(t){return r(this,t,arguments.length,arguments[1],!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(60)(!1),a=[].indexOf,s=!!a&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(s||!i(22)(a)),"Array",{indexOf:function(t){return s?a.apply(this,arguments)||0:r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(16),a=i(25),s=i(8),o=[].lastIndexOf,l=!!o&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(l||!i(22)(o)),"Array",{lastIndexOf:function(t){if(l)return o.apply(this,arguments)||0;var e=r(this),i=s(e.length),n=i-1;for(1<arguments.length&&(n=Math.min(n,a(arguments[1]))),n<0&&(n=i+n);0<=n;n--)if(n in e&&e[n]===t)return n||0;return-1}})},function(t,e,i){var n=i(0);n(n.P,"Array",{copyWithin:i(121)}),i(33)("copyWithin")},function(t,e,i){var n=i(0);n(n.P,"Array",{fill:i(97)}),i(33)("fill")},function(t,e,i){"use strict";var n=i(0),r=i(27)(5),a=!0;"find"in[]&&Array(1).find(function(){a=!1}),n(n.P+n.F*a,"Array",{find:function(t){return r(this,t,1<arguments.length?arguments[1]:void 0)}}),i(33)("find")},function(t,e,i){"use strict";var n=i(0),r=i(27)(6),a="findIndex",s=!0;a in[]&&Array(1)[a](function(){s=!1}),n(n.P+n.F*s,"Array",{findIndex:function(t){return r(this,t,1<arguments.length?arguments[1]:void 0)}}),i(33)(a)},function(t,e,i){i(41)("Array")},function(t,e,i){var n=i(2),a=i(84),r=i(7).f,s=i(40).f,o=i(63),l=i(65),u=n.RegExp,h=u,c=u.prototype,d=/a/g,f=/a/g,p=new u(d)!==d;if(i(6)&&(!p||i(3)(function(){return f[i(5)("match")]=!1,u(d)!=d||u(f)==f||"/a/i"!=u(d,"i")}))){u=function(t,e){var i=this instanceof u,n=o(t),r=void 0===e;return!i&&n&&t.constructor===u&&r?t:a(p?new h(n&&!r?t.source:t,e):h((n=t instanceof u)?t.source:t,n&&r?l.call(t):e),i?this:c,u)};for(var g=function(e){e in u||r(u,e,{configurable:!0,get:function(){return h[e]},set:function(t){h[e]=t}})},m=s(h),v=0;m.length>v;)g(m[v++]);(c.constructor=u).prototype=c,i(13)(n,"RegExp",u)}i(41)("RegExp")},function(t,e,i){"use strict";i(123);var n=i(1),r=i(65),a=i(6),s="toString",o=/./[s],l=function(t){i(13)(RegExp.prototype,s,t,!0)};i(3)(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?l(function(){var t=n(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?r.call(t):void 0)}):o.name!=s&&l(function(){return o.call(this)})},function(t,e,i){i(66)("match",1,function(n,r,t){return[function(t){"use strict";var e=n(this),i=null==t?void 0:t[r];return void 0!==i?i.call(t,e):new RegExp(t)[r](String(e))},t]})},function(t,e,i){i(66)("replace",2,function(r,a,s){return[function(t,e){"use strict";var i=r(this),n=null==t?void 0:t[a];return void 0!==n?n.call(t,i,e):s.call(String(i),t,e)},s]})},function(t,e,i){i(66)("search",1,function(n,r,t){return[function(t){"use strict";var e=n(this),i=null==t?void 0:t[r];return void 0!==i?i.call(t,e):new RegExp(t)[r](String(e))},t]})},function(t,e,i){i(66)("split",2,function(r,a,s){"use strict";var f=i(63),p=s,g=[].push,t="split",m="length";if("c"=="abbc"[t](/(b)*/)[1]||4!="test"[t](/(?:)/,-1)[m]||2!="ab"[t](/(?:ab)*/)[m]||4!="."[t](/(.?)(.?)/)[m]||1<"."[t](/()()/)[m]||""[t](/.?/)[m]){var v=void 0===/()??/.exec("")[1];s=function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!f(t))return p.call(i,t,e);var n,r,a,s,o,l=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),h=0,c=void 0===e?4294967295:e>>>0,d=new RegExp(t.source,u+"g");for(v||(n=new RegExp("^"+d.source+"$(?!\\s)",u));(r=d.exec(i))&&!(h<(a=r.index+r[0][m])&&(l.push(i.slice(h,r.index)),!v&&1<r[m]&&r[0].replace(n,function(){for(o=1;o<arguments[m]-2;o++)void 0===arguments[o]&&(r[o]=void 0)}),1<r[m]&&r.index<i[m]&&g.apply(l,r.slice(1)),s=r[0][m],h=a,l[m]>=c));)d.lastIndex===r.index&&d.lastIndex++;return h===i[m]?!s&&d.test("")||l.push(""):l.push(i.slice(h)),l[m]>c?l.slice(0,c):l}}else"0"[t](void 0,0)[m]&&(s=function(t,e){return void 0===t&&0===e?[]:p.call(this,t,e)});return[function(t,e){var i=r(this),n=null==t?void 0:t[a];return void 0!==n?n.call(t,i,e):s.call(String(i),t,e)},s]})},function(t,e,i){"use strict";var n,r,a,s,o=i(32),l=i(2),u=i(20),h=i(55),c=i(0),d=i(4),f=i(10),p=i(42),g=i(43),m=i(67),v=i(99).set,y=i(100)(),b=i(101),_=i(124),T=i(68),E=i(125),S="Promise",w=l.TypeError,k=l.process,A=k&&k.versions,L=A&&A.v8||"",P=l[S],C="process"==h(k),x=function(){},I=r=b.f,R=!!function(){try{var t=P.resolve(1),e=(t.constructor={})[i(5)("species")]=function(t){t(x,x)};return(C||"function"==typeof PromiseRejectionEvent)&&t.then(x)instanceof e&&0!==L.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(t){}}(),D=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},N=function(h,i){if(!h._n){h._n=!0;var n=h._c;y(function(){for(var l=h._v,u=1==h._s,t=0,e=function(t){var e,i,n,r=u?t.ok:t.fail,a=t.resolve,s=t.reject,o=t.domain;try{r?(u||(2==h._h&&U(h),h._h=1),!0===r?e=l:(o&&o.enter(),e=r(l),o&&(o.exit(),n=!0)),e===t.promise?s(w("Promise-chain cycle")):(i=D(e))?i.call(e,a,s):a(e)):s(l)}catch(t){o&&!n&&o.exit(),s(t)}};n.length>t;)e(n[t++]);h._c=[],h._n=!1,i&&!h._h&&O(h)})}},O=function(a){v.call(l,function(){var t,e,i,n=a._v,r=M(a);if(r&&(t=_(function(){C?k.emit("unhandledRejection",n,a):(e=l.onunhandledrejection)?e({promise:a,reason:n}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",n)}),a._h=C||M(a)?2:1),a._a=void 0,r&&t.e)throw t.v})},M=function(t){return 1!==t._h&&0===(t._a||t._c).length},U=function(e){v.call(l,function(){var t;C?k.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})})},F=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),N(e,!0))},B=function(t){var i,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw w("Promise can't be resolved itself");(i=D(t))?y(function(){var e={_w:n,_d:!1};try{i.call(t,u(B,e,1),u(F,e,1))}catch(t){F.call(e,t)}}):(n._v=t,n._s=1,N(n,!1))}catch(t){F.call({_w:n,_d:!1},t)}}};R||(P=function(t){p(this,P,S,"_h"),f(t),n.call(this);try{t(u(B,this,1),u(F,this,1))}catch(t){F.call(this,t)}},(n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(44)(P.prototype,{then:function(t,e){var i=I(m(this,P));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=C?k.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&N(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),a=function(){var t=new n;this.promise=t,this.resolve=u(B,t,1),this.reject=u(F,t,1)},b.f=I=function(t){return t===P||t===s?new a(t):r(t)}),c(c.G+c.W+c.F*!R,{Promise:P}),i(47)(P,S),i(41)(S),s=i(19)[S],c(c.S+c.F*!R,S,{reject:function(t){var e=I(this);return(0,e.reject)(t),e.promise}}),c(c.S+c.F*(o||!R),S,{resolve:function(t){return E(o&&this===s?P:this,t)}}),c(c.S+c.F*!(R&&i(64)(function(t){P.all(t).catch(x)})),S,{all:function(t){var s=this,e=I(s),o=e.resolve,l=e.reject,i=_(function(){var n=[],r=0,a=1;g(t,!1,function(t){var e=r++,i=!1;n.push(void 0),a++,s.resolve(t).then(function(t){i||(i=!0,n[e]=t,--a||o(n))},l)}),--a||o(n)});return i.e&&l(i.v),e.promise},race:function(t){var e=this,i=I(e),n=i.reject,r=_(function(){g(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r.e&&n(r.v),i.promise}})},function(t,e,i){"use strict";var n=i(130),r=i(50);i(69)("WeakSet",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return n.def(r(this,"WeakSet"),t,!0)}},n,!1,!0)},function(t,e,i){"use strict";var n=i(0),r=i(70),a=i(102),u=i(1),h=i(38),c=i(8),s=i(4),o=i(2).ArrayBuffer,d=i(67),f=a.ArrayBuffer,p=a.DataView,l=r.ABV&&o.isView,g=f.prototype.slice,m=r.VIEW,v="ArrayBuffer";n(n.G+n.W+n.F*(o!==f),{ArrayBuffer:f}),n(n.S+n.F*!r.CONSTR,v,{isView:function(t){return l&&l(t)||s(t)&&m in t}}),n(n.P+n.U+n.F*i(3)(function(){return!new f(2).slice(1,void 0).byteLength}),v,{slice:function(t,e){if(void 0!==g&&void 0===e)return g.call(u(this),t);for(var i=u(this).byteLength,n=h(t,i),r=h(void 0===e?i:e,i),a=new(d(this,f))(c(r-n)),s=new p(this),o=new p(a),l=0;n<r;)o.setUint8(l++,s.getUint8(n++));return a}}),i(41)(v)},function(t,e,i){var n=i(0);n(n.G+n.W+n.F*!i(70).ABV,{DataView:i(102).DataView})},function(t,e,i){i(29)("Int8",1,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Uint8",1,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Uint8",1,function(n){return function(t,e,i){return n(this,t,e,i)}},!0)},function(t,e,i){i(29)("Int16",2,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Uint16",2,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Int32",4,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Uint32",4,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Float32",4,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){i(29)("Float64",8,function(n){return function(t,e,i){return n(this,t,e,i)}})},function(t,e,i){var n=i(0),a=i(10),s=i(1),o=(i(2).Reflect||{}).apply,l=Function.apply;n(n.S+n.F*!i(3)(function(){o(function(){})}),"Reflect",{apply:function(t,e,i){var n=a(t),r=s(i);return o?o(n,e,r):l.call(n,e,r)}})},function(t,e,i){var n=i(0),o=i(39),l=i(10),u=i(1),h=i(4),r=i(3),c=i(111),d=(i(2).Reflect||{}).construct,f=r(function(){function t(){}return!(d(function(){},[],t)instanceof t)}),p=!r(function(){d(function(){})});n(n.S+n.F*(f||p),"Reflect",{construct:function(t,e){l(t),u(e);var i=arguments.length<3?t:l(arguments[2]);if(p&&!f)return d(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var n=[null];return n.push.apply(n,e),new(c.apply(t,n))}var r=i.prototype,a=o(h(r)?r:Object.prototype),s=Function.apply.call(t,a,e);return h(s)?s:a}})},function(t,e,i){var n=i(7),r=i(0),a=i(1),s=i(23);r(r.S+r.F*i(3)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,i){a(t),e=s(e,!0),a(i);try{return n.f(t,e,i),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),r=i(17).f,a=i(1);n(n.S,"Reflect",{deleteProperty:function(t,e){var i=r(a(t),e);return!(i&&!i.configurable)&&delete t[e]}})},function(t,e,i){"use strict";var n=i(0),r=i(1),a=function(t){this._t=r(t),this._i=0;var e,i=this._k=[];for(e in t)i.push(e)};i(90)(a,"Object",function(){var t,e=this._k;do{if(this._i>=e.length)return{value:void 0,done:!0}}while(!((t=e[this._i++])in this._t));return{value:t,done:!1}}),n(n.S,"Reflect",{enumerate:function(t){return new a(t)}})},function(t,e,i){var s=i(17),o=i(18),l=i(15),n=i(0),u=i(4),h=i(1);n(n.S,"Reflect",{get:function t(e,i){var n,r,a=arguments.length<3?e:arguments[2];return h(e)===a?e[i]:(n=s.f(e,i))?l(n,"value")?n.value:void 0!==n.get?n.get.call(a):void 0:u(r=o(e))?t(r,i,a):void 0}})},function(t,e,i){var n=i(17),r=i(0),a=i(1);r(r.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return n.f(a(t),e)}})},function(t,e,i){var n=i(0),r=i(18),a=i(1);n(n.S,"Reflect",{getPrototypeOf:function(t){return r(a(t))}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,i){var n=i(0),r=i(1),a=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(t){return r(t),!a||a(t)}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{ownKeys:i(132)})},function(t,e,i){var n=i(0),r=i(1),a=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(t){r(t);try{return a&&a(t),!0}catch(t){return!1}}})},function(t,e,i){var l=i(7),u=i(17),h=i(18),c=i(15),n=i(0),d=i(35),f=i(1),p=i(4);n(n.S,"Reflect",{set:function t(e,i,n){var r,a,s=arguments.length<4?e:arguments[3],o=u.f(f(e),i);if(!o){if(p(a=h(e)))return t(a,i,n,s);o=d(0)}if(c(o,"value")){if(!1===o.writable||!p(s))return!1;if(r=u.f(s,i)){if(r.get||r.set||!1===r.writable)return!1;r.value=n,l.f(s,i,r)}else l.f(s,i,d(0,n));return!0}return void 0!==o.set&&(o.set.call(s,n),!0)}})},function(t,e,i){var n=i(0),r=i(82);r&&n(n.S,"Reflect",{setPrototypeOf:function(t,e){r.check(t,e);try{return r.set(t,e),!0}catch(t){return!1}}})},function(t,e,i){"use strict";var n=i(0),r=i(60)(!0);n(n.P,"Array",{includes:function(t){return r(this,t,1<arguments.length?arguments[1]:void 0)}}),i(33)("includes")},function(t,e,i){"use strict";var n=i(0),r=i(133),a=i(9),s=i(8),o=i(10),l=i(96);n(n.P,"Array",{flatMap:function(t){var e,i,n=a(this);return o(t),e=s(n.length),i=l(n,0),r(i,n,n,e,0,1,t,arguments[1]),i}}),i(33)("flatMap")},function(t,e,i){"use strict";var n=i(0),r=i(133),a=i(9),s=i(8),o=i(25),l=i(96);n(n.P,"Array",{flatten:function(){var t=arguments[0],e=a(this),i=s(e.length),n=l(e,0);return r(n,e,e,i,0,void 0===t?1:o(t)),n}}),i(33)("flatten")},function(t,e,i){"use strict";var n=i(0),r=i(88)(!0);n(n.P,"String",{at:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(134),a=i(68);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padStart:function(t){return r(this,t,1<arguments.length?arguments[1]:void 0,!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(134),a=i(68);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padEnd:function(t){return r(this,t,1<arguments.length?arguments[1]:void 0,!1)}})},function(t,e,i){"use strict";i(48)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,e,i){"use strict";i(48)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,e,i){"use strict";var n=i(0),r=i(24),a=i(8),s=i(63),o=i(65),l=RegExp.prototype,u=function(t,e){this._r=t,this._s=e};i(90)(u,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),n(n.P,"String",{matchAll:function(t){if(r(this),!s(t))throw TypeError(t+" is not a regexp!");var e=String(this),i="flags"in l?String(t.flags):o.call(t),n=new RegExp(t.source,~i.indexOf("g")?i:"g"+i);return n.lastIndex=a(t.lastIndex),new u(n,e)}})},function(t,e,i){i(78)("asyncIterator")},function(t,e,i){i(78)("observable")},function(t,e,i){var n=i(0),l=i(132),u=i(16),h=i(17),c=i(94);n(n.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,i,n=u(t),r=h.f,a=l(n),s={},o=0;a.length>o;)void 0!==(i=r(n,e=a[o++]))&&c(s,e,i);return s}})},function(t,e,i){var n=i(0),r=i(135)(!1);n(n.S,"Object",{values:function(t){return r(t)}})},function(t,e,i){var n=i(0),r=i(135)(!0);n(n.S,"Object",{entries:function(t){return r(t)}})},function(t,e,i){"use strict";var n=i(0),r=i(9),a=i(10),s=i(7);i(6)&&n(n.P+i(71),"Object",{__defineGetter__:function(t,e){s.f(r(this),t,{get:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(9),a=i(10),s=i(7);i(6)&&n(n.P+i(71),"Object",{__defineSetter__:function(t,e){s.f(r(this),t,{set:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(9),a=i(23),s=i(18),o=i(17).f;i(6)&&n(n.P+i(71),"Object",{__lookupGetter__:function(t){var e,i=r(this),n=a(t,!0);do{if(e=o(i,n))return e.get}while(i=s(i))}})},function(t,e,i){"use strict";var n=i(0),r=i(9),a=i(23),s=i(18),o=i(17).f;i(6)&&n(n.P+i(71),"Object",{__lookupSetter__:function(t){var e,i=r(this),n=a(t,!0);do{if(e=o(i,n))return e.set}while(i=s(i))}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Map",{toJSON:i(136)("Map")})},function(t,e,i){var n=i(0);n(n.P+n.R,"Set",{toJSON:i(136)("Set")})},function(t,e,i){i(72)("Map")},function(t,e,i){i(72)("Set")},function(t,e,i){i(72)("WeakMap")},function(t,e,i){i(72)("WeakSet")},function(t,e,i){i(73)("Map")},function(t,e,i){i(73)("Set")},function(t,e,i){i(73)("WeakMap")},function(t,e,i){i(73)("WeakSet")},function(t,e,i){var n=i(0);n(n.G,{global:i(2)})},function(t,e,i){var n=i(0);n(n.S,"System",{global:i(2)})},function(t,e,i){var n=i(0),r=i(21);n(n.S,"Error",{isError:function(t){return"Error"===r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clamp:function(t,e,i){return Math.min(i,Math.max(e,t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,e,i){var n=i(0),r=180/Math.PI;n(n.S,"Math",{degrees:function(t){return t*r}})},function(t,e,i){var n=i(0),a=i(138),s=i(118);n(n.S,"Math",{fscale:function(t,e,i,n,r){return s(a(t,e,i,n,r))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{iaddh:function(t,e,i,n){var r=t>>>0,a=i>>>0;return(e>>>0)+(n>>>0)+((r&a|(r|a)&~(r+a>>>0))>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{isubh:function(t,e,i,n){var r=t>>>0,a=i>>>0;return(e>>>0)-(n>>>0)-((~r&a|~(r^a)&r-a>>>0)>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{imulh:function(t,e){var i=+t,n=+e,r=65535&i,a=65535&n,s=i>>16,o=n>>16,l=(s*a>>>0)+(r*a>>>16);return s*o+(l>>16)+((r*o>>>0)+(65535&l)>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,e,i){var n=i(0),r=Math.PI/180;n(n.S,"Math",{radians:function(t){return t*r}})},function(t,e,i){var n=i(0);n(n.S,"Math",{scale:i(138)})},function(t,e,i){var n=i(0);n(n.S,"Math",{umulh:function(t,e){var i=+t,n=+e,r=65535&i,a=65535&n,s=i>>>16,o=n>>>16,l=(s*a>>>0)+(r*a>>>16);return s*o+(l>>>16)+((r*o>>>0)+(65535&l)>>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:0<t}})},function(t,e,i){"use strict";var n=i(0),r=i(19),a=i(2),s=i(67),o=i(125);n(n.P+n.R,"Promise",{finally:function(e){var i=s(this,r.Promise||a.Promise),t="function"==typeof e;return this.then(t?function(t){return o(i,e()).then(function(){return t})}:e,t?function(t){return o(i,e()).then(function(){throw t})}:e)}})},function(t,e,i){"use strict";var n=i(0),r=i(101),a=i(124);n(n.S,"Promise",{try:function(t){var e=r.f(this),i=a(t);return(i.e?e.reject:e.resolve)(i.v),e.promise}})},function(t,e,i){var n=i(30),r=i(1),a=n.key,s=n.set;n.exp({defineMetadata:function(t,e,i,n){s(t,e,r(i),a(n))}})},function(t,e,i){var n=i(30),a=i(1),s=n.key,o=n.map,l=n.store;n.exp({deleteMetadata:function(t,e){var i=arguments.length<3?void 0:s(arguments[2]),n=o(a(e),i,!1);if(void 0===n||!n.delete(t))return!1;if(n.size)return!0;var r=l.get(e);return r.delete(i),!!r.size||l.delete(e)}})},function(t,e,i){var n=i(30),r=i(1),a=i(18),s=n.has,o=n.get,l=n.key,u=function(t,e,i){if(s(t,e,i))return o(t,e,i);var n=a(e);return null!==n?u(t,n,i):void 0};n.exp({getMetadata:function(t,e){return u(t,r(e),arguments.length<3?void 0:l(arguments[2]))}})},function(t,e,i){var a=i(128),s=i(137),n=i(30),r=i(1),o=i(18),l=n.keys,u=n.key,h=function(t,e){var i=l(t,e),n=o(t);if(null===n)return i;var r=h(n,e);return r.length?i.length?s(new a(i.concat(r))):r:i};n.exp({getMetadataKeys:function(t){return h(r(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,e,i){var n=i(30),r=i(1),a=n.get,s=n.key;n.exp({getOwnMetadata:function(t,e){return a(t,r(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(30),r=i(1),a=n.keys,s=n.key;n.exp({getOwnMetadataKeys:function(t){return a(r(t),arguments.length<2?void 0:s(arguments[1]))}})},function(t,e,i){var n=i(30),r=i(1),a=i(18),s=n.has,o=n.key,l=function(t,e,i){if(s(t,e,i))return!0;var n=a(e);return null!==n&&l(t,n,i)};n.exp({hasMetadata:function(t,e){return l(t,r(e),arguments.length<3?void 0:o(arguments[2]))}})},function(t,e,i){var n=i(30),r=i(1),a=n.has,s=n.key;n.exp({hasOwnMetadata:function(t,e){return a(t,r(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(30),r=i(1),a=i(10),s=n.key,o=n.set;n.exp({metadata:function(i,n){return function(t,e){o(i,n,(void 0!==e?r:a)(t),s(e))}}})},function(t,e,i){var n=i(0),r=i(100)(),a=i(2).process,s="process"==i(21)(a);n(n.G,{asap:function(t){var e=s&&a.domain;r(e?e.bind(t):t)}})},function(t,e,i){"use strict";var n=i(0),a=i(2),s=i(19),r=i(100)(),o=i(5)("observable"),l=i(10),u=i(1),h=i(42),c=i(44),d=i(12),f=i(43),p=f.RETURN,g=function(t){return null==t?void 0:l(t)},m=function(t){var e=t._c;e&&(t._c=void 0,e())},v=function(t){return void 0===t._o},y=function(t){v(t)||(t._o=void 0,m(t))},b=function(e,t){u(e),this._c=void 0,this._o=e,e=new _(this);try{var i=t(e),n=i;null!=i&&("function"==typeof i.unsubscribe?i=function(){n.unsubscribe()}:l(i),this._c=i)}catch(t){return void e.error(t)}v(this)&&m(this)};b.prototype=c({},{unsubscribe:function(){y(this)}});var _=function(t){this._s=t};_.prototype=c({},{next:function(t){var e=this._s;if(!v(e)){var i=e._o;try{var n=g(i.next);if(n)return n.call(i,t)}catch(t){try{y(e)}finally{throw t}}}},error:function(t){var e=this._s;if(v(e))throw t;var i=e._o;e._o=void 0;try{var n=g(i.error);if(!n)throw t;t=n.call(i,t)}catch(t){try{m(e)}finally{throw t}}return m(e),t},complete:function(t){var e=this._s;if(!v(e)){var i=e._o;e._o=void 0;try{var n=g(i.complete);t=n?n.call(i,t):void 0}catch(t){try{m(e)}finally{throw t}}return m(e),t}}});var T=function(t){h(this,T,"Observable","_f")._f=l(t)};c(T.prototype,{subscribe:function(t){return new b(t,this._f)},forEach:function(n){var r=this;return new(s.Promise||a.Promise)(function(t,e){l(n);var i=r.subscribe({next:function(t){try{return n(t)}catch(t){e(t),i.unsubscribe()}},error:e,complete:t})})}}),c(T,{from:function(t){var e="function"==typeof this?this:T,i=g(u(t)[o]);if(i){var n=u(i.call(t));return n.constructor===e?n:new e(function(t){return n.subscribe(t)})}return new e(function(e){var i=!1;return r(function(){if(!i){try{if(f(t,!1,function(t){if(e.next(t),i)return p})===p)return}catch(t){if(i)throw t;return void e.error(t)}e.complete()}}),function(){i=!0}})},of:function(){for(var t=0,e=arguments.length,n=new Array(e);t<e;)n[t]=arguments[t++];return new("function"==typeof this?this:T)(function(e){var i=!1;return r(function(){if(!i){for(var t=0;t<n.length;++t)if(e.next(n[t]),i)return;e.complete()}}),function(){i=!0}})}}),d(T.prototype,o,function(){return this}),n(n.G,{Observable:T}),i(41)("Observable")},function(t,e,i){var n=i(2),r=i(0),a=i(68),s=[].slice,o=/MSIE .\./.test(a),l=function(r){return function(t,e){var i=2<arguments.length,n=!!i&&s.call(arguments,2);return r(i?function(){("function"==typeof t?t:Function(t)).apply(this,n)}:t,e)}};r(r.G+r.B+r.F*o,{setTimeout:l(n.setTimeout),setInterval:l(n.setInterval)})},function(t,e,i){var n=i(0),r=i(99);n(n.G+n.B,{setImmediate:r.set,clearImmediate:r.clear})},function(t,e,i){for(var n=i(98),r=i(37),a=i(13),s=i(2),o=i(12),l=i(49),u=i(5),h=u("iterator"),c=u("toStringTag"),d=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),g=0;g<p.length;g++){var m,v=p[g],y=f[v],b=s[v],_=b&&b.prototype;if(_&&(_[h]||o(_,h,d),_[c]||o(_,c,v),l[v]=d,y))for(m in n)_[m]||a(_,m,n[m],!0)}},function(R,t,e){(function(t){!function(t){"use strict";var l,e=Object.prototype,u=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag",s="object"==typeof R,o=t.regeneratorRuntime;if(o)s&&(R.exports=o);else{(o=t.regeneratorRuntime=s?R.exports:{}).wrap=b;var c="suspendedStart",d="suspendedYield",f="executing",p="completed",g={},h={};h[r]=function(){return this};var m=Object.getPrototypeOf,v=m&&m(m(x([])));v&&v!==e&&u.call(v,r)&&(h=v);var y=S.prototype=T.prototype=Object.create(h);E.prototype=y.constructor=S,S.constructor=E,S[a]=E.displayName="GeneratorFunction",o.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,S):(t.__proto__=S,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(y),t},o.awrap=function(t){return{__await:t}},w(k.prototype),k.prototype[n]=function(){return this},o.AsyncIterator=k,o.async=function(t,e,i,n){var r=new k(b(t,e,i,n));return o.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},w(y),y[a]="Generator",y[r]=function(){return this},y.toString=function(){return"[object Generator]"},o.keys=function(i){var n=[];for(var t in i)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in i)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=x,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function t(t,e){return a.type="throw",a.arg=i,n.next=t,e&&(n.method="next",n.arg=l),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e],a=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=u.call(r,"catchLoc"),o=u.call(r,"finallyLoc");if(s&&o){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),P(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;P(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:x(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=l),g}}}function b(t,e,i,n){var a,s,o,l,r=e&&e.prototype instanceof T?e:T,u=Object.create(r.prototype),h=new C(n||[]);return u._invoke=(a=t,s=i,o=h,l=c,function(t,e){if(l===f)throw new Error("Generator is already running");if(l===p){if("throw"===t)throw e;return I()}for(o.method=t,o.arg=e;;){var i=o.delegate;if(i){var n=A(i,o);if(n){if(n===g)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(l===c)throw l=p,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);l=f;var r=_(a,s,o);if("normal"===r.type){if(l=o.done?p:d,r.arg===g)continue;return{value:r.arg,done:o.done}}"throw"===r.type&&(l=p,o.method="throw",o.arg=r.arg)}}),u}function _(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function T(){}function E(){}function S(){}function w(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function k(o){function l(t,e,i,n){var r=_(o[t],o,e);if("throw"!==r.type){var a=r.arg,s=a.value;return s&&"object"==typeof s&&u.call(s,"__await")?Promise.resolve(s.__await).then(function(t){l("next",t,i,n)},function(t){l("throw",t,i,n)}):Promise.resolve(s).then(function(t){a.value=t,i(a)},n)}n(r.arg)}var e;"object"==typeof t.process&&t.process.domain&&(l=t.process.domain.bind(l)),this._invoke=function(i,n){function t(){return new Promise(function(t,e){l(i,n,t,e)})}return e=e?e.then(t,t):t()}}function A(t,e){var i=t.iterator[e.method];if(i===l){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=l,A(t,e),"throw"===e.method))return g;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var n=_(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,g;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=l),e.delegate=null,g):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function x(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(u.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=l,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:l,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,e(58))},function(t,e,i){i(346),t.exports=i(19).RegExp.escape},function(t,e,i){var n=i(0),r=i(347)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(t){return r(t)}})},function(t,e){t.exports=function(e,i){var n=i===Object(i)?function(t){return i[t]}:i;return function(t){return String(t).replace(e,n)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FakeEventTarget=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),r=i(139);e.FakeEventTarget=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners_=new r.MultiMap}return n(t,[{key:"addEventListener",value:function(t,e,i){this.listeners_.push(t,e)}},{key:"removeEventListener",value:function(t,e,i){this.listeners_.remove(t,e)}},{key:"destroy",value:function(){this.listeners_.clear()}},{key:"dispatchEvent",value:function(t){for(var e=this.listeners_.get(t.type)||[],i=0;i<e.length;++i){t.target=this,t.currentTarget=this;var n=e[i];try{n.handleEvent?n.handleEvent(t):n.call(this,t)}catch(t){}if(t.stopped)break}return t.defaultPrevented}}]),t}()},function(t,e,i){(function(t){!function(t){"use strict";t.exports.is_uri=c,t.exports.is_http_uri=e,t.exports.is_https_uri=i,t.exports.is_web_uri=n,t.exports.isUri=c,t.exports.isHttpUri=e,t.exports.isHttpsUri=i,t.exports.isWebUri=n;var h=function(t){return t.match(/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/)};function c(t){if(t&&!/[^a-z0-9\:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\.\-\_\~\%]/i.test(t)&&!/%[^0-9a-f]/i.test(t)&&!/%[0-9a-f](:?[^0-9a-f]|$)/i.test(t)){var e,i,n,r,a,s="",o="";if(s=(e=h(t))[1],i=e[2],n=e[3],r=e[4],a=e[5],s&&s.length&&0<=n.length){if(i&&i.length){if(0!==n.length&&!/^\//.test(n))return}else if(/^\/\//.test(n))return;if(/^[a-z][a-z0-9\+\-\.]*$/.test(s.toLowerCase()))return o+=s+":",i&&i.length&&(o+="//"+i),o+=n,r&&r.length&&(o+="?"+r),a&&a.length&&(o+="#"+a),o}}}function e(t,e){if(c(t)){var i,n,r,a,s="",o="",l="",u="";if(s=(i=h(t))[1],o=i[2],n=i[3],r=i[4],a=i[5],s){if(e){if("https"!=s.toLowerCase())return}else if("http"!=s.toLowerCase())return;if(o)return/:(\d+)$/.test(o)&&(l=o.match(/:(\d+)$/)[0],o=o.replace(/:\d+$/,"")),u+=s+":",u+="//"+o,l&&(u+=l),u+=n,r&&r.length&&(u+="?"+r),a&&a.length&&(u+="#"+a),u}}}function i(t){return e(t,!0)}function n(t){return e(t)||i(t)}}(t)}).call(this,i(350)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(e,t){(function(t){e.exports=t}).call(this,{})},function(t,e,i){var n,r={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};void 0===(n=function(){var t=function(){};return t.toISO6391=function(t){return r[t]?r[t]:t},t}.apply(e,[]))||(t.exports=n)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StateManager=void 0;var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=i(45),s=i(51),o=i(11);var n=e.StateManager=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t._logger));return i._video=t._video,i._state=n.State.IDLE,i._playStarted=!1,i._inUserSeeking=!1,i._inSeeking=!1,i._bufferingTime=0,i._startBufferingTime=-1,i._stateCallback=e,i._eventManager=new a.EventManager,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,s.Logger),r(n,[{key:"destroy",value:function(){this._video=null,this._player=null,this._eventManager&&this._eventManager.removeAll()}},{key:"_onLoadStart",value:function(t){this._video.error&&4===this._video.error.code||this._setState(n.State.BUFFERING,{from:"loadstart"})}},{key:"_onTimeUpdate",value:function(t){0===this._video.playbackRate||this._inSeeking||(this._video.paused?this._setState(n.State.PAUSED,{from:"timeupdate"}):this._setState(n.State.PLAYING,{from:"timeupdate"}))}},{key:"_onCanPlayThrough",value:function(t){this._video.paused?this._setState(n.State.PAUSED,{from:"canplaythrough"}):this._setState(n.State.PLAYING,{from:"canplaythrough"})}},{key:"_onPlaying",value:function(t){}},{key:"_onPlay",value:function(t){this._setState(n.State.STARTPLAY,{from:"play"})}},{key:"_onPause",value:function(t){this._setState(n.State.PAUSED,{from:"paused"})}},{key:"_onEnded",value:function(t){this.reset({reason:n.ActionReason.COMPLETE})}},{key:"_onAbort",value:function(t){}},{key:"_onError",value:function(t){this.reset({reason:n.ActionReason.ERROR})}},{key:"_onWaiting",value:function(t){this._setState(n.State.BUFFERING,{from:"waiting"})}},{key:"_onStalled",value:function(t){this._setState(n.State.BUFFERING,{from:"stalled"})}},{key:"_onRateChange",value:function(t){0===this._video.playbackRate&&this._playStarted&&this._setState(n.State.BUFFERING,{from:"ratechange"})}},{key:"_onSeeking",value:function(t){this._inSeeking=!0,this._setState(n.State.SEEKING,{from:"seeking"})}},{key:"_onSeeked",value:function(t){this._inSeeking=!1,this._inUserSeeking=!1,this._setState(n.State.BUFFERING,{from:"seeked"})}},{key:"reset",value:function(t){this._setState(n.State.IDLE,{from:t}),this._playStarted=!1,this._inUserSeeking=!1,this._startBufferingTime=-1,this._bufferingTime=0,t.reason===n.ActionReason.START?(this._eventManager.listen(this._video,"loadstart",this._onLoadStart.bind(this)),this._eventManager.listen(this._video,"ended",this._onEnded.bind(this)),this._eventManager.listen(this._video,"abort",this._onAbort.bind(this)),this._eventManager.listen(this._video,"seeking",this._onSeeking.bind(this)),this._eventManager.listen(this._video,"seeked",this._onSeeked.bind(this)),this._eventManager.listen(this._video,"timeupdate",this._onTimeUpdate.bind(this)),this._eventManager.listen(this._video,"waiting",this._onWaiting.bind(this)),this._eventManager.listen(this._video,"ratechange",this._onRateChange.bind(this)),this._eventManager.listen(this._video,"canplaythrough",this._onCanPlayThrough.bind(this)),this._eventManager.listen(this._video,"play",this._onPlay.bind(this)),this._eventManager.listen(this._video,"pause",this._onPause.bind(this))):t.reason!==n.ActionReason.ABORT&&t.reason!==n.ActionReason.ERROR||this._eventManager.removeAll()}},{key:"notifyUserSeek",value:function(){this._inUserSeeking=!0}},{key:"_setState",value:function(t,e){if(t!==this._state){var i=this._state;(this._state=t)===n.State.PLAYING?(this._playStarted=!0,(e=e||{}).playStart=!0,0<this._startBufferingTime&&(this._bufferingTime+=Date.now()-this._startBufferingTime,this.print(o.AdaptivePlayer.LogLevel.DEBUG,"StateManager","End Trigger BufferTime: "+this._bufferingTime+" from: "+e.from),this._startBufferingTime=-1)):t!==n.State.BUFFERING&&t!==n.State.SEEKING||this._startBufferingTime<0&&(this._startBufferingTime=Date.now(),this.print(o.AdaptivePlayer.LogLevel.DEBUG,"StateManager","Start Trigger BufferTime: "+this._startBufferingTime+" from: "+e.from)),this._stateCallback(i,t,e),this.print(o.AdaptivePlayer.LogLevel.DEBUG,"StateManager","Fired StateChange: "+i+"->"+t)}}},{key:"getState",value:function(){return this._state}},{key:"getBufferingTime",value:function(){return this._bufferingTime}}]),n}();n.State={IDLE:"idle",LOADING:"loading",BUFFERING:"buffering",STARTPLAY:"play",PLAYING:"playing",PAUSED:"paused",SEEKING:"seeking"},n.ActionReason={START:"start",ABORT:"abort",COMPLETE:"complete",ERROR:"error"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StatisticManager=void 0;var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=i(11),s=i(28),o=i(34),l=i(51);e.StatisticManager=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e._logger));return i._eventHandler=e,i._video=t,i.startWatchDog=null,i.seekWatchDog=null,i._onError=null,i._errConfig={url:"",level:0},i.errorCheckList=[],n.WATCHDOG_TIMEOUT=1e4,n.ERROR_CHECK_INTERVAL=3e4,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,l.Logger),r(n,[{key:"stop",value:function(){this.stopLoadWatchDog(),this.stopSeekWatchDog()}},{key:"setErrorCallback",value:function(t,e){this._onError=t,this._errConfig=e}},{key:"getErrorConfig",value:function(){return this._errConfig}},{key:"_generateCheckFunction",value:function(t){return function(t,e){return t.compare(e)}.bind(null,t)}},{key:"_onCheckErrorInfo",value:function(t){for(var e=0;e<this.errorCheckList.length;e++){var i=this.errorCheckList[e];if(Date.now()-i.time>n.ERROR_CHECK_INTERVAL)this.errorCheckList.splice(e,1),e--;else if(i.checkFunc(t))return!0}return this.errorCheckList.push({checkFunc:this._generateCheckFunction(t),time:Date.now()}),!1}},{key:"reset",value:function(t){this.startWatchDog&&(this.stopLoadWatchDog(),this.startWatchDog=null),this.seekWatchDog&&(this.stopSeekWatchDog(),this.seekWatchDog=null),this.errorCheckList=[],this._errConfig.url=t,this.startLoadWatchDog()}},{key:"startLoadWatchDog",value:function(){this.startWatchDog&&this.stopLoadWatchDog(),this.startWatchDog=window.setTimeout(function(){var t=s.NLError.Code.Start_Playback_Timeout,e=s.NLError.SeverityLevel.Warning,i=s.NLError.create(t,e,this._errConfig.url,"Start playback timeout");this.reportError(i)}.bind(this),n.WATCHDOG_TIMEOUT)}},{key:"startSeekWatchDog",value:function(){this.seekWatchDog&&this.stopSeekWatchDog(),this.seekWatchDog=window.setTimeout(function(){var t=s.NLError.Code.Seek_Timeout,e=s.NLError.SeverityLevel.Warning,i=s.NLError.create(t,e,this._errConfig.url,"Seek timeout");this.reportError(i)}.bind(this),n.WATCHDOG_TIMEOUT)}},{key:"stopLoadWatchDog",value:function(){this.startWatchDog&&(this.startWatchDog=window.clearTimeout(this.startWatchDog))}},{key:"stopSeekWatchDog",value:function(){this.seekWatchDog&&(this.seekWatchDog=window.clearTimeout(this.seekWatchDog))}},{key:"reportUnsupportedSchema",value:function(t){var e=s.NLError.Code.Get_Primary_Manifest_Failed+s.NLError.NetworkDetailCode.Connect_Failed,i=s.NLError.SeverityLevel.Fatal;this.reportError(s.NLError.create(e,i,t,"load with wrong url!"))}},{key:"reportUnsupported",value:function(){var t=s.NLError.Code.Platform_Not_Supported,e=s.NLError.SeverityLevel.Fatal,i=s.NLError.create(t,e,this._errConfig.url,"Your Browser does not support MSE or WebRTC");this.reportError(i)}},{key:"reportNativeVideoError",value:function(t,e){var i=e||s.NLError.Code.Playback_Generic_Error,n=s.NLError.SeverityLevel.Fatal,r=s.NLError.create(i,n,this._errConfig.url,t);this.reportError(r)}},{key:"reportError",value:function(t){!t.isValid()||this._onCheckErrorInfo(t)||this._errConfig&&this._errConfig.level&&this._errConfig.level<t.level||(this._onError&&t.level<=s.NLError.SeverityLevel.Error&&this._onError(t.toJSON()),t.level>s.NLError.SeverityLevel.Error&&(t.code+=5e3),this._eventHandler.dispatchEvent(new o.FakeEvent(a.AdaptivePlayer.EventType.Error,{details:t.toJSON()})),this.print(a.AdaptivePlayer.LogLevel.INFO,"StatisticManager","Trigger Error event: "+JSON.stringify(t.toJSON())))}}]),n}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CuepointManager=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=i(11),o=i(142),r=i(34),l=i(51);(e.CuepointManager=function(t){function s(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t._logger));return e._eventHandler=t,e._cuepoints=[],e._cuepoints_bak=[],e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(s,l.Logger),n(s,[{key:"dispatch",value:function(t,e){this._eventHandler.dispatchEvent(new r.FakeEvent(a.AdaptivePlayer.EventType.ID3Event,{start:t,end:t,value:e})),this.print(a.AdaptivePlayer.LogLevel.DEBUG,"CuePointManager","CuePoint Triggered: "+t),e&&e.dict&&e.dict.cueType&&("start"===e.dict.cueType||"keep"===e.dict.cueType)&&this._eventHandler.clearWrongCues()}},{key:"cleanup",value:function(){this._cuepoints.splice(0,this._cuepoints.length),this._cuepoints_bak.splice(0,this._cuepoints_bak.length)}},{key:"clearID3",value:function(){this._cuepoints.splice(0,this._cuepoints.length),this._cuepoints=this._cuepoints_bak.slice()}},{key:"onTimeUpdate",value:function(t){this._cuepoints.sort(function(t,e){return t.pts-e.pts});for(var e=0;e<this._cuepoints.length;e++){var i=this._cuepoints[e];if(i.pts<=t.currentTime&&i.pts>=t.currentTime-1){var n={key:i.dict.key,dict:i.dict};this._cuepoints.splice(e,1),e--,this.dispatch(i.pts,n)}else if(i.pts>t.currentTime)break}}},{key:"onID3",value:function(e){if(e&&(e.data||e.unit)&&!isNaN(e.pts))if(this._cuepoints.some(function(t){return t.pts===e.pts&&t.type===s.CUE_TYPE.ID3.value}))this.print(a.AdaptivePlayer.LogLevel.WARNING,"CuePointManager","onID3: ID3 with sample pts already exists: "+e.pts);else{var t=e.unit||e.data,i=new o.ID3(t);e.dict={};var n=i.dict();for(var r in n)e.dict[r]=n[r];e.type=s.CUE_TYPE.ID3.value,void 0!==e.dict.type&&(e.dict.tag=e.dict.type),e.dict.type=s.CUE_TYPE.ID3.name,this._cuepoints.push(e),this._cuepoints_bak.push(e),this._cuepoints.sort(function(t,e){return t.pts-e.pts}),this._cuepoints_bak.sort(function(t,e){return t.pts-e.pts})}else this.print(a.AdaptivePlayer.LogLevel.WARNING,"CuePointManager","onID3: Wrong ID3 data")}},{key:"onNativeID3",value:function(t){try{var e={raw:t.value||t.data,key:t.value.key,dict:t.value.data["ad-list"]?t.value.data["ad-list"][0]:t.value};e.dict.type=s.CUE_TYPE.ID3.name,e.dict.data&&(e.dict.value=e.dict.data,e.dict.info||(e.dict.info=e.dict.data)),this.print(a.AdaptivePlayer.LogLevel.TRACE,"CuePointManager","Native ID3 got: "+t.startTime),this.dispatch(t.startTime,e)}catch(t){this.print(a.AdaptivePlayer.LogLevel.WARNING,"CuePointManager","Native ID3 got, but no adlist value")}}},{key:"addCuepoints",value:function(t){return t.forEach(function(t){t&&t.dict&&t.time&&(t.pts=t.time,t.data={},t.type=s.CUE_TYPE.CUE_POINT.value,t.dict.type=s.CUE_TYPE.CUE_POINT.name,this._cuepoints.push(t),this._cuepoints_bak.push(t))},this),this._cuepoints.sort(function(t,e){return t.pts-e.pts}),this._cuepoints_bak.sort(function(t,e){return t.pts-e.pts}),!0}},{key:"removeCuepoint",value:function(n,r){var a=!1;return n&&r&&[this._cuepoints,this._cuepoints_bak].forEach(function(t){for(var e=0;e<t.length;e++){var i=t[e];i&&i.type===s.CUE_TYPE.CUE_POINT.value&&i.pts&&i.pts===n&&i.dict&&i.dict.name&&i.dict.name===r&&(t.splice(e,1),e--,a=!0)}}),a}},{key:"getCuepoints",value:function(){for(var t=[],e=0;e<this._cuepoints_bak.length;e++){var i=this._cuepoints_bak[e];i&&i.type===s.CUE_TYPE.CUE_POINT.value&&t.push(i)}return t}},{key:"removeAllCuepoints",value:function(){[this._cuepoints,this._cuepoints_bak].forEach(function(t){for(var e=0;e<t.length;e++){var i=t[e];i&&i.type===s.CUE_TYPE.CUE_POINT.value&&(t.splice(e,1),e--)}})}}]),s}()).CUE_TYPE={ID3:{value:1,name:"id3"},CUE_POINT:{value:2,name:"cuepoint"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MultiviewsManager=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),c=i(11),r=i(51);e.MultiviewsManager=function(t){function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t._logger));return e._player=t,e._syncupPlayers=null,e._syncTimer=null,e._resumeTimer=null,e.MIN_TIME_OFFSET=.2,e.SEEK_RANGE=3,e.SYNC_TIMER_INTERVAL=200,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,r.Logger),n(i,[{key:"_onStateChanged",value:function(t){this._syncUp(t.target)}},{key:"_getTimeOffset",value:function(){if(!this._syncupPlayers)return 0;if(""===!this._player.src)return 0;for(var t=this._player.currentTime,e=t,i=0;i<this._syncupPlayers.length;i++){var n=this._syncupPlayers[i];if(n.src&&!(n.readyState<2)){var r=n.currentTime;r<t&&(t=r),e<r&&(e=r)}}return this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","sync timeOffset: "+Math.abs(e-t)),Math.abs(e-t)}},{key:"_onCheckTimer",value:function(){!this._syncupPlayers&&this._syncTimer&&(this._syncTimer=window.clearInterval(this._syncTimer)),this._syncUp(this._player)}},{key:"setSyncViews",value:function(t){if(this._syncupPlayers&&(this._syncupPlayers.forEach(function(t){this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","remove secondary player: "+t.viewId),t.removeEventListener(c.AdaptivePlayer.EventType.StateChange,this._onStateChanged.bind(this))}.bind(this)),this._player.removeEventListener(c.AdaptivePlayer.EventType.StateChange,this._onStateChanged.bind(this)),clearInterval(this._syncTimer)),0<t.length){this._syncupPlayers=[];var e=0;t.forEach(function(t){t&&(t.viewId="player"+e++,this._syncupPlayers.push(t),t.addEventListener(c.AdaptivePlayer.EventType.StateChange,this._onStateChanged.bind(this)),this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary player: "+t.viewId+" added!"))}.bind(this)),this._player.addEventListener(c.AdaptivePlayer.EventType.StateChange,this._onStateChanged.bind(this)),this._syncTimer=window.setInterval(this._onCheckTimer.bind(this),"MultiviewManager".SYNC_TIMER_INTERVAL)}}},{key:"_syncUp",value:function(){if(this._syncupPlayers)if(this._syncupPlayers.filter(function(t){return!!t.src&&2<t.readyState}).length<=0)this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player not ready");else{var e=this._player.playbackRate;this._syncupPlayers.forEach(function(t){.1<Math.abs(t.playbackRate-e)&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","sync secondary playbackRate: "+t.viewId+" : "+t.playbackRate+"->"+e),t.playbackRate=e)}.bind(this));var t=this._player.getState();t!==c.AdaptivePlayer.State.BUFFERING&&t!==c.AdaptivePlayer.State.PLAYING&&t!==c.AdaptivePlayer.State.PAUSED&&t!==c.AdaptivePlayer.State.SEEKING||(this._syncupPlayers.forEach(function(t){t.getState()===c.AdaptivePlayer.State.IDLE&&t.src&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","load secondary Player: "+t.viewId),t.load())}.bind(this)),this._player._playerType===c.AdaptivePlayer.PlayerType.NATIVE?this._syncNativePlay():this._syncPlay()),this._player.getState()===c.AdaptivePlayer.State.IDLE&&this._syncupPlayers.forEach(function(t){t.getState()!==c.AdaptivePlayer.State.IDLE&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","stop secondary Player: "+t.viewId),t.stop())}.bind(this))}}},{key:"_innerSeek",value:function(e,t,i){if(e&&e.src){var n=function t(){e.removeEventListener("seeked",t),e.addEventListener("timeupdate",r),window.setTimeout(function(){e.removeEventListener("timeupdate",r),i(e.currentTime)},500)},r=function t(){e.removeEventListener("timeupdate",t),i(e.currentTime)};e.addEventListener("seeking",function t(){e.removeEventListener("seeking",t),e.addEventListener("seeked",n)}),e.currentTime=t}}},{key:"_syncPlay",value:function(){var i=this._player.currentTime;if(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","Main Player CurrentTime: "+i),this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","Main Player State: "+this._player.getState()),this._syncupPlayers.filter(function(t){return!!t.src&&2<t.readyState}).length<=0)this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player not ready");else{if(this._player.getState()===c.AdaptivePlayer.State.PAUSED)return this._syncupPlayers.forEach(function(t){t.getState()!==c.AdaptivePlayer.State.PLAYING&&t.getState()!==c.AdaptivePlayer.State.BUFFERING||(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","made secondary Player Paused : "+t.viewId),t.pause())}.bind(this)),void this._syncupPlayers.forEach(function(t){if(t.getState()===c.AdaptivePlayer.State.PAUSED){var e=i-t.currentTime;Math.abs(e)>this.MIN_TIME_OFFSET&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","made secondary Player seek to main Player playheadTime: "+t.viewId+" : "+t.currentTime+"->"+i),t.currentTime=i)}}.bind(this));if(this._player.getState()===c.AdaptivePlayer.State.PLAYING){var t=this.MIN_TIME_OFFSET/2,e=this._player.playbackRate;0<e&&(t*=e);var n=i-t,r=i+t,a=i+this.SEEK_RANGE;this._syncupPlayers.forEach(function(t){if(t.getState()!==c.AdaptivePlayer.State.SEEKING&&t.getState()!==c.AdaptivePlayer.State.IDLE){var e=t.currentTime;this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player CurrentTime: "+t.viewId+" : "+e+","+a+", ["+n+", "+r+"]"),e<n||a<e?t.getState()!==c.AdaptivePlayer.State.PLAYING&&t.getState()!==c.AdaptivePlayer.State.BUFFERING&&t.getState()!==c.AdaptivePlayer.State.PAUSED||(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","made secondary Player Paused "+t.viewId+":"),t.pause(),this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","made secondary Player seek to main Player playheadTime: "+t.viewId+" : "+e+"->"+a),t.currentTime=a):r<e?t.getState()===c.AdaptivePlayer.State.PLAYING&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","made secondary Player Paused"+t.viewId+" :"),t.pause()):n<=e&&e<=r&&t.getState()===c.AdaptivePlayer.State.PAUSED&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","made secondary Player Play"+t.viewId+" :"),t.play())}}.bind(this)),this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","Main Player State: "+this._player.getState()),this._syncupPlayers.forEach(function(t){!t.src||t.readyState<2||this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player State: "+t.viewId+"/"+t.getState())}.bind(this))}}}},{key:"_syncNativePlay",value:function(){var e=this._syncupPlayers.filter(function(t){return!!t.src&&2<t.readyState})[0];if(e){var t=this._player.currentTime,i=this.MIN_TIME_OFFSET/2,n=this._player.playbackRate;0<n&&(i*=n);var r=t-i,a=t+i,s=t+this.SEEK_RANGE,o=!1,l=!1;if(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","Main Player CurrentTime: "+t),this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","Main Player State: "+this._player.getState()),this._player.getState()!==c.AdaptivePlayer.State.PAUSED)if(this._player.getState()!==c.AdaptivePlayer.State.PLAYING)this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","Main Player State: "+this._player.getState()),this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player State: "+e.getState());else{if(e.getState()===c.AdaptivePlayer.State.SEEKING||e.getState()===c.AdaptivePlayer.State.IDLE)return;var u=e.currentTime;if(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player CurrentTime: "+e.viewId+" : "+u),u<r||s<u){if(e.getState()===c.AdaptivePlayer.State.PLAYING||e.getState()===c.AdaptivePlayer.State.BUFFERING||e.getState()===c.AdaptivePlayer.State.PAUSED){if(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player currentTime: "+u),l)return;this._innerSeek(e,s,function(t){this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","inner seek: currentTime: "+e.currentTime+" to: "+s+" accurate: "+t),a<t?(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","set secondary Player inSyncing true, made secondary player pause"),e.pause()):t<r?(this._player.pause(),o=!0,this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","set MainPlayer inSyncing true, made MainPlayer pause")):(l=!1,this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","set MainPlayer inSyncing false, seek point is in sync range"))}.bind(this)),l=!0}}else r<=u&&u<=a&&(e.getState()===c.AdaptivePlayer.State.PAUSED&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","set secondary Player inSyncing false, made secondary player play"),e.play()),l&&(l=!1))}else if(e.getState()===c.AdaptivePlayer.State.PLAYING||e.getState()===c.AdaptivePlayer.State.BUFFERING||e.getState()===c.AdaptivePlayer.State.PAUSED){this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player CurrentTime: "+e.currentTime);var h=t-e.currentTime;if(Math.abs(h)>this.MIN_TIME_OFFSET){if(l)return;this._innerSeek(e,s,function(t){this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","inner seek: currentTime: "+e.currentTime+" to: "+s+" accurate: "+t),r<=t&&(this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","set secondary Player inSyncing true, made secondary player pause"),e.pause())}.bind(this)),l=!0}else o&&(e.play(),this._player.play(),o=l=!1,this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","set secondary Player inSyncing false, made MainPlayer & SecondarayPlayer play"))}}else this.print(c.AdaptivePlayer.LogLevel.TRACE,"MultiviewManager","secondary Player not ready")}}]),i}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DebugPanel=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=r(i(358)),g=r(i(359)),m=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(52)),v=i(11),s=i(46),o=i(51);function r(t){return t&&t.__esModule?t:{default:t}}var l=["Version","Url","Control","State","HttpServer","Download","Switch","Buffer","Frames","VideoPlayer","Time","Event","Ad"],u=[{S1:"CpUrl",S2:"CpUrl"},{S1:"Copy",S2:"Copy"},{S1:"Chart",S2:"Text"},{S1:"Close",S2:"Close"}];function h(t,e,i,n){return"panel_inform_column_"+t+"_"+e+"_row_"+i+"_"+n}function c(t,e,i,n,r){i.innerHTML="I"===e?t+":    ":"",i.id=h("caption",t,e,n),i.style.cssText=r}e.DebugPanel=function(t){function r(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t._logger));i._video=t._video,i._player=t;var n=v.AdaptivePlayer.browserType.toLowerCase();return i._isFirefox=-1!==n.search("firefox"),i._isMacOS="Mac OS"===v.AdaptivePlayer.OS.name,i._clipboardCopy=null,i._clipboardCpUrl=null,i._clipboardText=null,i._hashId=i._uniqueid(),i._refreshInterval=!e||e<=0?s.Settings.DEBUG_PANEL.REFRESH_INTERVAL:e,i._panel={container:i._video.parentNode,div_root:null,div_informs:null,table_informs:null,canvas_chart:null,canvas_chartCxt:null,div_buttons:null,div_buttons_button:null,buttonsId:[]},i._panelStyle={div_root_hidden:"display:block; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; visibility: hidden; overflow: hidden; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;",div_root_show:"z-index: 99;display: block;position: absolute;top: 0px;left: 0px;width: 100%;height: 220px;visibility: visible;overflow: hidden;box-sizing: border-box;background: black;opacity: 0.8;",div_informs:"display:block; position: absolute; left: 65px; width: 90%; overflow: hidden;",table_informs:"display:block; position: absolute; width: 100%; height: 100%; overflow: hidden;",table_informs_colomns:"font: bold 12px arial,serif; vertical-align: text-top; overflow: hidden; white-space:nowrap; text-overflow:ellipsis; word-break:keep-all; color: #FFFFFF;",table_informs_colomns_data:"font: bold 12px arial,serif; vertical-align: text-top; overflow: hidden; white-space:nowrap; text-overflow:ellipsis; word-break:keep-all; color: #FFFFFF; position: absolute;",canvas_chart:"display:none; position: absolute; left: 55px; width: 90px; overflow: hidden;",div_buttons:"display:block; position: absolute; width: 60px;",div_buttons_button:"font: bold 12px arial,serif; width: 100%; color: #FFFFFF; background-color: #FF0000; padding: 0px; opacity:0.8;",chartCSS:".dygraph-axis-label {z-index: 10;line-height: normal;overflow: hidden;color: white;font: bold 12px arial,serif;} .dygraph-legend {position: absolute;font-size: 12px;line-height: normal;text-align: left;overflow: hidden;color: white;font: bold 12px arial,serif;}"},i._init=!1,i._showPanel=null,i._downloadDataset=[],i._bufferSize=s.Settings.DEBUG_PANEL.DATA_BUFFER_SIZE,i.ACTIVATE_AREA=s.Settings.DEBUG_PANEL.ACTIVATE_AREA,i._seekRange={start:0,end:0},i._player.addEventListener(v.AdaptivePlayer.EventType.ID3Event,i._onID3.bind(i)),i._player.addEventListener(v.AdaptivePlayer.EventType.AdEvent,i._onAds.bind(i)),i._player.addEventListener(v.AdaptivePlayer.EventType.SeekRangeChange,i._onSeekRangeChanged.bind(i)),i._player.addEventListener(v.AdaptivePlayer.EventType.PlayStart,i._onPlayStart.bind(i)),i._player.addEventListener(v.AdaptivePlayer.EventType.PlayEnd,i.reset.bind(i)),i.init(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,o.Logger),n(r,[{key:"destroy",value:function(){this.stopDebug(),this._video=null,this._player=null,this._panel&&this._panel.container.removeChild(this._panel.div_root),this._panel=null,this._init=!1,this._browserType=null,this._clipboardCopy=null,this._clipboardCpUrl=null,this._clipboardText=null,this._hashId=null}},{key:"clipboaddCB",value:function(){return this._clipboardText}},{key:"init",value:function(){if(!1===this._init){this.initHtmlElement_();for(var t=0;t<u.length;t++){var e=h("button",u[t].S1,"div_buttons",this._hashId);this._panel.buttonsId.push(e)}var i=document.getElementById(this._panel.buttonsId[0]);i&&(this._clipboardCpUrl=new a.default(i,{text:this.clipboaddCB.bind(this)}));var n=document.getElementById(this._panel.buttonsId[1]);n&&(this._clipboardCopy=new a.default(n,{text:this.clipboaddCB.bind(this)}));document.getElementById(this._panel.buttonsId[2]);this._init=!0}}},{key:"initHtmlElement_",value:function(){this._panel.div_root=document.createElement("div"),this._panel.div_root.id="debug_panel_id_"+this._hashId,this._panel.div_root.style.cssText=this._panelStyle.div_root_hidden,this._panel.container.appendChild(this._panel.div_root),this._panel.div_buttons=document.createElement("div"),this._panel.div_buttons.style.cssText=this._panelStyle.div_buttons,this._panel.div_buttons_button=function(t,e,i,n){for(var r=0;r<u.length;r++){var a=document.createElement("BUTTON");a.id=h("button",u[r].S1,"div_buttons",i),a.class="debugcopybtns",a.innerHTML=u[r].S1,a.addEventListener("click",e,!1),a.style.cssText=n,t.appendChild(a)}}(this._panel.div_buttons,this.buttonClick_.bind(this),this._hashId,this._panelStyle.div_buttons_button),this._panel.div_root.appendChild(this._panel.div_buttons),this._panel.div_informs=document.createElement("div"),this._panel.div_informs.style.cssText=this._panelStyle.div_informs,this._panel.div_root.appendChild(this._panel.div_informs),this._panel.table_informs=document.createElement("table"),this._panel.table_informs.id=h("table","table_informs","I",this._hashId),function(t,e,i,n){var r=void 0,a=void 0;t.deleteTHead();for(var s=0;s<l.length;s++)a=(r=t.insertRow()).insertCell(),c(l[s],"I",a,e,i),a=r.insertCell(),c(l[s],"II",a,e,n)}(this._panel.table_informs,this._hashId,this._panelStyle.table_informs_colomns,this._panelStyle.table_informs_colomns_data),this._panel.div_informs.appendChild(this._panel.table_informs),this._panel.canvas_chart=document.createElement("div"),this._panel.canvas_chart.id=h("canvas","chart","I",this._hashId),this._panel.canvas_chart.style.cssText=this._panelStyle.canvas_chart,this._panel.div_root.appendChild(this._panel.canvas_chart);var t=document.createElement("style");t.innerHTML=this._panelStyle.chartCSS,document.body.appendChild(t),this._video.addEventListener("dblclick",this.doubleClick_.bind(this),!1)}},{key:"startDebug",value:function(){null===this._showPanel&&(this._panel.div_root.style.cssText=this._panelStyle.div_root_show,this._refreshPanelInfo(),this._showPanel=setInterval(this._refreshPanelInfo.bind(this),this._refreshInterval))}},{key:"reset",value:function(){this._downloadDataset=[],this._loadTime=0,this.updateInfo("Control",""),this.updateInfo("Url",""),this.updateInfo("State",""),this.updateInfo("HttpServer",""),this.updateInfo("Download",""),this.updateInfo("Switch",""),this.updateInfo("Buffer",""),this.updateInfo("Frames",""),this.updateInfo("VideoPlayer",""),this.updateInfo("Time",""),this.updateInfo("Event",""),this.updateInfo("Ad","")}},{key:"_onPlayStart",value:function(t){this.reset(),this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","_onPlayStart"),t.loadTime&&(this._loadTime=t.loadTime)}},{key:"stopDebug",value:function(){this.reset(),clearTimeout(this._showPanel),this._showPanel=null}},{key:"start",value:function(){this.resizeUI_(),this.startDebug()}},{key:"doubleClick_",value:function(t){if(this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","dclick event"),(!s.Settings.DEBUG_PANEL.HOTKEYS.alt||s.Settings.DEBUG_PANEL.HOTKEYS.alt&&t.altKey)&&(!s.Settings.DEBUG_PANEL.HOTKEYS.shift||s.Settings.DEBUG_PANEL.HOTKEYS.shift&&t.shiftKey)&&(!s.Settings.DEBUG_PANEL.HOTKEYS.ctrl||t.ctrlKey&&!this._isMacOS||this._isMacOS)){var e=this._video.clientWidth,i=this._video.clientHeight;t.offsetX<=e*this.ACTIVATE_AREA&&t.offsetY<=i*this.ACTIVATE_AREA&&this.start()}}},{key:"buttonClick_",value:function(t){this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","click event");var e=void 0;if(this._isFirefox?t.originalTarget&&t.originalTarget.id&&(e=document.getElementById(t.originalTarget.id)):t.srcElement&&t.srcElement.id&&(e=document.getElementById(t.srcElement.id)),e)if("CpUrl"===e.innerHTML){var i=h("caption","Url","II",this._hashId),n=document.getElementById(i);this._clipboardText=n.innerHTML}else"Copy"===e.innerHTML?this._clipboardText=this._panel.table_informs.innerText:"Chart"===e.innerHTML?(this.drawText_(),e.innerHTML="Text"):"Text"===e.innerHTML?(this.drawChart_(),e.innerHTML="Chart"):"Close"===e.innerHTML&&this.close_()}},{key:"updateInfo",value:function(t,e){var i=h("caption",t,"II",this._hashId),n=document.getElementById(i);n&&(n.innerHTML=e)}},{key:"drawChart_",value:function(){this._panel.canvas_chart.style.display="none",this._panel.div_informs.style.display="block",this._panel.div_informs.style.width=this._video.clientWidth-65+"px"}},{key:"drawText_",value:function(){this._panel.canvas_chart.style.display="block",this._panel.canvas_chart.style.height=this._panel.div_informs.clientHeight+"px",this._panel.canvas_chart.style.width=this._video.clientWidth-65+"px",this._panel.div_informs.style.display="none"}},{key:"close_",value:function(){this._panel.div_root.style.display="none",this.stopDebug()}},{key:"resizeUI_",value:function(t){this._init&&(this._panel.div_root.style.cssText=this._panelStyle.div_root_show,this._panel.div_buttons.style.cssText=this._panelStyle.div_buttons)}},{key:"isInit",value:function(){return this._init}},{key:"_uniqueid",value:function(){var t=String.fromCharCode(Math.floor(25*Math.random()+65));do{var e=Math.floor(42*Math.random()+48);(e<58||64<e)&&(t+=String.fromCharCode(e))}while(t.length<32);return t}},{key:"_refreshPanelInfo",value:function(){this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","_refreshPanelInfo");var t=v.AdaptivePlayer.version+" / "+v.AdaptivePlayer.coreVersion;this.updateInfo("Version",t);var e=0;0<this._panel.div_informs.clientHeight?(this._panel.div_informs.style.width=this._video.clientWidth-65+"px",e=this._panel.div_informs.clientHeight):(e=this._panel.canvas_chart.clientHeight,this._panel.canvas_chart.style.width=this._video.clientWidth-65+"px"),this._panel.div_root.style.height=e+"px";var i=this._player.getStats();if(""!==i.url){var n=this._player._url;this.updateInfo("Url",n);var r=JSON.stringify(this._player.getConfigure());this.updateInfo("Control",r);var a=this._player.streamType+(this._player.isLive()?" Live":" VOD");a+="("+this._player.playerType+"), "+this._player.getState(),0<this._loadTime&&(a+=", LoadTime="+this._loadTime/1e3+"s"),this.updateInfo("State",a);var s="";if(i.bytesLoaded&&0<i.bytesLoaded.length)for(var o=0;o<i.bytesLoaded.length;o++){var l=i.bytesLoaded[o];s+="H"+o+": "+l.cdnName+" B: "+l.bandwidthRate+" P: "+l.priority+" S: "+l.onlineSpeed+"Kbps "+m.formatBytes(l.bytes)+"; "}this.updateInfo("HttpServer",s);var u="";isNaN(i.bitrate)||isNaN(i.bandwidth)||(u="bitrate="+i.bitrate+" bandwidth="+i.bandwidth),this.updateInfo("Download",u),this._downloadDataset.push([new Date,i.bandwidth,i.bitrate]),this._downloadDataset.length>this._bufferSize/this._refreshInterval&&this._downloadDataset.splice(0,1),null===this._panel.canvas_chartCxt&&0<this._panel.canvas_chart.clientHeight&&(this._panel.canvas_chartCxt=new g.default(this._panel.canvas_chart,this._downloadDataset,{drawPoints:!1,showRoller:!1,colors:["rgb(0,255,255)","rgb(255,10,10)"],axisLineColor:"white",gridLineColor:"white",legend:"never",labels:["Time","bandwidth","bitrate"]})),null!==this._panel.canvas_chartCxt&&(this._panel.canvas_chartCxt.resize(this._panel.canvas_chart.clientWidth,this._panel.canvas_chart.clientHeight),this._panel.canvas_chartCxt.updateOptions({file:this._downloadDataset})),this.updateInfo("Switch",i.switchInfo);var h="";if(i.buffered)for(var c=0;c<i.buffered.length;c++)h+="["+i.buffered.start(c).toFixed(2)+", "+i.buffered.end(c).toFixed(2)+"];";this._player.isLive()&&i.livePointOffest&&(h+=" liveDelay:"+i.livePointOffest.toFixed(2)),this.updateInfo("Buffer",h);var d;d="decoded: "+i.totalVideoFrames+" dropped:"+i.droppedFrameCount+" ratio:"+(i.droppedFrameCount/i.totalVideoFrames).toFixed(2),this.updateInfo("Frames",d);var f="";f+="player="+i.videoWidth+"x"+i.videoHeight,f+=" screen="+this._video.clientWidth+"x"+this._video.clientHeight,f+=" mute: "+this._video.muted,f+=" volume: "+this._video.volume.toFixed(2),f+=" playbackRate: "+this._video.playbackRate,this.updateInfo("VideoPlayer",f);var p="P:";this._player.isLive()?(p+=m.toDateString(i.currentTime),p+=" ["+m.toDateString(this._seekRange.start)+", "+m.toDateString(this._seekRange.end)+"]"):(p+=m.formatSeconds(i.currentTime),p+=" [0, "+m.formatSeconds(i.duration)+"]"),this.updateInfo("Time",p)}}},{key:"_onID3",value:function(t){if(this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","_debugPanelEvent"),t.start&&t.value){var e=this._player.isLive()?m.toDateString(t.start):m.formatSeconds(t.start);this.updateInfo("Event",e+": "+JSON.stringify(t.value))}}},{key:"_onAds",value:function(t){this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","_debugPanelEvent");var e=(this._player.isLive()?m.toDateString(t.start):m.formatSeconds(t.start))+": "+JSON.stringify(t.data);this.updateInfo("Ad",e)}},{key:"_onSeekRangeChanged",value:function(t){this.print(v.AdaptivePlayer.LogLevel.TRACE,"DebugPanel","_onSeekRangeChanged"),t.details&&(this._seekRange=t.details)}}]),r}()},function(t,e,i){t.exports=function(i){function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r={};return n.m=i,n.c=r,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,i){var n,r,a;r=[t,i(7)],void 0!==(a="function"==typeof(n=function(t,e){"use strict";var i,n=(i=e)&&i.__esModule?i:{default:i},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=function(){function e(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),this.resolveOptions(t),this.initSelection()}return a(e,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.container=t.container,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[e?"right":"left"]="-9999px";var i=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=i+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,n.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,n.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==(void 0===t?"undefined":r(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),e}();t.exports=s})?n.apply(e,r):n)&&(t.exports=a)},function(t,e,i){var d=i(6),f=i(5);t.exports=function(t,e,i){if(!t&&!e&&!i)throw new Error("Missing required arguments");if(!d.string(e))throw new TypeError("Second argument must be a String");if(!d.fn(i))throw new TypeError("Third argument must be a Function");if(d.node(t))return r=e,a=i,(n=t).addEventListener(r,a),{destroy:function(){n.removeEventListener(r,a)}};var n,r,a,s,o,l,u,h,c;if(d.nodeList(t))return s=t,o=e,l=i,Array.prototype.forEach.call(s,function(t){t.addEventListener(o,l)}),{destroy:function(){Array.prototype.forEach.call(s,function(t){t.removeEventListener(o,l)})}};if(d.string(t))return u=t,h=e,c=i,f(document.body,u,h,c);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},function(t,e){function i(){}i.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){function n(){r.off(t,n),e.apply(i,arguments)}var r=this;return n._=e,this.on(t,n,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,r=i.length;n<r;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],r=[];if(n&&e)for(var a=0,s=n.length;a<s;a++)n[a].fn!==e&&n[a].fn._!==e&&r.push(n[a]);return r.length?i[t]=r:delete i[t],this}},t.exports=i},function(t,e,i){var n,r,a;r=[t,i(0),i(2),i(1)],void 0!==(a="function"==typeof(n=function(t,e,i,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var i="data-clipboard-"+t;if(e.hasAttribute(i))return e.getAttribute(i)}var s=r(e),o=r(i),l=r(n),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),c=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.resolveOptions(e),i.listenClick(t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,t),h(n,[{key:"resolveOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===u(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=(0,l.default)(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new s.default({action:this.action(e),target:this.target(e),text:this.text(e),container:this.container,trigger:e,emitter:this})}},{key:"defaultAction",value:function(t){return a("action",t)}},{key:"defaultTarget",value:function(t){var e=a("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return a("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],e="string"==typeof t?[t]:t,i=!!document.queryCommandSupported;return e.forEach(function(t){i=i&&!!document.queryCommandSupported(t)}),i}}]),n}(o.default);t.exports=c})?n.apply(e,r):n)&&(t.exports=a)},function(t,e){if("undefined"!=typeof Element&&!Element.prototype.matches){var i=Element.prototype;i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector}t.exports=function(t,e){for(;t&&9!==t.nodeType;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}},function(t,e,i){function a(t,e,i,n,r){var a=function(e,i,t,n){return function(t){t.delegateTarget=s(t.target,i),t.delegateTarget&&n.call(e,t)}}.apply(this,arguments);return t.addEventListener(i,a,r),{destroy:function(){t.removeEventListener(i,a,r)}}}var s=i(4);t.exports=function(t,e,i,n,r){return"function"==typeof t.addEventListener?a.apply(null,arguments):"function"==typeof i?a.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,function(t){return a(t,e,i,n,r)}))}},function(t,i){i.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},i.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||i.node(t[0]))},i.string=function(t){return"string"==typeof t||t instanceof String},i.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},function(t,e){t.exports=function(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var i=t.hasAttribute("readonly");i||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),i||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var n=window.getSelection(),r=document.createRange();r.selectNodeContents(t),n.removeAllRanges(),n.addRange(r),e=n.toString()}return e}}])},function(t,e,i){t.exports=function r(a,s,o){function l(i,t){if(!s[i]){if(!a[i]){if(u)return u(i,!0);var e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}var n=s[i]={exports:{}};a[i][0].call(n.exports,function(t){var e=a[i][1][t];return l(e||t)},n,n.exports,r,a,s,o)}return s[i].exports}for(var u=!1,t=0;t<o.length;t++)l(o[t]);return l}({1:[function(t,e,i){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(h===setTimeout)return setTimeout(e,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function s(){g&&f&&(g=!1,f.length?p=f.concat(p):m=-1,p.length&&o())}function o(){if(!g){var t=a(s);g=!0;for(var e=p.length;e;){for(f=p,p=[];++m<e;)f&&f[m].run();m=-1,e=p.length}f=null,g=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(t)}}function l(t,e){this.fun=t,this.array=e}function u(){}var h,c,d=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(t){c=r}}();var f,p=[],g=!1,m=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new l(t,e)),1!==p.length||g||a(o)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=t("./bars"),a=(n=r)&&n.__esModule?n:{default:n},s=function(){};(s.prototype=new a.default).extractSeries=function(t,e,i){for(var n,r,a,s=[],o=i.get("logscale"),l=0;l<t.length;l++)n=t[l][0],a=t[l][e],o&&null!==a&&(a[0]<=0||a[1]<=0||a[2]<=0)&&(a=null),null!==a?null===(r=a[1])||isNaN(r)?s.push([n,r,[r,r]]):s.push([n,r,[a[0],a[2]]]):s.push([n,null,[null,null]]);return s},s.prototype.rollingAverage=function(t,e,i){e=Math.min(e,t.length);var n,r,a,s,o,l,u,h=[];for(l=o=a=s=r=0;l<t.length;l++){if(n=t[l][1],u=t[l][2],h[l]=t[l],null===n||isNaN(n)||(r+=u[0],s+=n,a+=u[1],o+=1),0<=l-e){var c=t[l-e];null===c[1]||isNaN(c[1])||(r-=c[2][0],s-=c[1],a-=c[2][1],o-=1)}h[l]=o?[t[l][0],1*s/o,[1*r/o,1*a/o]]:[t[l][0],null,[null,null]]}return h},i.default=s,e.exports=i.default},{"./bars":5}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=t("./bars"),a=(n=r)&&n.__esModule?n:{default:n},s=function(){};(s.prototype=new a.default).extractSeries=function(t,e,i){for(var n,r,a,s,o=[],l=i.get("sigma"),u=i.get("logscale"),h=0;h<t.length;h++)n=t[h][0],s=t[h][e],u&&null!==s&&(s[0]<=0||s[0]-l*s[1]<=0)&&(s=null),null!==s?null===(r=s[0])||isNaN(r)?o.push([n,r,[r,r,r]]):(a=l*s[1],o.push([n,r,[r-a,r+a,s[1]]])):o.push([n,null,[null,null,null]]);return o},s.prototype.rollingAverage=function(t,e,i){e=Math.min(e,t.length);var n,r,a,s,o,l,u,h,c,d=[],f=i.get("sigma");for(n=0;n<t.length;n++){for(l=h=o=0,r=Math.max(0,n-e+1);r<n+1;r++)null===(a=t[r][1])||isNaN(a)||(l++,o+=a,h+=Math.pow(t[r][2][2],2));d[n]=l?(u=Math.sqrt(h)/l,c=o/l,[t[n][0],c,[c-f*u,c+f*u]]):(s=1==e?t[n][1]:null,[t[n][0],s,[s,s]])}return d},i.default=s,e.exports=i.default},{"./bars":5}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=t("./bars"),a=(n=r)&&n.__esModule?n:{default:n},s=function(){};(s.prototype=new a.default).extractSeries=function(t,e,i){for(var n,r,a,s,o,l,u,h,c=[],d=i.get("sigma"),f=i.get("logscale"),p=0;p<t.length;p++)n=t[p][0],a=t[p][e],f&&null!==a&&(a[0]<=0||a[1]<=0)&&(a=null),null!==a?(s=a[0],o=a[1],null===s||isNaN(s)?c.push([n,s,[s,s,s,o]]):(l=o?s/o:0,u=o?d*Math.sqrt(l*(1-l)/o):1,h=100*u,r=100*l,c.push([n,r,[r-h,r+h,s,o]]))):c.push([n,null,[null,null,null,null]]);return c},s.prototype.rollingAverage=function(t,e,i){e=Math.min(e,t.length);var n,r,a,s,o=[],l=i.get("sigma"),u=i.get("wilsonInterval"),h=0,c=0;for(a=0;a<t.length;a++){h+=t[a][2][2],c+=t[a][2][3],0<=a-e&&(h-=t[a-e][2][2],c-=t[a-e][2][3]);var d=t[a][0],f=c?h/c:0;if(u)if(c){var p=f<0?0:f,g=c,m=l*Math.sqrt(p*(1-p)/g+l*l/(4*g*g)),v=1+l*l/c;n=(p+l*l/(2*c)-m)/v,r=(p+l*l/(2*c)+m)/v,o[a]=[d,100*p,[100*n,100*r]]}else o[a]=[d,0,[0,0]];else s=c?l*Math.sqrt(f*(1-f)/c):1,o[a]=[d,100*f,[100*(f-s),100*(f+s)]]}return o},i.default=s,e.exports=i.default},{"./bars":5}],5:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var r=t("./datahandler"),a=n(r),s=t("../dygraph-layout"),o=n(s),l=function(){a.default.call(this)};(l.prototype=new a.default).extractSeries=function(t,e,i){},l.prototype.rollingAverage=function(t,e,i){},l.prototype.onPointsCreated_=function(t,e){for(var i=0;i<t.length;++i){var n=t[i],r=e[i];r.y_top=NaN,r.y_bottom=NaN,r.yval_minus=a.default.parseFloat(n[2][0]),r.yval_plus=a.default.parseFloat(n[2][1])}},l.prototype.getExtremeYValues=function(t,e,i){for(var n,r=null,a=null,s=t.length-1,o=0;o<=s;o++)if(null!==(n=t[o][1])&&!isNaN(n)){var l=t[o][2][0],u=t[o][2][1];n<l&&(l=n),u<n&&(u=n),(null===a||a<u)&&(a=u),(null===r||l<r)&&(r=l)}return[r,a]},l.prototype.onLineEvaluated=function(t,e,i){for(var n,r=0;r<t.length;r++)(n=t[r]).y_top=o.default.calcYNormal_(e,n.yval_minus,i),n.y_bottom=o.default.calcYNormal_(e,n.yval_plus,i)},i.default=l,e.exports=i.default},{"../dygraph-layout":13,"./datahandler":6}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){},u=n;u.X=0,u.Y=1,u.EXTRAS=2,u.prototype.extractSeries=function(t,e,i){},u.prototype.seriesToPoints=function(t,e,i){for(var n=[],r=0;r<t.length;++r){var a=t[r],s=a[1],o=null===s?null:u.parseFloat(s),l={x:NaN,y:NaN,xval:u.parseFloat(a[0]),yval:o,name:e,idx:r+i};n.push(l)}return this.onPointsCreated_(t,n),n},u.prototype.onPointsCreated_=function(t,e){},u.prototype.rollingAverage=function(t,e,i){},u.prototype.getExtremeYValues=function(t,e,i){},u.prototype.onLineEvaluated=function(t,e,i){},u.parseFloat=function(t){return null===t?NaN:t},i.default=n,e.exports=i.default},{}],7:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var r=t("./datahandler"),a=(n(r),t("./default")),s=n(a),o=function(){};(o.prototype=new s.default).extractSeries=function(t,e,i){for(var n,r,a,s,o,l=[],u=i.get("logscale"),h=0;h<t.length;h++)n=t[h][0],a=t[h][e],u&&null!==a&&(a[0]<=0||a[1]<=0)&&(a=null),null!==a?(s=a[0],o=a[1],null===s||isNaN(s)?l.push([n,s,[s,o]]):(r=100*(o?s/o:0),l.push([n,r,[s,o]]))):l.push([n,null,[null,null]]);return l},o.prototype.rollingAverage=function(t,e,i){e=Math.min(e,t.length);var n,r=[],a=0,s=0;for(n=0;n<t.length;n++){a+=t[n][2][0],s+=t[n][2][1],0<=n-e&&(a-=t[n-e][2][0],s-=t[n-e][2][1]);var o=t[n][0],l=s?a/s:0;r[n]=[o,100*l]}return r},i.default=o,e.exports=i.default},{"./datahandler":6,"./default":8}],8:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=t("./datahandler"),a=(n=r)&&n.__esModule?n:{default:n},s=function(){};(s.prototype=new a.default).extractSeries=function(t,e,i){for(var n=[],r=i.get("logscale"),a=0;a<t.length;a++){var s=t[a][0],o=t[a][e];r&&o<=0&&(o=null),n.push([s,o])}return n},s.prototype.rollingAverage=function(t,e,i){e=Math.min(e,t.length);var n,r,a,s,o,l=[];if(1==e)return t;for(n=0;n<t.length;n++){for(o=s=0,r=Math.max(0,n-e+1);r<n+1;r++)null===(a=t[r][1])||isNaN(a)||(o++,s+=t[r][1]);l[n]=o?[t[n][0],s/o]:[t[n][0],null]}return l},s.prototype.getExtremeYValues=function(t,e,i){for(var n,r=null,a=null,s=t.length-1,o=0;o<=s;o++)null===(n=t[o][1])||isNaN(n)||((null===a||a<n)&&(a=n),(null===r||n<r)&&(r=n));return[r,a]},i.default=s,e.exports=i.default},{"./datahandler":6}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=t("./dygraph-utils"),D=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),a=t("./dygraph"),N=(n=a)&&n.__esModule?n:{default:n},O=function(t,e,i,n){if(this.dygraph_=t,this.layout=n,this.element=e,this.elementContext=i,this.height=t.height_,this.width=t.width_,!D.isCanvasSupported(this.element))throw"Canvas is not supported.";this.area=n.getPlotArea();var r=this.dygraph_.canvas_ctx_;r.beginPath(),r.rect(this.area.x,this.area.y,this.area.w,this.area.h),r.clip(),(r=this.dygraph_.hidden_ctx_).beginPath(),r.rect(this.area.x,this.area.y,this.area.w,this.area.h),r.clip()};O.prototype.clear=function(){this.elementContext.clearRect(0,0,this.width,this.height)},O.prototype.render=function(){this._updatePoints(),this._renderLineChart()},O._getIteratorPredicate=function(t){return t?O._predicateThatSkipsEmptyPoints:null},O._predicateThatSkipsEmptyPoints=function(t,e){return null!==t[e].yval},O._drawStyledLine=function(t,e,i,n,r,a,s){var o=t.dygraph,l=o.getBooleanOption("stepPlot",t.setName);D.isArrayLike(n)||(n=null);var u=o.getBooleanOption("drawGapEdgePoints",t.setName),h=t.points,c=t.setName,d=D.createIterator(h,0,h.length,O._getIteratorPredicate(o.getBooleanOption("connectSeparatedPoints",c))),f=n&&2<=n.length,p=t.drawingContext;p.save(),f&&p.setLineDash&&p.setLineDash(n);var g=O._drawSeries(t,d,i,s,r,u,l,e);O._drawPointsOnLine(t,g,a,e,s),f&&p.setLineDash&&p.setLineDash([]),p.restore()},O._drawSeries=function(t,e,i,n,r,a,s,o){var l,u,h=null,c=null,d=null,f=[],p=!0,g=t.drawingContext;g.beginPath(),g.strokeStyle=o,g.lineWidth=i;for(var m=e.array_,v=e.end_,y=e.predicate_,b=e.start_;b<v;b++){if(u=m[b],y){for(;b<v&&!y(m,b);)b++;if(b==v)break;u=m[b]}if(null===u.canvasy||u.canvasy!=u.canvasy)s&&null!==h&&(g.moveTo(h,c),g.lineTo(u.canvasx,c)),h=c=null;else{if(l=!1,a||null===h){e.nextIdx_=b,e.next();var _=null===(d=e.hasNext?e.peek.canvasy:null)||d!=d;l=null===h&&_,a&&(!p&&null===h||e.hasNext&&_)&&(l=!0)}null!==h?i&&(s&&(g.moveTo(h,c),g.lineTo(u.canvasx,c)),g.lineTo(u.canvasx,u.canvasy)):g.moveTo(u.canvasx,u.canvasy),(r||l)&&f.push([u.canvasx,u.canvasy,u.idx]),h=u.canvasx,c=u.canvasy}p=!1}return g.stroke(),f},O._drawPointsOnLine=function(t,e,i,n,r){for(var a=t.drawingContext,s=0;s<e.length;s++){var o=e[s];a.save(),i.call(t.dygraph,t.dygraph,t.setName,a,o[0],o[1],n,r,o[2]),a.restore()}},O.prototype._updatePoints=function(){for(var t=this.layout.points,e=t.length;e--;)for(var i=t[e],n=i.length;n--;){var r=i[n];r.canvasx=this.area.w*r.x+this.area.x,r.canvasy=this.area.h*r.y+this.area.y}},O.prototype._renderLineChart=function(t,e){var i,n,r=e||this.elementContext,a=this.layout.points,s=this.layout.setNames;this.colors=this.dygraph_.colorsMap_;var o=this.dygraph_.getOption("plotter"),l=o;D.isArrayLike(l)||(l=[l]);var u={};for(i=0;i<s.length;i++){n=s[i];var h=this.dygraph_.getOption("plotter",n);h!=o&&(u[n]=h)}for(i=0;i<l.length;i++)for(var c=l[i],d=i==l.length-1,f=0;f<a.length;f++)if(n=s[f],!t||n==t){var p=a[f],g=c;if(n in u){if(!d)continue;g=u[n]}var m=this.colors[n],v=this.dygraph_.getOption("strokeWidth",n);r.save(),r.strokeStyle=m,r.lineWidth=v,g({points:p,setName:n,drawingContext:r,color:m,strokeWidth:v,dygraph:this.dygraph_,axis:this.dygraph_.axisPropertiesForSeries(n),plotArea:this.area,seriesIndex:f,seriesCount:a.length,singleSeriesName:t,allSeriesPoints:a}),r.restore()}},O._Plotters={linePlotter:function(t){O._linePlotter(t)},fillPlotter:function(t){O._fillPlotter(t)},errorPlotter:function(t){O._errorPlotter(t)}},O._linePlotter=function(t){var e=t.dygraph,i=t.setName,n=t.strokeWidth,r=e.getNumericOption("strokeBorderWidth",i),a=e.getOption("drawPointCallback",i)||D.Circles.DEFAULT,s=e.getOption("strokePattern",i),o=e.getBooleanOption("drawPoints",i),l=e.getNumericOption("pointSize",i);r&&n&&O._drawStyledLine(t,e.getOption("strokeBorderColor",i),n+2*r,s,o,a,l),O._drawStyledLine(t,t.color,n,s,o,a,l)},O._errorPlotter=function(t){var e=t.dygraph,i=t.setName;if(e.getBooleanOption("errorBars")||e.getBooleanOption("customBars")){e.getBooleanOption("fillGraph",i)&&console.warn("Can't use fillGraph option with error bars");var n,r=t.drawingContext,a=t.color,s=e.getNumericOption("fillAlpha",i),o=e.getBooleanOption("stepPlot",i),l=t.points,u=D.createIterator(l,0,l.length,O._getIteratorPredicate(e.getBooleanOption("connectSeparatedPoints",i))),h=NaN,c=NaN,d=[-1,-1],f=D.toRGB_(a),p="rgba("+f.r+","+f.g+","+f.b+","+s+")";r.fillStyle=p,r.beginPath();for(var g=function(t){return null==t||isNaN(t)};u.hasNext;){var m=u.next();h=!o&&g(m.y)||o&&!isNaN(c)&&g(c)?NaN:(n=[m.y_bottom,m.y_top],o&&(c=m.y),isNaN(n[0])&&(n[0]=m.y),isNaN(n[1])&&(n[1]=m.y),n[0]=t.plotArea.h*n[0]+t.plotArea.y,n[1]=t.plotArea.h*n[1]+t.plotArea.y,isNaN(h)||(o?(r.moveTo(h,d[0]),r.lineTo(m.canvasx,d[0]),r.lineTo(m.canvasx,d[1])):(r.moveTo(h,d[0]),r.lineTo(m.canvasx,n[0]),r.lineTo(m.canvasx,n[1])),r.lineTo(h,d[1]),r.closePath()),d=n,m.canvasx)}r.fill()}},O._fastCanvasProxy=function(r){var h=[],s=null,o=null,a=0,l=function(t){!function(t){if(!(h.length<=1)){for(var e=h.length-1;0<e;e--){var i=h[e];if(2==i[0]){var n=h[e-1];n[1]==i[1]&&n[2]==i[2]&&h.splice(e,1)}}for(var e=0;e<h.length-1;){var i=h[e];2==i[0]&&2==h[e+1][0]?h.splice(e,1):e++}if(2<h.length&&!t){var r=0;2==h[0][0]&&r++;for(var a=null,s=null,e=r;e<h.length;e++){var i=h[e];if(1==i[0])if(null===a&&null===s)s=a=e;else{var o=i[2];o<h[a][2]?a=e:o>h[s][2]&&(s=e)}}var l=h[a],u=h[s];h.splice(r,h.length-r),a<s?(h.push(l),h.push(u)):(s<a&&h.push(u),h.push(l))}}}(t);for(var e=0,i=h.length;e<i;e++){var n=h[e];1==n[0]?r.lineTo(n[1],n[2]):2==n[0]&&r.moveTo(n[1],n[2])}h.length&&(o=h[h.length-1][1]),a+=h.length,h=[]},i=function(t,e,i){var n=Math.round(e);if(null===s||n!=s){var r=1<s-o,a=1<n-s;l(r||a),s=n}h.push([t,e,i])};return{moveTo:function(t,e){i(2,t,e)},lineTo:function(t,e){i(1,t,e)},stroke:function(){l(!0),r.stroke()},fill:function(){l(!0),r.fill()},beginPath:function(){l(!0),r.beginPath()},closePath:function(){l(!0),r.closePath()},_count:function(){return a}}},O._fillPlotter=function(t){if(!t.singleSeriesName&&0===t.seriesIndex){for(var e=t.dygraph,i=e.getLabels().slice(1),n=i.length;0<=n;n--)e.visibility()[n]||i.splice(n,1);if(function(){for(var t=0;t<i.length;t++)if(e.getBooleanOption("fillGraph",i[t]))return!0;return!1}())for(var r,a,s=t.plotArea,o=t.allSeriesPoints,l=o.length,u=e.getBooleanOption("stackedGraph"),h=e.getColors(),c={},d=function(t,e,i,n){if(t.lineTo(e,i),u)for(var r=n.length-1;0<=r;r--){var a=n[r];t.lineTo(a[0],a[1])}},f=l-1;0<=f;f--){var p=t.drawingContext,g=i[f];if(e.getBooleanOption("fillGraph",g)){var m=e.getNumericOption("fillAlpha",g),v=e.getBooleanOption("stepPlot",g),y=h[f],b=e.axisPropertiesForSeries(g),_=1+b.minyval*b.yscale;_<0?_=0:1<_&&(_=1),_=s.h*_+s.y;var T,E=o[f],S=D.createIterator(E,0,E.length,O._getIteratorPredicate(e.getBooleanOption("connectSeparatedPoints",g))),w=NaN,k=[-1,-1],A=D.toRGB_(y),L="rgba("+A.r+","+A.g+","+A.b+","+m+")";p.fillStyle=L,p.beginPath();var P,C=!0;(E.length>2*e.width_||N.default.FORCE_FAST_PROXY)&&(p=O._fastCanvasProxy(p));for(var x,I=[];S.hasNext;)if(x=S.next(),D.isOK(x.y)||v){if(u){if(!C&&P==x.xval)continue;var R;C=!1,P=x.xval,r=c[x.canvasx],R=void 0===r?_:a?r[0]:r,T=[x.canvasy,R],v?-1===k[0]?c[x.canvasx]=[x.canvasy,_]:c[x.canvasx]=[x.canvasy,k[0]]:c[x.canvasx]=x.canvasy}else T=isNaN(x.canvasy)&&v?[s.y+s.h,_]:[x.canvasy,_];isNaN(w)?(p.moveTo(x.canvasx,T[1]),p.lineTo(x.canvasx,T[0])):(v&&p.lineTo(x.canvasx,k[0]),p.lineTo(x.canvasx,T[0]),u&&(I.push([w,k[1]]),a&&r?I.push([x.canvasx,r[1]]):I.push([x.canvasx,T[1]]))),k=T,w=x.canvasx}else d(p,w,k[1],I),I=[],w=NaN,null===x.y_stacked||isNaN(x.y_stacked)||(c[x.canvasx]=s.h*x.y_stacked+s.y);a=v,T&&x&&(d(p,x.canvasx,T[1],I),I=[]),p.fill()}}}},i.default=O,e.exports=i.default},{"./dygraph":18,"./dygraph-utils":17}],10:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(i,"__esModule",{value:!0});var a=t("./dygraph-tickers"),s=r(a),o=t("./dygraph-interaction-model"),l=n(o),u=t("./dygraph-canvas"),h=n(u),c=t("./dygraph-utils"),d=r(c),f={highlightCircleSize:3,highlightSeriesOpts:null,highlightSeriesBackgroundAlpha:.5,highlightSeriesBackgroundColor:"rgb(255, 255, 255)",labelsSeparateLines:!1,labelsShowZeroValues:!0,labelsKMB:!1,labelsKMG2:!1,showLabelsOnHighlight:!0,digitsAfterDecimal:2,maxNumberWidth:6,sigFigs:null,strokeWidth:1,strokeBorderWidth:0,strokeBorderColor:"white",axisTickSize:3,axisLabelFontSize:14,rightGap:5,showRoller:!1,xValueParser:void 0,delimiter:",",sigma:2,errorBars:!1,fractions:!1,wilsonInterval:!0,customBars:!1,fillGraph:!1,fillAlpha:.15,connectSeparatedPoints:!1,stackedGraph:!1,stackedGraphNaNFill:"all",hideOverlayOnMouseOut:!0,legend:"onmouseover",stepPlot:!1,xRangePad:0,yRangePad:null,drawAxesAtZero:!1,titleHeight:28,xLabelHeight:18,yLabelWidth:18,axisLineColor:"black",axisLineWidth:.3,gridLineWidth:.3,axisLabelWidth:50,gridLineColor:"rgb(128,128,128)",interactionModel:l.default.defaultModel,animatedZooms:!1,showRangeSelector:!1,rangeSelectorHeight:40,rangeSelectorPlotStrokeColor:"#808FAB",rangeSelectorPlotFillGradientColor:"white",rangeSelectorPlotFillColor:"#A7B1C4",rangeSelectorBackgroundStrokeColor:"gray",rangeSelectorBackgroundLineWidth:1,rangeSelectorPlotLineWidth:1.5,rangeSelectorForegroundStrokeColor:"black",rangeSelectorForegroundLineWidth:1,rangeSelectorAlpha:.6,showInRangeSelector:null,plotter:[h.default._fillPlotter,h.default._errorPlotter,h.default._linePlotter],plugins:[],axes:{x:{pixelsPerLabel:70,axisLabelWidth:60,axisLabelFormatter:d.dateAxisLabelFormatter,valueFormatter:d.dateValueFormatter,drawGrid:!0,drawAxis:!0,independentTicks:!0,ticker:s.dateTicker},y:{axisLabelWidth:50,pixelsPerLabel:30,valueFormatter:d.numberValueFormatter,axisLabelFormatter:d.numberAxisLabelFormatter,drawGrid:!0,drawAxis:!0,independentTicks:!0,ticker:s.numericTicks},y2:{axisLabelWidth:50,pixelsPerLabel:30,valueFormatter:d.numberValueFormatter,axisLabelFormatter:d.numberAxisLabelFormatter,drawAxis:!0,drawGrid:!1,independentTicks:!1,ticker:s.numericTicks}}};i.default=f,e.exports=i.default},{"./dygraph-canvas":9,"./dygraph-interaction-model":12,"./dygraph-tickers":16,"./dygraph-utils":17}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=t("./dygraph"),a=(n=r)&&n.__esModule?n:{default:n},s=function(t){this.container=t};s.prototype.draw=function(t,e){this.container.innerHTML="",void 0!==this.date_graph&&this.date_graph.destroy(),this.date_graph=new a.default(this.container,t,e)},s.prototype.setSelection=function(t){var e=!1;t.length&&(e=t[0].row),this.date_graph.setSelection(e)},s.prototype.getSelection=function(){var t=[],e=this.date_graph.getSelection();if(e<0)return t;for(var i=this.date_graph.layout_.points,n=0;n<i.length;++n)t.push({row:e,column:n+1});return t},i.default=s,e.exports=i.default},{"./dygraph":18}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./dygraph-utils"),T=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),h={maybeTreatMouseOpAsClick:function(t,e,i){i.dragEndX=T.dragGetX_(t,i),i.dragEndY=T.dragGetY_(t,i);var n=Math.abs(i.dragEndX-i.dragStartX),r=Math.abs(i.dragEndY-i.dragStartY);n<2&&r<2&&void 0!==e.lastx_&&-1!=e.lastx_&&h.treatMouseOpAsClick(e,t,i),i.regionWidth=n,i.regionHeight=r},startPan:function(t,e,i){var n,r;i.isPanning=!0;var a=e.xAxisRange();if(e.getOptionForAxis("logscale","x")?(i.initialLeftmostDate=T.log10(a[0]),i.dateRange=T.log10(a[1])-T.log10(a[0])):(i.initialLeftmostDate=a[0],i.dateRange=a[1]-a[0]),i.xUnitsPerPixel=i.dateRange/(e.plotter_.area.w-1),e.getNumericOption("panEdgeFraction")){var s=e.width_*e.getNumericOption("panEdgeFraction"),o=e.xAxisExtremes(),l=e.toDomXCoord(o[0])-s,u=e.toDomXCoord(o[1])+s,h=e.toDataXCoord(l),c=e.toDataXCoord(u);i.boundedDates=[h,c];var d=[],f=e.height_*e.getNumericOption("panEdgeFraction");for(n=0;n<e.axes_.length;n++){var p=(r=e.axes_[n]).extremeRange,g=e.toDomYCoord(p[0],n)+f,m=e.toDomYCoord(p[1],n)-f,v=e.toDataYCoord(g,n),y=e.toDataYCoord(m,n);d[n]=[v,y]}i.boundedValues=d}for(i.is2DPan=!1,i.axes=[],n=0;n<e.axes_.length;n++){r=e.axes_[n];var b={},_=e.yAxisRange(n);e.attributes_.getForAxis("logscale",n)?(b.initialTopValue=T.log10(_[1]),b.dragValueRange=T.log10(_[1])-T.log10(_[0])):(b.initialTopValue=_[1],b.dragValueRange=_[1]-_[0]),b.unitsPerPixel=b.dragValueRange/(e.plotter_.area.h-1),i.axes.push(b),r.valueRange&&(i.is2DPan=!0)}},movePan:function(t,e,i){i.dragEndX=T.dragGetX_(t,i),i.dragEndY=T.dragGetY_(t,i);var n=i.initialLeftmostDate-(i.dragEndX-i.dragStartX)*i.xUnitsPerPixel;i.boundedDates&&(n=Math.max(n,i.boundedDates[0]));var r=n+i.dateRange;if(i.boundedDates&&r>i.boundedDates[1]&&(n-=r-i.boundedDates[1],r=n+i.dateRange),e.getOptionForAxis("logscale","x")?e.dateWindow_=[Math.pow(T.LOG_SCALE,n),Math.pow(T.LOG_SCALE,r)]:e.dateWindow_=[n,r],i.is2DPan)for(var a=i.dragEndY-i.dragStartY,s=0;s<e.axes_.length;s++){var o=e.axes_[s],l=i.axes[s],u=a*l.unitsPerPixel,h=i.boundedValues?i.boundedValues[s]:null,c=l.initialTopValue+u;h&&(c=Math.min(c,h[1]));var d=c-l.dragValueRange;h&&d<h[0]&&(c-=d-h[0],d=c-l.dragValueRange),e.attributes_.getForAxis("logscale",s)?o.valueRange=[Math.pow(T.LOG_SCALE,d),Math.pow(T.LOG_SCALE,c)]:o.valueRange=[d,c]}e.drawGraph_(!1)}};h.endPan=h.maybeTreatMouseOpAsClick,h.startZoom=function(t,e,i){i.isZooming=!0,i.zoomMoved=!1},h.moveZoom=function(t,e,i){i.zoomMoved=!0,i.dragEndX=T.dragGetX_(t,i),i.dragEndY=T.dragGetY_(t,i);var n=Math.abs(i.dragStartX-i.dragEndX),r=Math.abs(i.dragStartY-i.dragEndY);i.dragDirection=n<r/2?T.VERTICAL:T.HORIZONTAL,e.drawZoomRect_(i.dragDirection,i.dragStartX,i.dragEndX,i.dragStartY,i.dragEndY,i.prevDragDirection,i.prevEndX,i.prevEndY),i.prevEndX=i.dragEndX,i.prevEndY=i.dragEndY,i.prevDragDirection=i.dragDirection},h.treatMouseOpAsClick=function(t,e,i){for(var n=t.getFunctionOption("clickCallback"),r=t.getFunctionOption("pointClickCallback"),a=null,s=-1,o=Number.MAX_VALUE,l=0;l<t.selPoints_.length;l++){var u=t.selPoints_[l],h=Math.pow(u.canvasx-i.dragEndX,2)+Math.pow(u.canvasy-i.dragEndY,2);!isNaN(h)&&(-1==s||h<o)&&(o=h,s=l)}var c=t.getNumericOption("highlightCircleSize")+2;if(o<=c*c&&(a=t.selPoints_[s]),a){var d={cancelable:!0,point:a,canvasx:i.dragEndX,canvasy:i.dragEndY};if(t.cascadeEvents_("pointClick",d))return;r&&r.call(t,e,a)}var d={cancelable:!0,xval:t.lastx_,pts:t.selPoints_,canvasx:i.dragEndX,canvasy:i.dragEndY};t.cascadeEvents_("click",d)||n&&n.call(t,e,t.lastx_,t.selPoints_)},h.endZoom=function(t,e,i){e.clearZoomRect_(),i.isZooming=!1,h.maybeTreatMouseOpAsClick(t,e,i);var n=e.getArea();if(10<=i.regionWidth&&i.dragDirection==T.HORIZONTAL){var r=Math.min(i.dragStartX,i.dragEndX),a=Math.max(i.dragStartX,i.dragEndX);r=Math.max(r,n.x),a=Math.min(a,n.x+n.w),r<a&&e.doZoomX_(r,a),i.cancelNextDblclick=!0}else if(10<=i.regionHeight&&i.dragDirection==T.VERTICAL){var s=Math.min(i.dragStartY,i.dragEndY),o=Math.max(i.dragStartY,i.dragEndY);s=Math.max(s,n.y),o=Math.min(o,n.y+n.h),s<o&&e.doZoomY_(s,o),i.cancelNextDblclick=!0}i.dragStartX=null,i.dragStartY=null},h.startTouch=function(t,e,i){t.preventDefault(),1<t.touches.length&&(i.startTimeForDoubleTapMs=null);for(var n=[],r=0;r<t.touches.length;r++){var a=t.touches[r];n.push({pageX:a.pageX,pageY:a.pageY,dataX:e.toDataXCoord(a.pageX),dataY:e.toDataYCoord(a.pageY)})}if(1==(i.initialTouches=n).length)i.initialPinchCenter=n[0],i.touchDirections={x:!0,y:!0};else if(2<=n.length){i.initialPinchCenter={pageX:.5*(n[0].pageX+n[1].pageX),pageY:.5*(n[0].pageY+n[1].pageY),dataX:.5*(n[0].dataX+n[1].dataX),dataY:.5*(n[0].dataY+n[1].dataY)};var s=180/Math.PI*Math.atan2(i.initialPinchCenter.pageY-n[0].pageY,n[0].pageX-i.initialPinchCenter.pageX);90<(s=Math.abs(s))&&(s=90-s),i.touchDirections={x:s<67.5,y:22.5<s}}i.initialRange={x:e.xAxisRange(),y:e.yAxisRange()}},h.moveTouch=function(t,e,i){i.startTimeForDoubleTapMs=null;var n,r=[];for(n=0;n<t.touches.length;n++){var a=t.touches[n];r.push({pageX:a.pageX,pageY:a.pageY})}var s,o,l,u=i.initialTouches,h=i.initialPinchCenter,c={pageX:(s=1==r.length?r[0]:{pageX:.5*(r[0].pageX+r[1].pageX),pageY:.5*(r[0].pageY+r[1].pageY)}).pageX-h.pageX,pageY:s.pageY-h.pageY},d=i.initialRange.x[1]-i.initialRange.x[0],f=i.initialRange.y[0]-i.initialRange.y[1];if(c.dataX=c.pageX/e.plotter_.area.w*d,c.dataY=c.pageY/e.plotter_.area.h*f,1==r.length)l=o=1;else if(2<=r.length){var p=u[1].pageX-h.pageX;o=(r[1].pageX-s.pageX)/p;var g=u[1].pageY-h.pageY;l=(r[1].pageY-s.pageY)/g}o=Math.min(8,Math.max(.125,o)),l=Math.min(8,Math.max(.125,l));var m=!1;if(i.touchDirections.x&&(e.dateWindow_=[h.dataX-c.dataX+(i.initialRange.x[0]-h.dataX)/o,h.dataX-c.dataX+(i.initialRange.x[1]-h.dataX)/o],m=!0),i.touchDirections.y)for(n=0;n<1;n++){var v=e.axes_[n],y=e.attributes_.getForAxis("logscale",n);y||(v.valueRange=[h.dataY-c.dataY+(i.initialRange.y[0]-h.dataY)/l,h.dataY-c.dataY+(i.initialRange.y[1]-h.dataY)/l],m=!0)}if(e.drawGraph_(!1),m&&1<r.length&&e.getFunctionOption("zoomCallback")){var b=e.xAxisRange();e.getFunctionOption("zoomCallback").call(e,b[0],b[1],e.yAxisRanges())}},h.endTouch=function(t,e,i){if(0!==t.touches.length)h.startTouch(t,e,i);else if(1==t.changedTouches.length){var n=(new Date).getTime(),r=t.changedTouches[0];i.startTimeForDoubleTapMs&&n-i.startTimeForDoubleTapMs<500&&i.doubleTapX&&Math.abs(i.doubleTapX-r.screenX)<50&&i.doubleTapY&&Math.abs(i.doubleTapY-r.screenY)<50?e.resetZoom():(i.startTimeForDoubleTapMs=n,i.doubleTapX=r.screenX,i.doubleTapY=r.screenY)}};var c=function(t,e,i){return t<e?e-t:i<t?t-i:0};h.defaultModel={mousedown:function(t,l,u){if(!t.button||2!=t.button){u.initializeMouseDown(t,l,u),t.altKey||t.shiftKey?h.startPan(t,l,u):h.startZoom(t,l,u);var i=function(t){var e,i,n,r,a,s,o;u.isZooming?(e=t,i=l,n=T.findPos(i.canvas_),r={left:n.x,right:n.x+i.canvas_.offsetWidth,top:n.y,bottom:n.y+i.canvas_.offsetHeight},a={x:T.pageX(e),y:T.pageY(e)},s=c(a.x,r.left,r.right),o=c(a.y,r.top,r.bottom),Math.max(s,o)<100?h.moveZoom(t,l,u):null!==u.dragEndX&&(u.dragEndX=null,u.dragEndY=null,l.clearZoomRect_())):u.isPanning&&h.movePan(t,l,u)};l.addAndTrackEvent(document,"mousemove",i),l.addAndTrackEvent(document,"mouseup",function t(e){u.isZooming?null!==u.dragEndX?h.endZoom(e,l,u):h.maybeTreatMouseOpAsClick(e,l,u):u.isPanning&&h.endPan(e,l,u),T.removeEvent(document,"mousemove",i),T.removeEvent(document,"mouseup",t),u.destroy()})}},willDestroyContextMyself:!0,touchstart:function(t,e,i){h.startTouch(t,e,i)},touchmove:function(t,e,i){h.moveTouch(t,e,i)},touchend:function(t,e,i){h.endTouch(t,e,i)},dblclick:function(t,e,i){if(i.cancelNextDblclick)i.cancelNextDblclick=!1;else{var n={canvasx:i.dragEndX,canvasy:i.dragEndY,cancelable:!0};e.cascadeEvents_("dblclick",n)||t.altKey||t.shiftKey||e.resetZoom()}}},h.nonInteractiveModel_={mousedown:function(t,e,i){i.initializeMouseDown(t,e,i)},mouseup:h.maybeTreatMouseOpAsClick},h.dragIsPanInteractionModel={mousedown:function(t,e,i){i.initializeMouseDown(t,e,i),h.startPan(t,e,i)},mousemove:function(t,e,i){i.isPanning&&h.movePan(t,e,i)},mouseup:function(t,e,i){i.isPanning&&h.endPan(t,e,i)}},i.default=h,e.exports=i.default},{"./dygraph-utils":17}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./dygraph-utils"),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),c=function(t){this.dygraph_=t,this.points=[],this.setNames=[],this.annotations=[],this.yAxes_=null,this.xTicks_=null,this.yTicks_=null};c.prototype.addDataset=function(t,e){this.points.push(e),this.setNames.push(t)},c.prototype.getPlotArea=function(){return this.area_},c.prototype.computePlotArea=function(){var i={x:0,y:0};i.w=this.dygraph_.width_-i.x-this.dygraph_.getOption("rightGap"),i.h=this.dygraph_.height_;var t={chart_div:this.dygraph_.graphDiv,reserveSpaceLeft:function(t){var e={x:i.x,y:i.y,w:t,h:i.h};return i.x+=t,i.w-=t,e},reserveSpaceRight:function(t){var e={x:i.x+i.w-t,y:i.y,w:t,h:i.h};return i.w-=t,e},reserveSpaceTop:function(t){var e={x:i.x,y:i.y,w:i.w,h:t};return i.y+=t,i.h-=t,e},reserveSpaceBottom:function(t){var e={x:i.x,y:i.y+i.h-t,w:i.w,h:t};return i.h-=t,e},chartRect:function(){return{x:i.x,y:i.y,w:i.w,h:i.h}}};this.dygraph_.cascadeEvents_("layout",t),this.area_=i},c.prototype.setAnnotations=function(t){this.annotations=[];for(var e=this.dygraph_.getOption("xValueParser")||function(t){return t},i=0;i<t.length;i++){var n={};if(!t[i].xval&&void 0===t[i].x)return void console.error("Annotations must have an 'x' property");if(t[i].icon&&(!t[i].hasOwnProperty("width")||!t[i].hasOwnProperty("height")))return void console.error("Must set width and height when setting annotation.icon property");r.update(n,t[i]),n.xval||(n.xval=e(n.x)),this.annotations.push(n)}},c.prototype.setXTicks=function(t){this.xTicks_=t},c.prototype.setYAxes=function(t){this.yAxes_=t},c.prototype.evaluate=function(){this._xAxis={},this._evaluateLimits(),this._evaluateLineCharts(),this._evaluateLineTicks(),this._evaluateAnnotations()},c.prototype._evaluateLimits=function(){var t=this.dygraph_.xAxisRange();this._xAxis.minval=t[0],this._xAxis.maxval=t[1];var e=t[1]-t[0];this._xAxis.scale=0!==e?1/e:1,this.dygraph_.getOptionForAxis("logscale","x")&&(this._xAxis.xlogrange=r.log10(this._xAxis.maxval)-r.log10(this._xAxis.minval),this._xAxis.xlogscale=0!==this._xAxis.xlogrange?1/this._xAxis.xlogrange:1);for(var i=0;i<this.yAxes_.length;i++){var n=this.yAxes_[i];n.minyval=n.computedValueRange[0],n.maxyval=n.computedValueRange[1],n.yrange=n.maxyval-n.minyval,n.yscale=0!==n.yrange?1/n.yrange:1,this.dygraph_.getOption("logscale")&&(n.ylogrange=r.log10(n.maxyval)-r.log10(n.minyval),n.ylogscale=0!==n.ylogrange?1/n.ylogrange:1,isFinite(n.ylogrange)&&!isNaN(n.ylogrange)||console.error("axis "+i+" of graph at "+n.g+" can't be displayed in log scale for range ["+n.minyval+" - "+n.maxyval+"]"))}},c.calcXNormal_=function(t,e,i){return i?(r.log10(t)-r.log10(e.minval))*e.xlogscale:(t-e.minval)*e.scale},c.calcYNormal_=function(t,e,i){if(i){var n=1-(r.log10(e)-r.log10(t.minyval))*t.ylogscale;return isFinite(n)?n:NaN}return 1-(e-t.minyval)*t.yscale},c.prototype._evaluateLineCharts=function(){for(var t=this.dygraph_.getOption("stackedGraph"),e=this.dygraph_.getOptionForAxis("logscale","x"),i=0;i<this.points.length;i++){for(var n=this.points[i],r=this.setNames[i],a=this.dygraph_.getOption("connectSeparatedPoints",r),s=this.dygraph_.axisPropertiesForSeries(r),o=this.dygraph_.attributes_.getForSeries("logscale",r),l=0;l<n.length;l++){var u=n[l];u.x=c.calcXNormal_(u.xval,this._xAxis,e);var h=u.yval;t&&(u.y_stacked=c.calcYNormal_(s,u.yval_stacked,o),null===h||isNaN(h)||(h=u.yval_stacked)),null===h&&(h=NaN,a||(u.yval=NaN)),u.y=c.calcYNormal_(s,h,o)}this.dygraph_.dataHandler_.onLineEvaluated(n,s,o)}},c.prototype._evaluateLineTicks=function(){var t,e,i,n,r,a;for(this.xticks=[],t=0;t<this.xTicks_.length;t++)e=this.xTicks_[t],i=e.label,r=(a=!("label_v"in e))?e.v:e.label_v,0<=(n=this.dygraph_.toPercentXCoord(r))&&n<1&&this.xticks.push({pos:n,label:i,has_tick:a});for(this.yticks=[],t=0;t<this.yAxes_.length;t++)for(var s=this.yAxes_[t],o=0;o<s.ticks.length;o++)e=s.ticks[o],i=e.label,r=(a=!("label_v"in e))?e.v:e.label_v,0<(n=this.dygraph_.toPercentYCoord(r,t))&&n<=1&&this.yticks.push({axis:t,pos:n,label:i,has_tick:a})},c.prototype._evaluateAnnotations=function(){var t,e={};for(t=0;t<this.annotations.length;t++){var i=this.annotations[t];e[i.xval+","+i.series]=i}if(this.annotated_points=[],this.annotations&&this.annotations.length)for(var n=0;n<this.points.length;n++){var r=this.points[n];for(t=0;t<r.length;t++){var a=r[t],s=a.xval+","+a.name;s in e&&(a.annotation=e[s],this.annotated_points.push(a))}}},c.prototype.removeAllDatasets=function(){delete this.points,delete this.setNames,delete this.setPointsLengths,delete this.setPointsOffsets,this.points=[],this.setNames=[],this.setPointsLengths=[],this.setPointsOffsets=[]},i.default=c,e.exports=i.default},{"./dygraph-utils":17}],14:[function(t,e,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=null,e.exports=i.default}).call(this,t("_process"))},{_process:1}],15:[function(a,s,h){(function(t){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(h,"__esModule",{value:!0});var i=a("./dygraph-utils"),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i),n=a("./dygraph-default-attrs"),l=e(n),r=a("./dygraph-options-reference"),u=(e(r),function(t){this.dygraph_=t,this.yAxes_=[],this.xAxis_={},this.series_={},this.global_=this.dygraph_.attrs_,this.user_=this.dygraph_.user_attrs_||{},this.labels_=[],this.highlightSeries_=this.get("highlightSeriesOpts")||{},this.reparseSeries()});u.AXIS_STRING_MAPPINGS_={y:0,Y:0,y1:0,Y1:0,y2:1,Y2:1},u.axisToIndex_=function(t){if("string"==typeof t){if(u.AXIS_STRING_MAPPINGS_.hasOwnProperty(t))return u.AXIS_STRING_MAPPINGS_[t];throw"Unknown axis : "+t}if("number"==typeof t){if(0===t||1===t)return t;throw"Dygraphs only supports two y-axes, indexed from 0-1."}if(t)throw"Unknown axis : "+t;return 0},u.prototype.reparseSeries=function(){var t=this.get("labels");if(t){this.labels_=t.slice(1),this.yAxes_=[{series:[],options:{}}],this.xAxis_={options:{}},this.series_={};for(var e=this.user_.series||{},i=0;i<this.labels_.length;i++){var n=this.labels_[i],r=e[n]||{},a=u.axisToIndex_(r.axis);this.series_[n]={idx:i,yAxis:a,options:r},this.yAxes_[a]?this.yAxes_[a].series.push(n):this.yAxes_[a]={series:[n],options:{}}}var s=this.user_.axes||{};o.update(this.yAxes_[0].options,s.y||{}),1<this.yAxes_.length&&o.update(this.yAxes_[1].options,s.y2||{}),o.update(this.xAxis_.options,s.x||{})}},u.prototype.get=function(t){var e=this.getGlobalUser_(t);return null!==e?e:this.getGlobalDefault_(t)},u.prototype.getGlobalUser_=function(t){return this.user_.hasOwnProperty(t)?this.user_[t]:null},u.prototype.getGlobalDefault_=function(t){return this.global_.hasOwnProperty(t)?this.global_[t]:l.default.hasOwnProperty(t)?l.default[t]:null},u.prototype.getForAxis=function(t,e){var i,n;if("number"==typeof e)n=0===(i=e)?"y":"y2";else{if("y1"==e&&(e="y"),"y"==e)i=0;else if("y2"==e)i=1;else{if("x"!=e)throw"Unknown axis "+e;i=-1}n=e}var r=-1==i?this.xAxis_:this.yAxes_[i];if(r){var a=r.options;if(a.hasOwnProperty(t))return a[t]}if("x"!==e||"logscale"!==t){var s=this.getGlobalUser_(t);if(null!==s)return s}var o=l.default.axes[n];return o.hasOwnProperty(t)?o[t]:this.getGlobalDefault_(t)},u.prototype.getForSeries=function(t,e){if(e===this.dygraph_.getHighlightSeries()&&this.highlightSeries_.hasOwnProperty(t))return this.highlightSeries_[t];if(!this.series_.hasOwnProperty(e))throw"Unknown series: "+e;var i=this.series_[e],n=i.options;return n.hasOwnProperty(t)?n[t]:this.getForAxis(t,i.yAxis)},u.prototype.numAxes=function(){return this.yAxes_.length},u.prototype.axisForSeries=function(t){return this.series_[t].yAxis},u.prototype.axisOptions=function(t){return this.yAxes_[t].options},u.prototype.seriesForAxis=function(t){return this.yAxes_[t].series},u.prototype.seriesNames=function(){return this.labels_},h.default=u,s.exports=h.default}).call(this,a("_process"))},{"./dygraph-default-attrs":10,"./dygraph-options-reference":14,"./dygraph-utils":17,_process:1}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./dygraph-utils"),x=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n);i.numericLinearTicks=function(t,e,i,n,r,a){return s(t,e,i,function(t){return"logscale"!==t&&n(t)},r,a)};var s=function(t,e,i,n,r,a){var s,o,l,u,h=n("pixelsPerLabel"),c=[];if(a)for(s=0;s<a.length;s++)c.push({v:a[s]});else{if(n("logscale")){u=Math.floor(i/h);var d=x.binarySearch(t,I,1),f=x.binarySearch(e,I,-1);-1==d&&(d=0),-1==f&&(f=I.length-1);var p=null;if(u/4<=f-d){for(var g=f;d<=g;g--){var m=I[g],v=Math.log(m/t)/Math.log(e/t)*i,y={v:m};null===p?p={tickValue:m,pixel_coord:v}:Math.abs(v-p.pixel_coord)>=h?p={tickValue:m,pixel_coord:v}:y.label="",c.push(y)}c.reverse()}}if(0===c.length){var b,_,T=n("labelsKMG2");_=T?(b=[1,2,4,8,16,32,64,128,256],16):(b=[1,2,5,10,20,50,100],10);var E,S,w,k=Math.ceil(i/h),A=Math.abs(e-t)/k,L=Math.floor(Math.log(A)/Math.log(_)),P=Math.pow(_,L);for(o=0;o<b.length&&(E=P*b[o],S=Math.floor(t/E)*E,w=Math.ceil(e/E)*E,u=Math.abs(w-S)/E,!(h<i/u));o++);for(w<S&&(E*=-1),s=0;s<=u;s++)l=S+s*E,c.push({v:l})}}var C=n("axisLabelFormatter");for(s=0;s<c.length;s++)void 0===c[s].label&&(c[s].label=C.call(r,c[s].v,0,n,r));return c};i.numericTicks=s,i.dateTicker=function(t,e,i,n,r,a){var s=o(t,e,i,n);return 0<=s?u(t,e,s,n,r):[]};var y={MILLISECONDLY:0,TWO_MILLISECONDLY:1,FIVE_MILLISECONDLY:2,TEN_MILLISECONDLY:3,FIFTY_MILLISECONDLY:4,HUNDRED_MILLISECONDLY:5,FIVE_HUNDRED_MILLISECONDLY:6,SECONDLY:7,TWO_SECONDLY:8,FIVE_SECONDLY:9,TEN_SECONDLY:10,THIRTY_SECONDLY:11,MINUTELY:12,TWO_MINUTELY:13,FIVE_MINUTELY:14,TEN_MINUTELY:15,THIRTY_MINUTELY:16,HOURLY:17,TWO_HOURLY:18,SIX_HOURLY:19,DAILY:20,TWO_DAILY:21,WEEKLY:22,MONTHLY:23,QUARTERLY:24,BIANNUAL:25,ANNUAL:26,DECADAL:27,CENTENNIAL:28,NUM_GRANULARITIES:29};i.Granularity=y;var b={DATEFIELD_Y:0,DATEFIELD_M:1,DATEFIELD_D:2,DATEFIELD_HH:3,DATEFIELD_MM:4,DATEFIELD_SS:5,DATEFIELD_MS:6,NUM_DATEFIELDS:7},_=[];_[y.MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:1,spacing:1},_[y.TWO_MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:2,spacing:2},_[y.FIVE_MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:5,spacing:5},_[y.TEN_MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:10,spacing:10},_[y.FIFTY_MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:50,spacing:50},_[y.HUNDRED_MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:100,spacing:100},_[y.FIVE_HUNDRED_MILLISECONDLY]={datefield:b.DATEFIELD_MS,step:500,spacing:500},_[y.SECONDLY]={datefield:b.DATEFIELD_SS,step:1,spacing:1e3},_[y.TWO_SECONDLY]={datefield:b.DATEFIELD_SS,step:2,spacing:2e3},_[y.FIVE_SECONDLY]={datefield:b.DATEFIELD_SS,step:5,spacing:5e3},_[y.TEN_SECONDLY]={datefield:b.DATEFIELD_SS,step:10,spacing:1e4},_[y.THIRTY_SECONDLY]={datefield:b.DATEFIELD_SS,step:30,spacing:3e4},_[y.MINUTELY]={datefield:b.DATEFIELD_MM,step:1,spacing:6e4},_[y.TWO_MINUTELY]={datefield:b.DATEFIELD_MM,step:2,spacing:12e4},_[y.FIVE_MINUTELY]={datefield:b.DATEFIELD_MM,step:5,spacing:3e5},_[y.TEN_MINUTELY]={datefield:b.DATEFIELD_MM,step:10,spacing:6e5},_[y.THIRTY_MINUTELY]={datefield:b.DATEFIELD_MM,step:30,spacing:18e5},_[y.HOURLY]={datefield:b.DATEFIELD_HH,step:1,spacing:36e5},_[y.TWO_HOURLY]={datefield:b.DATEFIELD_HH,step:2,spacing:72e5},_[y.SIX_HOURLY]={datefield:b.DATEFIELD_HH,step:6,spacing:216e5},_[y.DAILY]={datefield:b.DATEFIELD_D,step:1,spacing:864e5},_[y.TWO_DAILY]={datefield:b.DATEFIELD_D,step:2,spacing:1728e5},_[y.WEEKLY]={datefield:b.DATEFIELD_D,step:7,spacing:6048e5},_[y.MONTHLY]={datefield:b.DATEFIELD_M,step:1,spacing:2629817280},_[y.QUARTERLY]={datefield:b.DATEFIELD_M,step:3,spacing:216e5*365.2524},_[y.BIANNUAL]={datefield:b.DATEFIELD_M,step:6,spacing:432e5*365.2524},_[y.ANNUAL]={datefield:b.DATEFIELD_Y,step:1,spacing:864e5*365.2524},_[y.DECADAL]={datefield:b.DATEFIELD_Y,step:10,spacing:315578073600},_[y.CENTENNIAL]={datefield:b.DATEFIELD_Y,step:100,spacing:3155780736e3};var I=function(){for(var t=[],e=-39;e<=39;e++)for(var i=Math.pow(10,e),n=1;n<=9;n++){var r=i*n;t.push(r)}return t}(),o=function(t,e,i,n){for(var r=n("pixelsPerLabel"),a=0;a<y.NUM_GRANULARITIES;a++)if(i/l(t,e,a)>=r)return a;return-1},l=function(t,e,i){var n=_[i].spacing;return Math.round(1*(e-t)/n)},u=function(t,e,i,n,r){var a=n("axisLabelFormatter"),s=n("labelsUTC"),o=s?x.DateAccessorsUTC:x.DateAccessorsLocal,l=_[i].datefield,u=_[i].step,h=_[i].spacing,c=new Date(t),d=[];d[b.DATEFIELD_Y]=o.getFullYear(c),d[b.DATEFIELD_M]=o.getMonth(c),d[b.DATEFIELD_D]=o.getDate(c),d[b.DATEFIELD_HH]=o.getHours(c),d[b.DATEFIELD_MM]=o.getMinutes(c),d[b.DATEFIELD_SS]=o.getSeconds(c),d[b.DATEFIELD_MS]=o.getMilliseconds(c);var f=d[l]%u;i==y.WEEKLY&&(f=o.getDay(c)),d[l]-=f;for(var p=l+1;p<b.NUM_DATEFIELDS;p++)d[p]=p===b.DATEFIELD_D?1:0;var g=[],m=o.makeDate.apply(null,d),v=m.getTime();if(i<=y.HOURLY)for(v<t&&(v+=h,m=new Date(v));v<=e;)g.push({v:v,label:a.call(r,m,i,n,r)}),v+=h,m=new Date(v);else for(v<t&&(d[l]+=u,m=o.makeDate.apply(null,d),v=m.getTime());v<=e;)(y.DAILY<=i||o.getHours(m)%u==0)&&g.push({v:v,label:a.call(r,m,i,n,r)}),d[l]+=u,m=o.makeDate.apply(null,d),v=m.getTime();return g};i.getDateAxis=u},{"./dygraph-utils":17}],17:[function(t,e,i){"use strict";function n(t){return!t.pageX||t.pageX<0?0:t.pageX}function r(t){return!t.pageY||t.pageY<0?0:t.pageY}function g(t,e){var i=Math.min(Math.max(1,e||2),21);return Math.abs(t)<.001&&0!==t?t.toExponential(i-1):t.toPrecision(i)}function m(t){return t<10?"0"+t:""+t}function v(t,e,i,n){var r=m(t)+":"+m(e);if(i&&(r+=":"+m(i),n)){var a=""+n;r+="."+("000"+a).substring(a.length)}return r}function a(t,e){var i=e?T:_,n=new Date(t),r=i.getFullYear(n),a=i.getMonth(n),s=i.getDate(n),o=i.getHours(n),l=i.getMinutes(n),u=i.getSeconds(n),h=i.getMilliseconds(n),c=""+r,d=m(a+1),f=m(s),p=3600*o+60*l+u+.001*h,g=c+"/"+d+"/"+f;return p&&(g+=" "+v(o,l,u,h)),g}function y(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i}function s(t){return new Date(t).getTime()}function o(t){var e=typeof t;return("object"==e||"function"==e&&"function"==typeof t.item)&&null!==t&&"number"==typeof t.length&&3!==t.nodeType}function l(t,e,i,n){e=e||0,i=i||t.length,this.hasNext=!0,this.peek=null,this.start_=e,this.array_=t,this.predicate_=n,this.end_=Math.min(t.length,e+i),this.nextIdx_=e-1,this.next()}function b(t,e){return e<0?1/Math.pow(t,-e):Math.pow(t,e)}function u(t){var e=k.exec(t);if(!e)return null;var i=parseInt(e[1],10),n=parseInt(e[2],10),r=parseInt(e[3],10);return e[4]?{r:i,g:n,b:r,a:parseFloat(e[4])}:{r:i,g:n,b:r}}function h(t,e){var i=e("sigFigs");if(null!==i)return g(t,i);var n,r=e("digitsAfterDecimal"),a=e("maxNumberWidth"),s=e("labelsKMB"),o=e("labelsKMG2");if(n=0!==t&&(Math.abs(t)>=Math.pow(10,a)||Math.abs(t)<Math.pow(10,-r))?t.toExponential(r):""+y(t,r),s||o){var l,u=[],h=[];s&&(l=1e3,u=A),o&&(s&&console.warn("Setting both labelsKMB and labelsKMG2. Pick one!"),l=1024,u=L,h=P);for(var c=Math.abs(t),d=b(l,u.length),f=u.length-1;0<=f;f--,d/=l)if(d<=c){n=y(t/d,r)+u[f];break}if(o){var p=String(t.toExponential()).split("e-");2===p.length&&3<=p[1]&&p[1]<=24&&(n=0<p[1]%3?y(p[0]/b(10,p[1]%3),r):Number(p[0]).toFixed(2),n+=h[Math.floor(p[1]/3)-1])}}return n}Object.defineProperty(i,"__esModule",{value:!0}),i.removeEvent=function(t,e,i){t.removeEventListener(e,i,!1)},i.cancelEvent=function(t){return(t=t||window.event).stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.cancel=!0,t.returnValue=!1},i.hsvToRGB=function(t,e,i){var n,r,a;if(0===e)a=r=n=i;else{var s=Math.floor(6*t),o=6*t-s,l=i*(1-e),u=i*(1-e*o),h=i*(1-e*(1-o));switch(s){case 1:n=u,r=i,a=l;break;case 2:n=l,r=i,a=h;break;case 3:n=l,r=u,a=i;break;case 4:n=h,r=l,a=i;break;case 5:n=i,r=l,a=u;break;case 6:case 0:n=i,r=h,a=l}}return n=Math.floor(255*n+.5),r=Math.floor(255*r+.5),a=Math.floor(255*a+.5),"rgb("+n+","+r+","+a+")"},i.findPos=function(t){var e=t.getBoundingClientRect(),i=window,n=document.documentElement;return{x:e.left+(i.pageXOffset||n.scrollLeft),y:e.top+(i.pageYOffset||n.scrollTop)}},i.pageX=n,i.pageY=r,i.dragGetX_=function(t,e){return n(t)-e.px},i.dragGetY_=function(t,e){return r(t)-e.py},i.isOK=function(t){return!!t&&!isNaN(t)},i.isValidPoint=function(t,e){return!!t&&null!==t.yval&&null!==t.x&&void 0!==t.x&&null!==t.y&&void 0!==t.y&&!(isNaN(t.x)||!e&&isNaN(t.y))},i.floatFormat=g,i.zeropad=m,i.hmsString_=v,i.dateString_=a,i.round_=y,i.binarySearch=function(t,e,i,n,r){for(var a=!0;a;){var s=t,o=e,l=i,u=n,h=r;if(a=!1,null!=u&&null!=h||(u=0,h=o.length-1),h<u)return-1;null!=l||(l=0);var c,d=function(t){return 0<=t&&t<o.length},f=parseInt((u+h)/2,10),p=o[f];if(p==s)return f;if(s<p){if(0<l&&d(c=f-1)&&o[c]<s)return f;t=s,e=o,i=l,n=u,r=f-1,a=!0,d=f=p=c=void 0}else{if(!(p<s))return-1;if(l<0&&d(c=f+1)&&o[c]>s)return f;t=s,e=o,i=l,n=f+1,r=h,a=!0,d=f=p=c=void 0}}},i.dateParser=function(t){var e,i;if((-1==t.search("-")||-1!=t.search("T")||-1!=t.search("Z"))&&(i=s(t))&&!isNaN(i))return i;if(-1!=t.search("-")){for(e=t.replace("-","/","g");-1!=e.search("-");)e=e.replace("-","/");i=s(e)}else i=8==t.length?s(e=t.substr(0,4)+"/"+t.substr(4,2)+"/"+t.substr(6,2)):s(t);return i&&!isNaN(i)||console.error("Couldn't parse "+t+" as a date"),i},i.dateStrToMillis=s,i.update=function(t,e){if(null!=e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},i.updateDeep=function t(e,i){if(null!=i)for(var n in i)i.hasOwnProperty(n)&&(null===i[n]?e[n]=null:o(i[n])?e[n]=i[n].slice():(r=i[n],("object"==typeof Node?r instanceof Node:"object"==typeof r&&"number"==typeof r.nodeType&&"string"==typeof r.nodeName)||"object"!=typeof i[n]?e[n]=i[n]:("object"==typeof e[n]&&null!==e[n]||(e[n]={}),t(e[n],i[n]))));var r;return e},i.isArrayLike=o,i.isDateLike=function(t){return"object"==typeof t&&null!==t&&"function"==typeof t.getTime},i.clone=function t(e){for(var i=[],n=0;n<e.length;n++)o(e[n])?i.push(t(e[n])):i.push(e[n]);return i},i.createCanvas=function(){return document.createElement("canvas")},i.getContextPixelRatio=function(t){try{var e=window.devicePixelRatio,i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return void 0!==e?e/i:1}catch(t){return 1}},i.Iterator=l,i.createIterator=function(t,e,i,n){return new l(t,e,i,n)},i.repeatAndCleanup=function(r,t,a,s){var o,l=0,u=(new Date).getTime();if(r(l),1!=t){var h=t-1;!function n(){t<=l||E.call(window,function(){var t=(new Date).getTime(),e=t-u;o=l;var i=(l=Math.floor(e/a))-o;h<l+i||h<=l?(r(h),s()):(0!==i&&r(l),n())})}()}else s()},i.isPixelChangingOptionList=function(t,e){var i={};if(t)for(var n=1;n<t.length;n++)i[t[n]]=!0;var r=function(t){for(var e in t)if(t.hasOwnProperty(e)&&!S[e])return!0;return!1};for(var a in e)if(e.hasOwnProperty(a))if("highlightSeriesOpts"==a||i[a]&&!e.series){if(r(e[a]))return!0}else if("series"==a||"axes"==a){var s=e[a];for(var o in s)if(s.hasOwnProperty(o)&&r(s[o]))return!0}else if(!S[a])return!0;return!1},i.detectLineDelimiter=function(t){for(var e=0;e<t.length;e++){var i=t.charAt(e);if("\r"===i)return e+1<t.length&&"\n"===t.charAt(e+1)?"\r\n":i;if("\n"===i)return e+1<t.length&&"\r"===t.charAt(e+1)?"\n\r":i}return null},i.isNodeContainedBy=function(t,e){if(null===e||null===t)return!1;for(var i=t;i&&i!==e;)i=i.parentNode;return i===e},i.pow=b,i.toRGB_=function(t){var e=u(t);if(e)return e;var i=document.createElement("div");i.style.backgroundColor=t,i.style.visibility="hidden",document.body.appendChild(i);var n=window.getComputedStyle(i,null).backgroundColor;return document.body.removeChild(i),u(n)},i.isCanvasSupported=function(t){try{(t||document.createElement("canvas")).getContext("2d")}catch(t){return!1}return!0},i.parseFloat_=function(t,e,i){var n=parseFloat(t);if(!isNaN(n))return n;if(/^ *$/.test(t))return null;if(/^ *nan *$/i.test(t))return NaN;var r="Unable to parse '"+t+"' as a number";return void 0!==i&&void 0!==e&&(r+=" on line "+(1+(e||0))+" ('"+i+"') of CSV."),console.error(r),null},i.numberValueFormatter=h,i.numberAxisLabelFormatter=function(t,e,i){return h.call(this,t,i)},i.dateAxisLabelFormatter=function(t,e,i){var n=i("labelsUTC")?T:_,r=n.getFullYear(t),a=n.getMonth(t),s=n.getDate(t),o=n.getHours(t),l=n.getMinutes(t),u=n.getSeconds(t),h=n.getMilliseconds(t);if(e>=d.Granularity.DECADAL)return""+r;if(e>=d.Granularity.MONTHLY)return C[a]+"&#160;"+r;if(0===3600*o+60*l+u+.001*h||e>=d.Granularity.DAILY)return m(s)+"&#160;"+C[a];if(e<d.Granularity.SECONDLY){var c=""+h;return m(u)+"."+("000"+c).substring(c.length)}return e>d.Granularity.MINUTELY?v(o,l,u,0):v(o,l,u,h)},i.dateValueFormatter=function(t,e){return a(t,e("labelsUTC"))};var c=t("./dygraph-tickers"),d=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(c);i.LOG_SCALE=10;var f=Math.log(10);i.LN_TEN=f;var p=function(t){return Math.log(t)/f};i.log10=p,i.logRangeFraction=function(t,e,i){var n=p(t),r=p(e),a=n+i*(r-n);return Math.pow(10,a)},i.DOTTED_LINE=[2,2],i.DASHED_LINE=[7,3],i.DOT_DASH_LINE=[7,2,2,2],i.HORIZONTAL=1,i.VERTICAL=2,i.getContext=function(t){return t.getContext("2d")},i.addEvent=function(t,e,i){t.addEventListener(e,i,!1)};var _={getFullYear:function(t){return t.getFullYear()},getMonth:function(t){return t.getMonth()},getDate:function(t){return t.getDate()},getHours:function(t){return t.getHours()},getMinutes:function(t){return t.getMinutes()},getSeconds:function(t){return t.getSeconds()},getMilliseconds:function(t){return t.getMilliseconds()},getDay:function(t){return t.getDay()},makeDate:function(t,e,i,n,r,a,s){return new Date(t,e,i,n,r,a,s)}};i.DateAccessorsLocal=_;var T={getFullYear:function(t){return t.getUTCFullYear()},getMonth:function(t){return t.getUTCMonth()},getDate:function(t){return t.getUTCDate()},getHours:function(t){return t.getUTCHours()},getMinutes:function(t){return t.getUTCMinutes()},getSeconds:function(t){return t.getUTCSeconds()},getMilliseconds:function(t){return t.getUTCMilliseconds()},getDay:function(t){return t.getUTCDay()},makeDate:function(t,e,i,n,r,a,s){return new Date(Date.UTC(t,e,i,n,r,a,s))}};i.DateAccessorsUTC=T,l.prototype.next=function(){if(!this.hasNext)return null;for(var t=this.peek,e=this.nextIdx_+1,i=!1;e<this.end_;){if(!this.predicate_||this.predicate_(this.array_,e)){this.peek=this.array_[e],i=!0;break}e++}return this.nextIdx_=e,i||(this.hasNext=!1,this.peek=null),t};var E=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};i.requestAnimFrame=E;var S={annotationClickHandler:!0,annotationDblClickHandler:!0,annotationMouseOutHandler:!0,annotationMouseOverHandler:!0,axisLineColor:!0,axisLineWidth:!0,clickCallback:!0,drawCallback:!0,drawHighlightPointCallback:!0,drawPoints:!0,drawPointCallback:!0,drawGrid:!0,fillAlpha:!0,gridLineColor:!0,gridLineWidth:!0,hideOverlayOnMouseOut:!0,highlightCallback:!0,highlightCircleSize:!0,interactionModel:!0,labelsDiv:!0,labelsKMB:!0,labelsKMG2:!0,labelsSeparateLines:!0,labelsShowZeroValues:!0,legend:!0,panEdgeFraction:!0,pixelsPerYLabel:!0,pointClickCallback:!0,pointSize:!0,rangeSelectorPlotFillColor:!0,rangeSelectorPlotFillGradientColor:!0,rangeSelectorPlotStrokeColor:!0,rangeSelectorBackgroundStrokeColor:!0,rangeSelectorBackgroundLineWidth:!0,rangeSelectorPlotLineWidth:!0,rangeSelectorForegroundStrokeColor:!0,rangeSelectorForegroundLineWidth:!0,rangeSelectorAlpha:!0,showLabelsOnHighlight:!0,showRoller:!0,strokeWidth:!0,underlayCallback:!0,unhighlightCallback:!0,zoomCallback:!0},w={DEFAULT:function(t,e,i,n,r,a,s){i.beginPath(),i.fillStyle=a,i.arc(n,r,s,0,2*Math.PI,!1),i.fill()}};i.Circles=w;var k=/^rgba?\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})(?:,\s*([01](?:\.\d+)?))?\)$/,A=["K","M","B","T","Q"],L=["k","M","G","T","P","E","Z","Y"],P=["m","u","n","p","f","a","z","y"],C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},{"./dygraph-tickers":16}],18:[function(X,q,Z){(function(t){"use strict";function e(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(Z,"__esModule",{value:!0});var p=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=X("./dygraph-layout"),r=i(n),a=X("./dygraph-canvas"),s=i(a),o=X("./dygraph-options"),f=i(o),l=X("./dygraph-interaction-model"),u=i(l),h=X("./dygraph-tickers"),b=e(h),c=X("./dygraph-utils"),N=e(c),d=X("./dygraph-default-attrs"),g=i(d),m=X("./dygraph-options-reference"),v=(i(m),X("./iframe-tarp")),y=i(v),_=X("./datahandler/default"),T=i(_),E=X("./datahandler/bars-error"),S=i(E),w=X("./datahandler/bars-custom"),k=i(w),A=X("./datahandler/default-fractions"),L=i(A),P=X("./datahandler/bars-fractions"),C=i(P),x=X("./datahandler/bars"),I=i(x),R=X("./plugins/annotations"),D=i(R),O=X("./plugins/axes"),M=i(O),U=X("./plugins/chart-labels"),F=i(U),B=X("./plugins/grid"),G=i(B),j=X("./plugins/legend"),H=i(j),V=X("./plugins/range-selector"),W=i(V),z=X("./dygraph-gviz"),K=i(z),Y=function(t,e,i){this.__init__(t,e,i)};Y.NAME="Dygraph",Y.VERSION="2.0.0",Y.DEFAULT_ROLL_PERIOD=1,Y.DEFAULT_WIDTH=480,Y.DEFAULT_HEIGHT=320,Y.ANIMATION_STEPS=12,Y.ANIMATION_DURATION=200,Y.Plotters=s.default._Plotters,Y.addedAnnotationCSS=!1,Y.prototype.__init__=function(t,e,i){if(this.is_initial_draw_=!0,this.readyFns_=[],null!=i||(i={}),i=Y.copyUserAttrs_(i),"string"==typeof t&&(t=document.getElementById(t)),!t)throw new Error("Constructing dygraph with a non-existent div!");this.maindiv_=t,this.file_=e,this.rollPeriod_=i.rollPeriod||Y.DEFAULT_ROLL_PERIOD,this.previousVerticalX_=-1,this.fractions_=i.fractions||!1,this.dateWindow_=i.dateWindow||null,this.annotations_=[],(t.innerHTML="")===t.style.width&&i.width&&(t.style.width=i.width+"px"),""===t.style.height&&i.height&&(t.style.height=i.height+"px"),""===t.style.height&&0===t.clientHeight&&(t.style.height=Y.DEFAULT_HEIGHT+"px",""===t.style.width&&(t.style.width=Y.DEFAULT_WIDTH+"px")),this.width_=t.clientWidth||i.width||0,this.height_=t.clientHeight||i.height||0,i.stackedGraph&&(i.fillGraph=!0),this.user_attrs_={},N.update(this.user_attrs_,i),this.attrs_={},N.updateDeep(this.attrs_,g.default),this.boundaryIds_=[],this.setIndexByName_={},this.datasetIndex_=[],this.registeredEvents_=[],this.eventListeners_={},this.attributes_=new f.default(this),this.createInterface_(),this.plugins_=[];for(var n=Y.PLUGINS.concat(this.getOption("plugins")),r=0;r<n.length;r++){var a,s=n[r],o={plugin:a=void 0!==s.activate?s:new s,events:{},options:{},pluginOptions:{}},l=a.activate(this);for(var u in l)l.hasOwnProperty(u)&&(o.events[u]=l[u]);this.plugins_.push(o)}for(var r=0;r<this.plugins_.length;r++){var h=this.plugins_[r];for(var u in h.events)if(h.events.hasOwnProperty(u)){var c=h.events[u],d=[h.plugin,c];u in this.eventListeners_?this.eventListeners_[u].push(d):this.eventListeners_[u]=[d]}}this.createDragInterface_(),this.start_()},Y.prototype.cascadeEvents_=function(t,e){if(!(t in this.eventListeners_))return!1;var i={dygraph:this,cancelable:!1,defaultPrevented:!1,preventDefault:function(){if(!i.cancelable)throw"Cannot call preventDefault on non-cancelable event.";i.defaultPrevented=!0},propagationStopped:!1,stopPropagation:function(){i.propagationStopped=!0}};N.update(i,e);var n=this.eventListeners_[t];if(n)for(var r=n.length-1;0<=r;r--){var a=n[r][0],s=n[r][1];if(s.call(a,i),i.propagationStopped)break}return i.defaultPrevented},Y.prototype.getPluginInstance_=function(t){for(var e=0;e<this.plugins_.length;e++){var i=this.plugins_[e];if(i.plugin instanceof t)return i.plugin}return null},Y.prototype.isZoomed=function(t){var e=!!this.dateWindow_;if("x"===t)return e;var i=0<=this.axes_.map(function(t){return!!t.valueRange}).indexOf(!0);if(null==t)return e||i;if("y"===t)return i;throw new Error("axis parameter is ["+t+"] must be null, 'x' or 'y'.")},Y.prototype.toString=function(){var t=this.maindiv_;return"[Dygraph "+(t&&t.id?t.id:t)+"]"},Y.prototype.attr_=function(t,e){return e?this.attributes_.getForSeries(t,e):this.attributes_.get(t)},Y.prototype.getOption=function(t,e){return this.attr_(t,e)},Y.prototype.getNumericOption=function(t,e){return this.getOption(t,e)},Y.prototype.getStringOption=function(t,e){return this.getOption(t,e)},Y.prototype.getBooleanOption=function(t,e){return this.getOption(t,e)},Y.prototype.getFunctionOption=function(t,e){return this.getOption(t,e)},Y.prototype.getOptionForAxis=function(t,e){return this.attributes_.getForAxis(t,e)},Y.prototype.optionsViewForAxis_=function(i){var n=this;return function(t){var e=n.user_attrs_.axes;return e&&e[i]&&e[i].hasOwnProperty(t)?e[i][t]:("x"!==i||"logscale"!==t)&&(void 0!==n.user_attrs_[t]?n.user_attrs_[t]:(e=n.attrs_.axes)&&e[i]&&e[i].hasOwnProperty(t)?e[i][t]:"y"==i&&n.axes_[0].hasOwnProperty(t)?n.axes_[0][t]:"y2"==i&&n.axes_[1].hasOwnProperty(t)?n.axes_[1][t]:n.attr_(t))}},Y.prototype.rollPeriod=function(){return this.rollPeriod_},Y.prototype.xAxisRange=function(){return this.dateWindow_?this.dateWindow_:this.xAxisExtremes()},Y.prototype.xAxisExtremes=function(){var t=this.getNumericOption("xRangePad")/this.plotter_.area.w;if(0===this.numRows())return[0-t,1+t];var e=this.rawData_[0][0],i=this.rawData_[this.rawData_.length-1][0];if(t){var n=i-e;e-=n*t,i+=n*t}return[e,i]},Y.prototype.yAxisExtremes=function(){var t=this.gatherDatasets_(this.rolledSeries_,null),e=t.extremes,i=this.axes_;this.computeYAxisRanges_(e);var n=this.axes_;return this.axes_=i,n.map(function(t){return t.extremeRange})},Y.prototype.yAxisRange=function(t){if(void 0===t&&(t=0),t<0||t>=this.axes_.length)return null;var e=this.axes_[t];return[e.computedValueRange[0],e.computedValueRange[1]]},Y.prototype.yAxisRanges=function(){for(var t=[],e=0;e<this.axes_.length;e++)t.push(this.yAxisRange(e));return t},Y.prototype.toDomCoords=function(t,e,i){return[this.toDomXCoord(t),this.toDomYCoord(e,i)]},Y.prototype.toDomXCoord=function(t){if(null===t)return null;var e=this.plotter_.area,i=this.xAxisRange();return e.x+(t-i[0])/(i[1]-i[0])*e.w},Y.prototype.toDomYCoord=function(t,e){var i=this.toPercentYCoord(t,e);if(null===i)return null;var n=this.plotter_.area;return n.y+i*n.h},Y.prototype.toDataCoords=function(t,e,i){return[this.toDataXCoord(t),this.toDataYCoord(e,i)]},Y.prototype.toDataXCoord=function(t){if(null===t)return null;var e=this.plotter_.area,i=this.xAxisRange();if(this.attributes_.getForAxis("logscale","x")){var n=(t-e.x)/e.w;return N.logRangeFraction(i[0],i[1],n)}return i[0]+(t-e.x)/e.w*(i[1]-i[0])},Y.prototype.toDataYCoord=function(t,e){if(null===t)return null;var i=this.plotter_.area,n=this.yAxisRange(e);if(void 0===e&&(e=0),this.attributes_.getForAxis("logscale",e)){var r=(t-i.y)/i.h;return N.logRangeFraction(n[1],n[0],r)}return n[0]+(i.y+i.h-t)/i.h*(n[1]-n[0])},Y.prototype.toPercentYCoord=function(t,e){if(null===t)return null;void 0===e&&(e=0);var i,n=this.yAxisRange(e);if(this.attributes_.getForAxis("logscale",e)){var r=N.log10(n[0]),a=N.log10(n[1]);i=(a-N.log10(t))/(a-r)}else i=(n[1]-t)/(n[1]-n[0]);return i},Y.prototype.toPercentXCoord=function(t){if(null===t)return null;var e,i=this.xAxisRange();if(!0===this.attributes_.getForAxis("logscale","x")){var n=N.log10(i[0]),r=N.log10(i[1]);e=(N.log10(t)-n)/(r-n)}else e=(t-i[0])/(i[1]-i[0]);return e},Y.prototype.numColumns=function(){return this.rawData_?this.rawData_[0]?this.rawData_[0].length:this.attr_("labels").length:0},Y.prototype.numRows=function(){return this.rawData_?this.rawData_.length:0},Y.prototype.getValue=function(t,e){return t<0||t>this.rawData_.length?null:e<0||e>this.rawData_[t].length?null:this.rawData_[t][e]},Y.prototype.createInterface_=function(){var t=this.maindiv_;this.graphDiv=document.createElement("div"),this.graphDiv.style.textAlign="left",this.graphDiv.style.position="relative",t.appendChild(this.graphDiv),this.canvas_=N.createCanvas(),this.canvas_.style.position="absolute",this.hidden_=this.createPlotKitCanvas_(this.canvas_),this.canvas_ctx_=N.getContext(this.canvas_),this.hidden_ctx_=N.getContext(this.hidden_),this.resizeElements_(),this.graphDiv.appendChild(this.hidden_),this.graphDiv.appendChild(this.canvas_),this.mouseEventElement_=this.createMouseEventElement_(),this.layout_=new r.default(this);var n=this;this.mouseMoveHandler_=function(t){n.mouseMove_(t)},this.mouseOutHandler_=function(t){var e=t.target||t.fromElement,i=t.relatedTarget||t.toElement;N.isNodeContainedBy(e,n.graphDiv)&&!N.isNodeContainedBy(i,n.graphDiv)&&n.mouseOut_(t)},this.addAndTrackEvent(window,"mouseout",this.mouseOutHandler_),this.addAndTrackEvent(this.mouseEventElement_,"mousemove",this.mouseMoveHandler_),this.resizeHandler_||(this.resizeHandler_=function(t){n.resize()},this.addAndTrackEvent(window,"resize",this.resizeHandler_))},Y.prototype.resizeElements_=function(){this.graphDiv.style.width=this.width_+"px",this.graphDiv.style.height=this.height_+"px";var t=this.getNumericOption("pixelRatio"),e=t||N.getContextPixelRatio(this.canvas_ctx_);this.canvas_.width=this.width_*e,this.canvas_.height=this.height_*e,this.canvas_.style.width=this.width_+"px",this.canvas_.style.height=this.height_+"px",1!==e&&this.canvas_ctx_.scale(e,e);var i=t||N.getContextPixelRatio(this.hidden_ctx_);this.hidden_.width=this.width_*i,this.hidden_.height=this.height_*i,this.hidden_.style.width=this.width_+"px",this.hidden_.style.height=this.height_+"px",1!==i&&this.hidden_ctx_.scale(i,i)},Y.prototype.destroy=function(){this.canvas_ctx_.restore(),this.hidden_ctx_.restore();for(var t=this.plugins_.length-1;0<=t;t--){var e=this.plugins_.pop();e.plugin.destroy&&e.plugin.destroy()}this.removeTrackedEvents_(),N.removeEvent(window,"mouseout",this.mouseOutHandler_),N.removeEvent(this.mouseEventElement_,"mousemove",this.mouseMoveHandler_),N.removeEvent(window,"resize",this.resizeHandler_),this.resizeHandler_=null,function t(e){for(;e.hasChildNodes();)t(e.firstChild),e.removeChild(e.firstChild)}(this.maindiv_);var i=function(t){for(var e in t)"object"==typeof t[e]&&(t[e]=null)};i(this.layout_),i(this.plotter_),i(this)},Y.prototype.createPlotKitCanvas_=function(t){var e=N.createCanvas();return e.style.position="absolute",e.style.top=t.style.top,e.style.left=t.style.left,e.width=this.width_,e.height=this.height_,e.style.width=this.width_+"px",e.style.height=this.height_+"px",e},Y.prototype.createMouseEventElement_=function(){return this.canvas_},Y.prototype.setColors_=function(){var t=this.getLabels(),e=t.length-1;this.colors_=[],this.colorsMap_={};for(var i=this.getNumericOption("colorSaturation")||1,n=this.getNumericOption("colorValue")||.5,r=Math.ceil(e/2),a=this.getOption("colors"),s=this.visibility(),o=0;o<e;o++)if(s[o]){var l=t[o+1],u=this.attributes_.getForSeries("color",l);if(!u)if(a)u=a[o%a.length];else{var h=o%2?r+(o+1)/2:Math.ceil((o+1)/2),c=1*h/(1+e);u=N.hsvToRGB(c,i,n)}this.colors_.push(u),this.colorsMap_[l]=u}},Y.prototype.getColors=function(){return this.colors_},Y.prototype.getPropertiesForSeries=function(t){for(var e=-1,i=this.getLabels(),n=1;n<i.length;n++)if(i[n]==t){e=n;break}return-1==e?null:{name:t,column:e,visible:this.visibility()[e-1],color:this.colorsMap_[t],axis:1+this.attributes_.axisForSeries(t)}},Y.prototype.createRollInterface_=function(){var t=this,e=this.roller_;e||(this.roller_=e=document.createElement("input"),e.type="text",e.style.display="none",e.className="dygraph-roller",this.graphDiv.appendChild(e));var i=this.getBooleanOption("showRoller")?"block":"none",n=this.getArea(),r={top:n.y+n.h-25+"px",left:n.x+1+"px",display:i};e.size="2",e.value=this.rollPeriod_,N.update(e.style,r),e.onchange=function(){return t.adjustRoll(e.value)}},Y.prototype.createDragInterface_=function(){var i={isZooming:!1,isPanning:!1,is2DPan:!1,dragStartX:null,dragStartY:null,dragEndX:null,dragEndY:null,dragDirection:null,prevEndX:null,prevEndY:null,prevDragDirection:null,cancelNextDblclick:!1,initialLeftmostDate:null,xUnitsPerPixel:null,dateRange:null,px:0,py:0,boundedDates:null,boundedValues:null,tarp:new y.default,initializeMouseDown:function(t,e,i){t.preventDefault?t.preventDefault():(t.returnValue=!1,t.cancelBubble=!0);var n=N.findPos(e.canvas_);i.px=n.x,i.py=n.y,i.dragStartX=N.dragGetX_(t,i),i.dragStartY=N.dragGetY_(t,i),i.cancelNextDblclick=!1,i.tarp.cover()},destroy:function(){var t=this;if((t.isZooming||t.isPanning)&&(t.isZooming=!1,t.dragStartX=null,t.dragStartY=null),t.isPanning){t.isPanning=!1,t.draggingDate=null,t.dateRange=null;for(var e=0;e<n.axes_.length;e++)delete n.axes_[e].draggingValue,delete n.axes_[e].dragValueRange}t.tarp.uncover()}},t=this.getOption("interactionModel"),n=this;for(var e in t)t.hasOwnProperty(e)&&this.addAndTrackEvent(this.mouseEventElement_,e,function(e){return function(t){e(t,n,i)}}(t[e]));t.willDestroyContextMyself||this.addAndTrackEvent(document,"mouseup",function(t){i.destroy()})},Y.prototype.drawZoomRect_=function(t,e,i,n,r,a,s,o){var l=this.canvas_ctx_;a==N.HORIZONTAL?l.clearRect(Math.min(e,s),this.layout_.getPlotArea().y,Math.abs(e-s),this.layout_.getPlotArea().h):a==N.VERTICAL&&l.clearRect(this.layout_.getPlotArea().x,Math.min(n,o),this.layout_.getPlotArea().w,Math.abs(n-o)),t==N.HORIZONTAL?i&&e&&(l.fillStyle="rgba(128,128,128,0.33)",l.fillRect(Math.min(e,i),this.layout_.getPlotArea().y,Math.abs(i-e),this.layout_.getPlotArea().h)):t==N.VERTICAL&&r&&n&&(l.fillStyle="rgba(128,128,128,0.33)",l.fillRect(this.layout_.getPlotArea().x,Math.min(n,r),this.layout_.getPlotArea().w,Math.abs(r-n)))},Y.prototype.clearZoomRect_=function(){this.currentZoomRectArgs_=null,this.canvas_ctx_.clearRect(0,0,this.width_,this.height_)},Y.prototype.doZoomX_=function(t,e){this.currentZoomRectArgs_=null;var i=this.toDataXCoord(t),n=this.toDataXCoord(e);this.doZoomXDates_(i,n)},Y.prototype.doZoomXDates_=function(t,e){var i=this,n=this.xAxisRange(),r=[t,e],a=this.getFunctionOption("zoomCallback");this.doAnimatedZoom(n,r,null,null,function(){a&&a.call(i,t,e,i.yAxisRanges())})},Y.prototype.doZoomY_=function(t,e){var r=this;this.currentZoomRectArgs_=null;for(var i=this.yAxisRanges(),n=[],a=0;a<this.axes_.length;a++){var s=this.toDataYCoord(t,a),o=this.toDataYCoord(e,a);n.push([o,s])}var l=this.getFunctionOption("zoomCallback");this.doAnimatedZoom(null,null,i,n,function(){if(l){var t=r.xAxisRange(),e=p(t,2),i=e[0],n=e[1];l.call(r,i,n,r.yAxisRanges())}})},Y.zoomAnimationFunction=function(t,e){return(1-Math.pow(1.5,-t))/(1-Math.pow(1.5,-e))},Y.prototype.resetZoom=function(){var t=this,e=this.isZoomed("x"),i=this.isZoomed("y"),n=e||i;if(this.clearSelection(),n){var r=this.xAxisExtremes(),a=p(r,2),s=a[0],o=a[1],l=this.getBooleanOption("animatedZooms"),u=this.getFunctionOption("zoomCallback");if(!l)return this.dateWindow_=null,this.axes_.forEach(function(t){t.valueRange&&delete t.valueRange}),this.drawGraph_(),void(u&&u.call(this,s,o,this.yAxisRanges()));var h=null,c=null,d=null,f=null;e&&(h=this.xAxisRange(),c=[s,o]),i&&(d=this.yAxisRanges(),f=this.yAxisExtremes()),this.doAnimatedZoom(h,c,d,f,function(){t.dateWindow_=null,t.axes_.forEach(function(t){t.valueRange&&delete t.valueRange}),u&&u.call(t,s,o,t.yAxisRanges())})}},Y.prototype.doAnimatedZoom=function(t,e,i,n,r){var a,s,o=this,l=this.getBooleanOption("animatedZooms")?Y.ANIMATION_STEPS:1,u=[],h=[];if(null!==t&&null!==e)for(a=1;a<=l;a++)s=Y.zoomAnimationFunction(a,l),u[a-1]=[t[0]*(1-s)+s*e[0],t[1]*(1-s)+s*e[1]];if(null!==i&&null!==n)for(a=1;a<=l;a++){s=Y.zoomAnimationFunction(a,l);for(var c=[],d=0;d<this.axes_.length;d++)c.push([i[d][0]*(1-s)+s*n[d][0],i[d][1]*(1-s)+s*n[d][1]]);h[a-1]=c}N.repeatAndCleanup(function(t){if(h.length)for(var e=0;e<o.axes_.length;e++){var i=h[t][e];o.axes_[e].valueRange=[i[0],i[1]]}u.length&&(o.dateWindow_=u[t]),o.drawGraph_()},l,Y.ANIMATION_DURATION/l,r)},Y.prototype.getArea=function(){return this.plotter_.area},Y.prototype.eventToDomCoords=function(t){if(t.offsetX&&t.offsetY)return[t.offsetX,t.offsetY];var e=N.findPos(this.mouseEventElement_);return[N.pageX(t)-e.x,N.pageY(t)-e.y]},Y.prototype.findClosestRow=function(t){for(var e=1/0,i=-1,n=this.layout_.points,r=0;r<n.length;r++)for(var a=n[r],s=a.length,o=0;o<s;o++){var l=a[o];if(N.isValidPoint(l,!0)){var u=Math.abs(l.canvasx-t);u<e&&(e=u,i=l.idx)}}return i},Y.prototype.findClosestPoint=function(t,e){for(var i,n,r,a,s,o,l,u=1/0,h=this.layout_.points.length-1;0<=h;--h)for(var c=this.layout_.points[h],d=0;d<c.length;++d)a=c[d],N.isValidPoint(a)&&(n=a.canvasx-t,r=a.canvasy-e,(i=n*n+r*r)<u&&(u=i,o=h,l=(s=a).idx));return{row:l,seriesName:this.layout_.setNames[o],point:s}},Y.prototype.findStackedPoint=function(t,e){for(var i,n,r=this.findClosestRow(t),a=0;a<this.layout_.points.length;++a){var s=this.getLeftBoundary_(a),o=r-s,l=this.layout_.points[a];if(!(o>=l.length)){var u=l[o];if(N.isValidPoint(u)){var h=u.canvasy;if(t>u.canvasx&&o+1<l.length){var c=l[o+1];if(N.isValidPoint(c)){var d=c.canvasx-u.canvasx;if(0<d){var f=(t-u.canvasx)/d;h+=f*(c.canvasy-u.canvasy)}}}else if(t<u.canvasx&&0<o){var p=l[o-1];if(N.isValidPoint(p)){var d=u.canvasx-p.canvasx;if(0<d){var f=(u.canvasx-t)/d;h+=f*(p.canvasy-u.canvasy)}}}(0===a||h<e)&&(i=u,n=a)}}}return{row:r,seriesName:this.layout_.setNames[n],point:i}},Y.prototype.mouseMove_=function(t){var e=this.layout_.points;if(null!=e){var i=this.eventToDomCoords(t),n=i[0],r=i[1],a=this.getOption("highlightSeriesOpts"),s=!1;if(a&&!this.isSeriesLocked()){var o;o=this.getBooleanOption("stackedGraph")?this.findStackedPoint(n,r):this.findClosestPoint(n,r),s=this.setSelection(o.row,o.seriesName)}else{var l=this.findClosestRow(n);s=this.setSelection(l)}var u=this.getFunctionOption("highlightCallback");u&&s&&u.call(this,t,this.lastx_,this.selPoints_,this.lastRow_,this.highlightSet_)}},Y.prototype.getLeftBoundary_=function(t){if(this.boundaryIds_[t])return this.boundaryIds_[t][0];for(var e=0;e<this.boundaryIds_.length;e++)if(void 0!==this.boundaryIds_[e])return this.boundaryIds_[e][0];return 0},Y.prototype.animateSelection_=function(e){void 0===this.fadeLevel&&(this.fadeLevel=0),void 0===this.animateId&&(this.animateId=0);var t=this.fadeLevel,i=e<0?t:10-t;if(i<=0)this.fadeLevel&&this.updateSelection_(1);else{var n=++this.animateId,r=this;N.repeatAndCleanup(function(t){r.animateId==n&&(r.fadeLevel+=e,0===r.fadeLevel?r.clearSelection():r.updateSelection_(r.fadeLevel/10))},i,30,function(){0!==r.fadeLevel&&e<0&&(r.fadeLevel=0,r.clearSelection())})}},Y.prototype.updateSelection_=function(t){this.cascadeEvents_("select",{selectedRow:-1===this.lastRow_?void 0:this.lastRow_,selectedX:-1===this.lastx_?void 0:this.lastx_,selectedPoints:this.selPoints_});var e,i=this.canvas_ctx_;if(this.getOption("highlightSeriesOpts")){i.clearRect(0,0,this.width_,this.height_);var n=1-this.getNumericOption("highlightSeriesBackgroundAlpha"),r=N.toRGB_(this.getOption("highlightSeriesBackgroundColor"));if(n){if(void 0===t)return void this.animateSelection_(1);n*=t,i.fillStyle="rgba("+r.r+","+r.g+","+r.b+","+n+")",i.fillRect(0,0,this.width_,this.height_)}this.plotter_._renderLineChart(this.highlightSet_,i)}else if(0<=this.previousVerticalX_){var a=0,s=this.attr_("labels");for(e=1;e<s.length;e++){var o=this.getNumericOption("highlightCircleSize",s[e]);a<o&&(a=o)}var l=this.previousVerticalX_;i.clearRect(l-a-1,0,2*a+2,this.height_)}if(0<this.selPoints_.length){var u=this.selPoints_[0].canvasx;for(i.save(),e=0;e<this.selPoints_.length;e++){var h=this.selPoints_[e];if(!isNaN(h.canvasy)){var c=this.getNumericOption("highlightCircleSize",h.name),d=this.getFunctionOption("drawHighlightPointCallback",h.name),f=this.plotter_.colors[h.name];d||(d=N.Circles.DEFAULT),i.lineWidth=this.getNumericOption("strokeWidth",h.name),i.strokeStyle=f,i.fillStyle=f,d.call(this,this,h.name,i,u,h.canvasy,f,c,h.idx)}}i.restore(),this.previousVerticalX_=u}},Y.prototype.setSelection=function(t,e,i){var n=!(this.selPoints_=[]);if(!1!==t&&0<=t){t!=this.lastRow_&&(n=!0),this.lastRow_=t;for(var r=0;r<this.layout_.points.length;++r){var a=this.layout_.points[r],s=t-this.getLeftBoundary_(r);if(0<=s&&s<a.length&&a[s].idx==t){var o=a[s];null!==o.yval&&this.selPoints_.push(o)}else for(var l=0;l<a.length;++l){var o=a[l];if(o.idx==t){null!==o.yval&&this.selPoints_.push(o);break}}}}else 0<=this.lastRow_&&(n=!0),this.lastRow_=-1;return this.selPoints_.length?this.lastx_=this.selPoints_[0].xval:this.lastx_=-1,void 0!==e&&(this.highlightSet_!==e&&(n=!0),this.highlightSet_=e),void 0!==i&&(this.lockedSet_=i),n&&this.updateSelection_(void 0),n},Y.prototype.mouseOut_=function(t){this.getFunctionOption("unhighlightCallback")&&this.getFunctionOption("unhighlightCallback").call(this,t),this.getBooleanOption("hideOverlayOnMouseOut")&&!this.lockedSet_&&this.clearSelection()},Y.prototype.clearSelection=function(){this.cascadeEvents_("deselect",{}),this.lockedSet_=!1,this.fadeLevel?this.animateSelection_(-1):(this.canvas_ctx_.clearRect(0,0,this.width_,this.height_),this.fadeLevel=0,this.selPoints_=[],this.lastx_=-1,this.lastRow_=-1,this.highlightSet_=null)},Y.prototype.getSelection=function(){if(!this.selPoints_||this.selPoints_.length<1)return-1;for(var t=0;t<this.layout_.points.length;t++)for(var e=this.layout_.points[t],i=0;i<e.length;i++)if(e[i].x==this.selPoints_[0].x)return e[i].idx;return-1},Y.prototype.getHighlightSeries=function(){return this.highlightSet_},Y.prototype.isSeriesLocked=function(){return this.lockedSet_},Y.prototype.loadedEvent_=function(t){this.rawData_=this.parseCSV_(t),this.cascadeDataDidUpdateEvent_(),this.predraw_()},Y.prototype.addXTicks_=function(){var t;t=this.dateWindow_?[this.dateWindow_[0],this.dateWindow_[1]]:this.xAxisExtremes();var e=this.optionsViewForAxis_("x"),i=e("ticker")(t[0],t[1],this.plotter_.area.w,e,this);this.layout_.setXTicks(i)},Y.prototype.getHandlerClass_=function(){return this.attr_("dataHandler")?this.attr_("dataHandler"):this.fractions_?this.getBooleanOption("errorBars")?C.default:L.default:this.getBooleanOption("customBars")?k.default:this.getBooleanOption("errorBars")?S.default:T.default},Y.prototype.predraw_=function(){var t=new Date;this.dataHandler_=new(this.getHandlerClass_()),this.layout_.computePlotArea(),this.computeYAxes_(),this.is_initial_draw_||(this.canvas_ctx_.restore(),this.hidden_ctx_.restore()),this.canvas_ctx_.save(),this.hidden_ctx_.save(),this.plotter_=new s.default(this,this.hidden_,this.hidden_ctx_,this.layout_),this.createRollInterface_(),this.cascadeEvents_("predraw"),this.rolledSeries_=[null];for(var e=1;e<this.numColumns();e++){var i=this.dataHandler_.extractSeries(this.rawData_,e,this.attributes_);1<this.rollPeriod_&&(i=this.dataHandler_.rollingAverage(i,this.rollPeriod_,this.attributes_)),this.rolledSeries_.push(i)}this.drawGraph_();var n=new Date;this.drawingTimeMs_=n-t},Y.PointType=void 0,Y.stackPoints_=function(i,t,e,n){for(var r=null,a=null,s=null,o=-1,l=0;l<i.length;++l){var u=i[l],h=u.xval;void 0===t[h]&&(t[h]=0);var c=u.yval;isNaN(c)||null===c?c="none"==n?0:(function(t){if(!(t<=o))for(var e=t;e<i.length;++e)if(s=null,!isNaN(i[e].yval)&&null!==i[e].yval){s=i[o=e];break}}(l),a&&s&&"none"!=n?a.yval+(s.yval-a.yval)*((h-a.xval)/(s.xval-a.xval)):a&&"all"==n?a.yval:s&&"all"==n?s.yval:0):a=u;var d=t[h];r!=h&&(d+=c,t[h]=d),r=h,(u.yval_stacked=d)>e[1]&&(e[1]=d),d<e[0]&&(e[0]=d)}},Y.prototype.gatherDatasets_=function(t,e){var i,n,r,a,s,o,l=[],u=[],h=[],c={},d=t.length-1;for(i=d;1<=i;i--)if(this.visibility()[i-1]){if(e){o=t[i];var f=e[0],p=e[1];for(a=r=null,n=0;n<o.length;n++)o[n][0]>=f&&null===r&&(r=n),o[n][0]<=p&&(a=n);null===r&&(r=0);for(var g=r,m=!0;m&&0<g;)m=null===o[--g][1];null===a&&(a=o.length-1);var v=a;for(m=!0;m&&v<o.length-1;)m=null===o[++v][1];g!==r&&(r=g),v!==a&&(a=v),l[i-1]=[r,a],o=o.slice(r,a+1)}else o=t[i],l[i-1]=[0,o.length-1];var y=this.attr_("labels")[i],b=this.dataHandler_.getExtremeYValues(o,e,this.getBooleanOption("stepPlot",y)),_=this.dataHandler_.seriesToPoints(o,y,l[i-1][0]);this.getBooleanOption("stackedGraph")&&(s=this.attributes_.axisForSeries(y),void 0===h[s]&&(h[s]=[]),Y.stackPoints_(_,h[s],b,this.getBooleanOption("stackedGraphNaNFill"))),c[y]=b,u[i]=_}return{points:u,extremes:c,boundaryIds:l}},Y.prototype.drawGraph_=function(){var t=new Date,e=this.is_initial_draw_;this.is_initial_draw_=!1,this.layout_.removeAllDatasets(),this.setColors_(),this.attrs_.pointSize=.5*this.getNumericOption("highlightCircleSize");var i=this.gatherDatasets_(this.rolledSeries_,this.dateWindow_),n=i.points,r=i.extremes;this.boundaryIds_=i.boundaryIds,this.setIndexByName_={};for(var a=this.attr_("labels"),s=0,o=1;o<n.length;o++)this.visibility()[o-1]&&(this.layout_.addDataset(a[o],n[o]),this.datasetIndex_[o]=s++);for(var o=0;o<a.length;o++)this.setIndexByName_[a[o]]=o;if(this.computeYAxisRanges_(r),this.layout_.setYAxes(this.axes_),this.addXTicks_(),this.layout_.evaluate(),this.renderGraph_(e),this.getStringOption("timingName")){var l=new Date;console.log(this.getStringOption("timingName")+" - drawGraph: "+(l-t)+"ms")}},Y.prototype.renderGraph_=function(t){this.cascadeEvents_("clearChart"),this.plotter_.clear();var e=this.getFunctionOption("underlayCallback");e&&e.call(this,this.hidden_ctx_,this.layout_.getPlotArea(),this,this);var i={canvas:this.hidden_,drawingContext:this.hidden_ctx_};this.cascadeEvents_("willDrawChart",i),this.plotter_.render(),this.cascadeEvents_("didDrawChart",i),this.lastRow_=-1,this.canvas_.getContext("2d").clearRect(0,0,this.width_,this.height_);var n=this.getFunctionOption("drawCallback");if(null!==n&&n.call(this,this,t),t)for(this.readyFired_=!0;0<this.readyFns_.length;){var r=this.readyFns_.pop();r(this)}},Y.prototype.computeYAxes_=function(){var t,e,i;for(this.axes_=[],t=0;t<this.attributes_.numAxes();t++)e={g:this},N.update(e,this.attributes_.axisOptions(t)),this.axes_[t]=e;for(t=0;t<this.axes_.length;t++)if(0===t)e=this.optionsViewForAxis_("y"+(t?"2":"")),(i=e("valueRange"))&&(this.axes_[t].valueRange=i);else{var n=this.user_attrs_.axes;n&&n.y2&&(i=n.y2.valueRange)&&(this.axes_[t].valueRange=i)}},Y.prototype.numAxes=function(){return this.attributes_.numAxes()},Y.prototype.axisPropertiesForSeries=function(t){return this.axes_[this.attributes_.axisForSeries(t)]},Y.prototype.computeYAxisRanges_=function(t){for(var e,i,n,r,a,s=function(t){return isNaN(parseFloat(t))},o=this.attributes_.numAxes(),l=0;l<o;l++){var u=this.axes_[l],h=this.attributes_.getForAxis("logscale",l),c=this.attributes_.getForAxis("includeZero",l),d=this.attributes_.getForAxis("independentTicks",l);n=this.attributes_.seriesForAxis(l),e=!0,r=.1;var f=this.getNumericOption("yRangePad");if(null!==f&&(e=!1,r=f/this.plotter_.area.h),0===n.length)u.extremeRange=[0,1];else{for(var p,g,m=1/0,v=-1/0,y=0;y<n.length;y++)t.hasOwnProperty(n[y])&&(null!==(p=t[n[y]][0])&&(m=Math.min(p,m)),null!==(g=t[n[y]][1])&&(v=Math.max(g,v)));c&&!h&&(0<m&&(m=0),v<0&&(v=0)),m==1/0&&(m=0),v==-1/0&&(v=1),0==(i=v-m)&&(i=0!==v?Math.abs(v):v=1);var b=v,_=m;e&&(h?(b=v+r*i,_=m):((_=m-r*i)<0&&0<=m&&(_=0),0<(b=v+r*i)&&v<=0&&(b=0))),u.extremeRange=[_,b]}if(u.valueRange){var T=s(u.valueRange[0])?u.extremeRange[0]:u.valueRange[0],E=s(u.valueRange[1])?u.extremeRange[1]:u.valueRange[1];u.computedValueRange=[T,E]}else u.computedValueRange=u.extremeRange;if(!e)if(h){T=u.computedValueRange[0],E=u.computedValueRange[1];var S=r/(2*r-1),w=(r-1)/(2*r-1);u.computedValueRange[0]=N.logRangeFraction(T,E,S),u.computedValueRange[1]=N.logRangeFraction(T,E,w)}else T=u.computedValueRange[0],E=u.computedValueRange[1],i=E-T,u.computedValueRange[0]=T-i*r,u.computedValueRange[1]=E+i*r;if(d){u.independentTicks=d;var k=this.optionsViewForAxis_("y"+(l?"2":"")),A=k("ticker");u.ticks=A(u.computedValueRange[0],u.computedValueRange[1],this.plotter_.area.h,k,this),a||(a=u)}}if(void 0===a)throw'Configuration Error: At least one axis has to have the "independentTicks" option activated.';for(var l=0;l<o;l++){var u=this.axes_[l];if(!u.independentTicks){for(var k=this.optionsViewForAxis_("y"+(l?"2":"")),A=k("ticker"),L=a.ticks,P=a.computedValueRange[1]-a.computedValueRange[0],C=u.computedValueRange[1]-u.computedValueRange[0],x=[],I=0;I<L.length;I++){var R=(L[I].v-a.computedValueRange[0])/P,D=u.computedValueRange[0]+R*C;x.push(D)}u.ticks=A(u.computedValueRange[0],u.computedValueRange[1],this.plotter_.area.h,k,this,x)}}},Y.prototype.detectTypeFromString_=function(t){var e=!1,i=t.indexOf("-");0<i&&"e"!=t[i-1]&&"E"!=t[i-1]||0<=t.indexOf("/")||isNaN(parseFloat(t))?e=!0:8==t.length&&"19700101"<t&&t<"20371231"&&(e=!0),this.setXAxisOptions_(e)},Y.prototype.setXAxisOptions_=function(t){this.attrs_.axes.x.axisLabelFormatter=t?(this.attrs_.xValueParser=N.dateParser,this.attrs_.axes.x.valueFormatter=N.dateValueFormatter,this.attrs_.axes.x.ticker=b.dateTicker,N.dateAxisLabelFormatter):(this.attrs_.xValueParser=function(t){return parseFloat(t)},this.attrs_.axes.x.valueFormatter=function(t){return t},this.attrs_.axes.x.ticker=b.numericTicks,this.attrs_.axes.x.valueFormatter)},Y.prototype.parseCSV_=function(t){var e,i,n=[],r=N.detectLineDelimiter(t),a=t.split(r||"\n"),s=this.getStringOption("delimiter");-1==a[0].indexOf(s)&&0<=a[0].indexOf("\t")&&(s="\t");var o=0;"labels"in this.user_attrs_||(o=1,this.attrs_.labels=a[0].split(s),this.attributes_.reparseSeries());for(var l,u=!1,h=this.attr_("labels").length,c=!1,d=o;d<a.length;d++){var f=a[d];if(0!==f.length&&"#"!=f[0]){var p=f.split(s);if(!(p.length<2)){var g=[];if(u||(this.detectTypeFromString_(p[0]),l=this.getFunctionOption("xValueParser"),u=!0),g[0]=l(p[0],this),this.fractions_)for(i=1;i<p.length;i++)2!=(e=p[i].split("/")).length?(console.error('Expected fractional "num/den" values in CSV data but found a value \''+p[i]+"' on line "+(1+d)+" ('"+f+"') which is not of this form."),g[i]=[0,0]):g[i]=[N.parseFloat_(e[0],d,f),N.parseFloat_(e[1],d,f)];else if(this.getBooleanOption("errorBars"))for(p.length%2!=1&&console.error("Expected alternating (value, stdev.) pairs in CSV data but line "+(1+d)+" has an odd number of values ("+(p.length-1)+"): '"+f+"'"),i=1;i<p.length;i+=2)g[(i+1)/2]=[N.parseFloat_(p[i],d,f),N.parseFloat_(p[i+1],d,f)];else if(this.getBooleanOption("customBars"))for(i=1;i<p.length;i++){var m=p[i];/^ *$/.test(m)?g[i]=[null,null,null]:3==(e=m.split(";")).length?g[i]=[N.parseFloat_(e[0],d,f),N.parseFloat_(e[1],d,f),N.parseFloat_(e[2],d,f)]:console.warn('When using customBars, values must be either blank or "low;center;high" tuples (got "'+m+'" on line '+(1+d))}else for(i=1;i<p.length;i++)g[i]=N.parseFloat_(p[i],d,f);if(0<n.length&&g[0]<n[n.length-1][0]&&(c=!0),g.length!=h&&console.error("Number of columns in line "+d+" ("+g.length+") does not agree with number of labels ("+h+") "+f),0===d&&this.attr_("labels")){var v=!0;for(i=0;v&&i<g.length;i++)g[i]&&(v=!1);if(v){console.warn("The dygraphs 'labels' option is set, but the first row of CSV data ('"+f+"') appears to also contain labels. Will drop the CSV labels and use the option labels.");continue}}n.push(g)}}}return c&&(console.warn("CSV is out of order; order it correctly to speed loading."),n.sort(function(t,e){return t[0]-e[0]})),n},Y.prototype.parseArray_=function(t){if(0===t.length)return console.error("Can't plot empty data set"),null;if(0===t[0].length)return console.error("Data set cannot contain an empty row"),null;var e;if(function(t){var e=t[0],i=e[0];if("number"!=typeof i&&!N.isDateLike(i))throw new Error("Expected number or date but got "+typeof i+": "+i+".");for(var n=1;n<e.length;n++){var r=e[n];if(null!=r&&"number"!=typeof r&&!N.isArrayLike(r))throw new Error("Expected number or array but got "+typeof r+": "+r+".")}}(t),null===this.attr_("labels")){for(console.warn("Using default labels. Set labels explicitly via 'labels' in the options parameter"),this.attrs_.labels=["X"],e=1;e<t[0].length;e++)this.attrs_.labels.push("Y"+e);this.attributes_.reparseSeries()}else{var i=this.attr_("labels");if(i.length!=t[0].length)return console.error("Mismatch between number of labels ("+i+") and number of columns in array ("+t[0].length+")"),null}if(N.isDateLike(t[0][0])){this.attrs_.axes.x.valueFormatter=N.dateValueFormatter,this.attrs_.axes.x.ticker=b.dateTicker,this.attrs_.axes.x.axisLabelFormatter=N.dateAxisLabelFormatter;var n=N.clone(t);for(e=0;e<t.length;e++){if(0===n[e].length)return console.error("Row "+(1+e)+" of data is empty"),null;if(null===n[e][0]||"function"!=typeof n[e][0].getTime||isNaN(n[e][0].getTime()))return console.error("x value in row "+(1+e)+" is not a Date"),null;n[e][0]=n[e][0].getTime()}return n}return this.attrs_.axes.x.valueFormatter=function(t){return t},this.attrs_.axes.x.ticker=b.numericTicks,this.attrs_.axes.x.axisLabelFormatter=N.numberAxisLabelFormatter,t},Y.prototype.parseDataTable_=function(t){var e=t.getNumberOfColumns(),i=t.getNumberOfRows(),n=t.getColumnType(0);if("date"==n||"datetime"==n)this.attrs_.xValueParser=N.dateParser,this.attrs_.axes.x.valueFormatter=N.dateValueFormatter,this.attrs_.axes.x.ticker=b.dateTicker,this.attrs_.axes.x.axisLabelFormatter=N.dateAxisLabelFormatter;else{if("number"!=n)throw new Error("only 'date', 'datetime' and 'number' types are supported for column 1 of DataTable input (Got '"+n+"')");this.attrs_.xValueParser=function(t){return parseFloat(t)},this.attrs_.axes.x.valueFormatter=function(t){return t},this.attrs_.axes.x.ticker=b.numericTicks,this.attrs_.axes.x.axisLabelFormatter=this.attrs_.axes.x.valueFormatter}var r,a,s=[],o={},l=!1;for(r=1;r<e;r++){var u=t.getColumnType(r);if("number"==u)s.push(r);else{if("string"!=u||!this.getBooleanOption("displayAnnotations"))throw new Error("Only 'number' is supported as a dependent type with Gviz. 'string' is only supported if displayAnnotations is true");var h=s[s.length-1];o.hasOwnProperty(h)?o[h].push(r):o[h]=[r],l=!0}}var c=[t.getColumnLabel(0)];for(r=0;r<s.length;r++)c.push(t.getColumnLabel(s[r])),this.getBooleanOption("errorBars")&&(r+=1);this.attrs_.labels=c,e=c.length;var d=[],f=!1,p=[];for(r=0;r<i;r++){var g=[];if(void 0!==t.getValue(r,0)&&null!==t.getValue(r,0)){if("date"==n||"datetime"==n?g.push(t.getValue(r,0).getTime()):g.push(t.getValue(r,0)),this.getBooleanOption("errorBars"))for(a=0;a<e-1;a++)g.push([t.getValue(r,1+2*a),t.getValue(r,2+2*a)]);else{for(a=0;a<s.length;a++){var m=s[a];if(g.push(t.getValue(r,m)),l&&o.hasOwnProperty(m)&&null!==t.getValue(r,o[m][0])){var v={};v.series=t.getColumnLabel(m),v.xval=g[0],v.shortText=function(t){var e=String.fromCharCode(65+t%26);for(t=Math.floor(t/26);0<t;)e=String.fromCharCode(65+(t-1)%26)+e.toLowerCase(),t=Math.floor((t-1)/26);return e}(p.length),v.text="";for(var y=0;y<o[m].length;y++)y&&(v.text+="\n"),v.text+=t.getValue(r,o[m][y]);p.push(v)}}for(a=0;a<g.length;a++)isFinite(g[a])||(g[a]=null)}0<d.length&&g[0]<d[d.length-1][0]&&(f=!0),d.push(g)}else console.warn("Ignoring row "+r+" of DataTable because of undefined or null first column.")}f&&(console.warn("DataTable is out of order; order it correctly to speed loading."),d.sort(function(t,e){return t[0]-e[0]})),this.rawData_=d,0<p.length&&this.setAnnotations(p,!0),this.attributes_.reparseSeries()},Y.prototype.cascadeDataDidUpdateEvent_=function(){this.cascadeEvents_("dataDidUpdate",{})},Y.prototype.start_=function(){var t=this.file_;if("function"==typeof t&&(t=t()),N.isArrayLike(t))this.rawData_=this.parseArray_(t),this.cascadeDataDidUpdateEvent_(),this.predraw_();else if("object"==typeof t&&"function"==typeof t.getColumnRange)this.parseDataTable_(t),this.cascadeDataDidUpdateEvent_(),this.predraw_();else if("string"==typeof t){var e=N.detectLineDelimiter(t);if(e)this.loadedEvent_(t);else{var i;i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var n=this;i.onreadystatechange=function(){4==i.readyState&&(200!==i.status&&0!==i.status||n.loadedEvent_(i.responseText))},i.open("GET",t,!0),i.send(null)}}else console.error("Unknown data format: "+typeof t)},Y.prototype.updateOptions=function(t,e){void 0===e&&(e=!1);var i=t.file,n=Y.copyUserAttrs_(t);"rollPeriod"in n&&(this.rollPeriod_=n.rollPeriod),"dateWindow"in n&&(this.dateWindow_=n.dateWindow);var r=N.isPixelChangingOptionList(this.attr_("labels"),n);N.updateDeep(this.user_attrs_,n),this.attributes_.reparseSeries(),i?(this.cascadeEvents_("dataWillUpdate",{}),this.file_=i,e||this.start_()):e||(r?this.predraw_():this.renderGraph_(!1))},Y.copyUserAttrs_=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&"file"!=i&&t.hasOwnProperty(i)&&(e[i]=t[i]);return e},Y.prototype.resize=function(t,e){if(!this.resize_lock){this.resize_lock=!0,null===t!=(null===e)&&(console.warn("Dygraph.resize() should be called with zero parameters or two non-NULL parameters. Pretending it was zero."),t=e=null);var i=this.width_,n=this.height_;this.height_=t?(this.maindiv_.style.width=t+"px",this.maindiv_.style.height=e+"px",this.width_=t,e):(this.width_=this.maindiv_.clientWidth,this.maindiv_.clientHeight),i==this.width_&&n==this.height_||(this.resizeElements_(),this.predraw_()),this.resize_lock=!1}},Y.prototype.adjustRoll=function(t){this.rollPeriod_=t,this.predraw_()},Y.prototype.visibility=function(){for(this.getOption("visibility")||(this.attrs_.visibility=[]);this.getOption("visibility").length<this.numColumns()-1;)this.attrs_.visibility.push(!0);return this.getOption("visibility")},Y.prototype.setVisibility=function(t,e){var i=this.visibility(),n=!1;if(Array.isArray(t)||(null!==t&&"object"==typeof t?n=!0:t=[t]),n)for(var r in t)t.hasOwnProperty(r)&&(r<0||r>=i.length?console.warn("Invalid series number in setVisibility: "+r):i[r]=t[r]);else for(var r=0;r<t.length;r++)"boolean"==typeof t[r]?r>=i.length?console.warn("Invalid series number in setVisibility: "+r):i[r]=t[r]:t[r]<0||t[r]>=i.length?console.warn("Invalid series number in setVisibility: "+t[r]):i[t[r]]=e;this.predraw_()},Y.prototype.size=function(){return{width:this.width_,height:this.height_}},Y.prototype.setAnnotations=function(t,e){this.annotations_=t,this.layout_?(this.layout_.setAnnotations(this.annotations_),e||this.predraw_()):console.warn("Tried to setAnnotations before dygraph was ready. Try setting them in a ready() block. See dygraphs.com/tests/annotation.html")},Y.prototype.annotations=function(){return this.annotations_},Y.prototype.getLabels=function(){var t=this.attr_("labels");return t?t.slice():null},Y.prototype.indexFromSetName=function(t){return this.setIndexByName_[t]},Y.prototype.getRowForX=function(t){for(var e=0,i=this.numRows()-1;e<=i;){var n=i+e>>1,r=this.getValue(n,0);if(r<t)e=n+1;else if(t<r)i=n-1;else{if(e==n)return n;i=n}}return null},Y.prototype.ready=function(t){this.is_initial_draw_?this.readyFns_.push(t):t.call(this,this)},Y.prototype.addAndTrackEvent=function(t,e,i){N.addEvent(t,e,i),this.registeredEvents_.push({elem:t,type:e,fn:i})},Y.prototype.removeTrackedEvents_=function(){if(this.registeredEvents_)for(var t=0;t<this.registeredEvents_.length;t++){var e=this.registeredEvents_[t];N.removeEvent(e.elem,e.type,e.fn)}this.registeredEvents_=[]},Y.PLUGINS=[H.default,M.default,W.default,F.default,D.default,G.default],Y.GVizChart=K.default,Y.DASHED_LINE=N.DASHED_LINE,Y.DOT_DASH_LINE=N.DOT_DASH_LINE,Y.dateAxisLabelFormatter=N.dateAxisLabelFormatter,Y.toRGB_=N.toRGB_,Y.findPos=N.findPos,Y.pageX=N.pageX,Y.pageY=N.pageY,Y.dateString_=N.dateString_,Y.defaultInteractionModel=u.default.defaultModel,Y.nonInteractiveModel=Y.nonInteractiveModel_=u.default.nonInteractiveModel_,Y.Circles=N.Circles,Y.Plugins={Legend:H.default,Axes:M.default,Annotations:D.default,ChartLabels:F.default,Grid:G.default,RangeSelector:W.default},Y.DataHandlers={DefaultHandler:T.default,BarsHandler:I.default,CustomBarsHandler:k.default,DefaultFractionHandler:L.default,ErrorBarsHandler:S.default,FractionsBarsHandler:C.default},Y.startPan=u.default.startPan,Y.startZoom=u.default.startZoom,Y.movePan=u.default.movePan,Y.moveZoom=u.default.moveZoom,Y.endPan=u.default.endPan,Y.endZoom=u.default.endZoom,Y.numericLinearTicks=b.numericLinearTicks,Y.numericTicks=b.numericTicks,Y.dateTicker=b.dateTicker,Y.Granularity=b.Granularity,Y.getDateAxis=b.getDateAxis,Y.floatFormat=N.floatFormat,Z.default=Y,q.exports=Z.default}).call(this,X("_process"))},{"./datahandler/bars":5,"./datahandler/bars-custom":2,"./datahandler/bars-error":3,"./datahandler/bars-fractions":4,"./datahandler/default":8,"./datahandler/default-fractions":7,"./dygraph-canvas":9,"./dygraph-default-attrs":10,"./dygraph-gviz":11,"./dygraph-interaction-model":12,"./dygraph-layout":13,"./dygraph-options":15,"./dygraph-options-reference":14,"./dygraph-tickers":16,"./dygraph-utils":17,"./iframe-tarp":19,"./plugins/annotations":20,"./plugins/axes":21,"./plugins/chart-labels":22,"./plugins/grid":23,"./plugins/legend":24,"./plugins/range-selector":25,_process:1}],19:[function(t,e,i){"use strict";function n(){this.tarps=[]}Object.defineProperty(i,"__esModule",{value:!0});var r=t("./dygraph-utils"),u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r);n.prototype.cover=function(){for(var t=document.getElementsByTagName("iframe"),e=0;e<t.length;e++){var i=t[e],n=u.findPos(i),r=n.x,a=n.y,s=i.offsetWidth,o=i.offsetHeight,l=document.createElement("div");l.style.position="absolute",l.style.left=r+"px",l.style.top=a+"px",l.style.width=s+"px",l.style.height=o+"px",l.style.zIndex=999,document.body.appendChild(l),this.tarps.push(l)}},n.prototype.uncover=function(){for(var t=0;t<this.tarps.length;t++)this.tarps[t].parentNode.removeChild(this.tarps[t]);this.tarps=[]},i.default=n,e.exports=i.default},{"./dygraph-utils":17}],20:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){this.annotations_=[]};n.prototype.toString=function(){return"Annotations Plugin"},n.prototype.activate=function(t){return{clearChart:this.clearChart,didDrawChart:this.didDrawChart}},n.prototype.detachLabels=function(){for(var t=0;t<this.annotations_.length;t++){var e=this.annotations_[t];e.parentNode&&e.parentNode.removeChild(e),this.annotations_[t]=null}this.annotations_=[]},n.prototype.clearChart=function(t){this.detachLabels()},n.prototype.didDrawChart=function(t){var a=t.dygraph,e=a.layout_.annotated_points;if(e&&0!==e.length)for(var i=t.canvas.parentNode,n=function(i,n,r){return function(t){var e=r.annotation;e.hasOwnProperty(i)?e[i](e,r,a,t):a.getOption(n)&&a.getOption(n)(e,r,a,t)}},r=t.dygraph.getArea(),s={},o=0;o<e.length;o++){var l=e[o];if(!(l.canvasx<r.x||l.canvasx>r.x+r.w||l.canvasy<r.y||l.canvasy>r.y+r.h)){var u=l.annotation,h=6;u.hasOwnProperty("tickHeight")&&(h=u.tickHeight);var c=document.createElement("div");c.style.fontSize=a.getOption("axisLabelFontSize")+"px";var d="dygraph-annotation";u.hasOwnProperty("icon")||(d+=" dygraphDefaultAnnotation dygraph-default-annotation"),u.hasOwnProperty("cssClass")&&(d+=" "+u.cssClass),c.className=d;var f=u.hasOwnProperty("width")?u.width:16,p=u.hasOwnProperty("height")?u.height:16;if(u.hasOwnProperty("icon")){var g=document.createElement("img");g.src=u.icon,g.width=f,g.height=p,c.appendChild(g)}else l.annotation.hasOwnProperty("shortText")&&c.appendChild(document.createTextNode(l.annotation.shortText));var m=l.canvasx-f/2;c.style.left=m+"px";var v=0;if(u.attachAtBottom){var y=r.y+r.h-p-h;s[m]?y-=s[m]:s[m]=0,s[m]+=h+p,v=y}else v=l.canvasy-p-h;c.style.top=v+"px",c.style.width=f+"px",c.style.height=p+"px",c.title=l.annotation.text,c.style.color=a.colorsMap_[l.name],c.style.borderColor=a.colorsMap_[l.name],u.div=c,a.addAndTrackEvent(c,"click",n("clickHandler","annotationClickHandler",l)),a.addAndTrackEvent(c,"mouseover",n("mouseOverHandler","annotationMouseOverHandler",l)),a.addAndTrackEvent(c,"mouseout",n("mouseOutHandler","annotationMouseOutHandler",l)),a.addAndTrackEvent(c,"dblclick",n("dblClickHandler","annotationDblClickHandler",l)),i.appendChild(c),this.annotations_.push(c);var b=t.drawingContext;if(b.save(),b.strokeStyle=u.hasOwnProperty("tickColor")?u.tickColor:a.colorsMap_[l.name],b.lineWidth=u.hasOwnProperty("tickWidth")?u.tickWidth:a.getOption("strokeWidth"),b.beginPath(),u.attachAtBottom){var y=v+p;b.moveTo(l.canvasx,y),b.lineTo(l.canvasx,y+h)}else b.moveTo(l.canvasx,l.canvasy),b.lineTo(l.canvasx,l.canvasy-2-h);b.closePath(),b.stroke(),b.restore()}}},n.prototype.destroy=function(){this.detachLabels()},i.default=n,e.exports=i.default},{}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../dygraph-utils"),A=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),r=function(){this.xlabels_=[],this.ylabels_=[]};r.prototype.toString=function(){return"Axes Plugin"},r.prototype.activate=function(t){return{layout:this.layout,clearChart:this.clearChart,willDrawChart:this.willDrawChart}},r.prototype.layout=function(t){var e,i=t.dygraph;if(i.getOptionForAxis("drawAxis","y")){var n=i.getOptionForAxis("axisLabelWidth","y")+2*i.getOptionForAxis("axisTickSize","y");t.reserveSpaceLeft(n)}if(i.getOptionForAxis("drawAxis","x")&&(e=i.getOption("xAxisHeight")?i.getOption("xAxisHeight"):i.getOptionForAxis("axisLabelFontSize","x")+2*i.getOptionForAxis("axisTickSize","x"),t.reserveSpaceBottom(e)),2==i.numAxes()){if(i.getOptionForAxis("drawAxis","y2")){var n=i.getOptionForAxis("axisLabelWidth","y2")+2*i.getOptionForAxis("axisTickSize","y2");t.reserveSpaceRight(n)}}else 2<i.numAxes()&&i.error("Only two y-axes are supported at this time. (Trying to use "+i.numAxes()+")")},r.prototype.detachLabels=function(){function t(t){for(var e=0;e<t.length;e++){var i=t[e];i.parentNode&&i.parentNode.removeChild(i)}}t(this.xlabels_),t(this.ylabels_),this.xlabels_=[],this.ylabels_=[]},r.prototype.clearChart=function(t){this.detachLabels()},r.prototype.willDrawChart=function(t){function e(t){return Math.round(t)+.5}function i(t){return Math.round(t)-.5}var a=this,n=t.dygraph;if(n.getOptionForAxis("drawAxis","x")||n.getOptionForAxis("drawAxis","y")||n.getOptionForAxis("drawAxis","y2")){var s,o,l,r=t.drawingContext,u=t.canvas.parentNode,h=n.width_,c=n.height_,d=function(t){return{position:"absolute",fontSize:n.getOptionForAxis("axisLabelFontSize",t)+"px",width:n.getOptionForAxis("axisLabelWidth",t)+"px"}},f={x:d("x"),y:d("y"),y2:d("y2")},p=function(t,e,i){var n=document.createElement("div"),r=f["y2"==i?"y2":e];A.update(n.style,r);var a=document.createElement("div");return a.className="dygraph-axis-label dygraph-axis-label-"+e+(i?" dygraph-axis-label-"+i:""),a.innerHTML=t,n.appendChild(a),n};r.save();var g=n.layout_,m=t.dygraph.plotter_.area,v=function(e){return function(t){return n.getOptionForAxis(t,e)}};if(n.getOptionForAxis("drawAxis","y")){if(g.yticks&&0<g.yticks.length){var y=n.numAxes(),b=[v("y"),v("y2")];g.yticks.forEach(function(t){if(void 0!==t.label){o=m.x;var e="y1",i=b[0];1==t.axis&&(o=m.x+m.w,e="y2",i=b[1]);var n=i("axisLabelFontSize");l=m.y+t.pos*m.h,s=p(t.label,"y",2==y?e:null);var r=l-n/2;r<0&&(r=0),c<r+n+3?s.style.bottom="0":s.style.top=r+"px",0===t.axis?(s.style.left=m.x-i("axisLabelWidth")-i("axisTickSize")+"px",s.style.textAlign="right"):1==t.axis&&(s.style.left=m.x+m.w+i("axisTickSize")+"px",s.style.textAlign="left"),s.style.width=i("axisLabelWidth")+"px",u.appendChild(s),a.ylabels_.push(s)}});var _=this.ylabels_[0],T=n.getOptionForAxis("axisLabelFontSize","y");parseInt(_.style.top,10)+T>c-T&&(_.style.top=parseInt(_.style.top,10)-T/2+"px")}var E;if(n.getOption("drawAxesAtZero")){var S=n.toPercentXCoord(0);(1<S||S<0||isNaN(S))&&(S=0),E=e(m.x+S*m.w)}else E=e(m.x);r.strokeStyle=n.getOptionForAxis("axisLineColor","y"),r.lineWidth=n.getOptionForAxis("axisLineWidth","y"),r.beginPath(),r.moveTo(E,i(m.y)),r.lineTo(E,i(m.y+m.h)),r.closePath(),r.stroke(),2==n.numAxes()&&(r.strokeStyle=n.getOptionForAxis("axisLineColor","y2"),r.lineWidth=n.getOptionForAxis("axisLineWidth","y2"),r.beginPath(),r.moveTo(i(m.x+m.w),i(m.y)),r.lineTo(i(m.x+m.w),i(m.y+m.h)),r.closePath(),r.stroke())}if(n.getOptionForAxis("drawAxis","x")){if(g.xticks){var w=v("x");g.xticks.forEach(function(t){if(void 0!==t.label){o=m.x+t.pos*m.w,l=m.y+m.h,(s=p(t.label,"x")).style.textAlign="center",s.style.top=l+w("axisTickSize")+"px";var e=o-w("axisLabelWidth")/2;e+w("axisLabelWidth")>h&&(e=h-w("axisLabelWidth"),s.style.textAlign="right"),e<0&&(e=0,s.style.textAlign="left"),s.style.left=e+"px",s.style.width=w("axisLabelWidth")+"px",u.appendChild(s),a.xlabels_.push(s)}})}var k;if(r.strokeStyle=n.getOptionForAxis("axisLineColor","x"),r.lineWidth=n.getOptionForAxis("axisLineWidth","x"),r.beginPath(),n.getOption("drawAxesAtZero")){var S=n.toPercentYCoord(0,0);(1<S||S<0)&&(S=1),k=i(m.y+S*m.h)}else k=i(m.y+m.h);r.moveTo(e(m.x),k),r.lineTo(e(m.x+m.w),k),r.closePath(),r.stroke()}r.restore()}},i.default=r,e.exports=i.default},{"../dygraph-utils":17}],22:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){this.title_div_=null,this.xlabel_div_=null,this.ylabel_div_=null,this.y2label_div_=null};n.prototype.toString=function(){return"ChartLabels Plugin"},n.prototype.activate=function(t){return{layout:this.layout,didDrawChart:this.didDrawChart}};var l=function(t){var e=document.createElement("div");return e.style.position="absolute",e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.width=t.w+"px",e.style.height=t.h+"px",e};n.prototype.detachLabels_=function(){for(var t=[this.title_div_,this.xlabel_div_,this.ylabel_div_,this.y2label_div_],e=0;e<t.length;e++){var i=t[e];i&&i.parentNode&&i.parentNode.removeChild(i)}this.title_div_=null,this.xlabel_div_=null,this.ylabel_div_=null,this.y2label_div_=null};var u=function(t,e,i,n,r){var a=document.createElement("div");a.style.position="absolute",a.style.left=1==i?"0px":e.x+"px",a.style.top=e.y+"px",a.style.width=e.w+"px",a.style.height=e.h+"px",a.style.fontSize=t.getOption("yLabelWidth")-2+"px";var s=document.createElement("div");s.style.position="absolute",s.style.width=e.h+"px",s.style.height=e.w+"px",s.style.top=e.h/2-e.w/2+"px",s.style.left=e.w/2-e.h/2+"px",s.className="dygraph-label-rotate-"+(1==i?"right":"left");var o=document.createElement("div");return o.className=n,o.innerHTML=r,s.appendChild(o),a.appendChild(s),a};n.prototype.layout=function(t){this.detachLabels_();var e=t.dygraph,i=t.chart_div;if(e.getOption("title")){var n=t.reserveSpaceTop(e.getOption("titleHeight"));this.title_div_=l(n),this.title_div_.style.fontSize=e.getOption("titleHeight")-8+"px";var r=document.createElement("div");r.className="dygraph-label dygraph-title",r.innerHTML=e.getOption("title"),this.title_div_.appendChild(r),i.appendChild(this.title_div_)}if(e.getOption("xlabel")){var a=t.reserveSpaceBottom(e.getOption("xLabelHeight"));this.xlabel_div_=l(a),this.xlabel_div_.style.fontSize=e.getOption("xLabelHeight")-2+"px";var r=document.createElement("div");r.className="dygraph-label dygraph-xlabel",r.innerHTML=e.getOption("xlabel"),this.xlabel_div_.appendChild(r),i.appendChild(this.xlabel_div_)}if(e.getOption("ylabel")){var s=t.reserveSpaceLeft(0);this.ylabel_div_=u(e,s,1,"dygraph-label dygraph-ylabel",e.getOption("ylabel")),i.appendChild(this.ylabel_div_)}if(e.getOption("y2label")&&2==e.numAxes()){var o=t.reserveSpaceRight(0);this.y2label_div_=u(e,o,2,"dygraph-label dygraph-y2label",e.getOption("y2label")),i.appendChild(this.y2label_div_)}},n.prototype.didDrawChart=function(t){var e=t.dygraph;this.title_div_&&(this.title_div_.children[0].innerHTML=e.getOption("title")),this.xlabel_div_&&(this.xlabel_div_.children[0].innerHTML=e.getOption("xlabel")),this.ylabel_div_&&(this.ylabel_div_.children[0].children[0].innerHTML=e.getOption("ylabel")),this.y2label_div_&&(this.y2label_div_.children[0].children[0].innerHTML=e.getOption("y2label"))},n.prototype.clearChart=function(){},n.prototype.destroy=function(){this.detachLabels_()},i.default=n,e.exports=i.default},{}],23:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){};n.prototype.toString=function(){return"Gridline Plugin"},n.prototype.activate=function(t){return{willDrawChart:this.willDrawChart}},n.prototype.willDrawChart=function(t){function i(t){return Math.round(t)+.5}function n(t){return Math.round(t)-.5}var r,a,e,s=t.dygraph,o=t.drawingContext,l=s.layout_,u=t.dygraph.plotter_.area;if(s.getOptionForAxis("drawGrid","y")){for(var h=["y","y2"],c=[],d=[],f=[],p=[],g=[],m=0;m<h.length;m++)f[m]=s.getOptionForAxis("drawGrid",h[m]),f[m]&&(c[m]=s.getOptionForAxis("gridLineColor",h[m]),d[m]=s.getOptionForAxis("gridLineWidth",h[m]),g[m]=s.getOptionForAxis("gridLinePattern",h[m]),p[m]=g[m]&&2<=g[m].length);e=l.yticks,o.save(),e.forEach(function(t){if(t.has_tick){var e=t.axis;f[e]&&(o.save(),p[e]&&o.setLineDash&&o.setLineDash(g[e]),o.strokeStyle=c[e],o.lineWidth=d[e],r=i(u.x),a=n(u.y+t.pos*u.h),o.beginPath(),o.moveTo(r,a),o.lineTo(r+u.w,a),o.stroke(),o.restore())}}),o.restore()}if(s.getOptionForAxis("drawGrid","x")){e=l.xticks,o.save();var g=s.getOptionForAxis("gridLinePattern","x"),p=g&&2<=g.length;p&&o.setLineDash&&o.setLineDash(g),o.strokeStyle=s.getOptionForAxis("gridLineColor","x"),o.lineWidth=s.getOptionForAxis("gridLineWidth","x"),e.forEach(function(t){t.has_tick&&(r=i(u.x+t.pos*u.w),a=n(u.y+u.h),o.beginPath(),o.moveTo(r,a),o.lineTo(r,u.y),o.closePath(),o.stroke())}),p&&o.setLineDash&&o.setLineDash([]),o.restore()}},n.prototype.destroy=function(){},i.default=n,e.exports=i.default},{}],24:[function(t,e,i){"use strict";function S(t,e,i){if(!t||t.length<=1)return'<div class="dygraph-legend-line" style="border-bottom-color: '+e+';"></div>';var n,r,a,s,o,l=0,u=0,h=[];for(n=0;n<=t.length;n++)l+=t[n%t.length];if(1<(o=Math.floor(i/(l-t[0])))){for(n=0;n<t.length;n++)h[n]=t[n]/i;u=h.length}else{for(o=1,n=0;n<t.length;n++)h[n]=t[n]/l;u=h.length+1}var c="";for(r=0;r<o;r++)for(n=0;n<u;n+=2)a=h[n%h.length],s=n<t.length?h[(n+1)%h.length]:0,c+='<div class="dygraph-legend-dash" style="margin-right: '+s+"em; padding-left: "+a+'em;"></div>';return c}Object.defineProperty(i,"__esModule",{value:!0});var n=t("../dygraph-utils"),w=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),k=function(){this.legend_div_=null,this.is_generated_div_=!1};k.prototype.toString=function(){return"Legend Plugin"},k.prototype.activate=function(t){var e,i=t.getOption("labelsDiv");return i&&null!==i?e="string"==typeof i||i instanceof String?document.getElementById(i):i:((e=document.createElement("div")).className="dygraph-legend",t.graphDiv.appendChild(e),this.is_generated_div_=!0),this.legend_div_=e,this.one_em_width_=10,{select:this.select,deselect:this.deselect,predraw:this.predraw,didDrawChart:this.didDrawChart}},k.prototype.select=function(t){var e=t.selectedX,i=t.selectedPoints,n=t.selectedRow,r=t.dygraph.getOption("legend");if("never"!==r){if("follow"===r){var a=t.dygraph.plotter_.area,s=this.legend_div_.offsetWidth,o=t.dygraph.getOptionForAxis("axisLabelWidth","y"),l=i[0].x*a.w+50,u=i[0].y*a.h-50;l+s+1>a.w&&(l=l-100-s-(o-a.x)),t.dygraph.graphDiv.appendChild(this.legend_div_),this.legend_div_.style.left=o+l+"px",this.legend_div_.style.top=u+"px"}var h=k.generateLegendHTML(t.dygraph,e,i,this.one_em_width_,n);this.legend_div_.innerHTML=h,this.legend_div_.style.display=""}else this.legend_div_.style.display="none"},k.prototype.deselect=function(t){"always"!==t.dygraph.getOption("legend")&&(this.legend_div_.style.display="none");var e=function(t){var e=document.createElement("span");e.setAttribute("style","margin: 0; padding: 0 0 0 1em; border: 0;"),t.appendChild(e);var i=e.offsetWidth;return t.removeChild(e),i}(this.legend_div_);this.one_em_width_=e;var i=k.generateLegendHTML(t.dygraph,void 0,void 0,e,null);this.legend_div_.innerHTML=i},k.prototype.didDrawChart=function(t){this.deselect(t)},k.prototype.predraw=function(t){if(this.is_generated_div_){t.dygraph.graphDiv.appendChild(this.legend_div_);var e=t.dygraph.getArea(),i=this.legend_div_.offsetWidth;this.legend_div_.style.left=e.x+e.w-i-1+"px",this.legend_div_.style.top=e.y+"px"}},k.prototype.destroy=function(){this.legend_div_=null},k.generateLegendHTML=function(t,e,i,n,r){var a,s={dygraph:t,x:e,series:[]},o={},l=t.getLabels();if(l)for(var u=1;u<l.length;u++){var h=t.getPropertiesForSeries(l[u]),c=t.getOption("strokePattern",l[u]),d={dashHTML:S(c,h.color,n),label:l[u],labelHTML:(a=l[u],a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),isVisible:h.visible,color:h.color};s.series.push(d),o[l[u]]=d}if(void 0!==e){var f=t.optionsViewForAxis_("x"),p=f("valueFormatter");s.xHTML=p.call(t,e,f,l[0],t,r,0);for(var g=[],m=t.numAxes(),u=0;u<m;u++)g[u]=t.optionsViewForAxis_("y"+(u?1+u:""));var v=t.getOption("labelsShowZeroValues"),y=t.getHighlightSeries();for(u=0;u<i.length;u++){var b=i[u],d=o[b.name];if(d.y=b.yval,0===b.yval&&!v||isNaN(b.canvasy))d.isVisible=!1;else{var h=t.getPropertiesForSeries(b.name),_=g[h.axis-1],T=_("valueFormatter"),E=T.call(t,b.yval,_,b.name,t,r,l.indexOf(b.name));w.update(d,{yHTML:E}),b.name==y&&(d.isHighlighted=!0)}}}return(t.getOption("legendFormatter")||k.defaultFormatter).call(t,s)},k.defaultFormatter=function(t){var e=t.dygraph;if(!0!==e.getOption("showLabelsOnHighlight"))return"";var i,n=e.getOption("labelsSeparateLines");if(void 0===t.x){if("always"!=e.getOption("legend"))return"";i="";for(var r=0;r<t.series.length;r++){var a=t.series[r];a.isVisible&&(""!==i&&(i+=n?"<br/>":" "),i+="<span style='font-weight: bold; color: "+a.color+";'>"+a.dashHTML+" "+a.labelHTML+"</span>")}return i}i=t.xHTML+":";for(var r=0;r<t.series.length;r++){var a=t.series[r];a.isVisible&&(n&&(i+="<br>"),i+="<span"+(a.isHighlighted?' class="highlight"':"")+"> <b><span style='color: "+a.color+";'>"+a.labelHTML+"</span></b>:&#160;"+a.yHTML+"</span>")}return i},i.default=k,e.exports=i.default},{"../dygraph-utils":17}],25:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var r=t("../dygraph-utils"),w=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),a=t("../dygraph-interaction-model"),S=n(a),s=t("../iframe-tarp"),k=n(s),o=function(){this.hasTouchInterface_="undefined"!=typeof TouchEvent,this.isMobileDevice_=/mobile|android/gi.test(navigator.appVersion),this.interfaceCreated_=!1};o.prototype.toString=function(){return"RangeSelector Plugin"},o.prototype.activate=function(t){return this.dygraph_=t,this.getOption_("showRangeSelector")&&this.createInterface_(),{layout:this.reserveSpace_,predraw:this.renderStaticLayer_,didDrawChart:this.renderInteractiveLayer_}},o.prototype.destroy=function(){this.bgcanvas_=null,this.fgcanvas_=null,this.leftZoomHandle_=null,this.rightZoomHandle_=null},o.prototype.getOption_=function(t,e){return this.dygraph_.getOption(t,e)},o.prototype.setDefaultOption_=function(t,e){this.dygraph_.attrs_[t]=e},o.prototype.createInterface_=function(){this.createCanvases_(),this.createZoomHandles_(),this.initInteraction_(),this.getOption_("animatedZooms")&&(console.warn("Animated zooms and range selector are not compatible; disabling animatedZooms."),this.dygraph_.updateOptions({animatedZooms:!1},!0)),this.interfaceCreated_=!0,this.addToGraph_()},o.prototype.addToGraph_=function(){var t=this.graphDiv_=this.dygraph_.graphDiv;t.appendChild(this.bgcanvas_),t.appendChild(this.fgcanvas_),t.appendChild(this.leftZoomHandle_),t.appendChild(this.rightZoomHandle_)},o.prototype.removeFromGraph_=function(){var t=this.graphDiv_;t.removeChild(this.bgcanvas_),t.removeChild(this.fgcanvas_),t.removeChild(this.leftZoomHandle_),t.removeChild(this.rightZoomHandle_),this.graphDiv_=null},o.prototype.reserveSpace_=function(t){this.getOption_("showRangeSelector")&&t.reserveSpaceBottom(this.getOption_("rangeSelectorHeight")+4)},o.prototype.renderStaticLayer_=function(){this.updateVisibility_()&&(this.resize_(),this.drawStaticLayer_())},o.prototype.renderInteractiveLayer_=function(){this.updateVisibility_()&&!this.isChangingRange_&&(this.placeZoomHandles_(),this.drawInteractiveLayer_())},o.prototype.updateVisibility_=function(){var t=this.getOption_("showRangeSelector");if(t)this.interfaceCreated_?this.graphDiv_&&this.graphDiv_.parentNode||this.addToGraph_():this.createInterface_();else if(this.graphDiv_){this.removeFromGraph_();var e=this.dygraph_;setTimeout(function(){e.width_=0,e.resize()},1)}return t},o.prototype.resize_=function(){function t(t,e,i,n){var r=n||w.getContextPixelRatio(e);t.style.top=i.y+"px",t.style.left=i.x+"px",t.width=i.w*r,t.height=i.h*r,t.style.width=i.w+"px",t.style.height=i.h+"px",1!=r&&e.scale(r,r)}var e=this.dygraph_.layout_.getPlotArea(),i=0;this.dygraph_.getOptionForAxis("drawAxis","x")&&(i=this.getOption_("xAxisHeight")||this.getOption_("axisLabelFontSize")+2*this.getOption_("axisTickSize")),this.canvasRect_={x:e.x,y:e.y+e.h+i+4,w:e.w,h:this.getOption_("rangeSelectorHeight")};var n=this.dygraph_.getNumericOption("pixelRatio");t(this.bgcanvas_,this.bgcanvas_ctx_,this.canvasRect_,n),t(this.fgcanvas_,this.fgcanvas_ctx_,this.canvasRect_,n)},o.prototype.createCanvases_=function(){this.bgcanvas_=w.createCanvas(),this.bgcanvas_.className="dygraph-rangesel-bgcanvas",this.bgcanvas_.style.position="absolute",this.bgcanvas_.style.zIndex=9,this.bgcanvas_ctx_=w.getContext(this.bgcanvas_),this.fgcanvas_=w.createCanvas(),this.fgcanvas_.className="dygraph-rangesel-fgcanvas",this.fgcanvas_.style.position="absolute",this.fgcanvas_.style.zIndex=9,this.fgcanvas_.style.cursor="default",this.fgcanvas_ctx_=w.getContext(this.fgcanvas_)},o.prototype.createZoomHandles_=function(){var t=new Image;t.className="dygraph-rangesel-zoomhandle",t.style.position="absolute",t.style.zIndex=10,t.style.visibility="hidden",t.style.cursor="col-resize",t.width=9,t.height=16,t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAQCAYAAADESFVDAAAAAXNSR0IArs4c6QAAAAZiS0dEANAAzwDP4Z7KegAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAAd0SU1FB9sHGw0cMqdt1UwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAaElEQVQoz+3SsRFAQBCF4Z9WJM8KCDVwownl6YXsTmCUsyKGkZzcl7zkz3YLkypgAnreFmDEpHkIwVOMfpdi9CEEN2nGpFdwD03yEqDtOgCaun7sqSTDH32I1pQA2Pb9sZecAxc5r3IAb21d6878xsAAAAAASUVORK5CYII=",this.isMobileDevice_&&(t.width*=2,t.height*=2),this.leftZoomHandle_=t,this.rightZoomHandle_=t.cloneNode(!1)},o.prototype.initInteraction_=function(){var i,e,n,r,a,s,o,l,u,h,t,c,d,f,p=this,g=document,m=0,v=null,y=!1,b=!1,_=!this.isMobileDevice_,T=new k.default;i=function(t){var e=p.dygraph_.xAxisExtremes(),i=(e[1]-e[0])/p.canvasRect_.w;return[e[0]+(t.leftHandlePos-p.canvasRect_.x)*i,e[0]+(t.rightHandlePos-p.canvasRect_.x)*i]},e=function(t){return w.cancelEvent(t),y=!0,m=t.clientX,v=t.target?t.target:t.srcElement,"mousedown"!==t.type&&"dragstart"!==t.type||(w.addEvent(g,"mousemove",n),w.addEvent(g,"mouseup",r)),p.fgcanvas_.style.cursor="col-resize",T.cover(),!0},n=function(t){if(!y)return!1;w.cancelEvent(t);var e=t.clientX-m;if(Math.abs(e)<4)return!0;m=t.clientX;var i,n=p.getZoomHandleStatus_();i=v==p.leftZoomHandle_?(i=n.leftHandlePos+e,i=Math.min(i,n.rightHandlePos-v.width-3),Math.max(i,p.canvasRect_.x)):(i=n.rightHandlePos+e,i=Math.min(i,p.canvasRect_.x+p.canvasRect_.w),Math.max(i,n.leftHandlePos+v.width+3));var r=v.width/2;return v.style.left=i-r+"px",p.drawInteractiveLayer_(),_&&a(),!0},r=function(t){return!!y&&(y=!1,T.uncover(),w.removeEvent(g,"mousemove",n),w.removeEvent(g,"mouseup",r),p.fgcanvas_.style.cursor="default",_||a(),!0)},a=function(){try{var t=p.getZoomHandleStatus_();if(p.isChangingRange_=!0,t.isZoomed){var e=i(t);p.dygraph_.doZoomXDates_(e[0],e[1])}else p.dygraph_.resetZoom()}finally{p.isChangingRange_=!1}},s=function(t){var e=p.leftZoomHandle_.getBoundingClientRect(),i=e.left+e.width/2,n=(e=p.rightZoomHandle_.getBoundingClientRect()).left+e.width/2;return t.clientX>i&&t.clientX<n},o=function(t){return!(b||!s(t)||!p.getZoomHandleStatus_().isZoomed||(w.cancelEvent(t),b=!0,m=t.clientX,"mousedown"===t.type&&(w.addEvent(g,"mousemove",l),w.addEvent(g,"mouseup",u)),0))},l=function(t){if(!b)return!1;w.cancelEvent(t);var e=t.clientX-m;if(Math.abs(e)<4)return!0;m=t.clientX;var i=p.getZoomHandleStatus_(),n=i.leftHandlePos,r=i.rightHandlePos,a=r-n;n+e<=p.canvasRect_.x?(n=p.canvasRect_.x,r=n+a):r+e>=p.canvasRect_.x+p.canvasRect_.w?(r=p.canvasRect_.x+p.canvasRect_.w,n=r-a):(n+=e,r+=e);var s=p.leftZoomHandle_.width/2;return p.leftZoomHandle_.style.left=n-s+"px",p.rightZoomHandle_.style.left=r-s+"px",p.drawInteractiveLayer_(),_&&h(),!0},u=function(t){return!!b&&(b=!1,w.removeEvent(g,"mousemove",l),w.removeEvent(g,"mouseup",u),_||h(),!0)},h=function(){try{p.isChangingRange_=!0,p.dygraph_.dateWindow_=i(p.getZoomHandleStatus_()),p.dygraph_.drawGraph_(!1)}finally{p.isChangingRange_=!1}},t=function(t){if(!y&&!b){var e=s(t)?"move":"default";e!=p.fgcanvas_.style.cursor&&(p.fgcanvas_.style.cursor=e)}},c=function(t){"touchstart"==t.type&&1==t.targetTouches.length?e(t.targetTouches[0])&&w.cancelEvent(t):"touchmove"==t.type&&1==t.targetTouches.length?n(t.targetTouches[0])&&w.cancelEvent(t):r(t)},d=function(t){"touchstart"==t.type&&1==t.targetTouches.length?o(t.targetTouches[0])&&w.cancelEvent(t):"touchmove"==t.type&&1==t.targetTouches.length?l(t.targetTouches[0])&&w.cancelEvent(t):u(t)},f=function(t,e){for(var i=["touchstart","touchend","touchmove","touchcancel"],n=0;n<i.length;n++)p.dygraph_.addAndTrackEvent(t,i[n],e)},this.setDefaultOption_("interactionModel",S.default.dragIsPanInteractionModel),this.setDefaultOption_("panEdgeFraction",1e-4);var E=window.opera?"mousedown":"dragstart";this.dygraph_.addAndTrackEvent(this.leftZoomHandle_,E,e),this.dygraph_.addAndTrackEvent(this.rightZoomHandle_,E,e),this.dygraph_.addAndTrackEvent(this.fgcanvas_,"mousedown",o),this.dygraph_.addAndTrackEvent(this.fgcanvas_,"mousemove",t),this.hasTouchInterface_&&(f(this.leftZoomHandle_,c),f(this.rightZoomHandle_,c),f(this.fgcanvas_,d))},o.prototype.drawStaticLayer_=function(){var t=this.bgcanvas_ctx_;t.clearRect(0,0,this.canvasRect_.w,this.canvasRect_.h);try{this.drawMiniPlot_()}catch(t){console.warn(t)}this.bgcanvas_ctx_.lineWidth=this.getOption_("rangeSelectorBackgroundLineWidth"),t.strokeStyle=this.getOption_("rangeSelectorBackgroundStrokeColor"),t.beginPath(),t.moveTo(.5,.5),t.lineTo(.5,this.canvasRect_.h-.5),t.lineTo(this.canvasRect_.w-.5,this.canvasRect_.h-.5),t.lineTo(this.canvasRect_.w-.5,.5),t.stroke()},o.prototype.drawMiniPlot_=function(){var t=this.getOption_("rangeSelectorPlotFillColor"),e=this.getOption_("rangeSelectorPlotFillGradientColor"),i=this.getOption_("rangeSelectorPlotStrokeColor");if(t||i){var n=this.getOption_("stepPlot"),r=this.computeCombinedSeriesAndLimits_(),a=r.yMax-r.yMin,s=this.bgcanvas_ctx_,o=this.dygraph_.xAxisExtremes(),l=Math.max(o[1]-o[0],1e-30),u=(this.canvasRect_.w-.5)/l,h=(this.canvasRect_.h-.5)/a,c=this.canvasRect_.w-.5,d=this.canvasRect_.h-.5,f=null,p=null;s.beginPath(),s.moveTo(.5,d);for(var g=0;g<r.data.length;g++){var m=r.data[g],v=null!==m[0]?(m[0]-o[0])*u:NaN,y=null!==m[1]?d-(m[1]-r.yMin)*h:NaN;(n||null===f||Math.round(v)!=Math.round(f))&&(isFinite(v)&&isFinite(y)?(null===f?s.lineTo(v,d):n&&s.lineTo(v,p),s.lineTo(v,y),f=v,p=y):(null!==f&&(n?(s.lineTo(v,p),s.lineTo(v,d)):s.lineTo(f,d)),f=p=null))}if(s.lineTo(c,d),s.closePath(),t){var b=this.bgcanvas_ctx_.createLinearGradient(0,0,0,d);e&&b.addColorStop(0,e),b.addColorStop(1,t),this.bgcanvas_ctx_.fillStyle=b,s.fill()}i&&(this.bgcanvas_ctx_.strokeStyle=i,this.bgcanvas_ctx_.lineWidth=this.getOption_("rangeSelectorPlotLineWidth"),s.stroke())}},o.prototype.computeCombinedSeriesAndLimits_=function(){var t,e=this.dygraph_,i=this.getOption_("logscale"),n=e.numColumns(),r=e.getLabels(),a=new Array(n),s=!1,o=e.visibility(),l=[];for(t=1;t<n;t++){var u=this.getOption_("showInRangeSelector",r[t]);l.push(u),null!==u&&(s=!0)}if(s)for(t=1;t<n;t++)a[t]=l[t-1];else for(t=1;t<n;t++)a[t]=o[t-1];var h=[],c=e.dataHandler_,d=e.attributes_;for(t=1;t<e.numColumns();t++)if(a[t]){var f=c.extractSeries(e.rawData_,t,d);1<e.rollPeriod()&&(f=c.rollingAverage(f,e.rollPeriod(),d)),h.push(f)}var p=[];for(t=0;t<h[0].length;t++){for(var g=0,m=0,v=0;v<h.length;v++){var y=h[v][t][1];null===y||isNaN(y)||(m++,g+=y)}p.push([h[0][t][0],g/m])}var b=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(t=0;t<p.length;t++){var T=p[t][1];null!==T&&isFinite(T)&&(!i||0<T)&&(b=Math.min(b,T),_=Math.max(_,T))}if(i)for(_=w.log10(_),_+=.25*_,b=w.log10(b),t=0;t<p.length;t++)p[t][1]=w.log10(p[t][1]);else{var E,S=_-b;E=S<=Number.MIN_VALUE?.25*_:.25*S,_+=E,b-=E}return{data:p,yMin:b,yMax:_}},o.prototype.placeZoomHandles_=function(){var t=this.dygraph_.xAxisExtremes(),e=this.dygraph_.xAxisRange(),i=t[1]-t[0],n=Math.max(0,(e[0]-t[0])/i),r=Math.max(0,(t[1]-e[1])/i),a=this.canvasRect_.x+this.canvasRect_.w*n,s=this.canvasRect_.x+this.canvasRect_.w*(1-r),o=Math.max(this.canvasRect_.y,this.canvasRect_.y+(this.canvasRect_.h-this.leftZoomHandle_.height)/2),l=this.leftZoomHandle_.width/2;this.leftZoomHandle_.style.left=a-l+"px",this.leftZoomHandle_.style.top=o+"px",this.rightZoomHandle_.style.left=s-l+"px",this.rightZoomHandle_.style.top=this.leftZoomHandle_.style.top,this.leftZoomHandle_.style.visibility="visible",this.rightZoomHandle_.style.visibility="visible"},o.prototype.drawInteractiveLayer_=function(){var t=this.fgcanvas_ctx_;t.clearRect(0,0,this.canvasRect_.w,this.canvasRect_.h);var e=this.canvasRect_.w-1,i=this.canvasRect_.h-1,n=this.getZoomHandleStatus_();if(t.strokeStyle=this.getOption_("rangeSelectorForegroundStrokeColor"),t.lineWidth=this.getOption_("rangeSelectorForegroundLineWidth"),n.isZoomed){var r=Math.max(1,n.leftHandlePos-this.canvasRect_.x),a=Math.min(e,n.rightHandlePos-this.canvasRect_.x);t.fillStyle="rgba(240, 240, 240, "+this.getOption_("rangeSelectorAlpha").toString()+")",t.fillRect(0,0,r,this.canvasRect_.h),t.fillRect(a,0,this.canvasRect_.w-a,this.canvasRect_.h),t.beginPath(),t.moveTo(1,1),t.lineTo(r,1),t.lineTo(r,i),t.lineTo(a,i),t.lineTo(a,1),t.lineTo(e,1),t.stroke()}else t.beginPath(),t.moveTo(1,1),t.lineTo(1,i),t.lineTo(e,i),t.lineTo(e,1),t.stroke()},o.prototype.getZoomHandleStatus_=function(){var t=this.leftZoomHandle_.width/2,e=parseFloat(this.leftZoomHandle_.style.left)+t,i=parseFloat(this.rightZoomHandle_.style.left)+t;return{leftHandlePos:e,rightHandlePos:i,isZoomed:e-1>this.canvasRect_.x||i+1<this.canvasRect_.x+this.canvasRect_.w}},i.default=o,e.exports=i.default},{"../dygraph-interaction-model":12,"../dygraph-utils":17,"../iframe-tarp":19}]},{},[18])(18)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),n=b(i(361)),y=i(11),a=i(75),d=b(i(56)),s=b(i(52)),o=i(34),l=i(45),f=i(28),u=i(76),p=b(i(74)),h=b(i(141)),c=i(46),g=b(i(363)),m=i(364),v=b(i(104));function b(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var _="undefined"==typeof shaka?n:shaka,T=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return _.polyfill.installAll(),i._url="",i._player=null,i._playerConfig={},i._config={},i._ccTrack=null,i._ccExtractor=null,i._sentSeekRangeForCVODOnce=!1,i.type=y.AdaptivePlayer.PlayerType.SHAKA,i.streamType=y.AdaptivePlayer.StreamType.DASH,i.print(y.AdaptivePlayer.LogLevel.INFO,"DashPlayer","Instance created!"),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,a.PlayerBase),r(n,[{key:"destroy",value:function(){return this.unload().then(function(){this.print(y.AdaptivePlayer.LogLevel.INFO,"DashPlayer","Instance destroyed!")}.bind(this))}},{key:"configure",value:function(t){this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","configure called!");var e={timeout:1e4,maxAttempts:3,baseDelay:1e3,backoffFactor:1.5,fuzzFactor:.5};this._playerConfig={abr:{},manifest:{retryParameters:e,dash:{}},streaming:{},closedCaption:{label:"English",language:"en"},debugConfig:{}},t&&(t.debug&&_.log&&_.log.setLevel(_.log.Level.DEBUG),t.drm&&(this._playerConfig.drm=this._convertDRMConfig(t.drm)),t.abr&&(isNaN(t.abr.enabled)||(this._playerConfig.abr.enabled=t.abr.enabled),t.abr.startBandwidth&&(this._playerConfig.abr.defaultBandwidthEstimate=t.abr.startBandwidth),t.abr.startBitrate&&(this._playerConfig.abr.startBitrate=t.abr.startBitrate),t.abr.bandwidthUpgradeTarget&&(this._playerConfig.abr.bandwidthUpgradeTarget=t.abr.bandwidthUpgradeTarget),t.abr.bandwidthDowngradeTarget&&(this._playerConfig.abr.bandwidthDowngradeTarget=t.abr.bandwidthDowngradeTarget)),t.streaming&&(this._playerConfig.streaming=t.streaming,null==t.streaming.bufferingGoal&&(this._playerConfig.streaming.bufferingGoal=5),null==t.streaming.bufferBehind&&(this._playerConfig.streaming.bufferBehind=5),this._playerConfig.streaming.retryParameters=e,null==t.streaming.neulionGapDealing&&(this._playerConfig.streaming.neulionGapDealing=!1),isNaN(t.streaming.safeEdgeEndSize)||(this._playerConfig.streaming.safeEdgeEndSize=t.streaming.safeEdgeEndSize),isNaN(t.streaming.safeEdgeBeginSize)||(this._playerConfig.streaming.safeEdgeBeginSize=t.streaming.safeEdgeBeginSize)),t.preferredAudioLanguage&&(this._playerConfig.preferredAudioLanguage=t.preferredAudioLanguage),t.preferredTextLanguage&&(this._playerConfig.preferredTextLanguage=t.preferredTextLanguage),t.closedCaption&&(this._playerConfig.closedCaption=t.closedCaption),t.debugConfig&&t.debugConfig.gapTolerance&&(this._playerConfig.debugConfig.gapTolerance=t.debugConfig.gapTolerance,isNaN(t.debugConfig.gapTolerance.firefox)&&(this._playerConfig.debugConfig.gapTolerance.firefox=.02),isNaN(t.debugConfig.gapTolerance.ie)&&(this._playerConfig.debugConfig.gapTolerance.ie=.02),isNaN(t.debugConfig.gapTolerance.edge)&&(this._playerConfig.debugConfig.gapTolerance.edge=.02),isNaN(t.debugConfig.gapTolerance.chrome)&&(this._playerConfig.debugConfig.gapTolerance.chrome=.03),isNaN(t.debugConfig.gapTolerance.safari)&&(this._playerConfig.debugConfig.gapTolerance.safari=.02),isNaN(t.debugConfig.gapTolerance.others)&&(this._playerConfig.debugConfig.gapTolerance.others=.02))),this._config=t}},{key:"load",value:function(t,e){this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","load called!"),this._emptyAdvertisementList=[],this._player=new _.Player(this._video),this._sentSeekRangeForCVODOnce=!1,this._ccExtractor=new m.CCExtractor(this._onClosedCaption.bind(this)),this._eventManager=new l.EventManager,this._eventManager.listen(this._player,"error",this._onShakaError.bind(this)),this._eventManager.listen(this._player,"buffering",this._onShakaBufferingEvent.bind(this)),this._eventManager.listen(this._player,"trackschanged",this._onShakaTracksChanged.bind(this)),this._eventManager.listen(this._player,"periodschanged",this._onShakaPeriodsChanged.bind(this)),this._eventManager.listen(this._player,"closedcaption",this._onClosedCaption.bind(this)),this._eventManager.listen(this._player,"emsg",this._onEMSG.bind(this)),this._eventManager.listen(this._player,"advertisement",this._onAdvertisement.bind(this)),this._eventManager.listen(this._player,"emptyAdPost",this._onEmptyAdvertisement.bind(this)),this._eventManager.listen(this._player,"adRangeUpdate",this._onAdRangesUpdate.bind(this)),this._eventManager.listen(this._player,"adaptation",this._onAdaptation.bind(this)),["loading","unloading"].forEach(function(t){this._eventManager.listen(this._player,t,this._onShakaEvent.bind(this))}.bind(this)),this._eventManager.listen(this._video,"loadeddata",function(){null!=this._eventManager&&(this._eventManager.listen(this._video,"seeking",function(){this._ccExtractor.resetData(),this._clearCConReset()}.bind(this)),this._eventManager.listen(this._video,"seeked",function(){this._reEnableSubtitleTrack()}.bind(this)))}.bind(this));try{"IE"!==y.AdaptivePlayer.browserType&&"Edge"!==y.AdaptivePlayer.browserType||_.dash.DashParser.setCustomConfig({isPlayReady:!0})}catch(t){return this.print(y.AdaptivePlayer.LogLevel.ERROR,"DashPlayer","register NeuLion Plugin error!"),Promise.reject(new Error("register NeuLion Plugin error!"))}this._player.getNetworkingEngine().registerRequestFilter(this._onLicenseHttpRequest.bind(this));var i=!0;return this._config&&"boolean"==typeof this._config.dashCC&&!this._config.dashCC&&(i=!1),i&&this._player.getNetworkingEngine().registerResponseFilter(this._onSegmentResponse.bind(this)),this._url=t,d.isEmpty(this._playerConfig)||this._player.configure(this._playerConfig),this._player.load(t,e).then(function(){this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","The video has now been loaded!"),this._video.paused&&this._video.autoplay&&this._video.play(),""!==this._player.getCCInfos()&&null==this._ccTrack&&this._addCCTrack()}.bind(this)).catch(this._onShakaError.bind(this))}},{key:"unload",value:function(){return this.print(y.AdaptivePlayer.LogLevel.INFO,"DashPlayer","unload called!"),this._eventManager&&this._eventManager.destroy(),this._player&&(this._player.unload(),this._ccTrack&&(this._clearCConReset(),this._ccTrack.mode="disabled",this._ccTrack.hashId=null,this._ccTrack=null),null!=this._player.getManifestUri())?(null!=this._player.setTextTrackVisibility&&this._player.setTextTrackVisibility(!1),this._player.destroy()):Promise.resolve()}},{key:"videoTracks",value:function(){if(this._player){var i=[],t=this._player.getVariantTracks();if(0===t.length)i=this._video.videoTracks;else{var n=t.filter(function(t){return!0===t.active})[0];t.forEach(function(t,e){t.audioId===n.audioId&&i.push(new u.NLTrack(y.AdaptivePlayer.Kind.VIDEO,t,y.AdaptivePlayer.PlayerType.SHAKA,{id:e,player:this}))}.bind(this))}return i.sort(function(t,e){return t.bandwidth-e.bandwidth}),i}}},{key:"audioTracks",value:function(){if(this._player){var i=[],t=this._player.getVariantTracks();if(0===t.length)i=this._video.audioTracks;else{var e=t.filter(function(t){return!0===t.active})[0],n=t.filter(function(t){return t.videoId===e.videoId});n.forEach(function(t,e){i.push(new u.NLTrack(y.AdaptivePlayer.Kind.AUDIO,t,y.AdaptivePlayer.PlayerType.SHAKA,{id:e,player:this}))}.bind(this))}return i}}},{key:"textTracks",value:function(){var e=this;if(this._player){var n=[],t=this._video.textTracks,r=!1;if(t)for(var a=0;a<t.length;a++){var s=t[a];"disabled"===s.mode||"captions"!==s.kind&&"subtitles"!==s.kind||s.label===c.Settings.DASHPLAYER.DEFAULT_SUBTITLE_TRACK_NAME||null===s.hashId||function(){"showing"===s.mode&&(r=!0);var i={},t=e._player.getCCInfos();""!==t&&t.split(";").forEach(function(t){var e=t.split("=");i[e[0]]={name:e[1],lang:"en"}});n.push(new u.NLTrack(y.AdaptivePlayer.Kind.TEXT,s,y.AdaptivePlayer.PlayerType.NATIVE,{id:a,player:e._video,ccInfos:i}))}()}var i=this._player.getTextTracks();return i&&i.forEach(function(t,e){r||this._playerConfig.preferredTextLanguage!==t.language||!t.active||this._player.isTextTrackVisible()||this._player.setTextTrackVisibility(!0),n.push(new u.NLTrack(y.AdaptivePlayer.Kind.TEXT,t,y.AdaptivePlayer.PlayerType.SHAKA,{id:e,player:this,flag:this._player.isTextTrackVisible()}))}.bind(this)),n}}},{key:"ccTracks",value:function(){for(var t=[],e=this._video.textTracks.length-1;0<=e;e--){var i=this._video.textTracks[e];(i.label===c.Settings.DASHPLAYER.DEFAULT_SUBTITLE_TRACK_NAME||i.label===this._playerConfig.closedCaption.label&&"disabled"!==i.mode)&&t.push(i)}return t}},{key:"setTextTrackVisibility",value:function(t){this._player.setTextTrackVisibility(t)}},{key:"selectTrack",value:function(e,t){if(e)if(null==t&&("AUDIO"===e.kind||"TEXT"===e.kind?t=!0:"VIDEO"===e.kind&&(t=!0)),"AUDIO"===e.kind){var i=this.audioTracks().filter(function(t){return e.base.audioId===t.base.audioId});if(0<i.length&&(e.id!==i[0].id&&this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","selectTrack(A): "+e.id+"->"+i[0].id),e=i[0]),e.active)return;this._player.selectAudioLanguage(e.base.language,e.base.displayName),this._player.selectVariantTrack(e.base,!!t)}else if("VIDEO"===e.kind){var n=this.videoTracks().filter(function(t){return e.base.videoId===t.base.videoId});if(0<n.length&&(e.id!==n[0].id&&this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","selectTrack(V): "+e.id+"->"+n[0].id),e=n[0]),e.active)return;this._player.configure({abr:{enabled:!1}}),this._player.selectVariantTrack(e.base,!!t),this._onAdaptation({from:"manual select"}),this._ccExtractor.resetInitSegment(),this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.TrackChange,{details:{type:y.AdaptivePlayer.Kind.AUDIO,tracks:this.audioTracks()}})),this._clearCConReset()}else"TEXT"===e.kind&&(e.type===y.AdaptivePlayer.PlayerType.SHAKA?(this.textTracks().forEach(function(t){t.type===y.AdaptivePlayer.PlayerType.NATIVE&&(t.base.mode="hidden")}),this._player.isTextTrackVisible()||this.setTextTrackVisibility(!0),this._player.selectTextTrack(e.base)):e.type===y.AdaptivePlayer.PlayerType.NATIVE&&(e.base.mode="showing",this._player.isTextTrackVisible()&&this.setTextTrackVisibility(!1)),this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.TrackChange,{details:{type:y.AdaptivePlayer.Kind.TEXT,tracks:this.textTracks()}})))}},{key:"getStats",value:function(){var n=this;if(!this._player)return{bytesLoaded:NaN,bitrate:NaN,bandwidth:NaN,switchInfo:NaN,isAutoSwitch:!0,livePointOffest:-1};var t=0,e=0,i=0,r=[],a=this._player.getStats(),s=this._player.getConfiguration(),o=void 0,l=void 0,u=void 0,h=-1;if(a&&(t=a.bytesLoaded,i=Math.floor(a.streamBandwidth/1e3),o=s.abr.enabled,e=a.estimatedBandwidth?a.estimatedBandwidth:0,e=Math.floor(e/1e3),r=a.switchHistory?a.switchHistory:null,u=a.livePointOffest?a.livePointOffest:-1,h=a.currentCdnIndex,r&&0<r.length)){var c=void 0,d=void 0,f=void 0,p=void 0,g=function(e){if("variant"===r[e].type){if(null==c){var t=n._player.getVariantTracks().filter(function(t){return t.id===r[e].id});return 0<t.length&&(c=t[0].videoBandwidth||t[0].bandwidth),f=r[e].fromAdaptation,p=r[e].timestamp,"continue"}if(null!=c&&null==d&&p!==r[e].timestamp){var i=n._player.getVariantTracks().filter(function(t){return t.id===r[e].id});return 0<i.length&&(d=i[0].videoBandwidth||i[0].bandwidth),"break"}}};t:for(var m=r.length-1;0<=m;m--){switch(g(m)){case"continue":continue;case"break":break t}}l={from:d,to:c,fromAdaptation:f}}var v={bytesLoaded:t,currentCdnIndex:h,bitrate:i,bandwidth:e,switchInfo:l,switchHistory:r,isAutoSwitch:o,livePointOffest:u};return this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","getStats return: "+JSON.stringify(v)),v}},{key:"isLive",value:function(){return!!this._player&&this._player.isLive()}},{key:"gotoLive",value:function(){if(this._player&&this._player.isLive()){var t=this._player.seekRange();this._video.currentTime=t.end}}},{key:"setAdaptation",value:function(t){if(this._player.getConfiguration()){var e=this._player.getConfiguration();e.abr.enabled=t,this._player.configure(e)}}},{key:"getThumbnailStreams",value:function(){if(this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","getThumbnailStreams!"),this._player&&this._player.getThumbnailStreams)return this._player.getThumbnailStreams()}},{key:"getThumbnailStreamImages",value:function(t,e,i){if(this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","getThumbnailStreamImages!"),this._player&&this._player.getThumbnailStreamImages){var n=0;if(!this.isLive()){var r=this._player.getPeriodSections();r&&0<r.length&&(n=Math.max(r[0].start,r[0].maxStart))}this._player.getThumbnailStreamImages(t,e,n,i)}}},{key:"notifyPlayStarted",value:function(){this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.TrackChange,{details:{type:y.AdaptivePlayer.Kind.TEXT,tracks:this.textTracks()}}));var t=this._player.getPeriodSections();if(!this.isLive()&&!this._sentSeekRangeForCVODOnce&&t&&0<t.length){this._sentSeekRangeForCVODOnce=!0;var i=[];t.forEach(function(t){var e=Math.max(t.start,t.maxStart);i.push({id:t.id,begin:e,end:t.minEnd})});var e=Math.max(t[0].start,t[0].maxStart);if(0<t.length&&0<e){var n={start:e,end:t[t.length-1].minEnd,ranges:i};this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.SeekRangeChange,{data:n,details:n})),this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","Fired SeekRangeChange of CVOD: ["+JSON.stringify(n)+"]")}}}},{key:"notifyProfileChanged",value:function(t){}},{key:"_onTimeUpdate",value:function(t){if(this.isLive()){var e=this._player.seekRange(),i=this.currentTime-this._video.currentTime,n=[],r=this._player.getPeriodSections();r&&0<r.length&&r.forEach(function(t){var e=Math.max(t.start,t.maxStart);n.push({id:t.id,begin:e,end:t.minEnd})});var a={start:e.start+i,end:e.end+i,ranges:n};this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.SeekRangeChange,{data:a,details:a})),this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","Fired SeekRangeChange: ["+JSON.stringify(a)+"]")}}},{key:"_onShakaError",value:function(t){var e=t.detail||t;if(e.hasOwnProperty("category")&&e.hasOwnProperty("code")){var i=0,n=f.NLError.SeverityLevel.All,r=this._url;switch(e.category){case _.util.Error.Category.NETWORK:if(r=e.data[0],!p.validateURL(r)){i=f.NLError.Code.Get_Primary_Manifest_Failed+f.NLError.NetworkDetailCode.Connect_Failed,n=f.NLError.SeverityLevel.Fatal;break}var a=p.getExtension(r);if("mpd"===a){var s=this.isLive();i=f.NLError.Code.Get_Primary_Manifest_Failed,n=s?f.NLError.SeverityLevel.Warning:f.NLError.SeverityLevel.Fatal}else if("m3u8"===a||"m3u"===a){i=this._url===r?f.NLError.Code.Get_Primary_Manifest_Failed:f.NLError.Code.Get_Single_Bitrate_Manifest_Failed,n=f.NLError.SeverityLevel.Warning}else i=f.NLError.Code.Get_Chunk_Failed,n=f.NLError.SeverityLevel.Warning;var o=0;switch(e.code){case _.util.Error.Code.UNSUPPORTED_SCHEME:case _.util.Error.Code.MALFORMED_DATA_URI:case _.util.Error.Code.UNKNOWN_DATA_URI_ENCODING:case _.util.Error.Code.HTTP_ERROR:o=f.NLError.NetworkDetailCode.Connect_Failed;break;case _.util.Error.Code.BAD_HTTP_STATUS:o=e.data[1];break;case _.util.Error.Code.TIMEOUT:o=f.NLError.NetworkDetailCode.Timeout}i+=o;break;case _.util.Error.Category.TEXT:i=f.NLError.Code.Get_Chunk_Failed+f.NLError.NetworkDetailCode.Content_Error,n=f.NLError.SeverityLevel.Warning;break;case _.util.Error.Category.MEDIA:break;case _.util.Error.Category.STREAMING:switch(e.code){case _.util.Error.Code.UNABLE_TO_GUESS_MANIFEST_TYPE:case _.util.Error.Code.DASH_INVALID_XML:case _.util.Error.Code.DASH_EMPTY_PERIOD:case _.util.Error.Code.DASH_UNSUPPORTED_CONTAINER:case _.util.Error.Code.DASH_NO_COMMON_KEY_SYSTEM:case _.util.Error.Code.DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:case _.util.Error.Code.DASH_CONFLICTING_KEY_IDS:case _.util.Error.Code.UNPLAYABLE_PERIOD:case _.util.Error.Code.RESTRICTIONS_CANNOT_BE_MET:i=f.NLError.Code.Playback_Generic_Error,n=f.NLError.SeverityLevel.Warning}break;case _.util.Error.Category.MANIFEST:i=f.NLError.Code.Get_Primary_Manifest_Failed+f.NLError.NetworkDetailCode.Content_Error,n=f.NLError.SeverityLevel.Warning;break;case _.util.Error.Category.DRM:switch(n=f.NLError.SeverityLevel.Fatal,e.code){case _.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS:case _.util.Error.Code.ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:i=f.NLError.Code.Get_Primary_Manifest_Failed+f.NLError.NetworkDetailCode.Content_Error;break;case _.util.Error.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:i=f.NLError.Code.DRM_Not_Supported;break;case _.util.Error.Code.NO_LICENSE_SERVER_GIVEN:case _.util.Error.Code.FAILED_TO_CREATE_CDM:case _.util.Error.Code.FAILED_TO_ATTACH_TO_VIDEO:case _.util.Error.Code.FAILED_TO_CREATE_SESSION:case _.util.Error.Code.INVALID_SERVER_CERTIFICATE:case _.util.Error.Code.FAILED_TO_GENERATE_LICENSE_REQUEST:i=f.NLError.Code.DRM_Init_Failed;break;case _.util.Error.Code.LICENSE_REQUEST_FAILED:i=f.NLError.Code.Get_Key_License_Failed;var l=e.data[0];if(!l)break;if(r=l.data[0],!p.validateURL(r)){i=f.NLError.Code.Get_Key_License_Failed+f.NLError.NetworkDetailCode.Connect_Failed;break}if(l.category===_.util.Error.Category.NETWORK){var u=0;switch(l.code){case _.util.Error.Code.UNSUPPORTED_SCHEME:case _.util.Error.Code.MALFORMED_DATA_URI:case _.util.Error.Code.UNKNOWN_DATA_URI_ENCODING:case _.util.Error.Code.HTTP_ERROR:u=f.NLError.NetworkDetailCode.Connect_Failed;break;case _.util.Error.Code.BAD_HTTP_STATUS:u=l.data[1];break;case _.util.Error.Code.TIMEOUT:u=f.NLError.NetworkDetailCode.Timeout}i+=u}break;case _.util.Error.Code.LICENSE_RESPONSE_REJECTED:i=f.NLError.Code.Get_Key_License_Failed+f.NLError.NetworkDetailCode.Content_Error;break;case _.util.Error.Code.EXPIRED:i=f.NLError.Code.DRM_Module_Error_License_Expired}break;case _.util.Error.Category.PLAYER:}e.severity===_.util.Error.Severity.CRITICAL&&(n=f.NLError.SeverityLevel.Fatal);var h=d.getKeyByValue(_.util.Error.Category,e.category)+" "+d.getKeyByValue(_.util.Error.Code,e.code);this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","shaka Error: ["+r+", "+h+"]");var c=f.NLError.create(i,n,r,h,e.code);this._statisticManager.reportError(c)}else this.print(y.AdaptivePlayer.LogLevel.Error,"DashPlayer","Unknown Error Format! ")}},{key:"_onShakaBufferingEvent",value:function(t){this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.Buffering,{newState:t.buffering?"pause":"playing"})),this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","Fired Buffering event: "+t.type+"["+t+"]")}},{key:"_onShakaTracksChanged",value:function(t){this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Fired TracksChange: "+t.type+"["+t+"]")}},{key:"_onShakaPeriodsChanged",value:function(t){this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Fired PeriodsChanged: "+t.type+"["+t+"]"),this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.TrackChange,{details:{type:y.AdaptivePlayer.Kind.TEXT,tracks:this.textTracks()},data:[{type:y.AdaptivePlayer.Kind.VIDEO,tracks:this.videoTracks()},{type:y.AdaptivePlayer.Kind.AUDIO,tracks:this.audioTracks()},{type:y.AdaptivePlayer.Kind.TEXT,tracks:this.textTracks()}]}))}},{key:"_addCCTrack",value:function(){this._ccTrack=this._video.addTextTrack("captions",this._playerConfig.closedCaption.label,this._playerConfig.closedCaption.language),this._ccTrack.mode="hidden",this._ccTrack.hashId="dash_cc_"+v.generateUUID(),this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.TrackChange,{details:{type:y.AdaptivePlayer.Kind.TEXT,tracks:this.textTracks()}})),this._logger.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Fired TracksChange")}},{key:"_onClosedCaption",value:function(t){this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","_onClosedCaption "),this._logger.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","_onClosedCaption "),null==this._ccTrack&&this._addCCTrack(),g.MakeCues(t,this._ccTrack)}},{key:"_addCue",value:function(t){if(this._ccTrack){if(this._ccTrack.cues)for(var e=this._ccTrack.cues.length;e--;){var i=this._ccTrack.cues[e],n=Math.min(i.endTime,t.endTime)-Math.max(i.startTime,t.startTime);if(0<=n&&.5<n/(t.endTime-t.startTime))return void this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Discard cue["+t.startTime+"/"+t.endTime+": "+t.text)}this._ccTrack.addCue(t)}}},{key:"_onEMSG",value:function(t){if(t.detail&&t.detail.messageData){var e={pts:0,data:null,dict:null};e.pts=t.detail.startTime;var i=s.utf8ArrayToStr(t.detail.messageData),n=(new DOMParser).parseFromString(i,"application/xml").getElementsByTagName("PrivateCommand");if(0<n.length){var r=n[0].getAttribute("PrivateBytes");e.data=new Uint8Array(s.hexStringToArray(r))}this._cuepointManager.onID3(e)}}},{key:"_onShakaEvent",value:function(t){this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.StreamingEvent,{details:{from:"DashPlayer",data:{type:t.type}}})),this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Fired streaming event: ["+t.type+"]")}},{key:"_onAdaptation",value:function(t){this.videoTracks().forEach(function(t){if(t.active&&t.id!==this._activeVideoTrackId){this._activeVideoTrackId=t.id;var e={id:t.id,videoWidth:t.width,videoHeight:t.height,details:{id:t.id,videoWidth:t.width,videoHeight:t.height}};this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.ProfileChange,e)),this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Fired ProfileChange: "+JSON.stringify(e)),this._eventHandler.dispatchEvent(new o.FakeEvent(y.AdaptivePlayer.EventType.TrackChange,{details:{type:y.AdaptivePlayer.Kind.VIDEO,tracks:this.videoTracks()}}))}}.bind(this))}},{key:"_onAdvertisement",value:function(t){if(this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","_onAdvertisement"),t&&t.detail){this.print(y.AdaptivePlayer.LogLevel.WARNING,"DashPlayer","_onAdvertisement: "+JSON.stringify(t.detail));var e={type:t.detail.uploadType,data:{adid:t.detail.adId,urls:t.detail.urls}};this._eventHandler._onAdvertisement(e)}}},{key:"_onEmptyAdvertisement",value:function(t){t&&t.detail&&this._eventHandler._onEmptyAdvertisement(t.detail)}},{key:"_onAdRangesUpdate",value:function(t){t&&t.detail&&this._eventHandler._onAdRangesUpdate(t.detail)}},{key:"_readDrmInfo",value:function(t,e,i,n){if(e){if(i){var r="";"com.widevine.alpha"===n?r="widevine":"com.microsoft.playready"===n?r="playready":"com.apple.fps.1_0"===n&&(r="fairplay"),t.servers[n]=e.server+"/getlicense/"+r}else t.servers[n]=e.server;e.serverCertificate&&(t.advanced[n]||(t.advanced[n]={}),t.advanced[n].serverCertificate=e.serverCertificate)}}},{key:"_convertDRMConfig",value:function(t){var e={servers:{},advanced:{}};if(!t)return e;var i=!1;return t&&t.params&&t.params.saffron_license_server_used&&(i=t.params.saffron_license_server_used),this._readDrmInfo(e,t.widevine||t,i,"com.widevine.alpha"),this._readDrmInfo(e,t.playready||t,i,"com.microsoft.playready"),this._readDrmInfo(e,t.fairplay||t,i,"com.apple.fps.1_0"),e}},{key:"_onLicenseHttpRequest",value:function(t,e){var i=!1;if(this._config.withCredentialsFragmentPattern.forEach(function(t){-1!==e.uris[0].indexOf(t)&&(i=!0)}),this._config.withCredentials&&(t===_.net.NetworkingEngine.RequestType.SEGMENT&&i||t!==_.net.NetworkingEngine.RequestType.SEGMENT)&&(e.allowCrossSiteCredentials=!0),this._config.headers)for(var n in this._config.headers)e.headers[n]=this._config.headers[n];t===_.net.NetworkingEngine.RequestType.LICENSE&&(this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","License request called!"),e.headers.Authorization=this._config.drm.params.token)}},{key:"_onSegmentResponse",value:function(t,e){this.print(y.AdaptivePlayer.LogLevel.TRACE,"DashPlayer","_onSegmentResponse: "+t+", uri="+e.uri);try{if(this._ccExtractor)if(t===_.net.NetworkingEngine.RequestType.VIDEO_INIT){var i=this._player.getPeriodSections(),n=0;i&&0<i.length&&(n=Math.max(i[0].start,i[0].maxStart)),this._ccExtractor.appendInit(e.data,this.isLive(),n)}else t===_.net.NetworkingEngine.RequestType.VIDEO_SEGMENT&&this._ccExtractor.appendSegment(e.data)}catch(t){this.print(y.AdaptivePlayer.LogLevel.WARNING,"DashPlayer","cc extractor and parser occured error: "+t)}}},{key:"_reEnableSubtitleTrack",value:function(){for(var t=null,e=0;e<this._video.textTracks.length;e++){var i=this._video.textTracks[e];"showing"===i.mode&&(i.mode="hidden",t=h.getHashNameOfTrack(i))}for(var n=0;n<this._video.textTracks.length;n++){var r=this._video.textTracks[n];h.getHashNameOfTrack(r)===t&&(r.mode="showing")}}},{key:"_clearCConReset",value:function(){"IE"===y.AdaptivePlayer.browserType||"Edge"===y.AdaptivePlayer.browserType?this._clearCC():this._clearCCActiveCues()}},{key:"_clearCCActiveCues",value:function(){if(this._ccTrack&&this._ccTrack.activeCues&&0<this._ccTrack.activeCues.length)for(var t=this._ccTrack.activeCues.length-1;0<=t;t--)try{this._ccTrack.removeCue(this._ccTrack.activeCues[t])}catch(t){this.print(y.AdaptivePlayer.LogLevel.WARNING,"DashPlayer","clear cc active cue exception: "+t)}}},{key:"_clearCC",value:function(){if(this._ccTrack&&this._ccTrack.cues&&0<this._ccTrack.cues.length)for(var t=this._ccTrack.cues.length-1;0<=t;t--)try{this._ccTrack.removeCue(this._ccTrack.cues[t])}catch(t){this.print(y.AdaptivePlayer.LogLevel.WARNING,"DashPlayer","clear cc cue exception: "+t)}this._clearCCActiveCues()}},{key:"currentTime",get:function(){return this._video.currentTime},set:function(t){this.print(y.AdaptivePlayer.LogLevel.DEBUG,"DashPlayer","Seek to "+t);var e=this._player.seekRange();t>e.end?t=e.end:t<e.start&&(t=e.start),this._video.currentTime=t}}],[{key:"support",value:function(e){try{_.Player.isBrowserSupported()?_.Player.probeSupport().then(function(t){e(t)}):e({manifest:{},media:{},drm:{},offline:!1})}catch(t){}}}]),n}();(e.default=T).version=_.Player.version},function(t,r,e){(function(n){!function(){var t="undefined"!=typeof window?window:n,e={};for(var i in function(g,t){var e,s="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,i){t!=Array.prototype&&t!=Object.prototype&&(t[e]=i.value)},u=void 0!==g&&g===this?this:void 0!==t&&null!=t?t:this;function i(){i=function(){},u.Symbol||(u.Symbol=r)}var n,r=(n=0,function(t){return"jscomp_symbol_"+(t||"")+n++});function a(){i();var t=u.Symbol.iterator;t||(t=u.Symbol.iterator=u.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&s(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return o(this)}}),a=function(){}}function o(t){var e,i=0;return e=function(){return i<t.length?{done:!1,value:t[i++]}:{done:!0}},a(),(e={next:e})[u.Symbol.iterator]=function(){return this},e}function h(t){a();var e=t[Symbol.iterator];return e?e.call(t):o(t)}function l(t,e){if(e){for(var i=u,n=t.split("."),r=0;r<n.length-1;r++){var a=n[r];a in i||(i[a]={}),i=i[a]}(a=e(r=i[n=n[n.length-1]]))!=r&&null!=a&&s(i,n,{configurable:!0,writable:!0,value:a})}}l("Promise",function(t){function o(t){this.ba=0,this.f=void 0,this.a=[];var e=this.c();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function l(e){return e instanceof o?e:new o(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){null==this.a&&(this.a=[],this.f()),this.a.push(t)},e.prototype.f=function(){var t=this;this.c(function(){t.h()})};var i=u.setTimeout;e.prototype.c=function(t){i(t,0)},e.prototype.h=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var i=t[e];t[e]=null;try{i()}catch(t){this.g(t)}}}this.a=null},e.prototype.g=function(t){this.c(function(){throw t})},o.prototype.c=function(){function t(e){return function(t){n||(n=!0,e.call(i,t))}}var i=this,n=!1;return{resolve:t(this.m),reject:t(this.b)}},o.prototype.m=function(t){if(t===this)this.b(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof o)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.j(t):this.g(t)}},o.prototype.j=function(t){var e=void 0;try{e=t.then}catch(t){return void this.b(t)}"function"==typeof e?this.s(e,t):this.g(t)},o.prototype.b=function(t){this.h(2,t)},o.prototype.g=function(t){this.h(1,t)},o.prototype.h=function(t,e){if(0!=this.ba)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.ba);this.ba=t,this.f=e,this.i()},o.prototype.i=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)r.b(this.a[t]);this.a=null}};var r=new e;return o.prototype.o=function(t){var e=this.c();t.Qb(e.resolve,e.reject)},o.prototype.s=function(t,e){var i=this.c();try{t.call(e,i.resolve,i.reject)}catch(t){i.reject(t)}},o.prototype.then=function(t,e){function i(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(t){r(t)}}:t}var n,r,a=new o(function(t,e){n=t,r=e});return this.Qb(i(t,n),i(e,r)),a},o.prototype.catch=function(t){return this.then(void 0,t)},o.prototype.Qb=function(t,e){function i(){switch(n.ba){case 1:t(n.f);break;case 2:e(n.f);break;default:throw Error("Unexpected state: "+n.ba)}}var n=this;null==this.a?r.b(i):this.a.push(i)},o.resolve=l,o.reject=function(i){return new o(function(t,e){e(i)})},o.race=function(r){return new o(function(t,e){for(var i=h(r),n=i.next();!n.done;n=i.next())l(n.value).Qb(t,e)})},o.all=function(t){var a=h(t),s=a.next();return s.done?l([]):new o(function(i,t){function e(e){return function(t){n[e]=t,0==--r&&i(n)}}for(var n=[],r=0;n.push(void 0),r++,l(s.value).Qb(e(n.length-1),t),!(s=a.next()).done;);})},o}),l("Array.prototype.find",function(t){return t||function(t,e){t:{var i=this;i instanceof String&&(i=String(i));for(var n=i.length,r=0;r<n;r++){var a=i[r];if(t.call(e,a,r,i)){i=a;break t}}i=void 0}return i}});var c=this;function d(t,e){var i,n=t.split("."),r=c;n[0]in r||!r.execScript||r.execScript("var "+n[0]);for(;n.length&&(i=n.shift());)n.length||void 0===e?r=r[i]?r[i]:r[i]={}:r[i]=e}function f(t,n){function e(){}e.prototype=n.prototype,t.yg=n.prototype,t.prototype=new e,(t.prototype.constructor=t).ug=function(t,e,i){return n.prototype[e].apply(t,Array.prototype.slice.call(arguments,2))}}function p(t){this.c=Math.exp(Math.log(.5)/t),this.b=this.a=0}function m(t,e,i){var n=Math.pow(t.c,e);i=i*(1-n)+n*t.a,isNaN(i)||(t.a=i,t.b+=e)}function v(t){return t.a/(1-Math.pow(t.c,t.b))}function y(){this.b=new p(2),this.c=new p(5),this.a=0}function b(){}function _(){}c.a=!0,y.prototype.getBandwidthEstimate=function(t){return this.a<128e3?t:Math.min(v(this.b),v(this.c))},g.console&&g.console.log.bind&&(b=console.warn.bind(console));var T=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function E(t){var e;t instanceof E?(S(this,t.ha),this.Va=t.Va,this.Z=t.Z,w(this,t.va),this.X=t.X,k(this,O(t.a)),this.Ja=t.Ja):t&&(e=String(t).match(T))?(S(this,e[1]||"",!0),this.Va=A(e[2]||""),this.Z=A(e[3]||"",!0),w(this,e[4]),this.X=A(e[5]||"",!0),k(this,e[6]||"",!0),this.Ja=A(e[7]||"")):this.a=new N(null)}function S(t,e,i){t.ha=i?A(e,!0):e,t.ha&&(t.ha=t.ha.replace(/:$/,""))}function w(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.va=e}else t.va=null}function k(t,e,i){t.a=e instanceof N?e:(i||(e=L(e,R)),new N(e))}function A(t,e){return t?e?decodeURI(t):decodeURIComponent(t):""}function L(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,P),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function P(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}(e=E.prototype).ha="",e.Va="",e.Z="",e.va=null,e.X="",e.Ja="",e.toString=function(){var t=[],e=this.ha;if(e&&t.push(L(e,C,!0),":"),e=this.Z){t.push("//");var i=this.Va;i&&t.push(L(i,C,!0),"@"),t.push(encodeURIComponent(e).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.va)&&t.push(":",String(e))}return(e=this.X)&&(this.Z&&"/"!=e.charAt(0)&&t.push("/"),t.push(L(e,"/"==e.charAt(0)?I:x,!0))),(e=this.a.toString())&&t.push("?",e),(e=this.Ja)&&t.push("#",L(e,D)),t.join("")},e.resolve=function(t){var e=new E(this);"data"===e.ha&&(e=new E);var i=!!t.ha;i?S(e,t.ha):i=!!t.Va,i?e.Va=t.Va:i=!!t.Z,i?e.Z=t.Z:i=null!=t.va;var n=t.X;if(i)w(e,t.va);else if(i=!!t.X){if("/"!=n.charAt(0))if(this.Z&&!this.X)n="/"+n;else{var r=e.X.lastIndexOf("/");-1!=r&&(n=e.X.substr(0,r+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){r=0==n.lastIndexOf("/",0),n=n.split("/");for(var a=[],s=0;s<n.length;){var o=n[s++];"."==o?r&&s==n.length&&a.push(""):".."==o?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),r&&s==n.length&&a.push("")):(a.push(o),r=!0)}n=a.join("/")}}return i?e.X=n:i=""!==t.a.toString(),i?k(e,O(t.a)):i=!!t.Ja,i&&(e.Ja=t.Ja),e};var C=/[#\/\?@]/g,x=/[#\?:]/g,I=/[#\?]/g,R=/[#\?@]/g,D=/#/g;function N(t){this.b=t||null}function O(t){var e=new N;if(e.b=t.b,t.a){var i,n={};for(i in t.a)n[i]=t.a[i].concat();e.a=n,e.c=t.c}return e}function M(){var i,n,t=new Promise(function(t,e){i=t,n=e});return t.resolve=i,t.reject=n,t}function U(t,e,i){var n={maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0};this.j=null==t.maxAttempts?n.maxAttempts:t.maxAttempts,this.f=null==t.baseDelay?n.baseDelay:t.baseDelay,this.i=null==t.fuzzFactor?n.fuzzFactor:t.fuzzFactor,this.h=null==t.backoffFactor?n.backoffFactor:t.backoffFactor,this.a=0,this.b=this.f,this.c=e||!1,this.g=i||null,this.c&&(this.a=1)}function F(t){if(t.a>=t.j){if(!t.c)return Promise.reject();t.a=1,t.b=t.f}var e=new M;return t.a?(function t(e,i,n){if(e.g)if(e.g()||0==n)i();else{var r=Math.min(200,n);B(function(){t(this,i,n-r)}.bind(e),r)}else B(i,n)}(t,e.resolve,t.b*(1+(2*Math.random()-1)*t.i)),t.b*=t.h):e.resolve(),t.a++,e}function B(t,e){g.setTimeout(t,e)}function G(){this.g=[],this.b=this.a=null,this.h=0,this.c=null,this.i="",this.f=[]}function j(t,e,i,n,r){var a=q(t,e);null==a&&(a={cdnName:e,bandwidthRate:1,priority:0,bytes:0,onlineSpeed:0},t.f.push(a)),a.bytes+=i,r&&(a.onlineSpeed=Math.round(8e3*i/n/1e3))}function H(t,e,i,n,r,a){if(e&&(t=X(t,e,3,i))){if(e=-1,t)for(var s=0;s<t.v.length;s++)if(t.v[s].host===i){e=s;break}-1!==(i=e)&&("inMPD"===t.periodId?0<r?(a&&(t.v[i].onlineSpeed=8e3*n/r),t.v[i].cc+=n):t.v[i].onlineSpeed=0:0<r?(a&&(t.v[i].onlineSpeed=8e3*n/r),t.v[i].cc+=n,t.v[i].bb=6e4):(t.v[i].onlineSpeed=0,t.v[i].bb*=1.5,6e5<t.v[i].bb&&(t.v[i].bb=6e5)))}}function V(t,e,i){var n,r,a,s,o,l=null;if(0<e.v.length){var u;if((u=null!==t.c)&&(u=!1,null!==t.c&&t.c.periodId===e.periodId&&(u=!0),u=!u),u&&(s=e,o=!1,null!==(a=t).c&&a.c.v.length===s.v.length&&(o=a.c.v.every(function(e){return s.v.some(function(t){return t.host===e.host})})),o?(r=e,null!==(n=t).c&&r.v.forEach(function(t){for(var e=this.c,i=0;i<e.v.length;i++){var n=e.v[i];if(n.host===t.host){t.onlineSpeed=n.onlineSpeed,t.La=n.La;break}}}.bind(n))):t.h=0),5e3<=(u=(new Date).getTime())-t.h){l=-1;for(var h=0,c=0;c<e.v.length;c++){var d=e.v[c];if(!0===d.enable){if(-1===d.La){l=c;break}var f=u-d.La;f>d.bb&&h<f&&(h=f,l=c)}}if(-1!==l&&(e.Ha=l,(d=e.v[l]).La=u),null===(l=-1!==l?e.v[l].host:null)&&0<=i){for(l=-1,h=0,e.Na=-1,c=0;c<e.v.length;c++)!0===(d=e.v[c]).enable&&0<d.bandwidthRate&&d.onlineSpeed>=i*d.bandwidthRate&&(h+=1,-1===l?(l=c,e.Na=d.priority):d.priority<e.v[l].priority&&(l=c,h=1,e.Na=d.priority));-1!==l&&1===h&&(e.Ha=l,(d=e.v[l]).La=u),l=-1!==l?e.v[l].host:null}if(null===l){for(i=-1,l=0;l<e.v.length;l++)!0!==(h=e.v[l]).enable||-1!==e.Na&&e.Na!==h.priority||(-1===i?i=l:h.onlineSpeed>h[i].onlineSpeed&&(i=l));-1!==i&&(e.Ha=i,(h=e.v[i]).La=u),l=-1!==i?e.v[i].host:null}null!==l&&(t.h=u)}null===l&&-1!==e.Ha&&(l=e.v[e.Ha].host),t.c=e}return l}function W(t,e){null!==e&&e.v.forEach(function(e){t.forEach(function(t){t===e.host&&(e.enable=!0)})})}function z(t){t&&t.v.forEach(function(t){t.enable=!1})}function K(t,e,i){if(e===i.periodId){var n=[];t.forEach(function(t){n.push(t.host)}),z(i),W(n,i)}}function Y(t,n){t.forEach(function(t){for(var e=-1,i=0;i<n.v.length;i++)if(n.v[i].host===t.host){e=i;break}-1===e?(e={host:t.host,enable:!0,onlineSpeed:0,bandwidthRate:t.bandwidthRate,priority:t.priority,La:-1,bb:6e4,xg:0,cc:0},n.v.push(e)):((e=n.v[e]).enable=!0,e.bandwidthRate=t.bandwidthRate,e.priority=t.priority)})}function X(t,e,i,n){var r=null;do{if(null!=e){if((0===i||3===i)&&t.b){if(void 0===n&&e===t.b.periodId){r=t.b;break}if(n&&n===t.b.v[0].host){r=t.b;break}}if(2===i||3===i){for(var a=0;a<t.g.length;a++)if(e===t.g[a].periodId){r=t.g[a];break}if(r)break}1!==i&&3!==i||!t.a||(void 0===n&&e===t.a.periodId?r=t.a:n&&t.a.v.some(function(t){return t.host===n})&&(r=t.a))}}while(0);return r}function q(t,e){for(var i=null,n=t.f.length-1;0<=n;n--)if(t.f[n].cdnName===e){i=t.f[n];break}return i}function Z(t,e,i,n,r){var a,s=r in n;for(a in e){var o=r+"."+a,l=s?n[r]:i[a];(s||a in t)&&(void 0===e[a]?void 0===l||s?delete t[a]:t[a]=l:l.constructor==Object&&e[a]&&e[a].constructor==Object?(t[a]||(t[a]=l),Z(t[a],e[a],l,n,o)):typeof e[a]==typeof l&&null!=e[a]&&e[a].constructor==l.constructor&&(t[a]=e[a]))}}function Q(t){var a=[];return function t(e){switch(typeof e){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return e;default:if(!e)return e;if(0<=a.indexOf(e))return null;var i=e.constructor==Array;if(e.constructor!=Object&&!i)return null;a.push(e);var n,r=i?[]:{};for(n in e)r[n]=t(e[n]);return i&&(r.length=e.length),r}}(t)}function J(t,e,i,n){this.severity=t,this.category=e,this.code=i,this.data=Array.prototype.slice.call(arguments,3),this.handled=!1}function $(t,e){return t.concat(e)}function tt(){}function et(t){return null!=t}function it(t,e,i){return i.indexOf(t)==e}function nt(t,e){return at(t.ha,t.Z,t.va,e)}function rt(t,e){var i=new E(t);return at(i.ha,i.Z,i.va,e)}function at(t,e,i,n){var r="";return""!=e&&(""!==t||null!==t.match(/https/i)?(""===(t=i?i.toString():"")&&n&&(t="443"),r=""!=t?e+":"+t:e):""!=t&&null===t.match(/http/i)||(""===(t=i?i.toString():"")&&n&&(t="80"),r=""!=t?e+":"+t:e)),r}function st(t){this.g=!1,this.b=[],this.c=[],this.f=[],this.h=t||null,this.a=null}N.prototype.a=null,N.prototype.c=null,N.prototype.add=function(t,e){if(!this.a&&(this.a={},this.c=0,this.b))for(var i=this.b.split("&"),n=0;n<i.length;n++){var r=i[n].indexOf("="),a=null;if(0<=r){var s=i[n].substring(0,r);a=i[n].substring(r+1)}else s=i[n];s=decodeURIComponent(s.replace(/\+/g," ")),a=a||"",this.add(s,decodeURIComponent(a.replace(/\+/g," ")))}return this.b=null,(i=this.a.hasOwnProperty(t)&&this.a[t])||(this.a[t]=i=[]),i.push(e),this.c++,this},N.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var t,e=[];for(t in this.a)for(var i=encodeURIComponent(t),n=this.a[t],r=0;r<n.length;r++){var a=i;""!==n[r]&&(a+="="+encodeURIComponent(n[r])),e.push(a)}return this.b=e.join("&")},M.prototype.resolve=function(){},M.prototype.reject=function(){},d("shaka.util.CdnManager",G),G.prototype.destroy=G.prototype.destroy=function(){this.g=[],this.c=this.b=this.a=null,this.h=0,this.i="",this.f=[]},G.prototype.updateCdns=G.prototype.Ua=function(t,e){if("inMPD"===e)0<t.length?(null===this.a&&(this.a={periodId:e,v:[],Ha:-1,Na:-1}),K(t,e,this.a),Y(t,this.a)):this.a=null;else if("Manifest"===e)null===this.b&&0<t.length&&(this.b={periodId:e,v:[],Ha:-1,Na:-1},K(t,e,this.b),Y(t,this.b));else if(0<t.length){var i=X(this,e,2);null===i&&(i={periodId:e,v:[],Ha:-1,Na:-1},this.g.push(i)),K(t,e,i),Y(t,i)}for(i=0;i<t.length;i++){var n=q(this,t[i].host);null==n&&(n={cdnName:t[i].host,bandwidthRate:t[i].bandwidthRate,priority:t[i].priority,bytes:0,onlineSpeed:0},this.f.push(n))}},G.prototype.getBytesInfo=G.prototype.ob=function(){return this.f},G.prototype.getCurrentHost=G.prototype.pb=function(){return this.i},G.prototype.getRecommendPeriodId=G.prototype.rb=function(t,e){var i="Manifest";if(t){var n=X(this,t,3,e);n&&(i=n.periodId)}return i},d("shaka.util.Error",J),J.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},J.Severity={RECOVERABLE:1,CRITICAL:2},J.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},J.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,LOAD_INTERRUPTED:7e3,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013},d("shaka.util.UriParserExtends.parseUri",function(t){var e="url protocol host port path query hash".split(" "),i=/^(?:([A-Za-z]+):)?(?:\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,n={};if(t&&(t=i.exec(t),i=7,t))for(;i--;)n[e[i]]=t[i]||"";return n}),d("shaka.util.UriParserExtends.getFullAddressWithUri",nt),d("shaka.util.UriParserExtends.getFullAddressWithUriString",rt),d("shaka.util.UriParserExtends.getFullAddress",at),d("shaka.net.NetworkingEngine",st),st.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,VIDEO_INIT:4,AUDIO_INIT:5,VIDEO_SEGMENT:6,AUDIO_SEGMENT:7},st.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var ot={};function lt(t,e,i){i=i||3;var n=ot[t];(!n||i>=n.priority)&&(ot[t]={priority:i,xf:e})}function ut(t,e){return{uris:t,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:e,userRequestExt:{periodId:void 0,requestStartTimeMs:void 0,lastSegment:!1}}}function ht(t){var e="";return(t=/^(?:.+(\.mpd$))|^(?:.+(_audio)(?:\.mp4)?\/Time=\d+\.m4s$)|^(?:.+(_video)(?:\.mp4)?\/Time=\d+\.m4s$)|^(?:.+(\.vtt|\.srt$))|^(?:.+(\.vtt|\.srt$))/.exec(t))&&(".mpd"===t[1]?e="manifest":"_audio"===t[2]?e="audio":"_video"===t[3]?e="video":".vtt"===t[4]||".srt"===t[4]?e="vtt":".images"===t[3]&&(e="image")),e}function ct(t,e,i,n,r,a){if(""!=(i=new E(i)).Z&&""!=i.X){var s=ht(i.X);0===r&&(r=1),i=nt(i,!1),t.a&&(a?"video"===s?(H(t=t.a,e,i,n,r,!0),j(t,i,n,r,!0)):(H(t=t.a,e,i,n,r,!1),j(t,i,n,r,!1)):(H(t=t.a,e,i,n,r,!0),j(t,i,n,r,!0)))}}function dt(t,e){for(var i=[],n=0;n<t.length;++n){for(var r=!1,a=0;a<i.length&&!(r=e?e(t[n],i[a]):t[n]===i[a]);++a);r||i.push(t[n])}return i}function ft(t,e,i){for(var n=0;n<t.length;++n)if(i(t[n],e))return n;return-1}function pt(t,e){var i=t.indexOf(e);-1<i&&t.splice(i,1)}function gt(){this.a={}}function mt(){this.a=new gt}function vt(t,e,i,n){t.a&&(e=new _t(e,i,n),t.a.push(i,e))}function yt(t,e,i,n){vt(t,e,i,function(t){this.ta(e,i),n(t)}.bind(t))}function bt(t){if(t.a){var e,i=t.a,n=[];for(e in i.a)n.push.apply(n,i.a[e]);for(i=0;i<n.length;++i)n[i].ta();t.a.clear()}}function _t(t,e,i){this.target=t,this.type=e,this.a=i,this.target.addEventListener(e,i,!1)}function Tt(t,e){var i,n=e||{};for(i in n)this[i]=n[i];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=g.performance&&g.performance.now?g.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function Et(t,e){if(0==e.length)return t;var i=e.map(function(t){return new E(t)});return t.map(function(t){return new E(t)}).map(function(t){return i.map(t.resolve.bind(t))}).reduce($,[]).map(function(t){return t.toString()})}function St(t,e){return{keySystem:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:e||[],keyIds:[]}}st.registerScheme=lt,st.unregisterScheme=function(t){delete ot[t]},st.prototype.registerRequestFilter=st.prototype.Af=function(t){this.c.push(t)},st.prototype.unregisterRequestFilter=st.prototype.kg=function(t){var e=this.c;0<=(t=e.indexOf(t))&&e.splice(t,1)},st.prototype.clearAllRequestFilters=st.prototype.me=function(){this.c=[]},st.prototype.registerResponseFilter=st.prototype.Bf=function(t){this.f.push(t)},st.prototype.unregisterResponseFilter=st.prototype.lg=function(t){var e=this.f;0<=(t=e.indexOf(t))&&e.splice(t,1)},st.prototype.clearAllResponseFilters=st.prototype.ne=function(){this.f=[]},st.prototype.destroy=st.prototype.destroy=function(){this.g=!0,this.c=[],this.f=[],this.a=null;for(var t=[],e=0;e<this.b.length;++e)t.push(this.b[e].catch(tt));return Promise.all(t)},st.prototype.request=st.prototype.request=function(n,r,a){var s=a||function(){return!1};if(this.g)return Promise.reject();r.method=r.method||"GET",r.headers=r.headers||{},r.retryParameters=r.retryParameters?Q(r.retryParameters):{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},r.uris=Q(r.uris);var o=Date.now(),e=Promise.resolve();return this.c.forEach(function(t){e=e.then(t.bind(null,n,r))}),e=(e=e.catch(function(t){throw new J(2,1,1006,t)})).then(function(){var t=Date.now()-o,e=new U(r.retryParameters,!1,a),i=function(t,e,i){var n=0;if(0<e.length){var r=0;(n=/.+\/.*_(\d+)_video\/Time=\d+\.m4s$/.exec(e[0]))&&n[1]&&(r=Number(n[1])),n=r}r=[];for(var a=0;a<e.length;a++){var s=new E(e[a]);if(""!=s.Z&&""!=s.X){var o=ht(s.X);s=nt(s,!1),"manifest"===o?t.a.Ua([{host:s,bandwidthRate:1/0,priority:0}],"Manifest"):r.push(s)}}if((e=0)<r.length)for(t=t.a,n*=1e3,a=null,i&&(o=null,0<t.g.length&&(o=X(t,i,2))&&W(r,o),o&&(a=V(t,o,n),z(o)),null===a&&t.a&&i===t.a.periodId&&(W(r,t.a),a=V(t,t.a,n),z(t.a)),null===a&&t.b&&(W(r,t.b),a=V(t,t.b,n),z(t.b))),null!==a&&(t.i=a),i=a,a=0;a<r.length;a++)if(i&&i===r[a]){e=a;break}return e}(this,r.uris,r.userRequestExt.periodId);return F(e).then(function(){return function e(t,n,r,i,a,s,o){if(t.g||o())return Promise.reject();var l=new E(r.uris[a]),u=l.ha;u||(u=location.protocol,u=u.slice(0,-1),S(l,u),r.uris[a]=l.toString());u=(u=ot[u])?u.xf:null;if(!u)return Promise.reject(new J(2,1,1e3,l));var h=Date.now();r.userRequestExt.requestStartTimeMs=h;return u(r.uris[a],r,n).then(function(e){null==e.timeMs&&(e.timeMs=Date.now()-h);var t=Date.now(),i=Promise.resolve();return this.f.forEach(function(t){i=i.then(function(){return Promise.resolve(t(n,e))}.bind(this))}.bind(this)),(i=i.catch(function(t){var e=2;throw t instanceof J&&(e=t.severity),new J(e,1,1007,t)})).then(function(){return e.userResponseExt.requestFilterTimeMs=s,e.userResponseExt.responseFilterTimeMs=Date.now()-t,e.timeMs+=e.userResponseExt.responseFilterTimeMs,e.timeMs+=e.userResponseExt.requestFilterTimeMs,ct(this,r.userRequestExt.periodId,e.uri,e.data.byteLength,e.timeMs,!0),e}.bind(this))}.bind(t)).catch(function(t){if(t.data&&t.data[0]&&ct(this,r.userRequestExt.periodId,t.data[0],0,-1,!1),t&&1==t.severity)return a=(a+1)%r.uris.length,o()?Promise.reject():F(i).then(function(){return e(this,n,r,i,a,s,o)}.bind(this),function(){throw t});throw t}.bind(t))}(this,n,r,e,i,t,s)}.bind(this))}.bind(this)),this.b.push(e),e.then(function(t){return 0<=this.b.indexOf(e)&&this.b.splice(this.b.indexOf(e),1),this.h&&!t.fromCache&&(1==n||4<=n&&n<=7)&&this.h(t.timeMs,t.data.byteLength),t}.bind(this)).catch(function(t){return t&&(t.severity=2,t.data&&t.data[0]&&ct(this,r.userRequestExt.periodId,t.data[0],0,-1,!1)),0<=this.b.indexOf(e)&&this.b.splice(this.b.indexOf(e),1),Promise.reject(t)}.bind(this))},st.prototype.updateCdns=st.prototype.Ua=function(t,e){this.a.Ua(t,e)},st.prototype.getRecommendPeriodId=st.prototype.rb=function(t,e){return this.a.rb(t,e)},st.prototype.setCdnMgr=st.prototype.Pd=function(t){this.a=t},st.prototype.getBytesInfo=st.prototype.ob=function(){return this.a.ob()},st.prototype.getCurrentHost=st.prototype.pb=function(){return this.a.pb()},gt.prototype.push=function(t,e){this.a.hasOwnProperty(t)?this.a[t].push(e):this.a[t]=[e]},gt.prototype.get=function(t){return(t=this.a[t])?t.slice():null},gt.prototype.remove=function(t,e){var i=this.a[t];if(i)for(var n=0;n<i.length;++n)i[n]==e&&(i.splice(n,1),--n)},gt.prototype.clear=function(){this.a={}},mt.prototype.destroy=function(){return bt(this),this.a=null,Promise.resolve()},mt.prototype.ta=function(t,e){if(this.a)for(var i=this.a.get(e)||[],n=0;n<i.length;++n){var r=i[n];r.target==t&&(r.ta(),this.a.remove(e,r))}},_t.prototype.ta=function(){this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null},Tt.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Tt.prototype.stopImmediatePropagation=function(){this.a=!0},Tt.prototype.stopPropagation=function(){};var wt=1/15;function kt(t){return!t||0==Object.keys(t).length}function At(e){return Object.keys(e).map(function(t){return e[t]})}function Lt(t,e){var i=t;return e&&(i+='; codecs="'+e+'"'),i}var Pt={codecs:"codecs",frameRate:"framerate",bandwidth:"bitrate",width:"width",height:"height",channelsCount:"channels"};function Ct(t){if(!t)return"";239==(t=new Uint8Array(t))[0]&&187==t[1]&&191==t[2]&&(t=t.subarray(3)),t=escape(Dt(t));try{return decodeURIComponent(t)}catch(t){throw new J(2,2,2004)}}function xt(t,e,i){if(!t)return"";if(!i&&0!=t.byteLength%2)throw new J(2,2,2004);if(t instanceof ArrayBuffer)var n=t;else(i=new Uint8Array(t.byteLength)).set(new Uint8Array(t)),n=i.buffer;t=Math.floor(t.byteLength/2),i=new Uint16Array(t),n=new DataView(n);for(var r=0;r<t;r++)i[r]=n.getUint16(2*r,e);return Dt(i)}function It(t){var e=new Uint8Array(t);if(239==e[0]&&187==e[1]&&191==e[2])return Ct(e);if(254==e[0]&&255==e[1])return xt(e.subarray(2),!1);if(255==e[0]&&254==e[1])return xt(e.subarray(2),!0);var i=function(t,e){return t.byteLength<=e||32<=t[e]&&t[e]<=126}.bind(null,e);if(0==e[0]&&0==e[2])return xt(t,!1);if(0==e[1]&&0==e[3])return xt(t,!0);if(i(0)&&i(1)&&i(2)&&i(3))return Ct(t);throw new J(2,2,2003)}function Rt(t){t=encodeURIComponent(t),t=unescape(t);for(var e=new Uint8Array(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e.buffer}function Dt(t){for(var e="",i=0;i<t.length;i+=16e3)e+=String.fromCharCode.apply(null,t.subarray(i,i+16e3));return e}function Nt(t){this.a=null,this.b=function(){this.a=null,t()}.bind(this)}function Ot(t,e){t.cancel();var i=function(){this.b(),this.a=setTimeout(i,1e3*e)}.bind(t);t.a=setTimeout(i,1e3*e)}function Mt(t,e){var i=null==e||e,n=g.btoa(Dt(t)).replace(/\+/g,"-").replace(/\//g,"_");return i?n:n.replace(/=*$/,"")}function Ut(t){t=g.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var e=new Uint8Array(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e}function Ft(t){for(var e=new Uint8Array(t.length/2),i=0;i<t.length;i+=2)e[i/2]=g.parseInt(t.substr(i,2),16);return e}function Bt(t){for(var e="",i=0;i<t.length;++i){var n=t[i].toString(16);1==n.length&&(n="0"+n),e+=n}return e}function Gt(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!=e[i])return!1;return!0}function jt(t){for(var e=0,i=0;i<arguments.length;++i)e+=arguments[i].length;e=new Uint8Array(e);var n=0;for(i=0;i<arguments.length;++i)e.set(arguments[i],n),n+=arguments[i].length;return e}function Ht(e){this.s=e,this.j=this.i=this.u=null,this.I=!1,this.b=null,this.g=new mt,this.a=[],this.o=[],this.m=new M,this.f=null,this.h=function(t){this.m.reject(t),e.onError(t)}.bind(this),this.C={},this.D=new Nt(this.zf.bind(this)),this.W=this.c=!1,this.G=[],this.O=!1,this.w=new Nt(this.yf.bind(this)),Ot(this.w,1),this.m.catch(function(){})}function Vt(t,e){if(!t.i)return yt(t.g,e,"encrypted",function(){this.h(new J(2,6,6010))}.bind(t)),Promise.resolve();t.j=e,yt(t.g,t.j,"play",t.bf.bind(t));var i=t.j.setMediaKeys(t.i);i=i.catch(function(t){return Promise.reject(new J(2,6,6003,t.message))});var n=null;return t.b.serverCertificate&&t.b.serverCertificate.length&&(n=t.i.setServerCertificate(t.b.serverCertificate).then(function(){}).catch(function(t){return Promise.reject(new J(2,6,6004,t.message))})),Promise.all([i,n]).then(function(){if(this.c)return Promise.reject();var t,e;(e=(t=this).b?t.b.initData:[]).forEach(function(t){Wt(this,t.initDataType,t.initData)}.bind(t)),t.o.forEach(function(t){!function(e,t){try{var i=e.i.createSession("persistent-license")}catch(t){var n=new J(2,6,6005,t.message);return e.h(n),Promise.reject(n)}vt(e.g,i,"message",e.Dd.bind(e)),vt(e.g,i,"keystatuseschange",e.zd.bind(e));var r={initData:null,ya:i,loaded:!1,Kc:1/0,Aa:null};e.a.push(r),i.load(t).then(function(t){if(!this.c){if(t)return r.loaded=!0,this.a.every(function(t){return t.loaded})&&this.m.resolve(),i;this.a.splice(this.a.indexOf(r),1),this.h(new J(2,6,6013))}}.bind(e),function(t){this.c||(this.a.splice(this.a.indexOf(r),1),this.h(new J(2,6,6005,t.message)))}.bind(e))}(this,t)}.bind(t)),e.length||t.o.length||t.m.resolve(),this.b.initData.length||this.o.length||vt(this.g,this.j,"encrypted",this.Qe.bind(this))}.bind(t)).catch(function(t){return this.c?Promise.resolve():Promise.reject(t)}.bind(t))}function Wt(e,t,i){try{var n=e.W?e.i.createSession("persistent-license"):e.i.createSession()}catch(t){return void e.h(new J(2,6,6005,t.message))}vt(e.g,n,"message",e.Dd.bind(e)),vt(e.g,n,"keystatuseschange",e.zd.bind(e)),e.a.push({initData:i,ya:n,loaded:!1,Kc:1/0,Aa:null}),n.generateRequest(t,i.buffer).catch(function(t){if(!this.c){for(var e=0;e<this.a.length;++e)if(this.a[e].ya==n){this.a.splice(e,1);break}this.h(new J(2,6,6006,t.message))}}.bind(e))}function zt(t,e){for(var i,n=e.target,r=0;r<t.a.length;r++)if(t.a[r].ya==n){i=t.a[r];break}(r=ut([t.b.licenseServerUri],t.f.retryParameters)).body=e.message,r.method="POST","com.microsoft.playready"!=t.b.keySystem&&"com.chromecast.playready"!=t.b.keySystem||function(t){var e=xt(t.body,!0,!0);if(-1==e.indexOf("PlayReadyKeyMessage"))t.headers["Content-Type"]="text/xml; charset=utf-8";else{for(var i=(e=(new DOMParser).parseFromString(e,"application/xml")).getElementsByTagName("HttpHeader"),n=0;n<i.length;++n)t.headers[i[n].querySelector("name").textContent]=i[n].querySelector("value").textContent;t.body=Ut(e.querySelector("Challenge").textContent).buffer}}(r),t.s.wb.request(2,r).then(function(t){return this.c?Promise.reject():n.update(t.data).then(function(){this.s.onEvent(new Tt("drmsessionupdate")),i&&(i.Aa&&i.Aa.resolve(),setTimeout(function(){i.loaded=!0,this.a.every(function(t){return t.loaded})&&this.m.resolve()}.bind(this),5e3))}.bind(this))}.bind(t),function(t){if(this.c)return Promise.resolve();t=new J(2,6,6007,t),this.h(t),i&&i.Aa&&i.Aa.reject(t)}.bind(t)).catch(function(t){if(this.c)return Promise.resolve();t=new J(2,6,6008,t.message),this.h(t),i&&i.Aa&&i.Aa.reject(t)}.bind(t))}function Kt(t,e){if(!t.length)return e;if(!e.length)return t;for(var i=[],n=0;n<t.length;n++)for(var r=0;r<e.length;r++)if(t[n].keySystem==e[r].keySystem){var a=t[n];r=e[r];var s=[];s=(s=s.concat(a.initData||[])).concat(r.initData||[]);var o=[];o=(o=o.concat(a.keyIds)).concat(r.keyIds),i.push({keySystem:a.keySystem,licenseServerUri:a.licenseServerUri||r.licenseServerUri,distinctiveIdentifierRequired:a.distinctiveIdentifierRequired||r.distinctiveIdentifierRequired,persistentStateRequired:a.persistentStateRequired||r.persistentStateRequired,videoRobustness:a.videoRobustness||r.videoRobustness,audioRobustness:a.audioRobustness||r.audioRobustness,serverCertificate:a.serverCertificate||r.serverCertificate,initData:s,keyIds:o});break}return i}function Yt(t){return!t||1==t.length&&t.end(0)-t.start(0)<1e-6?null:t.length?t.end(t.length-1):null}function Xt(t,e){return!(!t||!t.length||1==t.length&&t.end(0)-t.start(0)<1e-6)&&(e>=t.start(0)&&e<=t.end(t.length-1))}function qt(t,e){if(!t||!t.length||1==t.length&&t.end(0)-t.start(0)<1e-6)return 0;for(var i=0,n=t.length-1;0<=n&&t.end(n)>e;--n)i+=t.end(n)-Math.max(t.start(n),e);return i}function Zt(t,e){if(!t||!t.length||1==t.length&&t.end(0)-t.start(0)<1e-6)return null;var i=.05;/(Edge\/|Trident\/|Tizen)/.test(navigator.userAgent)&&(i=.5);for(var n=0;n<t.length;n++)if(t.start(n)>e&&(0==n||t.end(n-1)-e<=i))return n;return null}function Qt(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e}function Jt(t,e){if(t&&e)for(var i=0;i<t.length;i++)t.start(i),t.end(i)}function $t(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.b=null,this.f=[],this.c=!1,this.a.on("data",this.h.bind(this)),this.a.on("done",this.g.bind(this))}function te(t,e){return!(!g.muxjs||"mp2t"!=t.split(";")[0].split("/")[1])&&(e?MediaSource.isTypeSupported(ee(e,t)):MediaSource.isTypeSupported(ee("audio",t))||MediaSource.isTypeSupported(ee("video",t)))}function ee(t,e){var i=e.replace("mp2t","mp4");"audio"==t&&(i=i.replace("video","audio"));var n=/avc1\.(66|77|100)\.(\d+)/.exec(i);if(n){var r="avc1.",a=n[1],s=Number(n[2]);r=("66"==a?r+"4200":"77"==a?r+"4d00":r+"6400")+(s>>4).toString(16),r+=(15&s).toString(16),i=i.replace(n[0],r)}return i}function ie(t){this.f=null,this.c=t,this.h=this.i=0,this.g=1/0,this.b=this.a=null}d("shaka.util.StringUtils.fromUTF8",Ct),d("shaka.util.StringUtils.fromUTF16",xt),d("shaka.util.StringUtils.fromBytesAutoDetect",It),d("shaka.util.StringUtils.toUTF8",Rt),Nt.prototype.cancel=function(){null!=this.a&&(clearTimeout(this.a),this.a=null)},d("shaka.util.Uint8ArrayUtils.toBase64",Mt),d("shaka.util.Uint8ArrayUtils.fromBase64",Ut),d("shaka.util.Uint8ArrayUtils.fromHex",Ft),d("shaka.util.Uint8ArrayUtils.toHex",Bt),d("shaka.util.Uint8ArrayUtils.equal",Gt),d("shaka.util.Uint8ArrayUtils.concat",jt),(e=Ht.prototype).destroy=function(){this.c=!0;var i=[];return this.a.forEach(function(t){t=t.ya.close().catch(tt);var e=new Promise(function(t){setTimeout(t,1e3)});i.push(Promise.race([t,e]))}),this.m.reject(),this.g&&i.push(this.g.destroy()),this.j&&i.push(this.j.setMediaKeys(null).catch(tt)),this.w&&(this.w.cancel(),this.w=null),this.D&&(this.D.cancel(),this.D=null),this.g=this.j=this.i=this.u=this.b=null,this.a=[],this.o=[],this.s=this.h=this.f=null,Promise.all(i)},e.configure=function(t){this.f=t},e.init=function(t,e){var i,n,r,a,s,o,l,u,h,c,d={},f=[],p=t.periods.some(function(t){return t.variants.some(function(t){return t.drmInfos.length})});return this.W=e,this.o=t.offlineSessionIds,i=this,n=t,r=e||0<t.offlineSessionIds.length,a=d,s=f,o=function(t){if(kt(t.f.clearKeys))return null;var e,i=[],n=[];for(e in t.f.clearKeys){var r=t.f.clearKeys[e],a=Ft(e);r=Ft(r),a={kty:"oct",kid:Mt(a,!1),k:Mt(r,!1)},i.push(a),n.push(a.kid)}return t=JSON.stringify({keys:i}),n=JSON.stringify({kids:n}),n=[{initData:new Uint8Array(Rt(n)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+g.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:n,keyIds:[]}}(i),u=n,h=i.f,c=Object.keys(h.servers),l=!c.length||u.periods.some(function(t){return t.variants.some(function(t){return t.drmInfos.length})})?null:c.map(function(t){return{keySystem:t,licenseServerUri:h.servers[t],distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]}}),n.periods.forEach(function(t){t.variants.forEach(function(n){o&&(n.drmInfos=[o]),l&&(n.drmInfos=l),n.drmInfos.forEach(function(e){!function(t,e){var i=e.keySystem;if(i){if(!e.licenseServerUri){var n=t.f.servers[i];n&&(e.licenseServerUri=n)}e.keyIds||(e.keyIds=[]),(i=t.f.advanced[i])&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=i.persistentStateRequired),e.videoRobustness||(e.videoRobustness=i.videoRobustness),e.audioRobustness||(e.audioRobustness=i.audioRobustness),e.serverCertificate||(e.serverCertificate=i.serverCertificate))}}(this,e),g.cast&&g.cast.__platform__&&"com.microsoft.playready"==e.keySystem&&(e.keySystem="com.chromecast.playready");var i=a[e.keySystem];i||(i={audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:r?"required":"optional",sessionTypes:[r?"persistent-license":"temporary"],label:e.keySystem,drmInfos:[]},a[e.keySystem]=i,s.push(e.keySystem)),i.drmInfos.push(e),e.distinctiveIdentifierRequired&&(i.distinctiveIdentifier="required"),e.persistentStateRequired&&(i.persistentState="required");var t=[];n.video&&t.push(n.video),n.audio&&t.push(n.audio),t.forEach(function(t){("video"==t.type?i.videoCapabilities:i.audioCapabilities).push({robustness:("video"==t.type?e.videoRobustness:e.audioRobustness)||"",contentType:Lt(t.mimeType,t.codecs)})}.bind(this))}.bind(this))}.bind(this))}.bind(i)),f.length?function(t,h,e,i){if(1==e.length&&""==e[0])return Promise.reject(new J(2,6,6e3));var n=new M,r=n;return[!0,!1].forEach(function(i){e.forEach(function(t){var e=h[t];e.drmInfos.some(function(t){return!!t.licenseServerUri})==i&&(0==e.audioCapabilities.length&&delete e.audioCapabilities,0==e.videoCapabilities.length&&delete e.videoCapabilities,r=r.catch(function(){return this.c?Promise.reject():navigator.requestMediaKeySystemAccess(t,[e])}.bind(this)))}.bind(this))}.bind(t)),r=(r=r.catch(function(){return Promise.reject(new J(2,6,6001))})).then(function(t){if(this.c)return Promise.reject();var e,i,n,r,a,s,o,l=0<=navigator.userAgent.indexOf("Edge/"),u=t.getConfiguration();return this.u=(u.audioCapabilities||[]).concat(u.videoCapabilities||[]).map(function(t){return t.contentType}),l&&(this.u=null),l=h[t.keySystem],e=this,i=t.keySystem,function(t,i,n,r,a){function s(t,e){return!(!t.keyId||t.keyId!=e.keyId)||t.initDataType==e.initDataType&&Gt(t.initData,e.initData)}t.forEach(function(t){if(-1==i.indexOf(t.licenseServerUri)&&i.push(t.licenseServerUri),t.serverCertificate&&-1==ft(n,t.serverCertificate,Gt)&&n.push(t.serverCertificate),t.initData&&t.initData.forEach(function(t){-1==ft(r,t,s)&&r.push(t)}),t.keyIds)for(var e=0;e<t.keyIds.length;++e)-1==a.indexOf(t.keyIds[e])&&a.push(t.keyIds[e])})}((n=l).drmInfos,r=[],a=[],s=[],o=[]),e.b={keySystem:i,licenseServerUri:r[0],distinctiveIdentifierRequired:"required"==n.distinctiveIdentifier,persistentStateRequired:"required"==n.persistentState,audioRobustness:n.audioCapabilities?n.audioCapabilities[0].robustness:"",videoRobustness:n.videoCapabilities?n.videoCapabilities[0].robustness:"",serverCertificate:a[0],initData:s,keyIds:o},this.b.licenseServerUri?t.createMediaKeys():Promise.reject(new J(2,6,6012))}.bind(t)).then(function(t){if(this.c)return Promise.reject();this.i=t,this.I=!0}.bind(t)).catch(function(t){return this.c?Promise.resolve():(this.u=this.b=null,t instanceof J?Promise.reject(t):Promise.reject(new J(2,6,6002,t.message)))}.bind(t)),i||(r=r.catch(function(){})),n.reject(),r}(this,d,f,p):(this.I=!0,Promise.resolve())},e.keySystem=function(){return this.b?this.b.keySystem:""},e.wc=function(){var t=this.a.map(function(t){return t=t.ya.expiration,isNaN(t)?1/0:t});return Math.min.apply(Math,t)},e.Qe=function(t){for(var e=new Uint8Array(t.initData),i=0;i<this.a.length;++i)if(Gt(e,this.a[i].initData))return;Wt(this,t.initDataType,e)},e.Dd=function(t){this.f.delayLicenseRequestUntilPlayed&&this.j.paused&&!this.O?this.G.push(t):zt(this,t)},e.zd=function(t){var s,e;for(t=t.target,s=0;s<this.a.length&&this.a[s].ya!=t;++s);if(s!=this.a.length){var o=!1;t.keyStatuses.forEach(function(t,e){if("string"==typeof e){var i=e;e=t,t=i}if("com.microsoft.playready"==this.b.keySystem&&16==e.byteLength){var n=(i=new DataView(e)).getUint32(0,!0),r=i.getUint16(4,!0),a=i.getUint16(6,!0);i.setUint32(0,n,!1),i.setUint16(4,r,!1),i.setUint16(6,a,!1)}"com.microsoft.playready"==this.b.keySystem&&"status-pending"==t&&(t="usable"),"status-pending"!=t&&(this.a[s].loaded=!0,this.a.every(function(t){return t.loaded})&&this.m.resolve()),"expired"==t&&(o=!0),i=Bt(new Uint8Array(e)),this.C[i]=t}.bind(this));var i=t.expiration-Date.now();(i<0||o&&i<1e3)&&!this.a[s].Aa&&(this.a.splice(s,1),t.close().catch(function(){})),(e=this.D).cancel(),e.a=setTimeout(e.b,500)}},e.zf=function(){var e,i;!kt(this.C)&&(e=this.C,i=function(t,e){return"expired"==e},Object.keys(e).every(function(t){return i(t,e[t])}))&&this.h(new J(2,6,6014)),this.s.Ue(this.C)},e.bf=function(){for(var t=0;t<this.G.length;t++)zt(this,this.G[t]);this.O=!0,this.G=[]},e.yf=function(){this.a.forEach(function(t){var e=t.Kc,i=t.ya.expiration;isNaN(i)&&(i=1/0),i!=e&&(this.s.onExpirationUpdated(t.ya.sessionId,i),t.Kc=i)}.bind(this))},$t.prototype.destroy=function(){return this.a.dispose(),this.a=null,Promise.resolve()},$t.prototype.h=function(t){var e=new Uint8Array(t.data.byteLength+t.initSegment.byteLength);e.set(t.initSegment,0),e.set(t.data,t.initSegment.byteLength),this.f.push(e)},$t.prototype.g=function(){var t=jt.apply(null,this.f);this.b.resolve(t),this.c=!1};var ne={};function re(t,e,i){this.g=t,this.f=e,this.m=i,this.b={},this.a=null,this.c={},this.i=new mt,this.j=!1,this.h={}}function ae(t,e){t.a||(t.a=new ie(t.m)),t.a.f=new ne[e]}function se(t,e){if("text"==e)var i=t.a.a;else i=!(i=le(t,e))||1==i.length&&i.end(0)-i.start(0)<1e-6?null:1==i.length&&i.start(0)<0?0:i.length?i.start(0):null;return i}function oe(t,e){return"text"==e?t.a.b:Yt(le(t,e))}function le(t,e){try{return t.b[e].buffered}catch(t){return null}}function ue(t,e,i,n,r){return"text"==e?(a=t.a,s=i,o=n,l=r,Promise.resolve().then(function(){if(this.f&&this.c)if(null==o||null==l)this.f.parseInit(new Uint8Array(s));else{var t={periodStart:this.i,segmentStart:o,segmentEnd:l};t=this.f.parseMedia(new Uint8Array(s),t).filter(function(t){return t.startTime>=this.h&&t.startTime<this.g}.bind(this)),this.c.append(t),null==this.a&&(this.a=Math.max(o,this.h)),this.b=Math.min(l,this.g)}}.bind(a))):t.h[e]?function(t,e){t.c=!0,t.b=new M,t.f=[];var i=new Uint8Array(e);return t.a.push(i),t.a.flush(),t.c&&t.b.reject(new J(2,3,3018)),t.b}(t.h[e],i).then(function(t){return he(this,e,this.Yd.bind(this,e,t.buffer))}.bind(t)):he(t,e,t.Yd.bind(t,e,i));var a,s,o,l}function he(e,i,n){if(e.j)return Promise.reject();if(n={start:n,p:new M},e.c[i].push(n),1==e.c[i].length)try{n.start()}catch(t){"QuotaExceededError"==t.name?n.p.reject(new J(2,3,3017,i)):n.p.reject(new J(2,3,3015,t)),de(e,i)}return n.p}function ce(t,i){if(t.j)return Promise.reject();var e,n=[];for(e in t.b){var r=new M,a={start:function(t){t.resolve()}.bind(null,r),p:r};t.c[e].push(a),n.push(r),1==t.c[e].length&&a.start()}return Promise.all(n).then(function(){var t;try{i()}catch(t){var e=Promise.reject(new J(2,3,3015,t))}for(t in this.b)de(this,t);return e}.bind(t),function(){return Promise.reject()}.bind(t))}function de(e,i){e.c[i].shift();var n=e.c[i][0];if(n)try{n.start()}catch(t){n.p.reject(new J(2,3,3015,t)),de(e,i)}}function fe(t,e,i){return i==e||pe<=t&&i==e.split("-")[0]||ge<=t&&i.split("-")[0]==e.split("-")[0]}d("shaka.text.TextEngine.registerParser",function(t,e){ne[t]=e}),d("shaka.text.TextEngine.unregisterParser",function(t){delete ne[t]}),ie.prototype.destroy=function(){return this.c=this.f=null,Promise.resolve()},ie.prototype.setDisplayer=ie.prototype.Sf=function(t){this.c=t},ie.prototype.nd=function(t){try{return this.f.parseMedia(new Uint8Array(t),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(t){throw new J(2,2,2009,t)}},ie.prototype.remove=function(t,e){return Promise.resolve().then(function(){!this.c||!this.c.remove(t,e)||null==this.a||e<=this.a||t>=this.b||(t<=this.a&&e>=this.b?this.a=this.b=null:t<=this.a&&e<this.b?this.a=e:t>this.a&&e>=this.b&&(this.b=t))}.bind(this))},(e=re.prototype).destroy=function(){this.j=!0;var t,e=[];for(t in this.c){var i=this.c[t],n=i[0];for(this.c[t]=i.slice(0,1),n&&e.push(n.p.catch(tt)),n=1;n<i.length;++n)i[n].p.catch(tt),i[n].p.reject()}for(t in this.a&&e.push(this.a.destroy()),this.h)e.push(this.h[t].destroy());return Promise.all(e).then(function(){this.i.destroy(),this.m=this.a=this.f=this.g=this.i=null,this.b={},this.h={},this.c={}}.bind(this))},e.init=function(t){for(var e in t){var i=t[e];i=Lt(i.mimeType,i.codecs),"text"==e?ae(this,i):(!MediaSource.isTypeSupported(i)&&te(i,e)&&(this.h[e]=new $t,i=ee(e,i)),i=this.f.addSourceBuffer(i),vt(this.i,i,"error",this.fg.bind(this,e)),vt(this.i,i,"updateend",this.eb.bind(this,e)),this.b[e]=i,this.c[e]=[])}},e.tc=function(){var t=this.a&&null!=this.a.a?[{start:this.a.a,end:this.a.b}]:[];return{total:Qt(this.g.buffered),audio:Qt(le(this,"audio")),video:Qt(le(this,"video")),text:t}},e.remove=function(t,e,i){return"text"==t?this.a.remove(e,i):he(this,t,this.Kd.bind(this,t,e,i))},e.clear=function(t){return"text"==t?this.a?this.a.remove(0,1/0):Promise.resolve():he(this,t,this.Kd.bind(this,t,0,this.f.duration))},e.flush=function(t){return"text"==t?Promise.resolve():he(this,t,this.qe.bind(this,t))},e.endOfStream=function(t){return ce(this,function(){t?this.f.endOfStream(t):this.f.endOfStream()}.bind(this))},e.Sa=function(t){return ce(this,function(){this.f.duration=t}.bind(this))},e.ca=function(){return this.f.duration},e.Yd=function(t,e){Jt(this.b[t].buffered,!1),this.b[t].appendBuffer(e),Jt(this.b[t].buffered,!1)},e.Kd=function(t,e,i){i<=e?this.eb(t):this.b[t].remove(e,i)},e.he=function(t){var e=this.b[t].appendWindowStart,i=this.b[t].appendWindowEnd;this.b[t].abort(),this.b[t].appendWindowStart=e,this.b[t].appendWindowEnd=i,this.eb(t)},e.qe=function(t){this.g.currentTime-=.001,this.eb(t)},e.Vf=function(t,e){e<0&&(e+=.001),this.b[t].timestampOffset=e,this.eb(t)},e.Pf=function(t,e,i){this.b[t].appendWindowStart=0,this.b[t].appendWindowEnd=i,this.b[t].appendWindowStart=e,this.eb(t)},e.fg=function(t){this.c[t][0].p.reject(new J(2,3,3014,this.g.error?this.g.error.code:0))},e.eb=function(t){var e=this.c[t][0];e&&(e.p.resolve(),de(this,t))};var pe=1,ge=2;function me(t){t=t.toLowerCase().split("-");var e=ve[t[0]];return e&&(t[0]=e),t.join("-")}var ve={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function ye(t,e,i){var n=t.video;return!(n&&(n.width<e.minWidth||n.width>e.maxWidth||n.width>i.width||n.height<e.minHeight||n.height>e.maxHeight||n.height>i.height||n.width*n.height<e.minPixels||n.width*n.height>e.maxPixels)||t.bandwidth<e.minBandwidth||t.bandwidth>e.maxBandwidth)}function be(t,i,n){var r=!1;return t.variants.forEach(function(t){var e=t.allowedByApplication;t.allowedByApplication=ye(t,i,n),e!=t.allowedByApplication&&(r=!0)}),r}function _e(n,r,a,t){t.variants=t.variants.filter(function(t){return!(n&&n.I&&(e=t,i=n.keySystem(),0!=e.drmInfos.length&&!e.drmInfos.some(function(t){return t.keySystem==i})))&&(Te(t.audio,n,r)&&Te(t.video,n,a));var e,i}),t.textStreams=t.textStreams.filter(function(t){return!!ne[Lt(t.mimeType,t.codecs)]})}function Te(t,e,i){if(!t)return!0;var n=null;e&&e.I&&(n=e.u),e=Lt(t.mimeType,t.codecs);var r,a=Lt(t.mimeType,t.codecs),s=t.mimeType;for(r in Pt){var o=t[r],l=Pt[r];o&&(s+="; "+l+'="'+o+'"')}return!(!(ne[a]||MediaSource.isTypeSupported(s)||te(a,t.type))||n&&t.encrypted&&n.indexOf(e)<0||i&&(t.mimeType!=i.mimeType||t.codecs.split(".")[0]!=i.codecs.split(".")[0]))}function Ee(t){return t.allowedByApplication&&t.allowedByKeySystem}function Se(t){return t.filter(function(t){return Ee(t)})}function we(t,e,i,r,n){var a=Se(t),s=a;(t=a.filter(function(t){return t.primary})).length&&(s=t);var o,l=s.length?s[0].language:"";if(s=s.filter(function(t){return t.language==l}),e){var u=me(e);[ge,pe,0].forEach(function(i){var n=!1;a.forEach(function(t){u=me(u);var e=me(t.language);fe(i,u,e)&&(n?s.push(t):(s=[t],n=!0),r&&(r.audio=!0))})})}return i&&(e=[],(e=n?(o=i,s.filter(function(t){return t.audio&&0<=t.audio.roles.indexOf(o)})):Ae(s,i)).length)?e:(i=s.map(function(t){return(t.audio?t.audio.roles:[]).concat(t.video?t.video.roles:[])}).reduce($,[])).length?Ae(s,i[0]):s}function ke(t,e,i,r){var a=t,n=t.filter(function(t){return t.primary});n.length&&(a=n);var s=a.length?a[0].language:"";if(a=a.filter(function(t){return t.language==s}),e){var o=me(e);[ge,pe,0].forEach(function(i){var n=!1;t.forEach(function(t){var e=me(t.language);fe(i,o,e)&&(n?a.push(t):(a=[t],n=!0),r&&(r.text=!0))})})}if(i){if((e=Le(a,i)).length)return e}else if((e=a.filter(function(t){return 0==t.roles.length})).length)return e;return(e=a.map(function(t){return t.roles}).reduce($,[])).length?Le(a,e[0]):a}function Ae(t,e){return t.filter(function(t){return t.audio&&0<=t.audio.roles.indexOf(e)||t.video&&0<=t.video.roles.indexOf(e)})}function Le(t,e){return t.filter(function(t){return 0<=t.roles.indexOf(e)})}function Pe(t,e,i){for(var n=0;n<i.length;n++)if(i[n].audio==t&&i[n].video==e)return i[n];return null}function Ce(t,e){for(var i=t.periods.length-1;0<i;--i)if(e+wt>=t.periods[i].startTime)return i;return 0}function xe(t,e){for(var i=0;i<t.periods.length;++i){var n=t.periods[i];if("text"==e.type){for(var r=0;r<n.textStreams.length;++r)if(n.textStreams[r]==e)return i}else for(r=0;r<n.variants.length;++r){var a=n.variants[r];if(a.audio==e||a.video==e||a.video&&a.video.trickModeVideo==e)return i}}return-1}function Ie(){this.a=[],this.g=[],this.Ub={},this.h=0,this.m="",this.o=this.i=!1,this.b=this.f=null,this.j="",this.c=!1,this.s=null,this.u=0,this.w="none"}function Re(t){return"failover"===t.w}function De(t,e,i){if(null!==e&&0!==e.length){var n=null;if(i){var r=t.a,a=-1;if(i=e[0].start,r&&0<r.length){n=r[r.length-1].minEnd;for(var s=r.length-1;0<=s;s--)if(r[s].id===e[0].id){a=s;break}if(-1===a)r.splice(0,r.length);else{s=-1;var o=a;for(a=0;o<r.length;o++,a++)a<e.length&&r[o].id===e[a].id&&(r[o].start=e[a].start,r[o].end=e[a].end,s=a);-1!==s&&e.splice(0,s+1)}}if(e.forEach(function(t){r.push(t)}),a=-1,0<i)for(e=0;e<r.length;e++)if(r[e].start>i-600){a=e;break}-1!==a&&r.splice(0,a-1),function(t,e){var i,n=t.Ub,r=Object.keys(n);for(i in r)e>n[i].start+600&&delete n[i]}(t,i)}else t.a=[],t.a=t.a.concat(e);for(e=0;e<t.a.length;e++)for(a=0;a<t.g.length;a++)t.a[e].id===t.g[a].id&&(i=t.g[a],t.a[e].minEnd=Oe(i),t.a[e].maxStart=Ne(i));n&&0<t.a.length&&(e=t.a[t.a.length-1],n&&e&&e.minEnd&&(t.u=n!==e.minEnd?0:t.u+1)),function(t){for(var e=0;e<t.length;e++);}(t.a),function(t){for(var e=0;e<t.length;e++);}(t.g)}}function Ne(t){var e=0<t.Pb?t.Pb:-1;return 0<t.gc&&(e=Math.max(e,t.gc)),e}function Oe(t){var e=0<t.Ob?t.Ob:1/0;return 0<t.fc&&(e=Math.min(e,t.fc)),e}function Me(t,e,i,n){for(var r=-1,a=(t=t.a).length-1;0<a&&!(a-1<0);a--)if(e>=t[a-1].start&&e<=t[a].start){if(n){n=t[a-1].minEnd;var s=t[a].maxStart;n&&s&&n-i<=e&&e<s+i&&(r=t[a].maxStart)}-1===r&&e>=t[a-1].end-i&&e<=t[a].start+i&&(r=t[a].start);break}return r}function Ue(t,e){var i=-1;if(0<t.length)for(var n=0;n<t.length;n++){if(e<=t[0]){i=t[0];break}if(e>=t[t.length-1]){i=t[t.length-1];break}var r=t[n],a=t[n+1];if(r<=e&&e<a){i=r;break}}return i}function Fe(t){return t.filter(function(t,e,i){return i.indexOf(t)===e})}function Be(){this.h=null,this.c=!1,this.b=new y,this.g=[],this.j=!1,this.i=this.a=this.f=null}function Ge(e,t){return e&&(t=t.filter(function(t){return ye(t,e,{width:1/0,height:1/0})})),t.sort(function(t,e){return t.bandwidth-e.bandwidth})}d("shaka.util.UserDataManager",Ie),Ie.prototype.destroy=Ie.prototype.destroy=function(){this.a=[],this.g=[],this.Ub={},this.h=0,this.m="",this.o=this.i=!1,this.b=this.f=null,this.j="",this.c=!1,this.s=null,this.u=0,this.w="none"},Ie.prototype.uc=function(){return this.j},Ie.prototype.init=function(t,e,i){this.s=t,this.h=e,this.m=i,this.o=this.i=!1,this.b=this.f=null,this.c=!1},Ie.prototype.getPeriodSections=Ie.prototype.Vb=function(){return this.a},Ie.prototype.getStreamLiveEdge=Ie.prototype.od=function(){var t=0;return 0<this.a.length&&this.a[this.a.length-1].minEnd&&(t=this.a[this.a.length-1].minEnd),t},Ie.prototype.judgeNearPeriodEdge=Ie.prototype.sd=function(t,e){return Me(this,t,e,!0)},Ie.prototype.setVideoStartBitrate=Ie.prototype.Wf=function(t){this.h=t},Ie.prototype.setDefualtAudioLanguage=Ie.prototype.Qf=function(t){this.m=t},Ie.prototype.setLastVideoStream=Ie.prototype.Td=function(t){this.f=t},Ie.prototype.setLastAudioStream=Ie.prototype.Sd=function(t){this.b=t},Ie.prototype.setStartBitrateInited=Ie.prototype.Tf=function(t){this.i=t},Ie.prototype.setPeriodTransiting=Ie.prototype.Tc=function(t){this.o=t},Ie.prototype.setMpdType=Ie.prototype.Ud=function(t){this.c=t},Ie.prototype.getMpdType=Ie.prototype.ze=function(){return this.c},Ie.prototype.chooseVariantPlugin=Ie.prototype.cd=function(t,e,i,n,r){var a={choosen:t[0],find:!1};return 0<t.length&&(a=this.i?this.o?function(t,e){for(var i={choosen:e[0],find:!1},n=[],r=0;r<e.length;r++)e[r].video&&e[r].video.bandwidth&&n.push(e[r].video.bandwidth);n=Fe(n);var a=t.h;if(t.f&&t.f.bandwidth&&(a=t.f.bandwidth),r=e,0<n.length){var s=Ue(n,a);r=e.filter(function(t){return!(!t.video||!t.video.bandwidth||t.video.bandwidth!==s)})}if(n="",a=t.m,t.b&&t.b.language&&(a=t.b.language,t.b.roles))for(var o=0;o<t.b.roles[o].length;o++)if("main"===t.b.roles[o]||"alternate"===t.b.roles[o]){n=t.b.roles[o];break}return 0<(r=we(r,a,n,void 0,!0)).length&&(i.choosen=r[0],i.find=!0),i}(this,t):function(t,e,i,n,r){var a={choosen:e[0],find:!1},s=-1;if(t.b&&t.b.id&&(s=t.b.id),-1!==s&&null!==t.s){e=e.filter(function(t){return!(!t.audio||!t.audio.id||t.audio.id!==s)});var o=!1;if(-1!==Me(t,t.s.currentTime,5)&&!1===t.c&&(o=!0),o){if(t.f&&t.f.id)for(o=0;o<e.length;++o)e[o].video&&e[o].video.id&&t.f.id===e[o].video.id&&(a.choosen=e[o],a.find=!0)}else for(o=0;o<e.length;++o){t=e[o];var l=(e[o+1]||{bandwidth:1/0}).bandwidth/r;i>=t.bandwidth/n&&i<=l&&(a.choosen=t,a.find=!0)}}return a}(this,t,n,e,i):function(t,e,i){var n=e.filter(function(t){return t.audio&&0<=t.audio.roles.indexOf("main")});if(0<n.length&&(e=n),n={choosen:e[0],find:!1},!i&&null!==t.h){i=[];for(var r=0;r<e.length;r++)e[r].video&&e[r].video.bandwidth&&i.push(e[r].video.bandwidth);if(0<(i=Fe(i)).length){var a=Ue(i,t.h);0<(e=e.filter(function(t){return!(!t.video||!t.video.bandwidth||t.video.bandwidth!==a)})).length&&(n.choosen=e[0],n.find=!0)}}return t.i=!0,n}(this,t,r)),a},d("shaka.abr.SimpleAbrManager",Be),Be.prototype.stop=Be.prototype.stop=function(){this.h=null,this.c=!1,this.g=[],this.f=null},Be.prototype.init=Be.prototype.init=function(t){this.h=t},Be.prototype.chooseVariant=Be.prototype.chooseVariant=function(){var t=Ge(this.a.restrictions,this.g),e=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);if(this.g.length&&!t.length&&(t=[(t=Ge(null,this.g))[0]]),this.i){var i=this.i.cd(t,e,this.a.bandwidthDowngradeTarget,this.a.bandwidthUpgradeTarget,this.c);if(i.find)return this.f=Date.now(),i.choosen}i=t[0]||null;for(var n=0;n<t.length;++n){var r=t[n],a=(t[n+1]||{bandwidth:1/0}).bandwidth/this.a.bandwidthUpgradeTarget;e>=r.bandwidth/this.a.bandwidthDowngradeTarget&&e<=a&&(i=r)}return this.f=Date.now(),i},Be.prototype.enable=Be.prototype.enable=function(){this.c=!0},Be.prototype.disable=Be.prototype.disable=function(){this.c=!1},Be.prototype.segmentDownloaded=Be.prototype.segmentDownloaded=function(t,e){var i=this.b;if(!(e<16e3)){var n=8e3*e/t,r=t/1e3;i.a+=e,m(i.b,r,n),m(i.c,r,n)}if(null!=this.f&&this.c)t:{if(this.j){if(Date.now()-this.f<1e3*this.a.switchInterval)break t}else{if(!(128e3<=this.b.a))break t;this.j=!0}i=this.chooseVariant(),this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate),this.h(i)}},Be.prototype.getBandwidthEstimate=Be.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)},Be.prototype.setVariants=Be.prototype.setVariants=function(t){this.g=t},Be.prototype.configure=Be.prototype.configure=function(t){this.a=t},Be.prototype.setUserDataManager=Be.prototype.U=function(t){this.i=t};var je="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),He="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),Ve=["loop","playbackRate"],We=["pause","play"],ze="adaptation buffering emsg error loading streaming texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading".split(" "),Ke={drmInfo:20,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getManifestUri:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1},Ye={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},Xe=[["getConfiguration","configure"]],qe=[["isTextTrackVisible","setTextTrackVisibility"]],Ze="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack setTextTrackVisibility trickPlay".split(" "),Qe=["load","unload"];function Je(t){return JSON.stringify(t,function(t,e){if("function"!=typeof e){if(e instanceof Event||e instanceof Tt){var i,n={};for(i in e){var r=e[i];r&&"object"==typeof r?"detail"==i&&(n[i]=r):i in Event||(n[i]=r)}return n}if(e instanceof TimeRanges)for(n={__type__:"TimeRanges",length:e.length,start:[],end:[]},i=0;i<e.length;++i)n.start.push(e.start(i)),n.end.push(e.end(i));else n="number"==typeof e?isNaN(e)?"NaN":isFinite(e)?e:e<0?"-Infinity":"Infinity":e;return n}})}function $e(t){return JSON.parse(t,function(t,e){return"NaN"==e?NaN:"-Infinity"==e?-1/0:"Infinity"==e?1/0:e&&"object"==typeof e&&"TimeRanges"==e.__type__?{length:(i=e).length,start:function(t){return i.start[t]},end:function(t){return i.end[t]}}:e;var i})}function ti(t,e,i,n,r,a){this.G=t,this.g=e,this.I=i,this.j=!1,this.C=n,this.D=r,this.u=a,this.b=this.h=!1,this.w="",this.i=null,this.m=this.xd.bind(this),this.o=this.Ye.bind(this),this.a={video:{},player:{}},this.s=0,this.c={},this.f=null}var ei=!1,ii=null;function ni(t){var e=ii;e.removeUpdateListener(t.m),e.removeMessageListener("urn:x-cast:com.google.shaka.v2",t.o)}function ri(t){for(var e in t.c){var i=t.c[e];delete t.c[e],i.reject(new J(1,7,7e3))}}function ai(t){t=Je(t),ii.sendMessage("urn:x-cast:com.google.shaka.v2",t,function(){},_)}function si(){this.ic=new gt,this.Gb=this}function oi(t,e,i){si.call(this),this.c=t,this.b=e,this.i=this.g=this.f=this.j=this.h=null,this.a=new ti(i,this.ag.bind(this),this.bg.bind(this),this.cg.bind(this),this.dg.bind(this),this.kd.bind(this)),function(t){for(var e in t.a.init(),t.i=new mt,je.forEach(function(t){vt(this.i,this.c,t,this.qg.bind(this))}.bind(t)),ze.forEach(function(t){vt(this.i,this.b,t,this.wf.bind(this))}.bind(t)),t.h={},t.c)Object.defineProperty(t.h,e,{configurable:!1,enumerable:!0,get:t.pg.bind(t,e),set:t.rg.bind(t,e)});for(e in t.j={},t.b)Object.defineProperty(t.j,e,{configurable:!1,enumerable:!0,get:t.vf.bind(t,e)});t.f=new si,t.f.Gb=t.h,t.g=new si,t.g.Gb=t.j}(this)}function li(t,e,i,n){var r,a;si.call(this),this.a=t,this.b=e,this.s={video:t,player:e},this.u=i||function(){},this.w=n||function(t){return t},this.o=!1,this.g=!0,this.f=0,this.m=!1,this.i=!0,this.j=this.h=this.c=null,r=this,(a=cast.receiver.CastReceiverManager.getInstance()).onSenderConnected=r.Cd.bind(r),a.onSenderDisconnected=r.Cd.bind(r),a.onSystemVolumeChanged=r.pe.bind(r),r.h=a.getCastMessageBus("urn:x-cast:com.google.cast.media"),r.h.onMessage=r.Se.bind(r),r.c=a.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),r.c.onMessage=r.hf.bind(r),a.start(),je.forEach(function(t){this.a.addEventListener(t,this.Gd.bind(this,"video"))}.bind(r)),ze.forEach(function(t){this.b.addEventListener(t,this.Gd.bind(this,"player"))}.bind(r)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?r.b.Sc(3840,2160):r.b.Sc(1920,1080),r.a.addEventListener("loadeddata",function(){this.m=!0}.bind(r)),r.b.addEventListener("loading",function(){this.g=!1,ui(this)}.bind(r)),r.a.addEventListener("playing",function(){this.g=!1,ui(this)}.bind(r)),r.a.addEventListener("pause",function(){ui(this)}.bind(r)),r.b.addEventListener("unloading",function(){this.g=!0,ui(this)}.bind(r)),r.a.addEventListener("ended",function(){g.setTimeout(function(){this.a&&this.a.ended&&(this.g=!0,ui(this))}.bind(this),5e3)}.bind(r))}function ui(t){Promise.resolve().then(function(){this.dispatchEvent(new Tt("caststatuschanged")),hi(this)||fi(this,0)}.bind(t))}function hi(t){return!(!t.i||!t.a.duration&&!t.b.T())&&(ci(t),!(t.i=!1))}function ci(t){fi(t,0,{contentId:t.b.xc(),streamType:t.b.T()?"LIVE":"BUFFERED",duration:t.a.duration,contentType:""})}function di(t,e,i,n){t.o&&(t=Je(e),n?i.getCastChannel(n).send(t):i.broadcast(t))}function fi(t,e,i){var n=t.a.playbackRate,r=pi;n={mediaSessionId:0,playbackRate:n,playerState:r=t.g?r.IDLE:t.b.rd()?r.de:t.a.paused?r.ee:r.fe,currentTime:t.a.currentTime,supportedMediaCommands:15,volume:{level:t.a.volume,muted:t.a.muted}},i&&(n.media=i),di(t,{requestId:e,type:"MEDIA_STATUS",status:[n]},t.h)}(e=ti.prototype).destroy=function(){return ri(this),ii&&ni(this),this.D=this.C=this.g=null,this.b=this.h=!1,this.o=this.m=this.f=this.c=this.a=this.i=null,Promise.resolve()},e.ea=function(){return this.b},e.Pc=function(){return this.w},e.init=function(){if(g.chrome&&chrome.cast&&chrome.cast.isAvailable){delete g.__onGCastApiAvailable,this.h=!0,this.g();var t=new chrome.cast.SessionRequest(this.G);t=new chrome.cast.ApiConfig(t,this.yd.bind(this),this.ef.bind(this),"origin_scoped"),chrome.cast.initialize(t,function(){},function(){}),ei&&setTimeout(this.g.bind(this),20),(t=ii)&&t.status!=chrome.cast.SessionStatus.STOPPED?this.yd(t):ii=null}else g.__onGCastApiAvailable=function(t){t&&this.init()}.bind(this)},e.Rc=function(t){this.i=t,this.b&&ai({type:"appData",appData:this.i})},e.cast=function(t){return this.h?ei?this.b?Promise.reject(new J(1,8,8002)):(this.f=new M,chrome.cast.requestSession(this.Lc.bind(this,t),this.wd.bind(this)),this.f):Promise.reject(new J(1,8,8001)):Promise.reject(new J(1,8,8e3))},e.Tb=function(){this.b&&(ri(this),ii&&(ni(this),ii.stop(function(){},function(){}),ii=null))},e.get=function(t,e){if("video"==t){if(0<=We.indexOf(e))return this.Jd.bind(this,t,e)}else if("player"==t){if(Ye[e]&&!this.get("player","isLive")())return function(){};if(0<=Ze.indexOf(e))return this.Jd.bind(this,t,e);if(0<=Qe.indexOf(e))return this.Df.bind(this,t,e);if(Ke[e])return this.Fd.bind(this,t,e)}return this.Fd(t,e)},e.set=function(t,e,i){ai({type:"set",targetName:t,property:e,value:this.a[t][e]=i})},e.Lc=function(t,e){(ii=e).addUpdateListener(this.m),e.addMessageListener("urn:x-cast:com.google.shaka.v2",this.o),this.xd(),ai({type:"init",initState:t,appData:this.i}),this.f.resolve()},e.wd=function(t){var e=8003;switch(t.code){case"cancel":e=8004;break;case"timeout":e=8005;break;case"receiver_unavailable":e=8006}this.f.reject(new J(2,8,e,t))},e.Fd=function(t,e){return this.a[t][e]},e.Jd=function(t,e){ai({type:"call",targetName:t,methodName:e,args:Array.prototype.slice.call(arguments,2)})},e.Df=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=new M,r=this.s.toString();return this.s++,this.c[r]=n,ai({type:"asyncCall",targetName:t,methodName:e,args:i,id:r}),n},e.yd=function(t){var e=this.u();this.f=new M,this.j=!0,this.Lc(e,t)},e.ef=function(t){ei="available"==t,this.g()},e.xd=function(){var t=!!ii&&"connected"==ii.status;if(this.b&&!t){for(var e in this.D(),this.a)this.a[e]={};ri(this)}this.w=(this.b=t)?ii.receiver.friendlyName:"",this.g()},e.Ye=function(t,e){var i=$e(e);switch(i.type){case"event":var n=i.targetName,r=i.event;this.C(n,new Tt(r.type,r));break;case"update":for(n in r=i.update)for(var a in i=this.a[n]||{},r[n])i[a]=r[n][a];this.j&&(this.I(),this.j=!1);break;case"asyncComplete":if(n=i.id,a=i.error,i=this.c[n],delete this.c[n],i)if(a){for(r in n=new J(a.severity,a.category,a.code),a)n[r]=a[r];i.reject(n)}else i.resolve()}},si.prototype.addEventListener=function(t,e){this.ic.push(t,e)},si.prototype.removeEventListener=function(t,e){this.ic.remove(t,e)},si.prototype.dispatchEvent=function(t){for(var e=this.ic.get(t.type)||[],i=0;i<e.length;++i){t.target=this.Gb,t.currentTarget=this.Gb;var n=e[i];try{n.handleEvent?n.handleEvent(t):n.call(this,t)}catch(t){}if(t.a)break}return t.defaultPrevented},f(oi,si),d("shaka.cast.CastProxy",oi),oi.prototype.destroy=oi.prototype.destroy=function(t){return t&&this.a&&this.a.Tb(),t=[this.i?this.i.destroy():null,this.b?this.b.destroy():null,this.a?this.a.destroy():null],this.a=this.i=this.j=this.h=this.b=this.c=null,Promise.all(t)},oi.prototype.getVideo=oi.prototype.Ke=function(){return this.h},oi.prototype.getPlayer=oi.prototype.Ae=function(){return this.j},oi.prototype.canCast=oi.prototype.je=function(){return!!this.a&&(this.a.h&&ei)},oi.prototype.isCasting=oi.prototype.ea=function(){return!!this.a&&this.a.ea()},oi.prototype.receiverName=oi.prototype.Pc=function(){return this.a?this.a.Pc():""},oi.prototype.cast=oi.prototype.cast=function(){var t=this.kd();return this.a.cast(t).then(function(){if(this.b)return this.b.ec()}.bind(this))},oi.prototype.setAppData=oi.prototype.Rc=function(t){this.a.Rc(t)},oi.prototype.suggestDisconnect=oi.prototype.hg=function(){var t=this.a;if(t.b){var e=t.u();chrome.cast.requestSession(t.Lc.bind(t,e),t.wd.bind(t))}},oi.prototype.forceDisconnect=oi.prototype.Tb=function(){this.a.Tb()},(e=oi.prototype).kd=function(){var i={video:{},player:{},playerAfterLoad:{},manifest:this.b.xc(),startTime:null};return this.c.pause(),Ve.forEach(function(t){i.video[t]=this.c[t]}.bind(this)),this.c.ended||(i.startTime=this.c.currentTime),Xe.forEach(function(t){var e=t[1];t=this.b[t[0]](),i.player[e]=t}.bind(this)),qe.forEach(function(t){var e=t[1];t=this.b[t[0]](),i.playerAfterLoad[e]=t}.bind(this)),i},e.ag=function(){this.dispatchEvent(new Tt("caststatuschanged"))},e.bg=function(){this.f.dispatchEvent(new Tt(this.h.paused?"pause":"play"))},e.dg=function(){Xe.forEach(function(t){var e=t[1];t=this.a.get("player",t[0])(),this.b[e](t)}.bind(this));var t=this.a.get("player","getManifestUri")(),e=this.a.get("video","ended"),i=Promise.resolve(),n=this.c.autoplay,r=null;e||(r=this.a.get("video","currentTime")),t&&(this.c.autoplay=!1,(i=this.b.load(t,r)).catch(function(t){this.b.dispatchEvent(new Tt("error",{detail:t}))}.bind(this)));var a={};Ve.forEach(function(t){a[t]=this.a.get("video",t)}.bind(this)),i.then(function(){this.c&&(Ve.forEach(function(t){this.c[t]=a[t]}.bind(this)),qe.forEach(function(t){var e=t[1];t=this.a.get("player",t[0])(),this.b[e](t)}.bind(this)),this.c.autoplay=n,t&&this.c.play())}.bind(this))},e.pg=function(t){if("addEventListener"==t)return this.f.addEventListener.bind(this.f);if("removeEventListener"==t)return this.f.removeEventListener.bind(this.f);if(this.a.ea()&&0==Object.keys(this.a.a.video).length){var e=this.c[t];if("function"!=typeof e)return e}return this.a.ea()?this.a.get("video",t):("function"==typeof(e=this.c[t])&&(e=e.bind(this.c)),e)},e.rg=function(t,e){this.a.ea()?this.a.set("video",t,e):this.c[t]=e},e.qg=function(t){this.a.ea()||this.f.dispatchEvent(new Tt(t.type,t))},e.vf=function(t){return"addEventListener"==t?this.g.addEventListener.bind(this.g):"removeEventListener"==t?this.g.removeEventListener.bind(this.g):"getMediaElement"==t?function(){return this.h}.bind(this):"getNetworkingEngine"==t?this.b.md.bind(this.b):"getManifest"==t?this.a.ea()?function(){return null}:this.b.ld.bind(this.b):this.a.ea()&&0==Object.keys(this.a.a.video).length&&Ke[t]||!this.a.ea()?(t=this.b[t]).bind(this.b):this.a.get("player",t)},e.wf=function(t){this.a.ea()||this.g.dispatchEvent(t)},e.cg=function(t,e){this.a.ea()&&("video"==t?this.f.dispatchEvent(e):"player"==t&&this.g.dispatchEvent(e))},f(li,si),d("shaka.cast.CastReceiver",li),li.prototype.isConnected=li.prototype.isConnected=function(){return this.o},li.prototype.isIdle=li.prototype.Me=function(){return this.g},li.prototype.destroy=li.prototype.destroy=function(){var t=this.b?this.b.destroy():Promise.resolve();return null!=this.j&&g.clearTimeout(this.j),this.u=this.s=this.b=this.a=null,this.o=!1,this.g=!0,this.j=this.h=this.c=null,t.then(function(){cast.receiver.CastReceiverManager.getInstance().stop()})},(e=li.prototype).Cd=function(){this.f=0,this.i=!0,this.o=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,ui(this)},e.Gd=function(t,e){this.b&&(this.Mc(),di(this,{type:"event",targetName:t,event:e},this.c))},e.Mc=function(){null!=this.j&&g.clearTimeout(this.j),this.j=g.setTimeout(this.Mc.bind(this),500);var e={video:{},player:{}};if(He.forEach(function(t){e.video[t]=this.a[t]}.bind(this)),this.b.T())for(var t in Ye){var i=Ye[t];0==this.f%i&&(e.player[t]=this.b[t]())}for(t in Ke)i=Ke[t],0==this.f%i&&(e.player[t]=this.b[t]());(t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(e.video.volume=t.level,e.video.muted=t.muted),this.m&&(this.f+=1),di(this,{type:"update",update:e},this.c),hi(this)},e.pe=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&di(this,{type:"update",update:{video:{volume:t.level,muted:t.muted}}},this.c),di(this,{type:"event",targetName:"video",event:{type:"volumechange"}},this.c)},e.hf=function(t){var e=$e(t.data);switch(e.type){case"init":this.f=0,this.m=!1,this.i=!0,function(t,i,e){for(var n in i.player)t.b[n](i.player[n]);t.u(e),e=Promise.resolve();var r=t.a.autoplay;i.manifest&&(t.a.autoplay=!1,(e=t.b.load(i.manifest,i.startTime)).catch(function(t){this.b.dispatchEvent(new Tt("error",{detail:t}))}.bind(t))),e.then(function(){for(var t in i.video){var e=i.video[t];this.a[t]=e}for(t in i.playerAfterLoad)e=i.playerAfterLoad[t],this.b[t](e);this.a.autoplay=r,i.manifest&&(this.a.play(),fi(this,0))}.bind(t))}(this,e.initState,e.appData),this.Mc();break;case"appData":this.u(e.appData);break;case"set":var i=e.targetName,n=e.property,r=e.value;if("video"==i){if(e=cast.receiver.CastReceiverManager.getInstance(),"volume"==n){e.setSystemVolumeLevel(r);break}if("muted"==n){e.setSystemVolumeMuted(r);break}}this.s[i][n]=r;break;case"call":i=e.targetName,n=e.methodName,r=e.args;var a=this.s[i];a[n].apply(a,r);break;case"asyncCall":i=e.targetName,n=e.methodName,"player"==i&&"load"==n&&(this.f=0,this.m=!1),r=e.args,e=e.id,t=t.senderId,r=(a=this.s[i])[n].apply(a,r),"player"==i&&"load"==n&&(r=r.then(function(){this.i=!0}.bind(this))),r.then(this.Od.bind(this,t,e,null),this.Od.bind(this,t,e))}},e.Se=function(t){var i=$e(t.data);switch(i.type){case"PLAY":this.a.play(),fi(this,0);break;case"PAUSE":this.a.pause(),fi(this,0);break;case"SEEK":t=i.currentTime;var e=i.resumeState;null!=t&&(this.a.currentTime=Number(t)),e&&"PLAYBACK_START"==e?(this.a.play(),fi(this,0)):e&&"PLAYBACK_PAUSE"==e&&(this.a.pause(),fi(this,0));break;case"STOP":this.b.ec().then(function(){this.b&&fi(this,0)}.bind(this));break;case"GET_STATUS":fi(this,Number(i.requestId));break;case"VOLUME":t=(e=i.volume).level,e=e.muted;var n=this.a.volume,r=this.a.muted;null!=t&&(this.a.volume=Number(t)),null!=e&&(this.a.muted=e),n==this.a.volume&&r==this.a.muted||fi(this,0);break;case"LOAD":this.f=0,this.i=this.m=!1,e=i.media.contentId,t=i.currentTime,e=this.w(e),this.a.autoplay=!0,this.b.load(e,t).then(function(){this.b&&ci(this)}.bind(this)).catch(function(t){var e="LOAD_FAILED";7==t.category&&7e3==t.code&&(e="LOAD_CANCELLED"),di(this,{requestId:Number(i.requestId),type:e},this.h)}.bind(this));break;default:di(this,{requestId:Number(i.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.h)}},e.Od=function(t,e,i){this.b&&di(this,{type:"asyncComplete",id:e,error:i},this.c,t)};var pi={IDLE:"IDLE",fe:"PLAYING",de:"BUFFERING",ee:"PAUSED"};function gi(t,e){var i=mi(t,e);return 1!=i.length?null:i[0]}function mi(t,e){return Array.prototype.filter.call(t.childNodes,function(t){return t instanceof Element&&t.tagName==e})}function vi(t){var e=t.firstChild;return e&&e.nodeType==Node.TEXT_NODE?t.textContent.trim():null}function yi(t,e,i,n){var r=null;return null!=(t=t.getAttribute(e))&&(r=i(t)),null==r?null!=n?n:null:r}function bi(t){return t?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t)&&(t+="Z"),t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null}function _i(t){return t&&(t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(t))?(t=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(t)?t:null):null}function Ti(t){var e=/([0-9]+)-([0-9]+)/.exec(t);return e?(t=Number(e[1]),isFinite(t)?(e=Number(e[2]),isFinite(e)?{start:t,end:e}:null):null):null}function Ei(t){return 0==(t=Number(t))%1?t:null}function Si(t){return 0==(t=Number(t))%1&&0<t?t:null}function wi(t){return 0==(t=Number(t))%1&&0<=t?t:null}function ki(t){var e;return t=(e=t.match(/^(\d+)\/(\d+)$/))?Number(e[1]/e[2]):Number(t),isNaN(t)?null:t}var Ai={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"};function Li(t,e,i){t=t.map(function(t){var e,i=t.getAttribute("schemeIdUri"),n=t.hasAttributeNS("urn:mpeg:cenc:2013","default_KID")?t.getAttributeNS("urn:mpeg:cenc:2013","default_KID"):null,r=(e=t,Array.prototype.filter.call(e.childNodes,function(t){return t instanceof Element&&"pssh"==t.localName&&"urn:mpeg:cenc:2013"==t.namespaceURI})).map(vi);if(!i)return null;if(i=i.toLowerCase(),n&&0<=(n=n.replace(/-/g,"").toLowerCase()).indexOf(" "))throw new J(2,4,4009);var a=[];try{a=r.map(function(t){return{initDataType:"cenc",initData:Ut(t),keyId:null}})}catch(t){throw new J(2,4,4007)}return{node:t,Nd:i,keyId:n,init:0<a.length?a:null}}).filter(et);var n,r,a=null,s=[],o=[],l=t.map(function(t){return t.keyId}).filter(et);if(l.length&&1<l.filter(it).length)throw new J(2,4,4010);i||(o=t.filter(function(t){return"urn:mpeg:dash:mp4protection:2011"!=t.Nd||(a=t.init||a,!1)})).length&&(n=a,r=e,0==(s=o.map(function(t){var e=Ai[t.Nd];return e?[St(e,t.init||n)]:r(t.node)||[]}).reduce($,[])).length&&(s=[St("",a)])),!t.length||!i&&o.length||(s=At(Ai).filter(function(t){return"org.w3.clearkey"!=t}).map(function(t){return St(t,a)}));var u=l[0]||null;return u&&s.forEach(function(t){t.initData.forEach(function(t){t.keyId=u})}),{ed:u,wg:a,drmInfos:s,jd:!0}}function Pi(t,e,i,n,r){null!=r&&(r=Math.round(r));var a={RepresentationID:e,Number:i,Bandwidth:n,Time:r};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(t,e,i,n){if("$$"==t)return"$";var r=a[e];if(null==r)return t;switch("RepresentationID"==e&&i&&(i=void 0),n){case void 0:case"d":case"i":case"u":t=r.toString();break;case"o":t=r.toString(8);break;case"x":t=r.toString(16);break;case"X":t=r.toString(16).toUpperCase();break;default:t=r.toString()}return i=g.parseInt(i,10)||1,Array(Math.max(0,i-t.length)+1).join("0")+t})}function Ci(t,e){var i=xi(t,e,"timescale"),n=1;i&&(n=Si(i)||1),(i=Si((i=xi(t,e,"duration"))||""))&&(i/=n);var r=xi(t,e,"startNumber"),a=Number(xi(t,e,"presentationTimeOffset"))||0,s=wi(r||"");null!=r&&null!=s||(s=1);var o=Ii(t,e,"SegmentTimeline");if(r=null,o){r=n;var l=t.R.duration||1/0;o=mi(o,"S");for(var u=[],h=0,c=0;c<o.length;++c){var d=o[c],f=yi(d,"t",wi),p=yi(d,"d",wi);if(d=yi(d,"r",Ei),null!=f&&(f-=a),!p)break;if(f=null!=f?f:h,(d=d||0)<0)if(c+1<o.length){if(null==(d=yi(o[c+1],"t",wi)))break;if(d<=f)break;d=Math.ceil((d-f)/p)-1}else{if(1/0==l)break;if(l<=f/r)break;d=Math.ceil((l*r-f)/p)-1}0<u.length&&f!=h&&(u[u.length-1].end=f/r);for(var g=0;g<=d;++g)h=f+p,u.push({start:f/r,end:h/r,mg:f}),f=h}r=u}return{timescale:n,Y:i,Ta:s,ga:a/n||0,Eb:a,l:r}}function xi(t,e,i){return[e(t.B),e(t.P),e(t.J)].filter(et).map(function(t){return t.getAttribute(i)}).reduce(function(t,e){return t||e})}function Ii(t,e,i){return[e(t.B),e(t.P),e(t.J)].filter(et).map(function(t){return gi(t,i)}).reduce(function(t,e){return t||e})}function Ri(t,e,i){this.a=t,this.c=e,this.b=i}function Di(t,e,i,n,r,a){this.position=t,this.startTime=e,this.endTime=i,this.a=n,this.c=r,this.b=a}function Ni(t,e){this.K=t,this.b=e==Mi,this.a=0}d("shaka.media.InitSegmentReference",Ri),Ri.prototype.createUris=Ri.prototype.mc=function(){return this.a()},Ri.prototype.getStartByte=Ri.prototype.yc=function(){return this.c},Ri.prototype.getEndByte=Ri.prototype.vc=function(){return this.b},d("shaka.media.SegmentReference",Di),Di.prototype.getPosition=Di.prototype.da=function(){return this.position},Di.prototype.getStartTime=Di.prototype.nd=function(){return this.startTime},Di.prototype.getEndTime=Di.prototype.we=function(){return this.endTime},Di.prototype.createUris=Di.prototype.mc=function(){return this.a()},Di.prototype.getStartByte=Di.prototype.yc=function(){return this.c},Di.prototype.getEndByte=Di.prototype.vc=function(){return this.b},d("shaka.util.DataViewReader",Ni);var Oi,Mi=1;function Ui(){throw new J(2,3,3e3)}function Fi(){this.c=[],this.b=[],this.a=!1}function Bi(t){for(;t.A.pa()&&!t.fb.a;)t.fb.ac(t.start,t.A,t.Ed)}function Gi(t){for(var e=t.A.H();0<e&&!t.fb.a;--e)t.fb.ac(t.start,t.A,t.Ed)}function ji(e){return function(t){e(t.A.Ra(t.A.K.byteLength-t.A.da()))}}function Hi(t){for(var e=0,i=0;i<t.length;i++)e=e<<8|t.charCodeAt(i);return e}function Vi(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}function Wi(t,e,i,n){var r,a=(new Fi).na("sidx",function(t){r=function(t,e,i,n){var r=[];n.A.L(4);var a=n.A.H();if(0==a)throw new J(2,3,3005);if(0==n.version)var s=n.A.H(),o=n.A.H();else s=n.A.yb(),o=n.A.yb();n.A.L(2);var l=n.A.Id();for(t=t+n.size+o,o=0;o<l;o++){var u=n.A.H(),h=(2147483648&u)>>>31;u&=2147483647;var c=n.A.H();if(n.A.L(4),1==h)throw new J(2,3,3006);r.push(new Di(r.length,s/a-e,(s+c)/a-e,function(){return i},t,t+u-1)),s+=c,t+=u}return n.fb.stop(),r}(e,n,i,t)});if(t&&a.parse(t),r)return r;throw new J(2,3,3004)}function zi(t){this.a=t,this.b=null}function Ki(t,e){for(;t.a.length;){var i=t.a[t.a.length-1];if(!(i.startTime>=e))break;t.a.pop()}for(;t.a.length&&(i=t.a[0]).endTime<=0;)t.a.shift();0!=t.a.length&&((i=t.a[0]).startTime<wt&&(t.a[0]=new Di(i.position,0,i.endTime,i.a,i.c,i.b)),i=t.a[t.a.length-1],t.a[t.a.length-1]=new Di(i.position,i.startTime,e,i.a,i.c,i.b))}function Yi(t){this.b=t,this.a=new Ni(t,0),Oi||(Oi=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function Xi(t){var e=qi(t);if(7<e.length)throw new J(2,3,3002);for(var i=0,n=0;n<e.length;n++)i=256*i+e[n];e=i,i=qi(t);t:{for(n=0;n<Oi.length;n++)if(Gt(i,Oi[n])){n=!0;break t}n=!1}if(n)i=t.b.byteLength-t.a.da();else{if(8==i.length&&224&i[1])throw new J(2,3,3001);n=i[0]&(1<<8-i.length)-1;for(var r=1;r<i.length;r++)n=256*n+i[r];i=n}return i=t.a.da()+i<=t.b.byteLength?i:t.b.byteLength-t.a.da(),n=new DataView(t.b.buffer,t.b.byteOffset+t.a.da(),i),t.a.L(i),new Zi(e,n)}function qi(t){var e,i=t.a.Oc();for(e=1;e<=8&&!(i&1<<8-e);e++);if(8<e)throw new J(2,3,3002);var n=new Uint8Array(e);for(n[0]=i,i=1;i<e;i++)n[i]=t.a.Oc();return n}function Zi(t,e){this.id=t,this.a=e}function Qi(t){if(8<t.a.byteLength)throw new J(2,3,3002);if(8==t.a.byteLength&&224&t.a.getUint8(0))throw new J(2,3,3001);for(var e=0,i=0;i<t.a.byteLength;i++){e=256*e+t.a.getUint8(i)}return e}function Ji(){}function $i(t){var e=new Yi(t.a);if(179!=(t=Xi(e)).id)throw new J(2,3,3013);if(t=Qi(t),183!=(e=Xi(e)).id)throw new J(2,3,3012);e=new Yi(e.a);for(var i=0;e.pa();){var n=Xi(e);if(241==n.id){i=Qi(n);break}}return{ng:t,Cf:i}}function tn(t,e){var i=Ii(t,e,"Initialization");if(!i)return null;var n=t.B.ka,r=i.getAttribute("sourceURL");r&&(n=Et(t.B.ka,[r])),r=0;var a=null;return(i=yi(i,"range",Ti))&&(r=i.start,a=i.end),new Ri(function(){return n},r,a)}function en(t,e,i,n,r,a,s,o){var l=t.presentationTimeline,u=!t.ma||!t.R.Dc,h=t.R.start,c=t.R.duration,d=e,f=null;return{createSegmentIndex:function(){var t=[d(n,r,a),"webm"==s?d(i.a(),i.c,i.b):null];return d=null,Promise.all(t).then(function(t){var e=t[0];t=t[1]||null,e="mp4"==s?Wi(e,r,n,o):(new Ji).parse(e,t,n,o),l.$b(e,h),f=new zi(e),u&&Ki(f,c)})},findSegmentPosition:function(t){return f.find(t)},getSegmentReference:function(t){return f.get(t)}}}function nn(t){return t.zb}function rn(t,e){var i,n=tn(t,an),r=[(i=t).B.xa,i.P.xa,i.J.xa].filter(et).map(function(t){return mi(t,"SegmentURL")}).reduce(function(t,e){return 0<t.length?t:e}).map(function(t){t.getAttribute("indexRange")&&!i.qd&&(i.qd=!0);var e=t.getAttribute("media");return t=yi(t,"mediaRange",Ti,{start:0,end:null}),{Oe:e,start:t.start,end:t.end}}),a=Ci(t,an),s=a.Ta;0==s&&(s=1);var o=0;if(a.Y?o=a.Y*(s-1):a.l&&0<a.l.length&&(o=a.l[0].start),!(r={Y:a.Y,startTime:o,Ta:s,ga:a.ga,l:a.l,cb:r}).Y&&!r.l&&1<r.cb.length)throw new J(2,4,4002);if(!r.Y&&!t.R.duration&&!r.l&&1==r.cb.length)throw new J(2,4,4002);if(r.l&&0==r.l.length)throw new J(2,4,4002);return s=a=null,t.J.id&&t.B.id&&(a=e[s=t.J.id+","+t.B.id]),o=function(t,e,i,n){var r=n.cb.length;n.l&&n.l.length!=n.cb.length&&(r=Math.min(n.l.length,n.cb.length));for(var a=[],s=n.startTime,o=0;o<r;o++){var l=n.cb[o],u=Et(i,[l.Oe]),h=null!=n.Y?s+n.Y:n.l?n.l[o].end:s+t;a.push(new Di(o+e,s,h,function(t){return t}.bind(null,u),l.start,l.end)),s=h}return a}(t.R.duration,r.Ta,t.B.ka,r),a?(a.Ma(o),s=t.presentationTimeline.Wb(),a.qc(s-t.R.start)):(t.presentationTimeline.$b(o,t.R.start),a=new zi(o),s&&t.ma&&(e[s]=a)),t.ma&&t.R.Dc||Ki(a,t.R.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:a.find.bind(a),getSegmentReference:a.get.bind(a),initSegmentReference:n,ga:r.ga}}function an(t){return t.xa}function sn(t,e,i,n,r){var a,s,o,l,u,h,c,d,f,p,g=function(t){var e=xi(t,on,"initialization");if(!e)return null;var i=t.B.id,n=t.bandwidth||null,r=t.B.ka;return new Ri(function(){var t=Pi(e,i,null,n,null);return Et(r,[t])},0,null)}(t),m=Ci(t,on),v=xi(t,on,"media"),y=xi(t,on,"index");if(v=(m={Y:m.Y,timescale:m.timescale,Ta:m.Ta,ga:m.ga,Eb:m.Eb,l:m.l,Gc:v,vb:y}).vb?1:0,v+=m.l?1:0,0==(v+=m.Y?1:0))throw new J(2,4,4002);if(1!=v&&(m.vb&&(m.l=null),m.Y=null),!m.vb&&!m.Gc)throw new J(2,4,4002);if(m.vb){if("mp4"!=(i=t.B.mimeType.split("/")[1])&&"webm"!=i)throw new J(2,4,4006);if("webm"==i&&!g)throw new J(2,4,4005);r=Pi(m.vb,t.B.id,null,t.bandwidth||null,null),t=en(t,e,g,r=Et(t.B.ka,[r]),0,null,i,m.ga)}else if(m.Y)n||t.presentationTimeline.Ic(m.Y),s=m,o=(a=t).R.duration,l=s.Y,u=s.Ta,h=s.timescale,c=s.Gc,d=a.bandwidth||null,f=a.B.id,p=a.B.ka,t={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return t<0||o&&o<=t?null:Math.floor(t/l)},getSegmentReference:function(e){var i=e*l,t=i+l;return o&&(t=Math.min(t,o)),t<0||o&&o<=i?null:new Di(e,i,t,function(){var t=Pi(c,f,e+u,d,i*h);return Et(p,[t])},0,null)}};else{if(n=e=null,t.J.id&&t.B.id&&(e=i[n=t.J.id+","+t.B.id]),v=function(t,e){for(var i=[],n=0;n<e.l.length;n++){var r=n+e.Ta;i.push(new Di(r,e.l[n].start,e.l[n].end,function(t,e,i,n,r,a){return t=Pi(t,e,r,i,a),Et(n,[t]).map(function(t){return t.toString()})}.bind(null,e.Gc,t.B.id,t.bandwidth||null,t.B.ka,r,e.l[n].mg+e.Eb),0,null))}return i}(t,m),y=!t.ma||!t.R.Dc,e?(ln(t,v,m.Eb/m.timescale,r),y&&"video"===t.B.contentType&&Ki(new zi(v),t.R.duration),i=t.presentationTimeline.Wb(),0<v.length&&(i=v[0].startTime),e.Ma(v),e.qc(i-t.R.start)):("metadata"!==t.P.contentType&&t.presentationTimeline.$b(v,t.R.start),e=new zi(v),n&&t.ma&&(i[n]=e),e.Rd(n),ln(t,v,m.Eb/m.timescale,r)),!0===t.ma&&t.ib)for(i=0;i<v.length;i++)if(0!==i){r=v[i];var b=v[i-1];r.startTime-b.endTime>wt&&(r={type:"innerPeriod",id:n+","+b.endTime,periodId:t.J.id?t.J.id:"",start:b.endTime,end:r.startTime},null===(b=t.ib.Ub)[r.id]&&(b[r.id]=r))}y&&Ki(e,t.R.duration),t={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:e.find.bind(e),getSegmentReference:e.get.bind(e)}}return{createSegmentIndex:t.createSegmentIndex,findSegmentPosition:t.findSegmentPosition,getSegmentReference:t.getSegmentReference,initSegmentReference:g,ga:m.ga}}function on(t){return t.Ab}function ln(t,e,i,n){if(t.ib&&t.J.id&&0<e.length&&n&&("video"===t.B.contentType||"audio"==t.B.contentType)){n=t.ib;var r=t.J.id,a=e[0].startTime+i;e=e[e.length-1].endTime+i,i=t.be.Yb,t=t.B.contentType;for(var s=null,o=0;o<n.g.length;o++)if(r===n.g[o].id){s=n.g[o],"audio"===t?(s.Pb=a,s.Ob=e,-1===s.Bc&&(s.Bc=a)):(s.gc=a,s.fc=e,-1===s.Cc&&(s.Cc=a)),s.Yb=i;break}null===s&&(r={id:r,Pb:-1,Ob:-1,gc:-1,fc:-1,Bc:-1,Cc:-1,Yb:i},"audio"===t?(r.Pb=a,r.Ob=e,r.Bc=a):(r.gc=a,r.fc=e,r.Cc=a),n.g.push(r))}}Ni.Endianness={sg:0,tg:Mi},Ni.prototype.hasMoreData=Ni.prototype.pa=function(){return this.a<this.K.byteLength},Ni.prototype.getPosition=Ni.prototype.da=function(){return this.a},Ni.prototype.getLength=Ni.prototype.xe=function(){return this.K.byteLength},Ni.prototype.readUint8=Ni.prototype.Oc=function(){try{var t=this.K.getUint8(this.a);return this.a+=1,t}catch(t){Ui()}},Ni.prototype.readUint16=Ni.prototype.Id=function(){try{var t=this.K.getUint16(this.a,this.b);return this.a+=2,t}catch(t){Ui()}},Ni.prototype.readUint32=Ni.prototype.H=function(){try{var t=this.K.getUint32(this.a,this.b);return this.a+=4,t}catch(t){Ui()}},Ni.prototype.readInt32=Ni.prototype.Hd=function(){try{var t=this.K.getInt32(this.a,this.b);return this.a+=4,t}catch(t){Ui()}},Ni.prototype.readUint64=Ni.prototype.yb=function(){try{if(this.b)var t=this.K.getUint32(this.a,!0),e=this.K.getUint32(this.a+4,!0);else e=this.K.getUint32(this.a,!1),t=this.K.getUint32(this.a+4,!1)}catch(t){Ui()}if(2097151<e)throw new J(2,3,3001);return this.a+=8,e*Math.pow(2,32)+t},Ni.prototype.readBytes=Ni.prototype.Ra=function(t){this.a+t>this.K.byteLength&&Ui();var e=new Uint8Array(this.K.buffer,this.K.byteOffset+this.a,t);return this.a+=t,new Uint8Array(e)},Ni.prototype.skip=Ni.prototype.L=function(t){this.a+t>this.K.byteLength&&Ui(),this.a+=t},Ni.prototype.rewind=Ni.prototype.If=function(t){this.a<t&&Ui(),this.a-=t},Ni.prototype.seek=Ni.prototype.seek=function(t){(t<0||t>this.K.byteLength)&&Ui(),this.a=t},Ni.prototype.readTerminatedString=Ni.prototype.Nc=function(){for(var t=this.a;this.pa()&&0!=this.K.getUint8(this.a);)this.a+=1;return t=new Uint8Array(this.K.buffer,this.K.byteOffset+t,this.a-t),this.a+=1,Ct(t)},Ni.prototype.rewindToBegin=Ni.prototype.Jf=function(){this.a=0},d("shaka.util.Mp4Parser",Fi),Fi.prototype.box=Fi.prototype.M=function(t,e){var i=Hi(t);return this.c[i]=0,this.b[i]=e,this},Fi.prototype.fullBox=Fi.prototype.na=function(t,e){var i=Hi(t);return this.c[i]=1,this.b[i]=e,this},Fi.prototype.stop=Fi.prototype.stop=function(){this.a=!0},Fi.prototype.parse=Fi.prototype.parse=function(t,e){var i=new Uint8Array(t);for(i=new Ni(new DataView(i.buffer,i.byteOffset,i.byteLength),0),this.a=!1;i.pa()&&!this.a;)this.ac(0,i,e)},Fi.prototype.parseNext=Fi.prototype.ac=function(t,e,i){var n=e.da(),r=e.H(),a=e.H();switch(r){case 0:r=e.K.byteLength-n;break;case 1:r=e.yb()}var s=this.b[a];if(s){var o=null,l=null;1==this.c[a]&&(o=(l=e.H())>>>24,l&=16777215),a=n+r,i&&a>e.K.byteLength&&(a=e.K.byteLength),e=0<(a-=e.da())?e.Ra(a):new Uint8Array(0),s({fb:this,Ed:i||!1,version:o,flags:l,A:e=new Ni(new DataView(e.buffer,e.byteOffset,e.byteLength),0),size:r,start:n+t})}else e.L(n+r-e.da())},Fi.children=Bi,Fi.sampleDescription=Gi,Fi.allData=ji,Fi.typeToString=Vi,d("shaka.media.SegmentIndex",zi),zi.prototype.destroy=zi.prototype.destroy=function(){return this.a=null,Promise.resolve()},zi.prototype.find=zi.prototype.find=function(t){for(var e=this.a.length-1;0<=e;--e){var i=this.a[e];if(t>=i.startTime&&t<i.endTime)return i.position}return this.a.length&&t<this.a[0].startTime||this.a.length&&t<this.a[0].startTime?this.a[0].position:null},zi.prototype.get=zi.prototype.get=function(t){return 0==this.a.length?null:(t-=this.a[0].position)<0||t>=this.a.length?null:this.a[t]},zi.prototype.offset=zi.prototype.offset=function(t){for(var e=0;e<this.a.length;++e)this.a[e].startTime+=t,this.a[e].endTime+=t},zi.prototype.merge=zi.prototype.Ma=function(t){for(var e=[],i=0,n=0;i<this.a.length&&n<t.length;){var r=this.a[i],a=t[n];r.startTime<a.startTime?(e.push(r),i++):(r.startTime>a.startTime?0==i&&e.push(a):(.1<Math.abs(r.endTime-a.endTime)?(a=new Di(r.position,a.startTime,a.endTime,a.a,a.c,a.b),e.push(a)):e.push(r),i++),n++)}for(;i<this.a.length;)e.push(this.a[i++]);if(e.length)for(i=e[e.length-1].position+1;n<t.length;)a=new Di(i++,(a=t[n++]).startTime,a.endTime,a.a,a.c,a.b),e.push(a);else e=t;this.a=e},zi.prototype.evict=zi.prototype.qc=function(t){for(var e=0;e<this.a.length;++e)if(this.a[e].endTime>t)return void this.a.splice(0,e);this.a=[]},zi.prototype.duration=zi.prototype.duration=function(){return 0==this.a.length?0:this.a[this.a.length-1].endTime-this.a[0].startTime},zi.prototype.setDebugId=zi.prototype.Rd=function(t){this.b=t},zi.prototype.getDebugId=zi.prototype.ue=function(){return this.b},zi.prototype.isLast=zi.prototype.Ne=function(t){var e=!1;if(0<this.a.length){var i=this.a[this.a.length-1];i.startTime==t.startTime&&i.endTime==t.endTime&&(e=!0)}return e},Yi.prototype.pa=function(){return this.a.pa()},Ji.prototype.parse=function(t,e,i,n){var r;if(440786851!=Xi(e=new Yi(new DataView(e))).id)throw new J(2,3,3008);var a=Xi(e);if(408125543!=a.id)throw new J(2,3,3009);for(e=a.a.byteOffset,a=new Yi(a.a),r=null;a.pa();){var s=Xi(a);if(357149030==s.id){r=s;break}}if(!r)throw new J(2,3,3010);for(a=new Yi(r.a),r=1e6,s=null;a.pa();){var o=Xi(a);if(2807729==o.id)r=Qi(o);else if(17545==o.id)if(4==(s=o).a.byteLength)s=s.a.getFloat32(0);else{if(8!=s.a.byteLength)throw new J(2,3,3003);s=s.a.getFloat64(0)}}if(null==s)throw new J(2,3,3011);if(r=s*(a=r/1e9),475249515!=(t=Xi(new Yi(new DataView(t)))).id)throw new J(2,3,3007);return function(t,e,i,n,r,a){function s(){return r}var o=[];t=new Yi(t.a);for(var l=null,u=null;t.pa();){var h=Xi(t);if(187==h.id){var c=$i(h);c&&(h=i*c.ng,c=e+c.Cf,null!=l&&o.push(new Di(o.length,l-a,h-a,s,u,c-1)),l=h,u=c)}}return null!=l&&o.push(new Di(o.length,l-a,n-a,s,u,null)),o}(t,e,a,r,i,n)};var un={},hn={};function cn(t,e){this.b=t,this.m=e,this.f=this.c=1/0,this.a=1,this.g=this.h=null,this.j=0,this.o=!0,this.i=0}function dn(){this.f=this.c=this.b=this.a=this.l=this.periodId=this.id=null,this.clear()}function fn(t,e){var i={nb:!1,$:[],Rb:[],dc:[],V:-1};return gn(t,i,e),i}function pn(t,e,i){var n={nb:!1,$:[],Rb:[],dc:[],V:-1};return t.l.F&&((0<=(e-=t.l.F)||e<0&&Math.abs(e)<=.3||i)&&mn(t,n,i)),n}function gn(t,e,i){(!1===t.c.Ya||i)&&(e.nb=!0,i=[],0<t.a.pc.length&&(i=i.concat(t.a.pc)),0<t.a.Ac.length&&(i=i.concat(t.a.Ac)),0<t.a.nc.length&&(i=i.concat(t.a.nc)),0<t.a.start.length&&(i=i.concat(t.a.start)),0<t.a.Db.length&&!0===t.b.Ia&&(i=i.concat(t.a.Db)),e.$=i,0<t.a.oc.length&&(e.Rb=t.a.oc),0<t.a.Yc.length&&(e.dc=t.a.Yc),t.c.Ya=!0,e.V=0)}function mn(t,e,i){!0===t.c.Ya&&((!1===t.c.dd||i)&&(i=[],0<t.a.complete.length&&(i=i.concat(t.a.complete)),0<t.a.ia.length&&!0===t.b.Ka&&(i=i.concat(t.a.ia)),t.c.dd=!0,e.V=1,e.$=e.$.concat(i)),e.nb=!0)}function vn(t,e){"start"===e?t.f.bd=!0:t.f.end=!0}function yn(t,e){return t.periodId===e.periodId&&t.id===e.id}function bn(t,e){t.periodId===e.periodId&&t.id===e.id&&(t.l&&e.l&&(t.l.F!==e.l.F&&(t.l.F=e.l.F),t.l.ia!==e.l.ia&&(t.l.ia=e.l.ia),t.l.za!==e.l.za&&(t.l.za=e.l.za)),t.b&&e.b&&(t.b.Xa!==e.b.Xa&&(t.b.Xa=e.b.Xa),t.b.Ia!==e.b.Ia&&(t.b.Ia=e.b.Ia),t.b.ab!==e.b.ab&&(t.b.ab=e.b.ab),t.b.Ka!==e.b.Ka&&(t.b.Ka=e.b.Ka)))}function _n(t){this.a={};var e=0;do{var i=Tn(t,e,3);if(e+=3,"ID3"===i){e+=3;var n=127&t[e++];i=127&t[e++];var r=127&t[e++],a=127&t[e++];if(n=(n<<21)+(i<<14)+(r<<7)+a,i=t,e+8<=(a=n=e+n))switch(r=Tn(i,e,4),e+=4,this.a.key=r,r){case"GEOB":if("application/xml"==Tn(i,e+=7,15)&&("substitution.plist"==Tn(i,e+=16,18)&&(e=Tn(i,e+=20,a-e),1<(e=(new DOMParser).parseFromString(e,"application/xml")).getElementsByTagName("dict").length))){for(i=e.getElementsByTagName("dict")[1].childNodes,e=[],r=0;r<i.length;r++)1==i[r].nodeType&&i[r].nodeName&&e.push({node:i[r].nodeName,value:i[r].textContent.trim()});for(i=0;i<e.length;i++)r=i++,this.a[e[r].value]=e[i].value}break;case"PRIV":e++,e++,e++,e++,e++,"com.apple.streaming.transportStreamTimestamp"===Tn(i,++e,44)?(e+=48,r=1&i[e++],e=((i[e++]<<23)+(i[e++]<<15)+(i[e++]<<7)+i[e++])/45,r&&(e+=4294967296),e=Math.round(e),this.a.info=e,this.a.type="transportStreamTimestamp"):(this.a.info=Tn(i,e,a-e-2),this.a.type="data");break;default:this.a.info="Unknown"}e=n}else{if("3DI"!==i)break;e=n}}while(e<n)}function Tn(t,e,i){var n="",r=e;for(e+=i;n+=String.fromCharCode(t[r++]),r<e;);return n}function En(){this.media=this.h=null,this.a=[],this.b=[],this.c=null,this.j=1.2,this.g=this.f=this.C=null,this.m=this.s=this.o=!1,this.i=this.D=this.w=null,null===this.i&&(this.i=setTimeout(this.G.bind(this),2e3))}function Sn(t){for(var e=0;e<t.length;e++);}function wn(t,e){if(null!=t.c){var i=pn(t.c,e,!1);if(1===i.V){var n=t.c.l;-1!==(n={startTime:n.F?n.F:-1,type:"stop",id:t.c.id?t.c.id:"",duration:0,timeLeft:0}).startTime&&kn(t,i,n,t.c,!0),t.c=null}}}function kn(t,e,i,n,r){var a=An(e,i.id,i.type);t.D=i.startTime;var s=!0;if("ADSTART"===a.uploadType||"ADEND"===a.uploadType)if(r?("ADSTART"===a.uploadType&&(s=t.media.currentTime<n.l.S-.15),"ADEND"===a.uploadType&&(s=t.media.currentTime<n.l.F-.15)):s=t.media.currentTime<n.l.F,!s&&r)Pn(t,i.startTime,n.id,a);else{r=i.startTime;var o=n.id,l=e.V,u=n.periodId,h=new(g.WebKitDataCue||g.VTTCue||g.TextTrackCue)(r,r+t.j,"");h.value="type=uploadAd. time="+r,h.adEvents=a,h.noticed=!1,h.lastNoticeTime=null,h.stage=l,h.trackId=o,h.adType="upload",h.periodId=u,t.h.addCue(h)}0<e.$.length&&s&&(i=i.startTime,n=n.id,(a=new(g.WebKitDataCue||g.VTTCue||g.TextTrackCue)(i,i+t.j,"")).value="type=innerAd. time="+i,a.adType="inner",a.trackId=n,a.stage=e.V,a.adEvents=e.$,a.noticed=!1,a.lastNoticeTime=null,t.h.addCue(a))}function An(t,e,i){var n={adId:"",uploadType:"UNKNOWN",urls:[]};return e&&(0===t.V&&(n.adId=e,n.uploadType="ADSTART",t.Rb.forEach(function(t){n.urls.push({type:"defaultClick",url:t})}),t.dc.forEach(function(t){n.urls.push({type:"trackClick",url:t})})),1===t.V||"PostStop"===i)&&(n.adId=e,n.uploadType="ADEND"),n}function Ln(t,e,i,n){for(var r=null,a=t.a.length-1;0<=a;a--)if(e===t.a[a].id){var s=null,o=i.toLowerCase();if("poststop"!==o&&"prestart"!==o){var l=t.w.a;if(l)for(var u=l.length-1;0<=u;u--)if("start"===o){if(Math.abs(n-l[u].start)<=.1){s=l[u].id;break}}else if("keep"===o){if(n>l[u].start-.05&&n<l[u].end+.05){s=l[u].id;break}}else if("stop"===o&&Math.abs(n-l[u].end)<=.1){s=l[u].id;break}}if(s){if(s===t.a[a].periodId){r=t.a[a];break}}else if(s=t.a[a].l.F+.05,n>=t.a[a].l.S-.05&&n<=s){r=t.a[a];break}}return r}function Pn(t,e,i,n){if(t.f&&i){var r="ADEND"===n.uploadType?"end":"ADSTART"===n.uploadType?"start":"";(e=Ln(t,i,r,e))&&""!==r&&(vn(e,r),t.f.onEvent(new Tt("advertisement",{detail:n})))}}function Cn(t){if(t.f){if(0<t.b.length){var i=[];t.b.forEach(function(t){var e=[];0<t.a.Db.length&&(e=e.concat(t.a.Db)),0<t.a.ia.length&&(e=e.concat(t.a.ia)),i.push({type:"dash",time:t.l.S,urls:e})}),t.f.onEvent(new Tt("emptyAdPost",{detail:i}))}t.s=!0}}function xn(t){if(t.f){if(0<t.a.length){var e=[];t.a.forEach(function(t){e.push({id:t.id,start:t.l.S,end:t.l.F})}),t.f.onEvent(new Tt("adRangeUpdate",{detail:e}))}t.o=!0}}function In(){this.a=this.c=null,this.o=[],this.b=null,this.s=[],this.m=1,this.h={},this.u=0,this.w=new p(5),this.j=null,this.i="",this.g=this.f=null}d("shaka.media.ManifestParser.registerParserByExtension",function(t,e){hn[t]=e}),d("shaka.media.ManifestParser.registerParserByMime",function(t,e){un[t]=e}),d("shaka.media.PresentationTimeline",cn),cn.prototype.getDuration=cn.prototype.ca=function(){return this.c},cn.prototype.setDuration=cn.prototype.Sa=function(t){this.c=t},cn.prototype.getPresentationStartTime=cn.prototype.Ce=function(){return this.b},cn.prototype.setClockOffset=cn.prototype.Qd=function(t){this.j=t},cn.prototype.setStatic=cn.prototype.Vd=function(t){this.o=t},cn.prototype.setSegmentAvailabilityDuration=cn.prototype.Uc=function(t){this.f=t},cn.prototype.setDelay=cn.prototype.Rf=function(t){this.m=t},cn.prototype.getDelay=cn.prototype.ve=function(){return this.m},cn.prototype.notifySegments=cn.prototype.$b=function(t,e){if(0!=t.length){var i=t[0].startTime+e,n=t[t.length-1].endTime+e;this.h=null==this.h?i:Math.min(this.h,i),this.a=t.reduce(function(t,e){return Math.max(t,e.endTime-e.startTime)},this.a),this.g=Math.max(this.g,n),null!=this.b&&(this.b=(Date.now()+this.j)/1e3-this.g-this.a)}},cn.prototype.notifyMaxSegmentDuration=cn.prototype.Ic=function(t){this.a=Math.max(this.a,t)},cn.prototype.isLive=cn.prototype.T=function(){return 1/0==this.c&&!this.o},cn.prototype.isInProgress=cn.prototype.$a=function(){return 1/0!=this.c&&!this.o},cn.prototype.getSegmentAvailabilityStart=cn.prototype.Wb=function(){if(1/0==this.f)return this.i;var t=this.aa()-this.f;return Math.max(this.i,t)},cn.prototype.setUserSeekStart=cn.prototype.Wd=function(t){this.i=t},cn.prototype.getSegmentAvailabilityEnd=cn.prototype.aa=function(){return this.T()||this.$a()?Math.min(Math.max(0,(Date.now()+this.j)/1e3-this.a-this.b),this.c):this.c},cn.prototype.getSafeSeekRangeStart=cn.prototype.sb=function(t){var e=Math.max(this.h,this.i);if(1/0==this.f)return e;var i=this.aa()-this.f;return t=Math.min(i+t,this.oa()),Math.max(e,t)},cn.prototype.getSeekRangeStart=cn.prototype.Za=function(){return this.sb(0)},cn.prototype.getSeekRangeEnd=cn.prototype.oa=function(){var t=this.T()||this.$a()?this.m:0;return Math.max(0,this.aa()-t)},cn.prototype.usingPresentationStartTime=cn.prototype.ce=function(){return null!=this.b&&null==this.g},d("shaka.util.AdTrack",dn),dn.prototype.clear=dn.prototype.clear=function(){this.periodId=this.id=null,this.l={S:null,F:null,ia:null,za:null},this.a={pc:[],Ac:[],nc:[],start:[],sc:[],Hc:[],Wc:[],complete:[],Db:[],ia:[],oc:[],Yc:[]},this.b={Xa:!1,Ia:!1,ab:!1,Ka:!1},this.c={Ya:!1,hd:!1,td:!1,$d:!1,dd:!1},this.f={bd:!1,end:!1}},dn.prototype.merge=dn.prototype.Ma=function(){},d("shaka.util.ID3",_n),d("shaka.util.AdsManager",En),En.prototype.destroy=En.prototype.destroy=function(){this.media=this.h=null,this.a=[],this.b=[],this.c=null,this.j=1,this.C&&(g.clearTimeout(this.C),this.C=null),this.g&&(g.clearTimeout(this.g),this.g=null),this.i&&(g.clearTimeout(this.i),this.i=null),this.D=this.w=null},En.prototype.Ma=function(t){var e=!0;if(null===t.id&&(e=!1),null===t.periodId&&(e=!1),null===t.l.S&&(e=!1),t.l.F&&t.l.F<=t.l.S&&(e=!1),e){e=-1;for(var i=this.a.length-1;0<=i;i--)if(yn(this.a[i],t)){e=i;break}-1===e?(this.a.push(t),Sn(this.a)):bn(this.a[e],t)}},En.prototype.uniqueid=En.prototype.jg=function(){var t=String.fromCharCode(Math.floor(25*Math.random()+65));do{var e=Math.floor(42*Math.random()+48);(e<58||64<e)&&(t+=String.fromCharCode(e))}while(t.length<32);return t},En.prototype.adFilter=En.prototype.ad=function(t){if(t&&t.messageData){var e=Ct(t.messageData),i=null;if(0<(e=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("PrivateCommand")).length&&(i=Ft(e=e[0].getAttribute("PrivateBytes"))),null!==i&&!isNaN(t.startTime)){var n=new _n(i).a;if(null!==n.key&&"GEOB"===n.key&&null!==/(?:\s*(start|keep|stop|PreStart|PostStop)\s*)/.exec(n.cueType))if(this.h||(this.h=this.media.addTextTrack("metadata","NeulionDashAdvertisement"),this.h.addEventListener("cuechange",this.I.bind(this)),this.h.mode="hidden"),i=Ln(this,(e={startTime:t.startTime,type:n.cueType,id:n.id,duration:n.duration,timeLeft:n.timeLeft}).id,e.type,e.startTime)){if(null!==this.c&&this.c!==i&&this.c.l.F&&Math.abs(i.l.S-this.c.l.F)<=1&&wn(this,i.l.S?i.l.S:0),this.c=i,"keep"===e.type){var r=fn(i,!1);if(0===r.V){var a=i.l;kn(this,r,{startTime:a.S?a.S:-1,type:"start",id:i.id?i.id:"",duration:0,timeLeft:0},i,!0)}}r=t.startTime,t={nb:!1,$:[],Rb:[],dc:[],V:-1},i.id===n.id&&r>=i.l.S&&((n=new RegExp([/\s*(start|keep|stop)\s*/.source,/|\s*(PreStart|PostStop)\s*/.source].join(""),"gi")).lastIndex=0,null!==(n=n.exec(e.type)))&&(n[1]?(i.l.F&&r<=i.l.F||null===i.l.F)&&("start"===e.type?gn(i,t,!1):"keep"===e.type?(n=(e.duration-e.timeLeft)/e.duration)<=15&&!1===i.c.Ya?(i.c.Ya=!0,gn(i,t,!1)):25<=(n=100*n.toFixed(2))&&!1===i.c.hd&&0<i.a.sc.length?(i.c.hd=!0,t.V=.25,t.$=t.$.concat(i.a.sc)):50<=n&&!1===i.c.td&&0<i.a.Hc.length?(i.c.td=!0,t.V=.5,t.$=t.$.concat(i.a.Hc)):75<=n&&!1===i.c.$d&&0<i.a.Wc.length&&(i.c.$d=!0,t.V=.75,t.$=t.$.concat(i.a.Wc)):"stop"===e.type&&mn(i,t,!1)):n[2]&&"PreStart"!==e.type&&"PostStop"===e.type&&i.l.za&&r===i.l.za&&(t.nb=!0,t.V=1)),kn(this,t,e,i,!1)}else null==e.id&&"stop"==e.type&&0==e.timeLeft&&wn(this,e.startTime)}}},En.prototype.G=function(){if(Sn(this.a),this.media&&this.media.currentTime)for(var t=0;t<this.a.length;t++){var e=this.a[t];if(e.c.Ya){if(!e.f.bd&&e.l.S&&this.media.currentTime>e.l.S+.2){var i=fn(e,!0);0===i.V&&(i=An(i,e.id,"start"),Pn(this,e.l.S,e.id,i))}!e.f.end&&e.l.F&&this.media.currentTime>e.l.F+.2&&(1===(i=pn(e,this.media.currentTime,!0)).V&&e.l.F&&(i=An(i,e.id,"stop"),Pn(this,e.l.F,e.id,i)))}}this.i&&g.clearTimeout(this.i),this.i=setTimeout(this.G.bind(this),1e3)},En.prototype.I=function(){var t=this.h.activeCues;if(this.h&&t&&0<t.length)for(var e={},i=0;i<t.length;e={urls:e.urls},i++){var n=t[i];if(!1===n.noticed)if(n.noticed=!0,n.lastNoticeTime=performance.now(),"inner"===n.adType){e.urls=[],n.adEvents.forEach(function(e){return function(t){e.urls.push({type:n.stage.toString(),url:t})}}(e));var r=new Tt("advertisement",{detail:{adId:n.trackId,uploadType:"ADPOST",urls:e.urls}});this.f.onEvent(r)}else if(this.f){r=1==n.stage?"end":0==n.stage?"start":"";var a=Ln(this,n.trackId,r,n.startTime);a&&""!=r&&vn(a,r),r=new Tt("advertisement",{detail:n.adEvents}),this.f.onEvent(r)}}},En.prototype.updateAdRanges=En.prototype.ae=function(t){this.m=t,this.f||t?xn(this):!1===this.o&&null===this.g&&(this.g=g.setTimeout(this.u.bind(this),1e3))},En.prototype.u=function(){!1===this.m&&(this.f?(Cn(this),xn(this),g.clearTimeout(this.g),this.g=null):!1!==this.o&&!1!==this.s||(g.clearTimeout(this.g),this.g=g.setTimeout(this.u.bind(this),1e3)))},En.prototype.setUserDataManager=En.prototype.U=function(t){this.w=t},d("shaka.dash.DashParser",In);var Rn="",Dn={};function Nn(e){var t=ut(e.o,e.c.retryParameters);t.userRequestExt.periodId="Manifest";var i=Date.now();return e.a.networkingEngine.request(0,t,function(){return!this.a}.bind(e)).then(function(t){if(e.a)return function(t,e,i){if(!(e=function(t){var e=new DOMParser;try{var i=Ct(t),n=e.parseFromString(i,"text/xml")}catch(t){}if(n&&"MPD"==n.documentElement.tagName)var r=n.documentElement;return r&&0<r.getElementsByTagName("parsererror").length?null:r}(e)))throw new J(2,4,4001,i);return(n=e,Promise.all([]).then(function(){return n})).then(function(t){return function(t,e,i){i=[i];var n=mi(e,"Location").map(vi).filter(et);0<n.length&&(i=t.o=n);var r=Vn(e,n=[]);t.a.networkingEngine.Ua(n,"inMPD"),i=Et(i,r),n=e.getAttribute("stitchType"),t.g&&n&&(t.g.w=n),r=yi(e,"minBufferTime",_i),t.u=yi(e,"minimumUpdatePeriod",_i,-1);var a=yi(e,"availabilityStartTime",bi);n=yi(e,"timeShiftBufferDepth",_i);var s=yi(e,"suggestedPresentationDelay",_i),o=yi(e,"maxSegmentDuration",_i),l=e.getAttribute("type")||"static";if(t.b)var u=t.b.presentationTimeline;else{var h=Math.max(t.c.dash.defaultPresentationDelay,1.5*r);u=new cn(a,null!=s?s:h)}if(s=function(t,e,i,n){var r=yi(n,"mediaPresentationDuration",_i),a=[],s=0,o=mi(n,"Period");n=[];for(var l=0;l<o.length;l++){var u=o[l];s=yi(u,"start",_i,s);var h=yi(u,"duration",_i),c={id:"",start:"number"==typeof s?s:-1,end:1/0,maxStart:null,minEnd:null};e.be.Yb=l==o.length-1;var d=null;if(l!=o.length-1){var f=yi(o[l+1],"start",_i);null!=f&&(d=f-s,f&&(c.end=f))}else null!=r&&(d=r-s);if(null==d&&(d=h),h=On(t,e,i,{start:s,duration:d,node:u,index:l,Dc:null==d||l==o.length-1}),e.J&&e.J.id&&(c.id=e.J.id,Vn(u,f=[]),0<f.length&&t.a.networkingEngine.Ua(f,c.id)),a.push(h),u=e.J.id,-1==t.s.indexOf(u))t.s.push(u),t.b&&(t.a.filterNewPeriod(h),t.b.periods.push(h));else if(t.b&&t.b.periods)for(f=0;f<t.b.periods.length;f++){var p=t.b.periods[f];u===p.id&&p.thumbnailStreams.length!==h.thumbnailStreams.length&&(p.thumbnailStreams=h.thumbnailStreams)}if(null==d){s=null,""!=c.id&&-1!==c.start&&n.push(c);break}s+=d,""!=c.id&&-1!==c.start&&n.push(c)}if(0<a.length&&t.f){if(i=t.f,-1!==(o=a[0].startTime)){for(l=0,c=i.a.length-1;0<=c;c--)if(i.a[c].l.F&&i.a[c].l.F<o){l=c;break}for(0<=--l&&(i.a.splice(0,l),Sn(i.a)),l=0,c=i.b.length-1;0<=c;c--)if(i.b[c].l.S<o){l=c;break}0<=--l&&(i.b.splice(0,l),Sn(i.b))}else i.a=[],i.b=[];t.f.ae(e.ma),i=t.f,o=e.ma,i.m=o,i.f||o?Cn(i):!1===i.s&&null===i.g&&(i.g=g.setTimeout(i.u.bind(i),1e3))}return null==t.b&&t.a.filterAllPeriods(a),e&&e.ib&&De(e.ib,n,e.ma),null!=r?{periods:a,duration:r,fd:!1}:{periods:a,duration:s,fd:!0}}(t,{ma:"static"!=l,presentationTimeline:u,J:null,R:null,P:null,B:null,bandwidth:0,qd:!1,ib:t.g,be:{Yb:!1}},i,e),h=s.duration,a=s.periods,u.Vd("static"==l),"static"!=l&&s.fd||u.Sa(h||1/0),u.Uc(null!=n?n:1/0),u.Ic(o||1),t.b)return u.aa(),Promise.resolve();if(t.b={presentationTimeline:u,periods:a,offlineSessionIds:[],minBufferTime:r||0},o=r=0,0<a.length){var c=a[a.length-1].id,d={};Object.keys(t.h).forEach(function(t){var e=this.h[t].b;e&&new RegExp(c).exec(e)&&(d[t]=this.h[t])}.bind(t)),r=function(t,e,i,n){var r=0;if("segmentTemplate"===e&&t.T()&&n){for(var a in e=1/0,i)if(-1!==a.search(/_video|_audio/gi)){var s=i[a].a;if(0!==s.length){var o=s[s.length-1];s=s[0],o.endTime>r&&(r=o.endTime),s.startTime<e&&(e=s.startTime)}}null!=n&&(0<(i=r-e)&&i<n&&t.Uc(i))}return r}(u,t.i,d,n),o=a[a.length-1].startTime}return n=o+r,t.g&&t.g.Ud(u.T()),r=u.T(),u.ce()?(e=mi(e,"UTCTiming"),function(t,i,e,n,r){e=e.map(function(t){return{scheme:t.getAttribute("schemeIdUri"),value:t.getAttribute("value")}});var a,s,o=t.c.dash.clockSyncUri;return n&&!e.length&&o&&e.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:o}),(a=e,s=function(t){var e=t.value;switch(t.scheme){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Gn(this,i,e,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Gn(this,i,e,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return t=Date.parse(e),isNaN(t)?0:t-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:return Promise.reject()}}.bind(t),a.reduce(function(t,e,i){return e.catch(t.bind(null,i))}.bind(null,s),Promise.reject())).catch(function(){if(n){var t=-1;if(0<r&&(t=1e3*r-Date.now()),-1!==t)return t}return 0}.bind(t))}(t,i,e,r,n).then(function(t){this.a&&u.Qd(t)}.bind(t))):Promise.resolve()}(this,t,i)}.bind(t));var n}(e,t.data,t.uri)}).then(function(){var t=(Date.now()-i)/1e3;return m(e.w,1,t),t})}function On(t,e,i,n){e.J=Bn(n.node,null,i),e.R=n,e.J.id||(e.J.id="__shaka_period_"+n.start),mi(n.node,"EventStream").forEach(t.tf.bind(t,n.start,n.duration));var r=(i=mi(n.node,"AdaptationSet").map(t.rf.bind(t,e)).filter(et)).map(function(t){return t.Ef}).reduce($,[]),a=r.filter(it);if(e.ma&&r.length!=a.length)throw new J(2,4,4018);var s=i.filter(function(t){return!t.Zc});i.filter(function(t){return t.Zc}).forEach(function(t){var e=t.streams[0],i=t.Zc;s.forEach(function(t){t.id==i&&t.streams.forEach(function(t){t.trickModeVideo=e})})}),a=Mn(s,"video");var o=Mn(s,"audio");if(!a.length&&!o.length)throw new J(2,4,4004);for(o.length||(o=[null]),a.length||(a=[null]),i=[],r=0;r<o.length;r++)for(var l=0;l<a.length;l++)Un(t,o[r],a[l],i);for(o=Mn(s,"text"),a=[],r=0;r<o.length;r++)a.push.apply(a,o[r].streams);for(o=Mn(s,"metadata"),l=[],r=0;r<o.length;r++){var u=o[r].streams.filter(function(t){return t.roles&&t.roles[0]&&"thumbnail"==t.roles[0]});l.push.apply(l,u)}return t.f&&function(t,e,i){var n=gi(e.node,"CstTags");if(n){var r=gi(n,"CstAdId"),a=new dn;if(a.periodId=i,a.l.S=e.start,r){a.id=vi(r),i=Object.keys(t.h),r=null;for(var s=0;s<i.length;s++)if(e&&e.node&&e.node.id&&new RegExp(e.node.id).exec(i[s])){r=i[s];break}e.duration?a.l.F=e.start+e.duration:(i=null!==r?t.h[r].duration():0,a.l.F=e.start+i),a.l.F<=a.l.S||(gi(n,"CstAdStitchStart")&&(a.b.Xa=!0),gi(n,"CstAdSlotStart")&&(a.b.Ia=!0),gi(n,"CstAdSlotEnd")&&(a.b.Ka=!0,a.l.ia=a.l.F),gi(n,"CstAdStitchEnd")&&(a.b.ab=!0,a.l.za=a.l.F),Hn(e=mi(n,"CstTrack"),a),Hn(n=mi(n,"CstTrack2"),a),t.f.Ma(a))}else{for(Hn(n=mi(n,"CstTrack2"),a),a.id=i,a.l.F=e.start,a.l.za=e.start,a.l.ia=e.start,a.b.Xa=!0,a.b.Ia=!0,a.b.Ka=!0,a.b.ab=!0,t=t.f,e=-1,n=t.b.length-1;0<=n;n--)if(yn(t.b[n],a)){e=n;break}-1===e?(t.b.push(a),Sn(t.b)):bn(t.b[e],a)}}}(t,n,e.J.id),{startTime:n.start,textStreams:a,variants:i,thumbnailStreams:l,type:"unknown",id:e.J.id}}function Mn(t,e){return t.filter(function(t){return t.contentType==e})}function Un(t,e,i,n){if(e||i)if(e&&i){var r=e.drmInfos,a=i.drmInfos;if(!r.length||!a.length||0<Kt(r,a).length){var s=Kt(e.drmInfos,i.drmInfos);for(r=0;r<e.streams.length;r++)for(var o=0;o<i.streams.length;o++)a=(i.streams[o].bandwidth||0)+(e.streams[r].bandwidth||0),a={id:t.m++,language:e.language,primary:e.Fc||i.Fc,audio:e.streams[r],video:i.streams[o],bandwidth:a,drmInfos:s,allowedByApplication:!0,allowedByKeySystem:!0},n.push(a)}}else for(s=e||i,r=0;r<s.streams.length;r++)a=s.streams[r].bandwidth||0,a={id:t.m++,language:s.language||"und",primary:s.Fc,audio:e?s.streams[r]:null,video:i?s.streams[r]:null,bandwidth:a,drmInfos:s.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},n.push(a)}function Fn(t,e){t.u<0||(t.j=g.setTimeout(t.eg.bind(t),1e3*Math.max(2,t.u-e,v(t.w))))}function Bn(t,e,i){e=e||{contentType:"",mimeType:"",codecs:"",containsEmsgBoxes:!1,frameRate:void 0,Jc:null},i=i||e.ka;var n=mi(t,"BaseURL").map(vi),r=t.getAttribute("contentType")||e.contentType,a=t.getAttribute("mimeType")||e.mimeType,s=t.getAttribute("codecs")||e.codecs,o=yi(t,"frameRate",ki)||e.frameRate,l=!!mi(t,"InbandEventStream").length,u=mi(t,"AudioChannelConfiguration");u=function(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.getAttribute("schemeIdUri");if(n&&(i=i.getAttribute("value")))switch(n){case"urn:mpeg:dash:outputChannelPositionList:2012":return i.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(!(n=parseInt(i,10)))continue;return n;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(n=parseInt(i,16)){for(t=0;n;)1&n&&++t,n>>=1;return t}}}return null}(u)||e.Jc,r||(r=jn(a,s)),s=t.getAttribute("codecs");var h=RegExp("avc|hevc","g").test(s);try{var c=Dn;""===Rn&&c.hasOwnProperty("isPlayReady")&&c.isPlayReady&&h&&(Rn=s)}catch(t){}return s=h?Rn||s||e.codecs:s||e.codecs,{ka:Et(i,n),zb:gi(t,"SegmentBase")||e.zb,xa:gi(t,"SegmentList")||e.xa,Ab:gi(t,"SegmentTemplate")||e.Ab,width:yi(t,"width",wi)||e.width,height:yi(t,"height",wi)||e.height,contentType:r,mimeType:a,codecs:s,frameRate:o,containsEmsgBoxes:l||e.containsEmsgBoxes,id:t.getAttribute("id"),Jc:u}}function Gn(t,e,i,n){return(e=ut(e=Et(e,[i]),t.c.retryParameters)).method=n,t.a.networkingEngine.request(0,e).then(function(t){if("HEAD"==n){if(!t.headers||!t.headers.date)return 0;t=t.headers.date}else t=Ct(t.data);return t=Date.parse(t),isNaN(t)?0:t-Date.now()})}function jn(t,e){return ne[Lt(t,e)]?"text":t.split("/")[0]}function Hn(t,n){t.forEach(function(t){var e=t.getAttribute("name").trim(),i=t.firstChild;t=i&&i.nodeType==Node.CDATA_SECTION_NODE?t.textContent.trim():null,(i=/\<\s*\!\s*\[\s*CDATA\s*\[\s*(.+)\s*\]\s*\]\s*\>/.exec(t))&&i[1]&&(t=i[1]),e&&t&&("Impression"===e?n.a.Ac.push(t):"creativeView"===e?n.a.nc.push(t):"slotImpression"===e?n.a.Db.push(t):"defaultImpression"===e?n.a.pc.push(t):"defaultClick"===e?n.a.oc.push(t):"trackClick"===e?n.a.Yc.push(t):"slotEnd"===e?n.a.ia.push(t):"start"===e?n.a.start.push(t):"firstQuartile"===e?n.a.sc.push(t):"midPoint"===e?n.a.Hc.push(t):"thirdQuartile"===e?n.a.Wc.push(t):"complete"===e&&n.a.complete.push(t))})}function Vn(t,e){for(var i=[],n=mi(t,"BaseURL"),r=0;r<n.length;r++){var a={host:"",bandwidthRate:-1,priority:0,url:""},s=vi(n[r]);if(s){var o=new E(s);if(""!=o.Z){var l=n[r].getAttribute("bandwidthRate");l=""===l?0:Number(l);var u=n[r].getAttribute("priority");u=""===u?0:Number(u),a.host=nt(o,!1),a.bandwidthRate=l,a.priority=u,e.push(a),i.push(s)}}}return i}function Wn(t,e,i,n){this.a=t,this.c=e,this.h=i,this.O=n,this.C=new mt,this.j=null,this.w=!1,this.I=t.readyState,this.o=!1,this.i=this.D=-1,this.u=this.f=!1,e=this.G.bind(this),vt(this.C,t,"waiting",e),this.j=new Nt(e),Ot(this.j,.1),this.s=0,this.g=this.b=null,this.m=-1}function zn(t,e){var i=!1,n=t.c.presentationTimeline.oa();return t.c.presentationTimeline.aa(),n<e+.05||(i=!0),i}function Kn(t,e){var i=!1;return t.c.presentationTimeline.oa(),t.c.presentationTimeline.aa()-.5<e+.05||(i=!0),i}function Yn(t,e,i){this.a=t,this.i=e,this.h=i,this.c=new mt,this.f=1,this.g=!1,this.b=null,0<t.readyState?this.Ad():yt(this.c,t,"loadedmetadata",this.Ad.bind(this)),vt(this.c,t,"ratechange",this.df.bind(this))}function Xn(t){return 0<t.a.readyState?t.a.currentTime:t.h}function qn(t,e){0<t.a.readyState?function(t,e,i){t.a.currentTime=i;var n=0,r=function(){!this.a||10<=n++||this.a.currentTime!=e||(this.a.currentTime=i,setTimeout(r,100))}.bind(t);setTimeout(r,100)}(t,t.a.currentTime,e):(t.h=e,setTimeout(t.i,0))}function Zn(t,e){null!=t.b&&(t.b.cancel(),t.b=null),t.f=e,t.a.playbackRate=t.g||e<0?0:e,!t.g&&e<0&&(t.b=new Nt(function(){this.a.currentTime+=e/4}.bind(t)),Ot(t.b,.25))}function Qn(t,e,i,n,r,a){this.c=t,this.b=e,this.h=i,this.j=r,this.g=null,this.f=new Wn(t,e,i,a),e=this.ff.bind(this),null==n&&(n=1/0>(n=this.b.presentationTimeline).ca()?n.Za():n.oa()),n=$n(this,er(this,n)),this.a=new Yn(t,e,n),this.g=new Nt(this.cf.bind(this)),Ot(this.g,.25)}function Jn(t){var e=Xn(t.a);return 0<t.c.readyState&&(t.c.paused||(e=er(t,e))),e}function $n(t,e){var i=t.b.presentationTimeline.ca();return i<=e?i-t.h.durationBackoff:e}function tr(t,e){var i=Xt.bind(null,t.c.buffered),n=Math.max(t.b.minBufferTime||0,t.h.rebufferingGoal),r=t.b.presentationTimeline,a=r.Za(),s=r.oa(),o=r.ca();s-a<3&&(a=s-3);var l=r.sb(n),u=r.sb(5);return n=r.sb(n+5),o<=e?$n(t,e):s<e?s:e<a?i(u)?u:n:l<=e||i(e)?e:n}function er(t,e){var i=t.b.presentationTimeline.Za();return e<i?i:(i=t.b.presentationTimeline.oa())<e?i:e}function ir(t,e,i,n,r,a,s){this.a=t,this.w=e,this.g=i,this.u=n,this.m=r,this.h=a,this.C=s,this.c=[],this.j=new mt,this.b=!1,this.i=-1,this.f=null,rr(this)}function nr(t){var e=Q(t);return e.eventElement=t.eventElement,e}function rr(t){ar(t),t.f=g.setTimeout(t.D.bind(t),250)}function ar(t){t.f&&(g.clearTimeout(t.f),t.f=null)}function sr(t,e,i){this.startTime=t,this.endTime=e,this.payload=i,this.region={x:0,y:0,width:100,height:100},this.position=null,this.positionAlign=or,this.size=100,this.textAlign=lr,this.writingDirection=dr,this.lineInterpretation=fr,this.line=null,this.lineHeight="",this.lineAlign=pr,this.displayAlign=hr,this.fontSize=this.backgroundColor=this.color="",this.fontWeight=mr,this.fontStyle=vr,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id=""}(e=In.prototype).configure=function(t){this.c=t},e.start=function(t,e){return this.o=[t],this.a=e,Nn(this).then(function(t){return this.a&&Fn(this,t),this.b}.bind(this))},e.stop=function(){return this.c=this.a=null,this.o=[],this.b=null,this.s=[],this.h={},null!=this.j&&(g.clearTimeout(this.j),this.j=null),this.g=null,Promise.resolve()},e.update=function(){Nn(this).catch(function(t){this.a&&this.a.onError(t)}.bind(this))},e.onExpirationUpdated=function(){},e.rf=function(e,t){e.P=Bn(t,e.J,null);for(var i=!1,n=mi(t,"Role"),r=n.map(function(t){return t.getAttribute("value")}).filter(et),a=mi(t,"Accessibility"),s=[],o=0;o<a.length;o++)"urn:scte:dash:cc:cea-608:2015"==a[o].getAttribute("schemeIdUri")&&s.push(a[o].getAttribute("value"));var l,u;for(l=this.g,u=s.toString(),""==l.j&&(l.j=u),a=void 0,"text"==e.P.contentType&&(a="subtitle"),"metadata"==e.P.contentType&&(a="subtitle"),s="",o=0;o<n.length;o++){var h=n[o].getAttribute("schemeIdUri");if(null==h||"urn:mpeg:dash:role:2011"==h){var c=n[o].getAttribute("value");switch(c){case"main":i=!0;break;case"caption":case"subtitle":a=c}}"urn:neulion:audio:displayname"!==h&&"urn:neulion:subtitle:displayname"!==h||(s=n[o].getAttribute("value"))}var d=null,f=!1;if(mi(t,"EssentialProperty").forEach(function(t){"http://dashif.org/guidelines/trickmode"==t.getAttribute("schemeIdUri")?d=t.getAttribute("value"):f=!0}),f)return null;var p=Li(n=mi(t,"ContentProtection"),this.c.dash.customScheme,this.c.dash.ignoreDrmInfo);if(n=me(t.getAttribute("lang")||"und"),h=t.getAttribute("label"),0==(r=(o=mi(t,"Representation")).map(this.uf.bind(this,e,p,a,n,h,i,r,s)).filter(function(t){return!!t})).length)throw new J(2,4,4003);return e.P.contentType&&"application"!=e.P.contentType||(e.P.contentType=jn(r[0].mimeType,r[0].codecs),r.forEach(function(t){t.type=e.P.contentType})),e.P.contentType&&"metadata"!=e.P.contentType||r.forEach(function(t){t.type=e.P.contentType}),r.forEach(function(e){p.drmInfos.forEach(function(t){e.keyId&&t.keyIds.push(e.keyId)})}),a=o.map(function(t){return t.getAttribute("id")}).filter(et),{id:e.P.id||"__fake__"+this.m++,contentType:e.P.contentType,language:n,Fc:i,streams:r,drmInfos:p.drmInfos,Zc:d,Ef:a}},e.uf=function(t,e,i,n,r,a,s,o,l){if(t.B=Bn(l,t.P,null),u=t.B,h=u.zb?1:0,h+=u.xa?1:0,!(0==(h+=u.Ab?1:0)?"text"==u.contentType||"application"==u.contentType:(1!=h&&(u.zb&&(u.xa=null),u.Ab=null),1)))return null;var u,h;t.bandwidth=yi(l,"bandwidth",Si)||0;var c=this.Ff.bind(this);if(t.B.zb)c=function(t,e){var i=Number(xi(t,nn,"presentationTimeOffset"))||0,n=xi(t,nn,"timescale"),r=1;n&&(r=Si(n)||1),i=i/r||0,n=tn(t,nn);var a=t.B.contentType;if(r=t.B.mimeType.split("/")[1],"text"!=a&&"mp4"!=r&&"webm"!=r)throw new J(2,4,4006);if("webm"==r&&!n)throw new J(2,4,4005);a=Ii(t,nn,"RepresentationIndex");var s=xi(t,nn,"indexRange"),o=t.B.ka;if(s=Ti(s||""),a){var l=a.getAttribute("sourceURL");l&&(o=Et(t.B.ka,[l])),s=yi(a,"range",Ti,s)}if(!s)throw new J(2,4,4002);return{createSegmentIndex:(r=en(t,e,n,o,s.start,s.end,r,i)).createSegmentIndex,findSegmentPosition:r.findSegmentPosition,getSegmentReference:r.getSegmentReference,initSegmentReference:n,ga:i}}(t,c),this.i="segmentBase";else if(t.B.xa)c=rn(t,this.h),this.i="segmentList";else if(t.B.Ab)c=sn(t,c,this.h,!!this.b,a),this.i="segmentTemplate";else{this.i="unknown";var d=t.B.ka,f=t.R.duration||0;c={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return 0<=t&&t<f?1:null},getSegmentReference:function(t){return 1!=t?null:new Di(1,0,f,function(){return d},0,null)},initSegmentReference:null,ga:0}}l=function(t,e,i,n){var r=Li(t,e,n);if(i.jd)t=1==i.drmInfos.length&&!i.drmInfos[0].keySystem,e=0==r.drmInfos.length,(0==i.drmInfos.length||t&&!e)&&(i.drmInfos=r.drmInfos),i.jd=!1;else if(0<r.drmInfos.length&&(i.drmInfos=i.drmInfos.filter(function(e){return r.drmInfos.some(function(t){return t.keySystem==e.keySystem})}),0==i.drmInfos.length))throw new J(2,4,4008);return r.ed||i.ed}(l=mi(l,"ContentProtection"),this.c.dash.customScheme,e,this.c.dash.ignoreDrmInfo);var p="";return t.J.id&&t.B.id&&(p=t.J.id+"-,-"+t.B.id),{id:this.m++,createSegmentIndex:c.createSegmentIndex,findSegmentPosition:c.findSegmentPosition,getSegmentReference:c.getSegmentReference,initSegmentReference:c.initSegmentReference,presentationTimeOffset:c.ga,mimeType:t.B.mimeType,codecs:t.B.codecs,frameRate:t.B.frameRate,bandwidth:t.bandwidth,width:t.B.width,height:t.B.height,kind:i,encrypted:0<e.drmInfos.length,keyId:l,language:n,label:r,type:t.P.contentType,primary:a,trickModeVideo:null,containsEmsgBoxes:t.B.containsEmsgBoxes,roles:s,channelsCount:t.B.Jc,displayName:o,streamStats:{lastDecodedFrames:null,lastDroppedFrames:null,lastDetectTime:null,meetSwithThreshold:!1,meetSwitchThesholdCount:0,firstThresholdSwitchTime:null,lastThresholdSwitchTime:null},strId:p}},e.eg=function(){this.j=null,Nn(this).then(function(t){this.a&&Fn(this,t)}.bind(this)).catch(function(t){this.a&&(t.severity=1,this.a.onError(t),Fn(this,0))}.bind(this))},e.tf=function(n,r,t){var a=t.getAttribute("schemeIdUri")||"",s=t.getAttribute("value")||"",o=yi(t,"timescale",wi)||1;mi(t,"Event").forEach(function(t){var e=yi(t,"presentationTime",wi)||0,i=yi(t,"duration",wi)||0;i=(e=e/o+n)+i/o,null!=r&&(e=Math.min(e,n+r),i=Math.min(i,n+r)),t={schemeIdUri:a,value:s,startTime:e,endTime:i,id:t.getAttribute("id")||"",eventElement:t},this.a.onTimelineRegionAdded(t)}.bind(this))},e.Ff=function(t,e,i){return t=ut(t,this.c.retryParameters),null!=e&&(t.headers.Range="bytes="+e+"-"+(null!=i?i:"")),this.a.networkingEngine.request(1,t).then(function(t){return t.data})},In.setCustomConfig=function(t){Dn=t},In.prototype.getAdsManager=In.prototype.re=function(){return this.f},In.prototype.setAdsManager=In.prototype.bc=function(t){this.f=t},In.prototype.getUserDataManager=In.prototype.Ie=function(){return this.g},In.prototype.setUserDataManager=In.prototype.U=function(t){this.g=t},hn.mpd=In,un["application/dash+xml"]=In,Wn.prototype.destroy=function(){var t=this.C.destroy();return this.O=this.c=this.a=this.C=null,null!=this.j&&(this.j.cancel(),this.j=null),this.g=this.b=null,this.m=-1,t},Wn.prototype.xb=function(){this.u=!0,this.G()},Wn.prototype.G=function(){if(null!=this.a&&null!=this.a.readyState&&0!=this.a.readyState){if(this.a.seeking){if(!this.w)return}else this.w=!1;if(!this.a.paused){this.a.readyState!=this.I&&(this.o=!1,this.I=this.a.readyState);var t=this.h.smallGapLimit,e=this.a.currentTime,i=this.a.buffered,n=Zt(i,e),r=!1;if(this.b&&Re(this.b)&&this.b.c&&(r=!0),this.h.neulionGapDealing){n=-1,this.g&&(n=/(Edge)/i.test(navigator.userAgent)?this.g.gapTolerance.edge:/(IE)/i.test(navigator.userAgent)?this.g.gapTolerance.ie:/(Chrome)/i.test(navigator.userAgent)?this.g.gapTolerance.chrome:/(Firefox)/i.test(navigator.userAgent)?this.g.gapTolerance.firefox:/(Safari)/i.test(navigator.userAgent)?this.g.gapTolerance.safari:this.g.gapTolerance.others);var a=Zt(i,e);0<n&&null!==a&&1<=a&&i.start(a)-i.end(a-1)<n&&(a=null),n=a}if(null==n){if((r=this.h.neulionGapDealing)&&(r=!1,this.b&&!1===this.a.seeking&&(t=this.h.safeEdgeEndSize,this.b&&Re(this.b)&&(t=1),-1!==(e=this.b.sd(e,t))&&(this.b&&Re(this.b)&&this.b.c?(t=Kn(this,e),e>this.b.od()&&(t=!1),e+=1):(t=zn(this,e),e+=.2),t&&3e3<Date.now()-this.m&&this.a.currentTime<e&&(this.a.currentTime=e+this.h.safeEdgeBeginSize,r=!0,this.m=Date.now())))),r)Jt(i,!0);else if(i=this.a.currentTime,e=this.a.buffered,this.a.readyState<3&&0<this.a.playbackRate)if(this.i!=i)this.i=i,this.D=Date.now(),this.f=!1,this.s=2e3*this.c.presentationTimeline.a;else if(!this.f&&this.D<Date.now()-1e3){for(r=0;r<e.length;r++)if(i>=e.start(r)&&i<e.end(r)-.5){this.a.currentTime+=.1,this.i=this.a.currentTime,this.f=!0;break}if(this.h.neulionGapDealing&&!1===this.f)for(i=this.a.currentTime,e=this.a.buffered,null===(r=this.c.presentationTimeline.a)&&(r=2),t=0;t<e.length;t++)if(t<=e.length-2&&e.start(t+1)<=i+r&&Math.abs(e.end(t)-i)<=1.2){i=e.start(t+1),(this.b&&Re(this.b)&&this.b.c?Kn(this,i):zn(this,i))&&(this.a.currentTime=i+.05,this.i=this.a.currentTime,this.f=!0);break}if(this.h.neulionGapDealing&&!1===this.f){for(s in i=this.a.currentTime,r=null,e=this.b.Ub)i>=s.value.start&&i<=s.value.end&&(r=s.value);var s=r;null!==s&&(s=s.end,this.b&&Re(this.b)&&this.b.c?Kn(this,s):zn(this,s))&&(this.a.currentTime=s+.05,this.i=this.a.currentTime,this.f=!0)}if(this.h.neulionGapDealing&&!1===this.f){if(i=this.a.currentTime,3*(e=this.c.presentationTimeline.a)/4<(s=Date.now()-this.D)){if(r=null,t=this.b.a)for(n=t.length-1;0<=n;n--)i>=t[n].start&&i<=t[n].end&&(r=t[n]);if(null!==r)i+=0<e/2?e/2:1,(this.b&&Re(this.b)&&this.b.c?Kn(this,i):zn(this,i))&&(this.a.currentTime=i,this.i=this.a.currentTime,this.f=!0);else{for(e=null,t=(r=this.b.a).length-1;0<t&&!(t-1<0);t--)if(i>=r[t-1].start&&i<=r[t].start){e=r[t];break}null!==e&&(i+=Math.min(e.start-i,s),this.b&&Re(this.b)&&this.b.c?Kn(this,i):zn(this,i))&&(this.a.currentTime=i,this.i=this.a.currentTime,this.f=!0)}}!1===this.f&&s>this.s&&(this.s*=2)}}}else if(0!=n||this.u)if(s=i.start(n),a=this.c.presentationTimeline.oa(),r&&(a=this.c.presentationTimeline.aa()),a<=s)this.c.presentationTimeline.aa();else{t=(a=s-e)<=t;var o=!1;a<.001||r&&Date.now()-this.m<3e3||(this.c.presentationTimeline.aa(),t||this.o||(this.o=!0,(e=new Tt("largegap",{currentTime:e,gapSize:a})).cancelable=!0,this.O(e),this.h.jumpLargeGaps&&!e.defaultPrevented&&(o=!0)),!t&&!o)||(0!=n&&i.end(n-1),this.a.currentTime=s+.05,r&&(this.m=Date.now()))}}}},Wn.prototype.setUserDataManager=Wn.prototype.U=function(t){this.b=t},Wn.prototype.setDebugConfig=Wn.prototype.Bb=function(t){this.g=t},(e=Yn.prototype).destroy=function(){var t=this.c.destroy();return(this.c=null)!=this.b&&(this.b.cancel(),this.b=null),this.i=this.a=null,t},e.qb=function(){return this.f},e.df=function(){var t=this.g||this.f<0?0:this.f;this.a.playbackRate&&this.a.playbackRate!=t&&Zn(this,this.a.playbackRate)},e.Ad=function(){Math.abs(this.a.currentTime-this.h)<.001?this.Bd():(yt(this.c,this.a,"seeking",this.Bd.bind(this)),this.a.currentTime=0==this.a.currentTime?this.h:this.a.currentTime)},e.Bd=function(){vt(this.c,this.a,"seeking",this.i.bind(this))},(e=Qn.prototype).destroy=function(){var t=Promise.all([this.a.destroy(),this.f.destroy()]);return this.f=this.a=null,null!=this.g&&(this.g.cancel(),this.g=null),this.j=this.h=this.b=this.c=null,t},e.qb=function(){return this.a.qb()},e.xb=function(){this.f.xb()},e.cf=function(){if(0!=this.c.readyState&&!this.c.paused){var t=this.c.currentTime,e=this.b.presentationTimeline,i=e.Za();(e=e.oa())-i<3&&(i=e-3),t<i&&(t=tr(this,t),this.c.currentTime=t)}},e.ff=function(){var t=this.f;t.w=!0,t.u=!1,t.o=!1;var e=Xn(this.a);if(t=tr(this,e),.001<Math.abs(t-e)&&(e=(new Date).getTime()/1e3,!this.i||this.i<e-1))return this.i=e,void qn(this.a,t);this.j()},e.U=function(t){this.f.U(t)},Qn.prototype.setUserDataManager=Qn.prototype.U,Qn.prototype.setDebugConfig=Qn.prototype.Bb=function(t){this.f.Bb(t)},ir.prototype.destroy=function(){var t=this.j?this.j.destroy():Promise.resolve();return this.j=null,ar(this),this.C=this.h=this.m=this.u=this.g=this.w=this.a=null,this.c=[],t},ir.prototype.s=function(e){if(!this.c.some(function(t){return t.info.schemeIdUri==e.schemeIdUri&&t.info.startTime==e.startTime&&t.info.endTime==e.endTime})){var t={info:e,status:1};this.c.push(t);var i=new Tt("timelineregionadded",{detail:nr(e)});this.h(i),this.o(!0,t)}},ir.prototype.o=function(t,e){var i=e.info.startTime>this.a.currentTime?1:e.info.endTime<this.a.currentTime?3:2,n=2==e.status,r=2==i;i!=e.status&&((!t||n||r)&&(n||this.h(new Tt("timelineregionenter",{detail:nr(e.info)})),r||this.h(new Tt("timelineregionexit",{detail:nr(e.info)}))),e.status=i)},ir.prototype.D=function(){this.f=null,rr(this);var t=Ce(this.g,this.a.currentTime);t!=this.i&&(-1!=this.i&&this.C(),this.i=t),t=qt(this.a.buffered,this.a.currentTime);var e=Yt(this.a.buffered),i=this.g.presentationTimeline,n=i.aa();e=i.T()&&n<=e,i="ended"==this.w.readyState,e=e||this.a.ended||i,this.b?(i=Math.max(this.g.minBufferTime||0,this.u.rebufferingGoal),(e||i<=t)&&0!=this.b&&(this.b=!1,this.m(!1))):!e&&t<.5&&1!=this.b&&(this.b=!0,this.m(!0)),this.c.forEach(this.o.bind(this,!1))},d("shaka.text.Cue",sr);var or="auto";sr.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:or};var lr="center",ur={LEFT:"left",RIGHT:"right",CENTER:lr,START:"start",END:"end"};sr.textAlign=ur;var hr="before",cr={BEFORE:hr,CENTER:"center",AFTER:"after"};sr.displayAlign=cr;var dr=0;sr.writingDirection={HORIZONTAL_LEFT_TO_RIGHT:dr,HORIZONTAL_RIGHT_TO_LEFT:1,VERTICAL_LEFT_TO_RIGHT:2,VERTICAL_RIGHT_TO_LEFT:3};var fr=0;sr.lineInterpretation={LINE_NUMBER:fr,PERCENTAGE:1};var pr="center",gr={CENTER:pr,START:"start",END:"end"};sr.lineAlign=gr;var mr=400;sr.fontWeight={NORMAL:mr,BOLD:700};var vr="normal",yr={NORMAL:vr,ITALIC:"italic",OBLIQUE:"oblique"};function br(t){this.b=t,this.a=0}function _r(t,e){e.lastIndex=t.a;var i=e.exec(t.b);return i=null==i?null:{position:i.index,length:i[0].length,Hf:i},t.a==t.b.length||null==i||i.position!=t.a?null:(t.a+=i.length,i.Hf)}function Tr(t){return t.a==t.b.length?null:(t=_r(t,/[^ \t\n]*/gm))?t[0]:null}function Er(){}function Sr(t,e){var i;(i=/^align:(start|middle|center|end|left|right)$/.exec(e))?(i=i[1],t.textAlign="middle"==i?lr:ur[i.toUpperCase()]):(i=/^vertical:(lr|rl)$/.exec(e))?t.writingDirection="lr"==i[1]?2:3:(i=/^size:([\d.]+)%$/.exec(e))?t.size=Number(i[1]):(i=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(e))?(t.position=Number(i[1]),i[2]&&(i=i[2],t.positionAlign="line-left"==i||"start"==i?"line-left":"line-right"==i||"end"==i?"line-right":"center")):(i=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(e))?(t.lineInterpretation=1,t.line=Number(i[1]),i[2]&&(t.lineAlign=gr[i[2].toUpperCase()])):(i=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(e))&&(t.lineInterpretation=fr,t.line=Number(i[1]),i[2]&&(t.lineAlign=gr[i[2].toUpperCase()]))}function wr(t){if(null==(t=_r(t,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var e=Number(t[2]),i=Number(t[3]);return 59<e||59<i?null:Number(t[4])/1e3+i+60*e+3600*(Number(t[1])||0)}function kr(t,e){this.a=e,this.b=t,this.j=null,this.m=1,this.I=Promise.resolve(),this.i=[],this.o={},this.c={},this.O=!1,this.la=null,this.ja=this.f=this.w=!1,this.W=0,this.C=this.u=this.g=this.D=null,this.h={},this.G=!1,this.s=0}function Ar(t){var e=Jn(t.a.Qa);return t.b.periods[Ce(t.b,e)]}function Lr(t){var e=t.c.video||t.c.audio;return e?t.b.periods[e.Oa]:null}function Pr(t){return xr(t,"audio")}function Cr(t){return xr(t,"video")}function xr(t,e){var i=t.c[e];return i?i.wa||i.stream:null}function Ir(t,e){t.a.N.clear("text"),t.W++,t.ja=!1;var i=t.W;return t.a.N.init({text:e}),Br(t,[e]).then(function(){if(this.W==i&&!this.c.text&&!this.ja){var t=Jn(this.a.Qa);this.c.text=Ur(e,Ce(this.b,t)),zr(this,this.c.text,0)}}.bind(t))}function Rr(t,e){var i=t.c.video;if(i){var n=i.stream;if(n)if(e){var r=n.trickModeVideo;if(r){var a=i.wa;a||(Nr(t,r,!1),i.wa=n)}}else(a=i.wa)&&Nr(t,a,!(i.wa=null))}}function Dr(t,e,i){e.video&&Nr(t,e.video,i),e.audio&&Nr(t,e.audio,i)}function Nr(t,e,i){var n=t.c[e.type];if(!n&&"text"==e.type&&t.j.ignoreTextStreamFailures)Ir(t,e);else if(n){var r=xe(t.b,e);i&&r!=n.Oa?Or(t):(n.wa&&(e.trickModeVideo?e=(n.wa=e).trickModeVideo:n.wa=null),(r=t.i[r])&&r.gb&&(r=t.o[e.id])&&r.gb&&n.stream!=e&&("text"==e.type&&ae(t.a.N,Lt(e.mimeType,e.codecs)),n.stream=e,n.Zb=!0,i&&(n.Ga?n.hc=!0:n.Pa?(n.Ca=!0,n.hc=!0):(Kr(n),Wr(t,n,!0)))))}}function Or(t){for(var e in t.c){var i=t.c[e];i.Ga||i.Ca||(i.Pa?i.Ca=!0:null==se(t.a.N,e)?null==i.Ba&&zr(t,i,0):(Kr(i),Wr(t,i,!1)))}}function Mr(t,e,i){var n,r,a=Jn(t.a.Qa),s=Ce(t.b,a),o={};return a=[],e.variant&&e.variant.audio&&(o.audio=e.variant.audio,a.push(e.variant.audio)),e.variant&&e.variant.video&&(o.video=e.variant.video,a.push(e.variant.video)),e.text&&(o.text=e.text,a.push(e.text)),t.a.N.init(o),(r=(n=t).b.presentationTimeline.ca())<1/0?n.a.N.Sa(r):n.a.N.Sa(Math.pow(2,32)),Br(t,a).then(function(){if(!this.f)for(var t in o){var e=o[t];this.c[t]||(this.c[t]=Ur(e,s,i),zr(this,this.c[t],0))}}.bind(t))}function Ur(t,e,i){return{stream:t,type:t.type,qa:null,ra:null,wa:null,Zb:!0,Oa:e,endOfStream:!1,Pa:!1,Ba:null,Ca:!1,hc:!1,Ga:!1,Qc:!1,tb:!1,Ld:i||0}}function Fr(t,e){var i=t.i[e];if(i)return i.fa;i={fa:new M,gb:!1},t.i[e]=i;var n=t.b.periods[e].variants.map(function(t){var e=[];return t.audio&&e.push(t.audio),t.video&&e.push(t.video),t.video&&t.video.trickModeVideo&&e.push(t.video.trickModeVideo),e}).reduce($,[]).filter(it);return n.push.apply(n,t.b.periods[e].textStreams),t.I=t.I.then(function(){if(!this.f)return Br(this,n)}.bind(t)).then(function(){this.f||(this.i[e].fa.resolve(),this.i[e].gb=!0)}.bind(t)).catch(function(t){this.f||(this.i[e].fa.reject(),delete this.i[e],this.a.onError(t))}.bind(t)),i.fa}function Br(t,i){i.map(function(t){return t.id}).filter(it);for(var e=[],n=0;n<i.length;++n){var r=i[n],a=t.o[r.id];a?e.push(a.fa):(t.o[r.id]={fa:new M,gb:!1},e.push(r.createSegmentIndex()))}return Promise.all(e).then(function(){if(!this.f)for(var t=0;t<i.length;++t){var e=this.o[i[t].id];e.gb||(e.fa.resolve(),e.gb=!0)}}.bind(t)).catch(function(t){if(!this.f){for(var e=0;e<i.length;e++)this.o[i[e].id].fa.reject(),delete this.o[i[e].id];return Promise.reject(t)}}.bind(t))}function Gr(t,e,i){return e.qa&&e.ra?t.b.periods[xe(t.b,e.qa)].startTime+e.ra.endTime:Math.max(i,e.Ld)}function jr(t,e,i,n){return i=t.b.periods[i],(e=e.stream.getSegmentReference(n))?(t=(n=t.b.presentationTimeline).Wb(),n=n.aa(),i.startTime+e.endTime<t||i.startTime+e.startTime>n?null:e):null}function Hr(t){return!t.Pa&&null==t.Ba&&!t.Ca&&!t.Ga}function Vr(t,e,i){var n=i.kc,r=1,a=ut(e.a(),t.j.retryParameters);return i.periodId&&(a.userRequestExt.periodId=i.periodId),n&&(4<=n||n<=7)&&(r=n),i.lastSegment&&(a.userRequestExt.lastSegment=i.lastSegment),0==e.c&&null==e.b||(i="bytes="+e.c+"-",null!=e.b&&(i+=e.b),a.headers.Range=i),e.a().forEach(function(){}),t.a.wb.request(r,a).then(function(t){return t})}function Wr(t,e,i){e.Ca=!1,e.hc=!1,e.Ga=!0,t.a.N.clear(e.type).then(function(){if(!this.f&&i)return this.a.N.flush(e.type)}.bind(t)).then(function(){this.f||(e.qa=null,e.ra=null,e.Ga=!1,e.endOfStream=!1,zr(this,e,0))}.bind(t))}function zr(t,e,i){e.Ba=g.setTimeout(t.gg.bind(t,e),1e3*i)}function Kr(t){null!=t.Ba&&(g.clearTimeout(t.Ba),t.Ba=null)}function Yr(t,e){F(t.la).then(function(){this.f||(this.a.onError(e),e.handled||this.j.failureCallback(e))}.bind(t))}function Xr(t){if(t.G&&50<Object.keys(t.h).length){var e={};Object.keys(t.h).forEach(function(t){t=this.h[t],6e4<Date.now()-t.updateTime&&e.push(t)}.bind(t)),t.h=e}}function qr(t){var e=null,i=null;if(null!=t.g){var n=HTMLVideoElement.prototype,r=null,a=null;n.getVideoPlaybackQuality&&(a=!0),"webkitDroppedFrameCount"in n&&(r=!0),a?(t=t.g)&&(e=(i=t.getVideoPlaybackQuality()).droppedVideoFrames,i=i.totalVideoFrames):r&&(e=t.g.webkitDroppedFrameCount,i=t.g.webkitDecodedFrameCount)}return{droppedFrames:e,totalVideoFrames:i}}function Zr(t,e,i){e=t.b.periods[Ce(t.b,e)];var n="Manifest";return t.a&&t.a.wb&&(n=t.a.wb.rb(e.id,i)),n}function Qr(s,e){return new Promise(function(n,r){var a=new Qr.a;for(var t in a.open(e.method,s,!0),a.responseType="arraybuffer",a.timeout=e.retryParameters.timeout,a.withCredentials=e.allowCrossSiteCredentials,a.lastSegment=void 0!==e.userRequestExt.lastSegment&&e.userRequestExt.lastSegment,a.onload=function(t){var e=(t=t.target).getAllResponseHeaders().trim().split("\r\n").reduce(function(t,e){var i=e.split(": ");return t[i[0].toLowerCase()]=i.slice(1).join(": "),t},{});if(200<=t.status&&t.status<=299&&202!=t.status)t.responseURL&&(s=t.responseURL),n({uri:s,data:t.response,headers:e,fromCache:!!e["x-shaka-from-cache"],userResponseExt:{requestFilterTimeMs:void 0,responseFilterTimeMs:void 0,lastSegment:a.lastSegment}});else{var i=null;try{i=It(t.response)}catch(t){}r(new J(401==t.status||403==t.status?2:1,1,1001,s,t.status,i,e))}},a.onerror=function(){r(new J(1,1,1002,s))},a.ontimeout=function(){r(new J(1,1,1003,s))},e.headers)a.setRequestHeader(t,e.headers[t]);a.send(e.body)})}function Jr(t){this.a=null;for(var e=0;e<t.textTracks.length;++e){var i=t.textTracks[e];i.mode="disabled","Shaka Player TextTrack"==i.label&&(this.a=i)}this.a||(this.a=t.addTextTrack("subtitles","Shaka Player TextTrack")),this.a.mode="hidden",this.b=this.a.cues}function $r(t){if(t.startTime>=t.endTime)return null;var e=new VTTCue(t.startTime,t.endTime,t.payload);e.lineAlign=t.lineAlign,e.positionAlign=t.positionAlign,e.size=t.size;try{e.align=t.textAlign}catch(t){}return"center"==t.textAlign&&"center"!=e.align&&(e.align="middle"),2==t.writingDirection?e.vertical="lr":3==t.writingDirection&&(e.vertical="rl"),1==t.lineInterpretation&&(e.snapToLines=!1),null!=t.line&&(e.line=t.line),null!=t.position&&(e.position=t.position),e}function ta(t,e){for(var i=t.b,n=[],r=0;r<i.length;++r)e(i[r])&&n.push(i[r]);for(r=0;r<n.length;++r)t.a.removeCue(n[r])}function ea(){this.a=Promise.resolve(),this.b=this.c=this.f=!1,this.i=new Promise(function(t){this.g=t}.bind(this)),this.m=[],this.j=[]}function ia(t,e){si.call(this),this.I=!1,this.f=t,this.Nb=!1,this.C=null,this.u=new mt,this.i=this.jc=this.b=this.h=this.a=this.D=this.g=this.Kb=this.s=this.Ea=this.m=this.w=null,this.ge=1e9,this.Ib=[],this.Mb=!1,this.Fa=!0,this.W=this.mb=this.Wa=null,this.$c=!1,this.G=null,this.Lb=[],this.O={},this.c=fa(this),this.Jb={width:1/0,height:1/0},this.j=pa(),this.Hb=0,this.ja=this.c.preferredAudioLanguage,this.la=this.c.preferredTextLanguage,this.jb=this.kb="",e&&e(this),this.w=new st(this.Zf.bind(this)),this.lb=this.o=this.Da=null,this.Kb=aa(this),vt(this.u,this.f,"error",this.lf.bind(this))}function na(t){if(!t.Wa)return Promise.resolve();var e=Promise.resolve();return t.h&&(e=t.h.stop(),t.h=null),t=t.Wa.cancel(new J(2,7,7e3)),Promise.all([e,t])}sr.fontStyle=yr,sr.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},Er.prototype.parseInit=function(){},Er.prototype.parseMedia=function(t,e){var i=Ct(t);if(i=(i=i.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(i[0]))throw new J(2,2,2e3);var n=e.segmentStart;if(null==n&&(n=0)<=i[0].indexOf("X-TIMESTAMP-MAP")){var r=i[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),a=i[0].match(/MPEGTS:(\d+)/m);r&&a&&(n=wr(new br(r[1])),n=e.periodStart+(Number(a[1])/9e4-n))}for(a=[],r=1;r<i.length;r++){var s=i[r].split("\n"),o=n;if(1==s.length&&!s[0]||/^NOTE($|[ \t])/.test(s[0])||"STYLE"==s[0])var l=null;else{l=null,s[0].indexOf("--\x3e")<0&&(l=s[0],s.splice(0,1));var u=new br(s[0]),h=wr(u),c=_r(u,/[ \t]+--\x3e[ \t]+/g),d=wr(u);if(null==h||null==c||null==d)throw new J(2,2,2001);for(s=new sr(h+o,d+o,s.slice(1).join("\n").trim()),_r(u,/[ \t]+/gm),o=Tr(u);o;)Sr(s,o),_r(u,/[ \t]+/gm),o=Tr(u);null!=l&&(s.id=l),l=s}l&&a.push(l)}return a},ne["text/vtt"]=Er,ne['text/vtt; codecs="vtt"']=Er,(e=kr.prototype).destroy=function(){for(var t in this.c)Kr(this.c[t]);return null!=this.D&&(g.clearTimeout(this.D),this.D=null),this.g=this.C=this.u=null,this.h={},this.G=!1,this.s=0,this.j=this.c=this.o=this.i=this.I=this.b=this.a=null,this.f=!0,Promise.resolve()},e.configure=function(t){this.j=t,this.la=new U({maxAttempts:Math.max(t.retryParameters.maxAttempts,2),baseDelay:t.retryParameters.baseDelay,backoffFactor:t.retryParameters.backoffFactor,fuzzFactor:t.retryParameters.fuzzFactor,timeout:0},!0)},e.init=function(){var t=Jn(this.a.Qa);return(t=this.a.vd(this.b.periods[Ce(this.b,t)])).variant||t.text?(this.D=g.setTimeout(this.Zd.bind(this),.25),Mr(this,t).then(function(){!this.f&&this.a&&this.a.Te&&this.a.Te()}.bind(this))):Promise.reject(new J(2,5,5005))},e.gg=function(t){if(!this.f&&!t.Pa&&null!=t.Ba&&!t.Ga)if(t.Ba=null,t.Ca)Wr(this,t,t.hc);else{try{var e=function(t,e){var i=Jn(t.a.Qa),n=Gr(t,e,i),r=xe(t.b,e.stream),a=Ce(t.b,n),s=(l=t.a.N,u=e.type,h=i,"text"==u?null==(l=l.a).b||l.b<h?0:l.b-Math.max(h,l.a):qt(l=le(l,u),h)),o=Math.max(t.m*Math.max(t.b.minBufferTime||0,t.j.rebufferingGoal),t.m*t.j.bufferingGoal);var l,u,h;if(n>=t.b.presentationTimeline.ca())return e.endOfStream=!0,null;if(e.endOfStream=!1,(e.Oa=a)!=r)return null;if(o<=s)return.5;if(a=oe(t.a.N,e.type),!(a=function(t,e,i,n,r){if(e.ra&&e.stream==e.qa)return i=e.ra.position+1,jr(t,e,r,i);if(null==(i=e.ra?e.stream.findSegmentPosition(Math.max(0,t.b.periods[xe(t.b,e.qa)].startTime+e.ra.endTime-t.b.periods[r].startTime)):e.stream.findSegmentPosition(Math.max(0,(n||i)-t.b.periods[r].startTime))))return null;var a=null;return null==n&&(a=jr(t,e,r,Math.max(0,i-1))),a||jr(t,e,r,i)}(t,e,i,a,r)))return 1;var c=1/0;return At(t.c).forEach(function(t){c=Math.min(c,Gr(this,t,i))}.bind(t)),n>=c+t.b.presentationTimeline.a?1:(e.Ld=0,function(t,e,i,n,r){var a=t.b.periods[n],s=e.stream,o=t.b.presentationTimeline.ca(),l=t.b.periods[n+1];n=function(t,e,i,n,r){if(!e.Zb)return Promise.resolve();if(i=t.b.periods[i],a=t.a.N,s=e.type,o=i.startTime-e.stream.presentationTimeOffset,l=n,u=r,n="text"==s?(a.a.i=o,(a=a.a).h=l,a.g=u,Promise.resolve()):Promise.all([he(a,s,a.he.bind(a,s)),he(a,s,a.Vf.bind(a,s,o)),he(a,s,a.Pf.bind(a,s,l,u))]),!e.stream.initSegmentReference)return n;var a,s,o,l,u;r=1,"video"===e.stream.type?r=4:"audio"===e.stream.type&&(r=5);var h=e.stream.initSegmentReference.a();return h=rt(0<h.length?h[0]:"",!1),i={periodId:Zr(t,i.startTime,h),kc:r,lastSegment:!1},t=Vr(t,e.stream.initSegmentReference,i).then(function(t){if(!this.f)return e.stream.initSegmentReference.a(),ue(this.a.N,e.type,t.data,null,null)}.bind(t)).catch(function(t){return e.Zb=!0,Promise.reject(t)}),Promise.all([n,t])}(t,e,n,Math.max(0,a.startTime-.1),l?l.startTime:o),e.Pa=!0,e.Zb=!1,o=1,"video"===e.stream.type?o=6:"audio"===e.stream.type&&(o=7),l=rt(0<(l=r.a()).length?l[0]:"",!1),l=Zr(t,a.startTime+r.startTime,l);var u=!1;"video"===e.stream.type&&"number"==typeof t.g.duration&&Math.abs(r.endTime-t.g.duration)<1&&(u=!0),o=Vr(t,r,{periodId:l,kc:o,lastSegment:u}),Promise.all([n,o]).then(function(t){if(!this.f&&!this.w)return function(t,i,e,n,r,a,s){if(s.data){var o=s.data?s.data:new ArrayBuffer(0);s="text/vtt"==s.headers["content-type"]||s.uri.match(".vtt"),r.containsEmsgBoxes&&!s&&(new Fi).na("emsg",t.sf.bind(t,n,a)).parse(o)}return(l=t,u=i,h=e,c=Math.max(l.j.bufferBehind,l.b.presentationTimeline.a),d=se(l.a.N,u.type),null==d?Promise.resolve():(h=h-d-c)<=0?Promise.resolve():l.a.N.remove(u.type,d,d+h).then(function(){}.bind(l))).then(function(){if(!this.f)return ue(this.a.N,i.type,o,a.startTime+n.startTime,a.endTime+n.startTime)}.bind(t)).then(function(){if(!this.f){if("video"==i.type&&null!=i.qa&&i.qa!=i.stream){var t=(new Date).getTime(),e=qr(this);i.stream.streamStats.lastDecodedFrames=e.totalVideoFrames,i.stream.streamStats.lastDroppedFrames=e.droppedFrames,i.stream.streamStats.lastDetectTime=t}return i.qa=r,i.ra=a,Promise.resolve()}}.bind(t));var l,u,h,c,d}(this,e,i,a,s,r,t[1])}.bind(t)).then(function(){Jt(this.g.buffered,!1),this.C&&("video"===e.stream.type?this.C.Td(e.stream):"audio"===e.stream.type&&this.C.Sd(e.stream)),this.f||this.w||(e.Pa=!1,e.Qc=!1,e.Ca||this.a.xb(),zr(this,e,0),function(t,e){if(!t.O&&(t.O=At(t.c).every(function(t){return"text"==t.type||!t.Ca&&!t.Ga&&t.ra}),t.O)){var i=xe(t.b,e);for(t.i[i]||Fr(t,i).then(function(){this.f||this.a.ud()}.bind(t)).catch(tt),i=0;i<t.b.periods.length;++i)Fr(t,i).catch(tt);t.a.jf&&t.a.jf()}}(this,s))}.bind(t)).catch(function(t){this.f||this.w||(e.Pa=!1,"text"==e.type&&this.j.ignoreTextStreamFailures||(3017==t.code?function(t,e,i){if(!At(t.c).some(function(t){return t!=e&&t.Qc})){var n=Math.round(100*t.m);if(20<n)t.m-=.2;else{if(!(4<n))return e.tb=!0,t.w=!0,t.a.onError(i);t.m-=.04}e.Qc=!0}zr(t,e,4)}(this,e,t):(e.tb=!0,t.severity=2,Yr(this,t))))}.bind(t))}(t,e,i,r,a),null)}(this,t);null!=e&&(zr(this,t,e),t.tb=!1)}catch(t){return void Yr(this,t)}e=At(this.c),function(t,e){if(e.Oa!=xe(t.b,e.stream)){var r=e.Oa,a=At(t.c);a.every(function(t){return t.Oa==r})&&a.every(Hr)&&Fr(t,r).then(function(){if(!this.f&&a.every(function(t){var e=xe(this.b,t.stream);return Hr(t)&&t.Oa==r&&e!=r}.bind(this))){var t=this.b.periods[r],e=this.a.vd(t),i={};for(var n in e.variant&&e.variant.video&&(i.video=e.variant.video),e.variant&&e.variant.audio&&(i.audio=e.variant.audio),e.text&&(i.text=e.text),this.c)if(!i[n]&&"text"!=n)return void this.a.onError(new J(2,5,5005));for(n in i)if(!this.c[n]){if("text"!=n)return void this.a.onError(new J(2,5,5005));Mr(this,{text:i.text},t.startTime),delete i[n]}for(n in this.c)(t=i[n])?(Nr(this,t,!1),zr(this,this.c[n],0)):delete this.c[n];this.a.ud()}}.bind(t)).catch(tt)}}(this,t),e.every(function(t){return t.endOfStream})&&this.a.N.endOfStream().then(function(){if(!this.f){var t=this.a.N.ca();t<this.b.presentationTimeline.ca()&&this.b.presentationTimeline.Sa(t)}}.bind(this))}},e.sf=function(t,e,i){var n=i.A.Nc(),r=i.A.Nc(),a=i.A.H(),s=i.A.H(),o=i.A.H(),l=i.A.H();i=i.A.Ra(i.A.K.byteLength-i.A.da()),t=t.startTime+e.startTime+s/a,"urn:mpeg:dash:event:2012"==n?this.a.We():(n={startTime:t,endTime:t+o/a,schemeIdUri:n,value:r,timescale:a,presentationTimeDelta:s,eventDuration:o,id:l,messageData:i},this.a.onEvent(new Tt("emsg",{detail:n})),this.u&&this.u.ad(n))},e.bc=function(t){this.u=t,this.u.media=this.g,this.u.f=this.a},e.U=function(t){this.C=t},e.Xb=function(t){t=this.b.periods[Ce(this.b,t)];var e=[];if(this.b&&this.b.periods)for(var i=0;i<this.b.periods.length;i++);return t&&(e=t.thumbnailStreams),e},e.zc=function(t,e,i){var s={ua:null,ub:-1,url:null},o=new Promise(function(){});e+=i;var n=this.Xb(e);if(!(0<n.length))return o;i=null;for(var r=0;r<n.length;r++){var a=n[r].strId.split(","),l=t.split(",");if(0<a.length&&0<l.length&&a[1]===l[1]){i=n[r];break}}if(null==i)return o;i.createSegmentIndex().then(function(){}).catch(function(){});var u=i.presentationTimeOffset;if(null==(t=i.findSegmentPosition(e-u)))return o;var h=i.getSegmentReference(t);if(!h)return o;var c=0<(t=h.a()).length?t[0]:"";if(!(t=function(t,e){var i=null;if(t.G&&t.h[e]){var n=t.h[e];i=n[n],n.updateTime=Date.now()}return i}(this,c)))return 50<this.s?o:(e={periodId:Zr(this,e,t=rt(c,!1)),kc:void 0,lastSegment:!1},e=Vr(this,h,e),this.s+=1,e.then(function(t){o.then(function(){}).catch(function(){});var e,i,n,r=h.a().toString(),a=r.split("/");return null!=a&&2<a.length&&(a=r.search(a[a.length-2]),r=r.substring(0,a)),s.ua=(new Er).parseMedia(t.data,{periodStart:0,segmentStart:0,segmentEnd:0}),s.ub=h.startTime+u,s.url=r,Xr(this),i=c,n=s,(e=this).G&&(e.h[i]?e.h[i].og=Date.now():e.h[i]={og:Date.now(),zg:n}),--this.s,s}.bind(this)).catch(function(){return--this.s,o}.bind(this)));s=t,Xr(this)},e.Zd=function(){var t=this.c.video;if(null!=t&&null!=t.stream&&(null==t.qa||t.stream==t.qa)){var e=qr(this);if(t=t.stream,null!=e&&null!=e.droppedFrames&&null!=e.totalVideoFrames){var i=(new Date).getTime();if(6e4<i-t.streamStats.lastDetectTime){var n=(e.droppedFrames-t.streamStats.lastDroppedFrames)/(e.totalVideoFrames-t.streamStats.lastDecodedFrames);8e5<t.bandwidth&&(59.97<=t.frameRate&&.25<n||t.frameRate<59.97&&.025<n)&&(t.streamStats.meetSwithThreshold=!0),t.streamStats.lastDroppedFrames=e.droppedFrames,t.streamStats.lastDecodedFrames=e.totalVideoFrames,t.streamStats.lastDetectTime=i,t.streamStats.meetSwithThreshold&&(null==t.streamStats.firstThresholdSwitchTime&&(t.streamStats.firstThresholdSwitchTime=i),t.streamStats.lastThresholdSwitchTime=i)}}}this.D=g.setTimeout(this.Zd.bind(this),.25)},d("shaka.net.HttpPlugin",Qr),Qr.a=g.XMLHttpRequest,lt("http",Qr,1),lt("https",Qr,1),d("shaka.text.SimpleTextDisplayer",Jr),Jr.prototype.remove=Jr.prototype.remove=function(e,i){return!!this.a&&(ta(this,function(t){return!(t.startTime>=i||t.endTime<=e)}),!0)},Jr.prototype.append=Jr.prototype.append=function(t){for(var i=[],e=0;e<t.length;e++){var n=$r(t[e]);n&&i.push(n)}i.slice().sort(function(t,e){return t.startTime!=e.startTime?t.startTime-e.startTime:t.endTime!=e.endTime?t.endTime-e.startTime:i.indexOf(e)-i.indexOf(t)}).forEach(function(t){this.a.addCue(t)}.bind(this))},Jr.prototype.destroy=Jr.prototype.destroy=function(){return this.a&&ta(this,function(){return!0}),this.a=null,Promise.resolve()},Jr.prototype.isTextVisible=Jr.prototype.isTextVisible=function(){return"showing"==this.a.mode},Jr.prototype.setTextVisibility=Jr.prototype.setTextVisibility=function(t){this.a.mode=t?"showing":"hidden"},ea.prototype.then=function(t){return this.a=this.a.then(t).then(function(t){return this.b?(this.g(),Promise.reject(this.h)):Promise.resolve(t)}.bind(this)),this},ea.prototype.cancel=function(t){return this.c?Promise.resolve():(this.b=!0,this.h=t,this.j.forEach(function(t){t()}),this.i)},f(ia,si),d("shaka.Player",ia),ia.prototype.destroy=ia.prototype.destroy=function(){return this.I=!0,na(this).then(function(){var t=Promise.all([this.mb,ca(this),this.u?this.u.destroy():null,this.w?this.w.destroy():null]);return this.f=null,this.Nb=!1,this.c=this.w=this.i=this.u=null,this.Da&&(this.Da.destroy(),this.Da=null),this.o&&(this.o.destroy(),this.o=null),this.lb&&(this.lb.destroy(),this.lb=null),t}.bind(this))},ia.version="2.3.10-npm-dirty";var ra={};function aa(t){t.Ea=new MediaSource;var e=new M;return vt(t.u,t.Ea,"sourceopen",e.resolve),t.f.src=g.URL.createObjectURL(t.Ea),e}function sa(e){if(e.h&&e.h.configure(e.c.manifest),e.m&&e.m.configure(e.c.drm),e.a){e.a.configure(e.c.streaming);try{e.b.periods.forEach(e.Sb.bind(e))}catch(t){e.hb(t)}var t=Pr(e.a),i=Cr(e.a),n=Ar(e.a);(t=Pe(t,i,n.variants))&&t.allowedByApplication&&t.allowedByKeySystem||ya(e,n)}e.i&&(e.i.configure(e.c.abr),e.c.abr.enabled&&!e.Fa?e.i.enable():e.i.disable())}function oa(t){var i=[];return t.forEach(function(t){if(t){var e=t.language;t.roles.length?t.roles.forEach(function(t){i.push({language:e,role:t})}):i.push({language:e,role:""})}else i.push({language:"und",role:""})}),dt(i,function(t,e){return t.language==e.language&&t.role==e.role})}function la(t,e,i){e.video&&ha(t,e.video),e.audio&&ha(t,e.audio);var n=Lr(t.a);e!=Pe(Pr(t.a),Cr(t.a),n?n.variants:[])&&t.j.switchHistory.push({timestamp:Date.now()/1e3,id:e.id,type:"variant",fromAdaptation:i,bandwidth:e.bandwidth})}function ua(t,e,i){ha(t,e),t.j.switchHistory.push({timestamp:Date.now()/1e3,id:e.id,type:"text",fromAdaptation:i,bandwidth:null})}function ha(t,e){var i=xe(t.b,e);t.O[i]||(t.O[i]={}),t.O[i][e.type]=e.id}function ca(t){t.u&&(t.u.ta(t.Ea,"sourceopen"),t.u.ta(t.f,"loadeddata"),t.u.ta(t.f,"playing"),t.u.ta(t.f,"pause"),t.u.ta(t.f,"ended")),t.f&&(t.f.removeAttribute("src"),t.f.load());var e=Promise.all([t.i?t.i.stop():null,t.m?t.m.destroy():null,t.s?t.s.destroy():null,t.g?t.g.destroy():null,t.D?t.D.destroy():null,t.a?t.a.destroy():null,t.h?t.h.stop():null,t.C?t.C.destroy():null]);return t.Fa=!0,t.m=null,t.s=null,t.g=null,t.D=null,t.a=null,t.h=null,t.C=null,t.b=null,t.jc=null,t.Kb=null,t.Ea=null,t.Lb=[],t.O={},t.j=pa(),e}function da(){return{".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0)}}}function fa(t){var e=5e5,i=1/0;return navigator.connection&&navigator.connection.type&&(e=1e6*navigator.connection.downlink,navigator.connection.saveData&&(i=360)),{drm:{retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1},manifest:{retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},dash:{customScheme:function(t){if(t)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10}},streaming:{retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},failureCallback:t.oe.bind(t),rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:1,jumpLargeGaps:!0,durationBackoff:1,neulionGapDealing:!0,safeEdgeEndSize:.3,safeEdgeBeginSize:.01},abrFactory:Be,textDisplayFactory:function(t){return new Jr(t)}.bind(null,t.f),abr:{enabled:!0,defaultBandwidthEstimate:e,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:i,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0},startBitrate:0},preferredAudioLanguage:"",preferredTextLanguage:"",restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,vg:{label:"English",language:"en"},debugConfig:{gapTolerance:{firefox:.02,ie:.02,edge:.02,chrome:.03,safari:.02,others:.02}}}}function pa(){return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:0,bufferingTime:0,switchHistory:[],stateHistory:[],bytesLoaded:[],currentCdnIndex:"",livePointOffest:NaN}}function ga(t,e,i){t.Fa?(t.W=e,t.$c=i||!1):Dr(t.a,e,i||!1)}function ma(t){if(t.b){var e=Date.now()/1e3;t.Mb?t.j.bufferingTime+=e-t.Hb:t.j.playTime+=e-t.Hb,t.Hb=e}}function va(t,e){return e&&e.length?(t.i.setVariants(e),t.i.chooseVariant()):(t.hb(new J(2,4,4012)),null)}function ya(t,e){var i=we(e.variants,t.ja,t.kb),n=ke(e.textStreams,t.la,t.jb);(i=va(t,i))&&(la(t,i,!0),ga(t,i,!0)),(n=n[0])&&(t.c.streaming.alwaysStreamText||t.Ec())&&(ua(t,n,!0),t.Fa?t.G=n:Nr(t.a,n,!0)),ba(t)}function ba(t){Promise.resolve().then(function(){this.I||this.dispatchEvent(new Tt("adaptation"))}.bind(t))}function _a(t){Promise.resolve().then(function(){this.I||this.dispatchEvent(new Tt("trackschanged"))}.bind(t))}function Ta(t){t.dispatchEvent(new Tt("texttrackvisibility"))}ia.registerSupportPlugin=function(t,e){ra[t]=e},ia.isBrowserSupported=function(){return!!(g.Promise&&g.Uint8Array&&Array.prototype.forEach&&g.MediaSource&&MediaSource.isTypeSupported&&g.MediaKeys&&g.navigator&&g.navigator.requestMediaKeySystemAccess&&g.MediaKeySystemAccess&&g.MediaKeySystemAccess.prototype.getConfiguration)},ia.probeSupport=function(){return(e=[],t=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],n=[{videoCapabilities:t,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:t}],r={},"org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").forEach(function(i){var t=navigator.requestMediaKeySystemAccess(i,n).then(function(t){var e=t.getConfiguration().sessionTypes;return e=!!e&&0<=e.indexOf("persistent-license"),0<=navigator.userAgent.indexOf("Tizen 3")&&(e=!1),r[i]={persistentState:e},t.createMediaKeys()}).catch(function(){r[i]=null});e.push(t)}),Promise.all(e).then(function(){return r})).then(function(t){var i,e=function(){var t,e={};for(t in un)e[t]=!0;for(t in hn)e[t]=!0;return["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"].forEach(function(t){e[t]=!!un[t]}),["mpd","m3u8","ism"].forEach(function(t){e[t]=!!hn[t]}),e}(),n=(i={},'video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").forEach(function(t){i[t]=!!ne[t]||MediaSource.isTypeSupported(t)||te(t);var e=t.split(";")[0];i[e]=i[e]||i[t]}),i);for(var r in t={manifest:e,media:n,drm:t},ra)t[r]=ra[r]();return t});var e,t,n,r},ia.prototype.load=ia.prototype.load=function(a,t,s){var e=this.ec(),i=new ea;this.Wa=i,this.dispatchEvent(new Tt("loading"));var n,r=Date.now();return(n=i.then(function(){return e}).then(function(){return this.o=new Ie,this.o.init(this.f,this.c.abr.startBitrate,this.c.preferredAudioLanguage),this.Da=new En,this.Da.U(this.o),this.lb=new G,this.w.Pd(this.lb),this.j=pa(),vt(this.u,this.f,"playing",this.Fb.bind(this)),vt(this.u,this.f,"pause",this.Fb.bind(this)),vt(this.u,this.f,"ended",this.Fb.bind(this)),this.i=new this.c.abrFactory,this.i.configure(this.c.abr),this.i.U(this.o),this.C=new this.c.textDisplayFactory,this.C.setTextVisibility(this.Nb),e=a,t=this.w,i=this.c.manifest.retryParameters,(r=n=s)||1<(n=new E(e).X.split("/").pop().split(".")).length&&(n=n.pop().toLowerCase(),r=hn[n]),r?Promise.resolve(r):((i=ut([e],i)).method="HEAD",t.request(0,i).then(function(t){return(t=t.headers["content-type"])&&(t=t.toLowerCase()),(r=un[t])?r:Promise.reject(new J(2,4,4e3,e))},function(t){return t.severity=2,Promise.reject(t)}));var e,t,i,n,r}.bind(this)).then(function(t){return this.h=new t,this.h.configure(this.c.manifest),this.h.bc(this.Da),this.h.U(this.o),this.h.start(a,{networkingEngine:this.w,filterNewPeriod:this.Sb.bind(this),filterAllPeriods:this.rc.bind(this),onTimelineRegionAdded:this.kf.bind(this),onEvent:this.Cb.bind(this),onError:this.hb.bind(this),Qa:null})}.bind(this)).then(function(t){if(t.periods.some(function(t){return t.variants.some(function(t){return t.video&&t.audio})})&&t.periods.forEach(function(t){t.variants=t.variants.filter(function(t){return t.video&&t.audio})}),0==t.periods.length)throw new J(2,4,4014);return this.b=t,this.jc=a,this.m=new Ht({wb:this.w,onError:this.hb.bind(this),Ue:this.Ve.bind(this),onExpirationUpdated:this.Re.bind(this),onEvent:this.Cb.bind(this)}),this.m.configure(this.c.drm),this.m.init(t,!1)}.bind(this)).then(function(){this.rc(this.b.periods),this.Hb=Date.now()/1e3,this.ja=this.c.preferredAudioLanguage,this.la=this.c.preferredTextLanguage;var t=this.b.presentationTimeline.ca(),e=this.c.playRangeEnd,i=this.c.playRangeStart;return 0<i&&(this.T()||this.b.presentationTimeline.Wd(i)),e<t&&(this.T()||this.b.presentationTimeline.Sa(e)),Promise.all([Vt(this.m,this.f),this.Kb])}.bind(this)).then(function(){return this.i.init(this.$f.bind(this)),this.g=new Qn(this.f,this.b,this.c.streaming,null==t?null:t,this.Yf.bind(this),this.Cb.bind(this)),this.g.U(this.o),this.g.Bb(this.c.debugConfig),this.D=new ir(this.f,this.Ea,this.b,this.c.streaming,this.Xd.bind(this),this.Cb.bind(this),this.Xf.bind(this)),this.s=new re(this.f,this.Ea,this.C),this.a=new kr(this.b,{Qa:this.g,N:this.s,wb:this.w,vd:this.Pe.bind(this),ud:this.ke.bind(this),onError:this.hb.bind(this),onEvent:this.Cb.bind(this),We:this.Xe.bind(this),xb:this.gf.bind(this),filterNewPeriod:this.Sb.bind(this),filterAllPeriods:this.rc.bind(this)}),this.a.g=this.f,this.a.bc(this.Da),this.a.U(this.o),this.a.configure(this.c.streaming),function(t){function i(t){return(t.video?t.video.codecs.split(".")[0]:"")+"-"+(t.audio?t.audio.codecs.split(".")[0]:"")}var n={};t.b.periods.forEach(function(t){t.variants.forEach(function(t){var e=i(t);e in n||(n[e]=[]),n[e].push(t)})});var a=null,s=1/0;e=n,r=function(t,e){var i=0,n=0;e.forEach(function(t){i+=t.bandwidth||0,++n});var r=i/n;r<s&&(a=t,s=r)},Object.keys(e).forEach(function(t){r(t,e[t])}),t.b.periods.forEach(function(t){t.variants=t.variants.filter(function(t){return i(t)==a})});var e,r}(this),this.dispatchEvent(new Tt("streaming")),this.a.init()}.bind(this)).then(function(){if(this.c.streaming.startAtSegmentBoundary){var t=function(t,e){function i(t,e){if(!t)return null;var i=t.findSegmentPosition(e-a.startTime);return null==i?null:(i=t.getSegmentReference(i))?i.startTime+a.startTime:null}var n=Pr(t.a),r=Cr(t.a),a=Ar(t.a);return n=i(n,e),null!=(r=i(r,e))&&null!=n?Math.max(r,n):null!=r?r:null!=n?n:e}(this,Jn(this.g));qn(this.g.a,t)}this.b.periods.forEach(this.Sb.bind(this)),_a(this),ba(this);var e=we((t=Ar(this.a)).variants,this.ja,this.kb);this.i.setVariants(e),t.variants.some(function(t){return t.primary}),this.Lb.forEach(this.D.s.bind(this.D)),this.Lb=[],yt(this.u,this.f,"loadeddata",function(){this.j.loadLatency=(Date.now()-r)/1e3}.bind(this)),this.Wa=null}.bind(this)),n.f||(n.a=n.a.then(function(t){return this.c=!0,this.m.forEach(function(t){t()}),Promise.resolve(t)}.bind(n),function(t){return this.c=!0,this.b?(this.g(),Promise.reject(this.h)):Promise.reject(t)}.bind(n))),n.f=!0,n.a).catch(function(t){return this.Wa==i&&(this.Wa=null,this.dispatchEvent(new Tt("unloading"))),Promise.reject(t)}.bind(this))},ia.prototype.configure=ia.prototype.configure=function(t){Z(this.c,t,fa(this),da(),""),sa(this)},ia.prototype.getConfiguration=ia.prototype.getConfiguration=function(){var t=fa(this);return Z(t,this.c,fa(this),da(),""),t},ia.prototype.resetConfiguration=ia.prototype.Gf=function(){this.c=fa(this),sa(this)},ia.prototype.getMediaElement=ia.prototype.ye=function(){return this.f},ia.prototype.getNetworkingEngine=ia.prototype.md=function(){return this.w},ia.prototype.getManifestUri=ia.prototype.xc=function(){return this.jc},ia.prototype.isLive=ia.prototype.T=function(){return!!this.b&&this.b.presentationTimeline.T()},ia.prototype.isInProgress=ia.prototype.$a=function(){return!!this.b&&this.b.presentationTimeline.$a()},ia.prototype.isAudioOnly=ia.prototype.Le=function(){if(!this.b||!this.b.periods.length)return!1;var t=this.b.periods[0].variants;return!!t.length&&!t[0].video},ia.prototype.seekRange=ia.prototype.Kf=function(){var t=0,e=0;return this.b&&(t=(e=this.b.presentationTimeline).Za(),e=e.oa()),{start:t,end:e}},ia.prototype.keySystem=ia.prototype.keySystem=function(){return this.m?this.m.keySystem():""},ia.prototype.drmInfo=ia.prototype.drmInfo=function(){return this.m?this.m.b:null},ia.prototype.getExpiration=ia.prototype.wc=function(){return this.m?this.m.wc():1/0},ia.prototype.isBuffering=ia.prototype.rd=function(){return this.Mb},ia.prototype.unload=ia.prototype.ec=function(){return this.I?Promise.resolve():(this.dispatchEvent(new Tt("unloading")),na(this).then(function(){var t;return this.mb||(this.mb=(t=this,t.h?ca(t).then(function(){this.I||(this.Xd(!1),this.Kb=aa(this))}.bind(t)):Promise.resolve()).then(function(){this.mb=null}.bind(this))),this.mb}.bind(this)))},ia.prototype.getPlaybackRate=ia.prototype.qb=function(){return this.g?this.g.qb():0},ia.prototype.trickPlay=ia.prototype.ig=function(t){this.g&&Zn(this.g.a,t),this.a&&Rr(this.a,1!=t)},ia.prototype.cancelTrickPlay=ia.prototype.le=function(){this.g&&Zn(this.g.a,1),this.a&&Rr(this.a,!1)},ia.prototype.getVariantTracks=ia.prototype.Je=function(){if(!this.b||!this.g)return[];var t,u,h,e=Ce(this.b,Jn(this.g)),i=this.O[e]||{};return t=this.b.periods[e],u=i.audio,h=i.video,Se(t.variants).map(function(t){var e=t.audio,i=t.video,n=e?e.codecs:null,r=i?i.codecs:null,a=[];r&&a.push(r),n&&a.push(n);var s=[];i&&s.push(i.mimeType),e&&s.push(e.mimeType),s=s[0]||null;var o=[];e&&o.push(e.kind),i&&o.push(i.kind),o=o[0]||null;var l=[];return e&&l.push.apply(l,e.roles),i&&l.push.apply(l,i.roles),l=dt(l),n={id:t.id,active:!1,type:"variant",bandwidth:t.bandwidth,language:t.language,label:null,kind:o,width:null,height:null,frameRate:null,mimeType:s,codecs:a.join(", "),audioCodec:n,videoCodec:r,primary:t.primary,roles:l,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,displayName:t.audio?t.audio.displayName:null},i&&(n.videoId=i.id,n.width=i.width||null,n.height=i.height||null,n.frameRate=i.frameRate||null,n.videoBandwidth=i.bandwidth||null),e&&(n.audioId=e.id,n.channelsCount=e.channelsCount,n.audioBandwidth=e.bandwidth||null,n.label=e.label),t.video&&t.audio?n.active=h==t.video.id&&u==t.audio.id:t.video?n.active=h==t.video.id:t.audio&&(n.active=u==t.audio.id),n})},ia.prototype.getTextTracks=ia.prototype.He=function(){if(!this.b||!this.g)return[];var t,i,e=Ce(this.b,Jn(this.g)),n=this.O[e]||{};if(!n.text){var r=ke(this.b.periods[e].textStreams,this.la,this.jb);r.length&&(n.text=r[0].id)}return(t=this.b.periods[e],i=n.text,t.textStreams.map(function(t){var e={id:t.id,active:!1,type:"text",bandwidth:0,language:t.language,label:t.label,kind:t.kind||null,width:null,height:null,frameRate:null,mimeType:t.mimeType,codecs:t.codecs||null,audioCodec:null,videoCodec:null,primary:t.primary,roles:t.roles,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,displayName:t.displayName?t.displayName:null};return e.active=i==t.id,e})).filter(function(t){return this.Ib.indexOf(t.id)<0}.bind(this))},ia.prototype.selectTextTrack=ia.prototype.Nf=function(t){if(this.a){var e=Ar(this.a);t:{for(var i=0;i<e.textStreams.length;i++)if(e.textStreams[i].id==t.id){t=e.textStreams[i];break t}t=null}t&&(ua(this,t,!1),e=t,this.Fa?this.G=e:Nr(this.a,e,!0),this.la=t.language)}},ia.prototype.selectVariantTrack=ia.prototype.Of=function(t,e){if(this.a){this.c.abr.enabled&&b("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var i=Ar(this.a);t:{for(var n=0;n<i.variants.length;n++)if(i.variants[n].id==t.id){i=i.variants[n];break t}i=null}i&&Ee(i)&&(la(this,i,!1),ga(this,i,e),this.ja=i.language)}},ia.prototype.getAudioLanguagesAndRoles=ia.prototype.te=function(){if(!this.a)return[];var t=Ar(this.a);return oa(t=Se(t.variants).map(function(t){return t.audio}).filter(it))},ia.prototype.getTextLanguagesAndRoles=ia.prototype.Ge=function(){return this.a?oa(Ar(this.a).textStreams):[]},ia.prototype.getAudioLanguages=ia.prototype.se=function(){return this.a?Se(Ar(this.a).variants).map(function(t){return t.language}).filter(it):[]},ia.prototype.getTextLanguages=ia.prototype.Fe=function(){return this.a?Ar(this.a).textStreams.map(function(t){return t.language}).filter(it):[]},ia.prototype.selectAudioLanguage=ia.prototype.Lf=function(t,e){if(this.a){var i=Ar(this.a);this.ja=t,this.kb=e||"",ya(this,i)}},ia.prototype.selectTextLanguage=ia.prototype.Mf=function(t,e){if(this.a){var i=Ar(this.a);this.la=t,this.jb=e||"",ya(this,i)}},ia.prototype.isTextTrackVisible=ia.prototype.Ec=function(){return this.C?this.C.isTextVisible():this.Nb},ia.prototype.setTextTrackVisibility=ia.prototype.Uf=function(t){this.C&&this.C.setTextVisibility(t),this.Nb=t,Ta(this),!this.c.streaming.alwaysStreamText&&this.a&&(t?(t=ke((t=Ar(this.a)).textStreams,this.la,this.jb)[0])&&Ir(this.a,t):((t=this.a).ja=!0,t.c.text&&(Kr(t.c.text),delete t.c.text)))},ia.prototype.getPlayheadTimeAsDate=ia.prototype.Be=function(){return this.b?new Date(1e3*this.b.presentationTimeline.b+1e3*this.f.currentTime):null},ia.prototype.getPresentationStartTimeAsDate=ia.prototype.De=function(){return this.b?new Date(1e3*this.b.presentationTimeline.b):null},ia.prototype.getBufferedInfo=ia.prototype.tc=function(){return this.s?this.s.tc():{total:[],audio:[],video:[],text:[]}},ia.prototype.getStats=ia.prototype.getStats=function(){ma(this),this.Fb();var t=null,e=null,i=this.f;if(i=i&&i.getVideoPlaybackQuality?i.getVideoPlaybackQuality():{},this.g&&this.b){var n=Ce(this.b,Jn(this.g)),r=this.b.periods[n];(n=this.O[n])&&(t=(e=function(t,e,i){function n(t,e){return null==t?null==e:e.id==t}for(var r=0;r<i.length;r++)if(n(t,i[r].audio)&&n(e,i[r].video))return i[r];return null}(n.audio,n.video,r.variants)).video||{})}return t||(t={}),e||(e={}),r=-1,this.f&&this.f.currentTime&&this.b&&(r=this.b.presentationTimeline.aa()-this.f.currentTime),{width:t.width||0,height:t.height||0,streamBandwidth:e.bandwidth||0,decodedFrames:Number(i.totalVideoFrames),droppedFrames:Number(i.droppedVideoFrames),estimatedBandwidth:this.i?this.i.getBandwidthEstimate():NaN,loadLatency:this.j.loadLatency,playTime:this.j.playTime,bufferingTime:this.j.bufferingTime,switchHistory:Q(this.j.switchHistory),stateHistory:Q(this.j.stateHistory),bytesLoaded:this.w.ob(),currentCdnIndex:this.w.pb(),livePointOffest:r}},ia.prototype.addTextTrack=ia.prototype.addTextTrack=function(e,i,n,t,r,a){if(!this.a)return Promise.reject();for(var s,o=Ar(this.a),l=0;l<this.b.periods.length;l++)if(this.b.periods[l]==o){if(l==this.b.periods.length-1){if(1/0==(s=this.b.presentationTimeline.ca()-o.startTime))return Promise.reject()}else s=this.b.periods[l+1].startTime-o.startTime;break}var u={id:this.ge++,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(t){return 1!=t?null:new Di(1,0,s,function(){return[e]},0,null)},initSegmentReference:null,presentationTimeOffset:0,mimeType:t,codecs:r||"",kind:n,encrypted:!1,keyId:null,language:i,label:a||null,type:"text",primary:!1,trickModeVideo:null,containsEmsgBoxes:!1,roles:[],channelsCount:null,displayName:""};return this.Ib.push(u.id),o.textStreams.push(u),Ir(this.a,u).then(function(){if(!this.I){var t=this.b.periods.indexOf(o),e=xr(this.a,"text");return e&&(this.O[t].text=e.id),this.Ib.splice(this.Ib.indexOf(u.id),1),ya(this,o),_a(this),{id:u.id,active:!1,type:"text",bandwidth:0,language:i,label:a||null,kind:n,width:null,height:null}}}.bind(this))},ia.prototype.setMaxHardwareResolution=ia.prototype.Sc=function(t,e){this.Jb.width=t,this.Jb.height=e},ia.prototype.retryStreaming=ia.prototype.Md=function(){if(this.a){var t=this.a;if(t.f)t=!1;else if(t.w)t=!1;else{for(var e in t.c){var i=t.c[e];i.tb&&(i.tb=!1,zr(t,i,.1))}t=!0}}else t=!1;return t},ia.prototype.getManifest=ia.prototype.ld=function(){return this.b},(e=ia.prototype).oe=function(t){this.T()&&0<=[1001,1002,1003].indexOf(t.code)&&(t.severity=1,this.Md())},e.rc=function(t){t.forEach(_e.bind(null,this.m,this.a?Pr(this.a):null,this.a?Cr(this.a):null));var e,i,n=(e=function(t){return t.variants.some(Ee)},i=0,t.forEach(function(t){i+=e(t)?1:0}),i);if(0==n)throw new J(2,4,4032);if(n<t.length)throw new J(2,4,4011);t.forEach(function(t){if(be(t,this.c.restrictions,this.Jb)&&this.a&&Ar(this.a)==t&&_a(this),!t.variants.some(Ee))throw new J(2,4,4012)}.bind(this))},e.Sb=function(t){_e(this.m,this.a?Pr(this.a):null,this.a?Cr(this.a):null,t);var e=t.variants,i=e.some(Ee);if(be(t,this.c.restrictions,this.Jb)&&this.a&&Ar(this.a)==t&&_a(this),t=e.some(Ee),!i)throw new J(2,4,4011);if(!t)throw new J(2,4,4012)},e.Zf=function(t,e){this.i&&this.i.segmentDownloaded(t,e)},e.Xd=function(t){if(ma(this),this.Mb=t,this.Fb(),this.g){var e=this.g.a;t!=e.g&&(e.g=t,Zn(e,e.f))}this.dispatchEvent(new Tt("buffering",{buffering:t}))},e.Xf=function(){Promise.resolve().then(function(){this.I||this.dispatchEvent(new Tt("periodschanged"))}.bind(this))},e.Fb=function(){if(!this.I){var t=this.Mb?"buffering":this.f.ended?"ended":this.f.paused?"paused":"playing",e=Date.now()/1e3;if(this.j.stateHistory.length){var i=this.j.stateHistory[this.j.stateHistory.length-1];if(i.duration=e-i.timestamp,t==i.state)return}this.j.stateHistory.push({timestamp:e,state:t,duration:0})}},e.Yf=function(){if(this.D){var t=this.D;t.c.forEach(t.o.bind(t,!0))}var e,i;this.a&&(e=this.a,i=Jn(e.a.Qa),Object.keys(e.c).every(function(t){var e=this.a.N;return t="text"==t?(t=e.a,i>=t.a&&i<t.b):Xt(t=le(e,t),i)}.bind(e))||Or(e))},e.Pe=function(t){this.o&&(this.o.Tc(!0),Jn(this.g),se(this.s,"audio"),se(this.s,"video"),oe(this.s,"audio"),oe(this.s,"video")),this.Fa=!0,this.i.disable();var e={audio:!1,text:!1},i=we(t.variants,this.ja,this.kb,e),n=ke(t.textStreams,this.la,this.jb,e);if(i=va(this,i),n=n[0]||null,this.W){t:{for(var r=this.b,a=0;a<r.periods.length;++a)for(var s=r.periods[a],o=0;o<s.variants.length;++o)if(s.variants[o]==this.W){r=a;break t}r=-1}(r=this.b.periods[r])==t&&(i=this.W),this.W=null}return this.G&&(r=xe(this.b,this.G),(r=this.b.periods[r])==t&&(n=this.G),this.G=null),i&&la(this,i,!0),n&&(ua(this,n,!0),!Lr(this.a)&&i&&i.audio&&e.text&&n.language!=i.audio.language&&(this.C.setTextVisibility(!0),Ta(this))),this.c.streaming.alwaysStreamText||this.Ec()?{variant:i,text:n}:{variant:i,text:null}},e.ke=function(){this.o&&(this.o.Tc(!1),Jn(this.g),se(this.s,"audio"),se(this.s,"video"),oe(this.s,"audio"),oe(this.s,"video")),_a(this),this.Fa=!1,this.c.abr.enabled&&this.i.enable(),this.W&&(Dr(this.a,this.W,this.$c),this.W=null),this.G&&(Nr(this.a,this.G,!0),this.G=null)},e.Xe=function(){this.h&&this.h.update&&this.h.update()},e.gf=function(){this.g&&this.g.xb()},e.$f=function(t,e){la(this,t,!0),this.a&&(Dr(this.a,t,e||!1),ba(this))},e.hb=function(t){if(!this.I){var e=new Tt("error",{detail:t});this.dispatchEvent(e),e.defaultPrevented&&(t.handled=!0)}},e.kf=function(t){this.D?this.D.s(t):this.Lb.push(t)},e.Cb=function(t){this.dispatchEvent(t)},e.lf=function(){if(this.f.error){var t=this.f.error.code;if(1!=t){var e=this.f.error.msExtendedCode;e&&(e<0&&(e+=Math.pow(2,32)),e=e.toString(16)),this.hb(new J(2,3,3016,t,e,this.f.error.message))}}},e.Ve=function(n){var r=["output-restricted","internal-error"],t=Ar(this.a),a=!1,e=Object.keys(n),s=1==e.length&&"00"==e[0];e.length&&t.variants.forEach(function(i){var t=[];i.audio&&t.push(i.audio),i.video&&t.push(i.video),t.forEach(function(t){var e=i.allowedByKeySystem;t.keyId&&(t=n[s?"00":t.keyId],i.allowedByKeySystem=!!t&&r.indexOf(t)<0),e!=i.allowedByKeySystem&&(a=!0)})}),(e=Pe(Pr(this.a),Cr(this.a),t.variants))&&!e.allowedByKeySystem&&ya(this,t),a&&(_a(this),t=we(t.variants,this.ja,this.kb),this.i.setVariants(t))},e.Re=function(t,e){this.h&&this.h.onExpirationUpdated&&this.h.onExpirationUpdated(t,e),this.dispatchEvent(new Tt("expirationupdated"))},e.Xb=function(t){var e=[];if(this.a){t=t||Jn(this.g),t=this.a.Xb(t);for(var i=0;i<t.length;i++)0<t[i].width&&0<t[i].height&&e.push({width:t[i].width,height:t[i].height,id:t[i].strId})}return e},ia.prototype.getThumbnailStreams=ia.prototype.Xb,ia.prototype.getThumbnailStreamImages=ia.prototype.zc=function(t,e,i,a){var s={images:[],baseTime:i,requestTime:e,streamId:t};this.a&&t&&this.a.zc(t,e,i).then(function(t){if(null!=t&&null!=t.ua&&0<t.ua.length){for(var e=[],i=0;i<t.ua.length;i++){var n=t.ua[i].payload.split("#xywh=");if(null!=n&&2==n.length){var r=n[1].split(",");null!=r&&4==r.length&&(n={url:t.url+n[0],startTime:-1,endTime:-1,topX:r[0],topY:r[1],width:r[2],height:r[3]},this.T()?(n.startTime=t.ua[i].startTime+t.ub,n.endTime=t.ua[i].endTime+t.ub):(n.startTime=t.ua[i].startTime+t.ub-s.baseTime,n.endTime=t.ua[i].endTime+t.ub-s.baseTime),e.push(n))}}s.images=e,null!=a&&a(s)}}.bind(this)).catch(function(){null!=a&&a(s)}.bind(this))},ia.prototype.getSegmentIndexSourceType=ia.prototype.Ee=function(){var t="";return this.h&&(t=this.h.i),t},ia.prototype.getPeriodSections=ia.prototype.Vb=function(){return this.o.Vb()},ia.prototype.getCCInfos=ia.prototype.uc=function(){return this.o.uc()},d("shaka.polyfill.installAll",function(){for(var t=0;t<wa.length;++t)wa[t]()});var Ea,Sa,wa=[];function ka(t){wa.push(t)}function Aa(){}function La(t,e,i){if("input"==t)switch(this.type){case"range":t="change"}Ea.call(this,t,e,i)}function Pa(t){this.f=[],this.b=[],this.a=[],(new Fi).na("pssh",this.c.bind(this)).parse(t.buffer)}function Ca(t,e){try{var i=new xa(t,e);return Promise.resolve(i)}catch(t){return Promise.reject(t)}}function xa(t,e){this.keySystem=t;for(var i=!1,n=0;n<e.length;++n){var r=e[n],a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label},s=!1;if(r.audioCapabilities)for(var o=0;o<r.audioCapabilities.length;++o){var l=r.audioCapabilities[o];if(l.contentType){s=!0;var u=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,u)&&(a.audioCapabilities.push(l),i=!0)}}if(r.videoCapabilities)for(o=0;o<r.videoCapabilities.length;++o)(l=r.videoCapabilities[o]).contentType&&(s=!0,u=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,u)&&(a.videoCapabilities.push(l),i=!0));if(s||(i=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(i=!1),i)return void(this.a=a)}throw(i=Error("Unsupported keySystem")).name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function Ia(t){var e=this.mediaKeys;return e&&e!=t&&Da(e,null),delete this.mediaKeys,(this.mediaKeys=t)?Da(t,this):Promise.resolve()}function Ra(t){this.a=new MSMediaKeys(t),this.b=new mt}function Da(t,e){if(bt(t.b),!e)return Promise.resolve();vt(t.b,e,"msneedkey",Oa);var i=t;try{return 1<=e.readyState?e.msSetMediaKeys(t.a):e.addEventListener("loadedmetadata",function t(){e.msSetMediaKeys(i.a),e.removeEventListener("loadedmetadata",t)}),Promise.resolve()}catch(t){return Promise.reject(t)}}function Na(t){si.call(this),this.c=null,this.g=t,this.b=this.a=null,this.f=new mt,this.sessionId="",this.expiration=NaN,this.closed=new M,this.keyStatuses=new Fa}function Oa(t){var e=document.createEvent("CustomEvent");e.initCustomEvent("encrypted",!1,!1,null),e.initDataType="cenc";var i=t.initData;if(i){var n=new Pa(i);if(n.a.length<=1)t=i;else{var r=[];for(t=0;t<n.a.length;t++)r.push(i.subarray(n.a[t].start,n.a[t].end+1));for(i=dt(r,Ma),t=n=0;t<i.length;t++)n+=i[t].length;for(n=new Uint8Array(n),t=r=0;t<i.length;t++)n.set(i[t],r),r+=i[t].length;t=n}}else t=i;e.initData=t,this.dispatchEvent(e)}function Ma(t,e){return Gt(t,e)}function Ua(t,e){var i=t.keyStatuses;i.size=null==e?0:1,i.a=e,t.dispatchEvent(new Tt("keystatuseschange"))}function Fa(){this.size=0,this.a=void 0}function Ba(){return Promise.reject(Error("The key system specified is not supported."))}function Ga(t){return null==t?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function ja(){throw new TypeError("Illegal constructor.")}function Ha(){throw new TypeError("Illegal constructor.")}d("shaka.polyfill.register",ka),ka(function(){if(g.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,(t=Document.prototype).exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitExitFullscreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",Aa),document.addEventListener("webkitfullscreenerror",Aa),document.addEventListener("mozfullscreenchange",Aa),document.addEventListener("mozfullscreenerror",Aa),document.addEventListener("MSFullscreenChange",Aa),document.addEventListener("MSFullscreenError",Aa)}}),ka(function(){var t=navigator.userAgent;t&&0<=t.indexOf("CrKey")&&delete g.indexedDB}),ka(function(){navigator.userAgent.indexOf("Trident/")<0||HTMLInputElement.prototype.addEventListener==La||(Ea=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=La)}),ka(function(){}),Pa.prototype.c=function(t){if(!(1<t.version)){var e=Bt(t.A.Ra(16)),i=[];if(0<t.version)for(var n=t.A.H(),r=0;r<n;++r){var a=Bt(t.A.Ra(16));i.push(a)}n=t.A.H(),t.A.L(n),this.b.push.apply(this.b,i),this.f.push(e),this.a.push({start:t.start,end:t.start+t.size-1})}},xa.prototype.createMediaKeys=function(){var t=new Ra(this.keySystem);return Promise.resolve(t)},xa.prototype.getConfiguration=function(){return this.a},Ra.prototype.createSession=function(t){var e=t||"temporary";if("temporary"!=e)throw new TypeError("Session type "+t+" is unsupported on this platform.");return new Na(this.a,e)},Ra.prototype.setServerCertificate=function(){return Promise.resolve(!1)},f(Na,si),(e=Na.prototype).generateRequest=function(t,e){this.a=new M;try{this.c=this.g.createSession("video/mp4",new Uint8Array(e),null),vt(this.f,this.c,"mskeymessage",this.af.bind(this)),vt(this.f,this.c,"mskeyadded",this.Ze.bind(this)),vt(this.f,this.c,"mskeyerror",this.$e.bind(this)),Ua(this,"status-pending")}catch(t){this.a.reject(t)}return this.a},e.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},e.update=function(t){this.b=new M;try{this.c.update(new Uint8Array(t))}catch(t){this.b.reject(t)}return this.b},e.close=function(){try{this.c.close(),this.closed.resolve(),bt(this.f)}catch(t){this.closed.reject(t)}return this.closed},e.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},e.af=function(t){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new Tt("message",{messageType:null==this.keyStatuses.a?"licenserequest":"licenserenewal",message:t.message.buffer}))},e.Ze=function(){this.a?(Ua(this,"usable"),this.a.resolve(),this.a=null):this.b&&(Ua(this,"usable"),this.b.resolve(),this.b=null)},e.$e=function(){var t=Error("EME PatchedMediaKeysMs key error");if(t.errorCode=this.c.error,null!=this.a)this.a.reject(t),this.a=null;else if(null!=this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Ua(this,"output-not-allowed");break;default:Ua(this,"internal-error")}},(e=Fa.prototype).forEach=function(t){this.a&&t(this.a,Sa)},e.get=function(t){if(this.has(t))return this.a},e.has=function(t){var e=Sa;return!(!this.a||!Gt(new Uint8Array(t),new Uint8Array(e)))},e.entries=function(){},e.keys=function(){},e.values=function(){},ja.prototype.createSession=function(){},ja.prototype.setServerCertificate=function(){},Ha.prototype.getConfiguration=function(){},Ha.prototype.createMediaKeys=function(){};var Va,Wa="";function za(t){Wa=t,Va=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=Ya,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Xa,g.MediaKeys=Za,g.MediaKeySystemAccess=qa}function Ka(t){return Wa?Wa+t.charAt(0).toUpperCase()+t.slice(1):t}function Ya(t,e){try{var i=new qa(t,e);return Promise.resolve(i)}catch(t){return Promise.reject(t)}}function Xa(t){var e=this.mediaKeys;return e&&e!=t&&Qa(e,null),delete this.mediaKeys,(this.mediaKeys=t)&&Qa(t,this),Promise.resolve()}function qa(t,e){this.a=this.keySystem=t;var i=!1;"org.w3.clearkey"==t&&(i=!(this.a="webkit-org.w3.clearkey"));var n=!1,r=document.getElementsByTagName("video");r=r.length?r[0]:document.createElement("video");for(var a=0;a<e.length;++a){var s=e[a],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:s.initDataTypes,sessionTypes:["temporary"],label:s.label},l=!1;if(s.audioCapabilities)for(var u=0;u<s.audioCapabilities.length;++u){var h=s.audioCapabilities[u];if(h.contentType){l=!0;var c=h.contentType.split(";")[0];r.canPlayType(c,this.a)&&(o.audioCapabilities.push(h),n=!0)}}if(s.videoCapabilities)for(u=0;u<s.videoCapabilities.length;++u)(h=s.videoCapabilities[u]).contentType&&(l=!0,r.canPlayType(h.contentType,this.a)&&(o.videoCapabilities.push(h),n=!0));if(l||(n=r.canPlayType("video/mp4",this.a)||r.canPlayType("video/webm",this.a)),"required"==s.persistentState&&(i?(o.persistentState="required",o.sessionTypes=["persistent-license"]):n=!1),n)return void(this.b=o)}throw i="Unsupported keySystem","org.w3.clearkey"!=t&&"com.widevine.alpha"!=t||(i="None of the requested configurations were supported."),(i=Error(i)).name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function Za(t){this.g=t,this.b=null,this.a=new mt,this.c=[],this.f={}}function Qa(t,e){t.b=e,bt(t.a);var i=Wa;e&&(vt(t.a,e,i+"needkey",t.qf.bind(t)),vt(t.a,e,i+"keymessage",t.pf.bind(t)),vt(t.a,e,i+"keyadded",t.mf.bind(t)),vt(t.a,e,i+"keyerror",t.nf.bind(t)))}function Ja(t,e){var i=t.f[e];return i||((i=t.c.shift())?(i.sessionId=e,t.f[e]=i):null)}function $a(t,e,i){si.call(this),this.f=t,this.h=!1,this.a=this.b=null,this.c=e,this.g=i,this.sessionId="",this.expiration=NaN,this.closed=new M,this.keyStatuses=new is}function ts(e,t,i){if(e.h)return Promise.reject(Error("The session is already initialized."));e.h=!0;try{if("persistent-license"==e.g)if(i)var n=new Uint8Array(Rt("LOAD_SESSION|"+i));else{var r=Rt("PERSISTENT|"),a=new Uint8Array(r.byteLength+t.byteLength);a.set(new Uint8Array(r),0),a.set(new Uint8Array(t),r.byteLength),n=a}else n=new Uint8Array(t)}catch(t){return Promise.reject(t)}e.b=new M;var s=Ka("generateKeyRequest");try{e.f[s](e.c,n)}catch(t){if("InvalidStateError"!=t.name)return e.b=null,Promise.reject(t);setTimeout(function(){try{this.f[s](this.c,n)}catch(t){this.b.reject(t),this.b=null}}.bind(e),10)}return e.b}function es(t,e){var i=t.keyStatuses;i.size=null==e?0:1,i.a=e,t.dispatchEvent(new Tt("keystatuseschange"))}function is(){this.size=0,this.a=void 0}function ns(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var t=e.apply(this,arguments);return t.abort=function(){},t}}function rs(t){var e=t.target,i=e.mediaSource_;if(i.pd){for(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.gd=!0,t=0;t<i.sourceBuffers.length;++t)if(0==i.sourceBuffers[t].gd)return;i.pd=!1}}function as(t){t=t.target;for(var e=0;e<t.sourceBuffers.length;++e)t.sourceBuffers[e].removeEventListener("updateend",rs,!1);t.removeEventListener("sourceclose",as,!1)}function ss(t){if(this.c=[],this.b=[],this.ba=os,t)try{t(this.sa.bind(this),this.a.bind(this))}catch(t){this.a(t)}}qa.prototype.createMediaKeys=function(){var t=new Za(this.a);return Promise.resolve(t)},qa.prototype.getConfiguration=function(){return this.b},(e=Za.prototype).createSession=function(t){var e=t||"temporary";if("temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+t+" is unsupported on this platform.");return(t=this.b||document.createElement("video")).src||(t.src="about:blank"),e=new $a(t,this.g,e),this.c.push(e),e},e.setServerCertificate=function(){return Promise.resolve(!1)},e.qf=function(t){var e=document.createEvent("CustomEvent");e.initCustomEvent("encrypted",!1,!1,null),e.initDataType="webm",e.initData=t.initData,this.b.dispatchEvent(e)},e.pf=function(t){var e=Ja(this,t.sessionId);e&&(t=new Tt("message",{messageType:null==e.keyStatuses.a?"licenserequest":"licenserenewal",message:t.message}),e.b&&(e.b.resolve(),e.b=null),e.dispatchEvent(t))},e.mf=function(t){(t=Ja(this,t.sessionId))&&(es(t,"usable"),t.a&&t.a.resolve(),t.a=null)},e.nf=function(t){var e=Ja(this,t.sessionId);if(e){var i=Error("EME v0.1b key error");i.errorCode=t.errorCode,i.errorCode.systemCode=t.systemCode,!t.sessionId&&e.b?(i.method="generateRequest",45==t.systemCode&&(i.message="Unsupported session type."),e.b.reject(i),e.b=null):t.sessionId&&e.a?(i.method="update",e.a.reject(i),e.a=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?es(e,"output-restricted"):es(e,1==i?"expired":"internal-error"))}},f($a,si),(e=$a.prototype).Vc=function(t,e){if(this.a)this.a.then(this.Vc.bind(this,t,e)).catch(this.Vc.bind(this,t,e));else{if(this.a=t,"webkit-org.w3.clearkey"==this.c){var i=Ct(e),n=JSON.parse(i);"oct"!=n.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),i=Ut(n.keys[0].k),n=Ut(n.keys[0].kid)}else i=new Uint8Array(e),n=null;var r=Ka("addKey");try{this.f[r](this.c,i,n,this.sessionId)}catch(t){this.a.reject(t),this.a=null}}},e.generateRequest=function(t,e){return ts(this,e,null)},e.load=function(t){return"persistent-license"==this.g?ts(this,null,t):Promise.reject(Error("Not a persistent session."))},e.update=function(t){var e=new M;return this.Vc(e,t),e},e.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var t=Ka("cancelKeyRequest");try{this.f[t](this.c,this.sessionId)}catch(t){}}return this.closed.resolve(),this.closed},e.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()},(e=is.prototype).forEach=function(t){this.a&&t(this.a,Va)},e.get=function(t){if(this.has(t))return this.a},e.has=function(t){var e=Va;return!(!this.a||!Gt(new Uint8Array(t),new Uint8Array(e)))},e.entries=function(){},e.keys=function(){},e.values=function(){},ka(function(){!g.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?za("webkit"):HTMLMediaElement.prototype.generateKeyRequest?za(""):g.MSMediaKeys?(Sa=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ia,g.MediaKeys=Ra,g.MediaKeySystemAccess=xa,navigator.requestMediaKeySystemAccess=Ca):(navigator.requestMediaKeySystemAccess=Ba,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ga,g.MediaKeys=ja,g.MediaKeySystemAccess=Ha))}),ka(function(){if(g.MediaSource)if(g.cast&&cast.__platform__&&cast.__platform__.canDisplayType)u=MediaSource.isTypeSupported,h=/^dv(?:he|av)\./,MediaSource.isTypeSupported=function(t){for(var e=t.split(/ *; */),i=e[0],n={},r=1;r<e.length;++r){var a=e[r].split("="),s=a[0];a=a[1].replace(/"(.*)"/,"$1"),n[s]=a}if(!(e=n.codecs))return u(t);var o=!1,l=!1;for(s in t=e.split(",").filter(function(t){return h.test(t)?!(l=!0):(/^(hev|hvc)1\.2/.test(t)&&(o=!0),!0)}),l&&(o=!1),n.codecs=t.join(","),o&&(n.eotf="smpte2084"),n)i+="; "+s+'="'+(a=n[s])+'"';return cast.__platform__.canDisplayType(i)};else if(navigator.vendor&&0<=navigator.vendor.indexOf("Apple")){var t=navigator.appVersion;a=MediaSource.isTypeSupported,MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(/ *; */)[0].split("/")[1]&&a(t)},0<=t.indexOf("Version/8")?g.MediaSource=null:0<=t.indexOf("Version/9")?ns():0<=t.indexOf("Version/10")?(ns(),n=MediaSource.prototype.endOfStream,MediaSource.prototype.endOfStream=function(){for(var t=0,e=0;e<this.sourceBuffers.length;++e){var i=this.sourceBuffers[e];i=i.buffered.end(i.buffered.length-1),t=Math.max(t,i)}if(!isNaN(this.duration)&&t<this.duration)for(this.pd=!0,e=0;e<this.sourceBuffers.length;++e)(i=this.sourceBuffers[e]).gd=!1;return n.apply(this,arguments)},e=!1,r=MediaSource.prototype.addSourceBuffer,MediaSource.prototype.addSourceBuffer=function(){var t=r.apply(this,arguments);return t.mediaSource_=this,t.addEventListener("updateend",rs,!1),e||(this.addEventListener("sourceclose",as,!1),e=!0),t}):0<=t.indexOf("Version/11")&&(ns(),i=SourceBuffer.prototype.remove,SourceBuffer.prototype.remove=function(t,e){return i.call(this,t,e-.001)})}var i,n,e,r,a,u,h});var os=0;function ls(t){var e=new ss;return e.sa(void 0),e.then(function(){return t})}function us(t){var e=new ss;return e.a(t),e}function hs(t){function e(t,e,i){t.ba==os&&(r[e]=i,++n==r.length&&t.sa(r))}var i=new ss;if(!t.length)return i.sa([]),i;for(var n=0,r=Array(t.length),a=i.a.bind(i),s=0;s<t.length;++s)t[s]&&t[s].then?t[s].then(e.bind(null,i,s),a):e(i,s,t[s]);return i}function cs(t){for(var e=new ss,i=e.sa.bind(e),n=e.a.bind(e),r=0;r<t.length;++r)t[r]&&t[r].then?t[r].then(i,n):i(t[r]);return e}function ds(t,i,n){vs.push(function(){if(n&&"function"==typeof n){try{var t=n(this.f)}catch(t){return void i.a(t)}try{var e=t&&t.then}catch(t){return void i.a(t)}t instanceof ss?t==i?i.a(new TypeError("Chaining cycle detected")):t.then(i.sa.bind(i),i.a.bind(i)):e?function i(t,e,n){try{var r=!1;e.call(t,function(t){if(!r){r=!0;try{var e=t&&t.then}catch(t){return void n.a(t)}e?i(t,e,n):n.sa(t)}},n.a.bind(n))}catch(t){n.a(t)}}(t,e,i):i.sa(t)}else 1==this.ba?i.sa(this.f):i.a(this.f)}.bind(t)),null==ms&&(ms=ps(fs))}function fs(){for(;vs.length;){null!=ms&&(gs(ms),ms=null);var t=vs;vs=[];for(var e=0;e<t.length;++e)t[e]()}}function ps(){return 0}function gs(){}ss.prototype.then=function(t,e){var i=new ss;switch(this.ba){case 1:ds(this,i,t);break;case 2:ds(this,i,e);break;case os:this.c.push({fa:i,lc:t}),this.b.push({fa:i,lc:e})}return i},ss.prototype.catch=function(t){return this.then(void 0,t)},ss.prototype.sa=function(t){if(this.ba==os){for(this.f=t,this.ba=1,t=0;t<this.c.length;++t)ds(this,this.c[t].fa,this.c[t].lc);this.c=[],this.b=[]}},ss.prototype.a=function(t){if(this.ba==os){for(this.f=t,this.ba=2,t=0;t<this.b.length;++t)ds(this,this.b[t].fa,this.b[t].lc);this.c=[],this.b=[]}};var ms=null,vs=[];function ys(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function bs(t,e,i){return new g.TextTrackCue(t,e,i)}function _s(t,e,i){return new g.TextTrackCue(t+"-"+e+"-"+i,t,e,i)}function Ts(){}ka(function(t){gs=g.setImmediate?(ps=function(t){return g.setImmediate(t)},function(t){g.clearImmediate(t)}):(ps=function(t){return g.setTimeout(t,0)},function(t){g.clearTimeout(t)}),g.Promise&&!t||(g.Promise=ss,g.Promise.resolve=ls,g.Promise.reject=us,g.Promise.all=hs,g.Promise.race=cs,g.Promise.prototype.then=ss.prototype.then,g.Promise.prototype.catch=ss.prototype.catch)}),ka(function(){if(g.HTMLMediaElement){var e=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var t=e.apply(this,arguments);return t&&t.catch(function(){}),t}}}),ka(function(){if(g.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=ys)}}),ka(function(){if(!g.VTTCue&&g.TextTrackCue){var t=TextTrackCue.length;if(3==t)g.VTTCue=bs;else if(6==t)g.VTTCue=_s;else{try{var e=!!bs(1,2,"")}catch(t){e=!1}e&&(g.VTTCue=bs)}}}),Ts.prototype.parseInit=function(){},Ts.prototype.parseMedia=function(t,e){var i=Ct(t),n=[],r=new DOMParser,a=null;try{a=r.parseFromString(i,"text/xml")}catch(t){throw new J(2,2,2005)}if(a){var s=a.getElementsByTagName("tt")[0];if(!s)throw new J(2,2,2005);r=s.getAttribute("ttp:frameRate"),a=s.getAttribute("ttp:subFrameRate");var o=s.getAttribute("ttp:frameRateMultiplier"),l=s.getAttribute("ttp:tickRate");if("default"!=(i=s.getAttribute("xml:space")||"default")&&"preserve"!=i)throw new J(2,2,2005);for(i="default"==i,r=new js(r,a,o,l),a=Rs(s.getElementsByTagName("styling")[0]),o=Rs(s.getElementsByTagName("layout")[0]),s=Rs(s.getElementsByTagName("body")[0]),l=0;l<s.length;l++){var u=s[l],h=e.periodStart,c=r,d=a,f=o,p=i;if(u.hasAttribute("begin")||u.hasAttribute("end")||!/^\s*$/.test(u.textContent)){Ds(u,p),p=Bs(u.getAttribute("begin"),c);var g=Bs(u.getAttribute("end"),c);c=Bs(u.getAttribute("dur"),c);var m=u.textContent;if(null==g&&null!=c&&(g=p+c),null==p||null==g)throw new J(2,2,2001);h=new sr(p+h,g+h,m),p=Fs(u,"region",f),f=h,"rtl"==Os(u,p,d,"tts:direction")&&(f.writingDirection=1),"tb"==(g=Os(u,p,d,"tts:writingMode"))||"tblr"==g?f.writingDirection=2:"tbrl"==g?f.writingDirection=3:"rltb"==g||"rl"==g?f.writingDirection=1:g&&(f.writingDirection=dr),(g=Os(u,p,d,"tts:origin"))&&(null!=(g=Ps.exec(g))&&(f.region.x=Number(g[1]),f.region.y=Number(g[2]))),(g=Os(u,p,d,"tts:extent"))&&(null!=(g=Ps.exec(g))&&(f.region.width=Number(g[1]),f.region.height=Number(g[2]))),(g=Os(u,p,d,"tts:textAlign"))&&(f.positionAlign=Is[g],f.lineAlign=xs[g],f.textAlign=ur[g.toUpperCase()]),(g=Os(u,p,d,"tts:displayAlign"))&&(f.displayAlign=cr[g.toUpperCase()]),(g=Os(u,p,d,"tts:color"))&&(f.color=g),(g=Os(u,p,d,"tts:backgroundColor"))&&(f.backgroundColor=g),(g=Os(u,p,d,"tts:fontFamily"))&&(f.fontFamily=g),(g=Os(u,p,d,"tts:fontWeight"))&&"bold"==g&&(f.fontWeight=700),(g=Os(u,p,d,"tts:wrapOption"))&&"noWrap"==g&&(f.wrapLine=!1),(g=Os(u,p,d,"tts:lineHeight"))&&g.match(Cs)&&(f.lineHeight=g),(g=Os(u,p,d,"tts:fontSize"))&&g.match(Cs)&&(f.fontSize=g),(g=Os(u,p,d,"tts:fontStyle"))&&(f.fontStyle=yr[g.toUpperCase()]),(p=Ms(p,d,"tts:textDecoration"))&&Ns(f,p),(u=Us(u,d,"tts:textDecoration"))&&Ns(f,u)}else h=null;h&&n.push(h)}}return n};var Es=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ss=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,ws=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,ks=/^(\d*(?:\.\d*)?)f$/,As=/^(\d*(?:\.\d*)?)t$/,Ls=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,Ps=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,Cs=/^(\d+px|\d+em)$/,xs={left:"start",center:pr,right:"end",start:"start",end:"end"},Is={left:"line-left",center:"center",right:"line-right"};function Rs(t){var e=[];if(!t)return e;for(var i=t.childNodes,n=0;n<i.length;n++){var r="span"==i[n].nodeName&&"p"==t.nodeName;i[n].nodeType!=Node.ELEMENT_NODE||"br"==i[n].nodeName||r||(r=Rs(i[n]),e=e.concat(r))}return e.length||e.push(t),e}function Ds(t,e){for(var i=t.childNodes,n=0;n<i.length;n++)if("br"==i[n].nodeName&&0<n)i[n-1].textContent+="\n";else if(0<i[n].childNodes.length)Ds(i[n],e);else if(e){var r=i[n].textContent.trim();r=r.replace(/\s+/g," "),i[n].textContent=r}}function Ns(t,e){for(var i=e.split(" "),n=0;n<i.length;n++)switch(i[n]){case"underline":t.textDecoration.indexOf("underline")<0&&t.textDecoration.push("underline");break;case"noUnderline":0<=t.textDecoration.indexOf("underline")&&pt(t.textDecoration,"underline");break;case"lineThrough":t.textDecoration.indexOf("lineThrough")<0&&t.textDecoration.push("lineThrough");break;case"noLineThrough":0<=t.textDecoration.indexOf("lineThrough")&&pt(t.textDecoration,"lineThrough");break;case"overline":t.textDecoration.indexOf("overline")<0&&t.textDecoration.push("overline");break;case"noOverline":0<=t.textDecoration.indexOf("overline")&&pt(t.textDecoration,"overline")}}function Os(t,e,i,n){return(t=Us(t,i,n))?t:Ms(e,i,n)}function Ms(t,e,i){for(var n=Rs(t),r=0;r<n.length;r++){var a=n[r].getAttribute(i);if(a)return a}return(t=Fs(t,"style",e))?t.getAttribute(i):null}function Us(t,e,i){return(t=Fs(t,"style",e))?t.getAttribute(i):null}function Fs(t,e,i){if(!t||i.length<1)return null;var n=null,r=t;for(t=null;r&&!(t=r.getAttribute(e))&&(r=r.parentNode)instanceof Element;);if(e=t)for(t=0;t<i.length;t++)if(i[t].getAttribute("xml:id")==e){n=i[t];break}return n}function Bs(t,e){var i=null;if(Es.test(t)){i=Es.exec(t);var n=Number(i[1]),r=Number(i[2]),a=Number(i[3]),s=Number(i[4]);i=(a+=(s+=(Number(i[5])||0)/e.b)/e.frameRate)+60*r+3600*n}else Ss.test(t)?i=Gs(Ss,t):ws.test(t)?i=Gs(ws,t):ks.test(t)?(i=ks.exec(t),i=Number(i[1])/e.frameRate):As.test(t)?(i=As.exec(t),i=Number(i[1])/e.a):Ls.test(t)&&(i=Gs(Ls,t));return i}function Gs(t,e){var i=t.exec(e);return null==i||""==i[0]?null:(Number(i[4])||0)/1e3+(Number(i[3])||0)+60*(Number(i[2])||0)+3600*(Number(i[1])||0)}function js(t,e,i,n){this.frameRate=Number(t)||30,this.b=Number(e)||1,this.a=Number(n),0==this.a&&(this.a=t?this.frameRate*this.b:1),i&&(t=/^(\d+) (\d+)$/g.exec(i))&&(this.frameRate*=t[1]/t[2])}function Hs(){this.a=new Ts}function Vs(){this.a=null}function Ws(t,e,i){var n,r,a;return(new Fi).M("payl",ji(function(t){n=Ct(t)})).M("iden",ji(function(t){r=Ct(t)})).M("sttg",ji(function(t){a=Ct(t)})).parse(t),n?function(t,e,i,n,r){if(t=new sr(n,r,t),e&&(t.id=e),i)for(e=new br(i),i=Tr(e);i;)Sr(t,i),_r(e,/[ \t]+/gm),i=Tr(e);return t}(n,r,a,e,i):null}ne["application/ttml+xml"]=Ts,Hs.prototype.parseInit=function(t){var e=!1;if((new Fi).M("moov",Bi).M("trak",Bi).M("mdia",Bi).M("minf",Bi).M("stbl",Bi).na("stsd",Gi).M("stpp",function(t){e=!0,t.fb.stop()}).parse(t),!e)throw new J(2,2,2007)},Hs.prototype.parseMedia=function(t,e){var i=!1,n=[];if((new Fi).M("mdat",ji(function(t){i=!0,n=n.concat(this.a.parseMedia(t,e))}.bind(this))).parse(t),!i)throw new J(2,2,2007);return n},ne['application/mp4; codecs="stpp"']=Hs,ne['application/mp4; codecs="stpp.TTML.im1t"']=Hs,Vs.prototype.parseInit=function(t){var e=!1;if((new Fi).M("moov",Bi).M("trak",Bi).M("mdia",Bi).na("mdhd",function(t){0==t.version?(t.A.L(4),t.A.L(4),this.a=t.A.H(),t.A.L(4)):(t.A.L(8),t.A.L(8),this.a=t.A.H(),t.A.L(8)),t.A.L(4)}.bind(this)).M("minf",Bi).M("stbl",Bi).na("stsd",Gi).M("wvtt",function(){e=!0}).parse(t),!this.a)throw new J(2,2,2008);if(!e)throw new J(2,2,2008)},Vs.prototype.parseMedia=function(t,s){if(!this.a)throw new J(2,2,2008);var e,o=0,l=[],u=[],i=!1,h=!1,n=!1,c=null;if((new Fi).M("moof",Bi).M("traf",Bi).na("tfdt",function(t){i=!0,o=0==t.version?t.A.H():t.A.yb()}).na("tfhd",function(t){var e=t.flags;(t=t.A).L(4),1&e&&t.L(8),2&e&&t.L(4),c=8&e?t.H():null}).na("trun",function(t){h=!0;var e=t.version,i=t.flags,n=(t=t.A).H();1&i&&t.L(4),4&i&&t.L(4);for(var r=[],a=0;a<n;a++){var s={duration:null,sampleSize:null,Xc:null};256&i&&(s.duration=t.H()),512&i&&(s.sampleSize=t.H()),1024&i&&t.L(4),2048&i&&(s.Xc=0==e?t.H():t.Hd()),r.push(s)}l=r}).M("mdat",ji(function(t){n=!0,e=t})).parse(t),!n&&!i&&!h)throw new J(2,2,2008);var d=o,f=new Ni(new DataView(e.buffer,e.byteOffset,e.byteLength),0);return l.forEach(function(t){var e=t.duration||c,i=t.Xc?o+t.Xc:d;d=i+(e||0);var n=0;do{var r=f.H();n+=r;var a=null;"vttc"==Vi(f.H())?8<r&&(a=f.Ra(r-8)):f.L(r-8),e&&a&&u.push(Ws(a,s.periodStart+i/this.a,s.periodStart+d/this.a))}while(t.sampleSize&&n<t.sampleSize)}.bind(this)),u.filter(et)},ne['application/mp4; codecs="wvtt"']=Vs}.call(e,t,t),e.shaka)r[i]=e.shaka[i]}()}).call(this,e(58))},function(t,e,i){var n,r={aa:{"639-1":"aa","639-2":"aar",family:"Afro-Asiatic",name:"Afar",nativeName:"Afaraf",wikiUrl:"https://en.wikipedia.org/wiki/Afar_language"},ab:{"639-1":"ab","639-2":"abk",family:"Northwest Caucasian",name:"Abkhaz",nativeName:"аҧсуа бызшәа, аҧсшәа",wikiUrl:"https://en.wikipedia.org/wiki/Abkhaz_language"},ae:{"639-1":"ae","639-2":"ave",family:"Indo-European",name:"Avestan",nativeName:"avesta",wikiUrl:"https://en.wikipedia.org/wiki/Avestan_language"},af:{"639-1":"af","639-2":"afr",family:"Indo-European",name:"Afrikaans",nativeName:"Afrikaans",wikiUrl:"https://en.wikipedia.org/wiki/Afrikaans_language"},ak:{"639-1":"ak","639-2":"aka",family:"Niger–Congo",name:"Akan",nativeName:"Akan",wikiUrl:"https://en.wikipedia.org/wiki/Akan_language"},am:{"639-1":"am","639-2":"amh",family:"Afro-Asiatic",name:"Amharic",nativeName:"አማርኛ",wikiUrl:"https://en.wikipedia.org/wiki/Amharic_language"},an:{"639-1":"an","639-2":"arg",family:"Indo-European",name:"Aragonese",nativeName:"aragonés",wikiUrl:"https://en.wikipedia.org/wiki/Aragonese_language"},ar:{"639-1":"ar","639-2":"ara",family:"Afro-Asiatic",name:"Arabic",nativeName:"العربية",wikiUrl:"https://en.wikipedia.org/wiki/Arabic_language"},as:{"639-1":"as","639-2":"asm",family:"Indo-European",name:"Assamese",nativeName:"অসমীয়া",wikiUrl:"https://en.wikipedia.org/wiki/Assamese_language"},av:{"639-1":"av","639-2":"ava",family:"Northeast Caucasian",name:"Avaric",nativeName:"авар мацӀ, магӀарул мацӀ",wikiUrl:"https://en.wikipedia.org/wiki/Avar_language"},ay:{"639-1":"ay","639-2":"aym",family:"Aymaran",name:"Aymara",nativeName:"aymar aru",wikiUrl:"https://en.wikipedia.org/wiki/Aymara_language"},az:{"639-1":"az","639-2":"aze",family:"Turkic",name:"Azerbaijani",nativeName:"azərbaycan dili",wikiUrl:"https://en.wikipedia.org/wiki/Azerbaijani_language"},ba:{"639-1":"ba","639-2":"bak",family:"Turkic",name:"Bashkir",nativeName:"башҡорт теле",wikiUrl:"https://en.wikipedia.org/wiki/Bashkir_language"},be:{"639-1":"be","639-2":"bel",family:"Indo-European",name:"Belarusian",nativeName:"беларуская мова",wikiUrl:"https://en.wikipedia.org/wiki/Belarusian_language"},bg:{"639-1":"bg","639-2":"bul",family:"Indo-European",name:"Bulgarian",nativeName:"български език",wikiUrl:"https://en.wikipedia.org/wiki/Bulgarian_language"},bh:{"639-1":"bh","639-2":"bih",family:"Indo-European",name:"Bihari",nativeName:"भोजपुरी",wikiUrl:"https://en.wikipedia.org/wiki/Bihari_languages"},bi:{"639-1":"bi","639-2":"bis",family:"Creole",name:"Bislama",nativeName:"Bislama",wikiUrl:"https://en.wikipedia.org/wiki/Bislama_language"},bm:{"639-1":"bm","639-2":"bam",family:"Niger–Congo",name:"Bambara",nativeName:"bamanankan",wikiUrl:"https://en.wikipedia.org/wiki/Bambara_language"},bn:{"639-1":"bn","639-2":"ben",family:"Indo-European",name:"Bengali, Bangla",nativeName:"বাংলা",wikiUrl:"https://en.wikipedia.org/wiki/Bengali_language"},bo:{"639-1":"bo","639-2":"bod","639-2/B":"tib",family:"Sino-Tibetan",name:"Tibetan Standard, Tibetan, Central",nativeName:"བོད་ཡིག",wikiUrl:"https://en.wikipedia.org/wiki/Standard_Tibetan"},br:{"639-1":"br","639-2":"bre",family:"Indo-European",name:"Breton",nativeName:"brezhoneg",wikiUrl:"https://en.wikipedia.org/wiki/Breton_language"},bs:{"639-1":"bs","639-2":"bos",family:"Indo-European",name:"Bosnian",nativeName:"bosanski jezik",wikiUrl:"https://en.wikipedia.org/wiki/Bosnian_language"},ca:{"639-1":"ca","639-2":"cat",family:"Indo-European",name:"Catalan",nativeName:"català",wikiUrl:"https://en.wikipedia.org/wiki/Catalan_language"},ce:{"639-1":"ce","639-2":"che",family:"Northeast Caucasian",name:"Chechen",nativeName:"нохчийн мотт",wikiUrl:"https://en.wikipedia.org/wiki/Chechen_language"},ch:{"639-1":"ch","639-2":"cha",family:"Austronesian",name:"Chamorro",nativeName:"Chamoru",wikiUrl:"https://en.wikipedia.org/wiki/Chamorro_language"},co:{"639-1":"co","639-2":"cos",family:"Indo-European",name:"Corsican",nativeName:"corsu, lingua corsa",wikiUrl:"https://en.wikipedia.org/wiki/Corsican_language"},cr:{"639-1":"cr","639-2":"cre",family:"Algonquian",name:"Cree",nativeName:"ᓀᐦᐃᔭᐍᐏᐣ",wikiUrl:"https://en.wikipedia.org/wiki/Cree_language"},cs:{"639-1":"cs","639-2":"ces","639-2/B":"cze",family:"Indo-European",name:"Czech",nativeName:"čeština, český jazyk",wikiUrl:"https://en.wikipedia.org/wiki/Czech_language"},cu:{"639-1":"cu","639-2":"chu",family:"Indo-European",name:"Old Church Slavonic, Church Slavonic, Old Bulgarian",nativeName:"ѩзыкъ словѣньскъ",wikiUrl:"https://en.wikipedia.org/wiki/Old_Church_Slavonic"},cv:{"639-1":"cv","639-2":"chv",family:"Turkic",name:"Chuvash",nativeName:"чӑваш чӗлхи",wikiUrl:"https://en.wikipedia.org/wiki/Chuvash_language"},cy:{"639-1":"cy","639-2":"cym","639-2/B":"wel",family:"Indo-European",name:"Welsh",nativeName:"Cymraeg",wikiUrl:"https://en.wikipedia.org/wiki/Welsh_language"},da:{"639-1":"da","639-2":"dan",family:"Indo-European",name:"Danish",nativeName:"dansk",wikiUrl:"https://en.wikipedia.org/wiki/Danish_language"},de:{"639-1":"de","639-2":"deu","639-2/B":"ger",family:"Indo-European",name:"German",nativeName:"Deutsch",wikiUrl:"https://en.wikipedia.org/wiki/German_language"},dv:{"639-1":"dv","639-2":"div",family:"Indo-European",name:"Divehi, Dhivehi, Maldivian",nativeName:"ދިވެހި",wikiUrl:"https://en.wikipedia.org/wiki/Dhivehi_language"},dz:{"639-1":"dz","639-2":"dzo",family:"Sino-Tibetan",name:"Dzongkha",nativeName:"རྫོང་ཁ",wikiUrl:"https://en.wikipedia.org/wiki/Dzongkha_language"},ee:{"639-1":"ee","639-2":"ewe",family:"Niger–Congo",name:"Ewe",nativeName:"Eʋegbe",wikiUrl:"https://en.wikipedia.org/wiki/Ewe_language"},el:{"639-1":"el","639-2":"ell","639-2/B":"gre",family:"Indo-European",name:"Greek (modern)",nativeName:"ελληνικά",wikiUrl:"https://en.wikipedia.org/wiki/Greek_language"},en:{"639-1":"en","639-2":"eng",family:"Indo-European",name:"English",nativeName:"English",wikiUrl:"https://en.wikipedia.org/wiki/English_language"},eo:{"639-1":"eo","639-2":"epo",family:"Constructed",name:"Esperanto",nativeName:"Esperanto",wikiUrl:"https://en.wikipedia.org/wiki/Esperanto"},es:{"639-1":"es","639-2":"spa",family:"Indo-European",name:"Spanish",nativeName:"Español",wikiUrl:"https://en.wikipedia.org/wiki/Spanish_language"},et:{"639-1":"et","639-2":"est",family:"Uralic",name:"Estonian",nativeName:"eesti, eesti keel",wikiUrl:"https://en.wikipedia.org/wiki/Estonian_language"},eu:{"639-1":"eu","639-2":"eus","639-2/B":"baq",family:"Language isolate",name:"Basque",nativeName:"euskara, euskera",wikiUrl:"https://en.wikipedia.org/wiki/Basque_language"},fa:{"639-1":"fa","639-2":"fas","639-2/B":"per",family:"Indo-European",name:"Persian (Farsi)",nativeName:"فارسی",wikiUrl:"https://en.wikipedia.org/wiki/Persian_language"},ff:{"639-1":"ff","639-2":"ful",family:"Niger–Congo",name:"Fula, Fulah, Pulaar, Pular",nativeName:"Fulfulde, Pulaar, Pular",wikiUrl:"https://en.wikipedia.org/wiki/Fula_language"},fi:{"639-1":"fi","639-2":"fin",family:"Uralic",name:"Finnish",nativeName:"suomi, suomen kieli",wikiUrl:"https://en.wikipedia.org/wiki/Finnish_language"},fj:{"639-1":"fj","639-2":"fij",family:"Austronesian",name:"Fijian",nativeName:"vosa Vakaviti",wikiUrl:"https://en.wikipedia.org/wiki/Fijian_language"},fo:{"639-1":"fo","639-2":"fao",family:"Indo-European",name:"Faroese",nativeName:"føroyskt",wikiUrl:"https://en.wikipedia.org/wiki/Faroese_language"},fr:{"639-1":"fr","639-2":"fra","639-2/B":"fre",family:"Indo-European",name:"French",nativeName:"français, langue française",wikiUrl:"https://en.wikipedia.org/wiki/French_language"},fy:{"639-1":"fy","639-2":"fry",family:"Indo-European",name:"Western Frisian",nativeName:"Frysk",wikiUrl:"https://en.wikipedia.org/wiki/West_Frisian_language"},ga:{"639-1":"ga","639-2":"gle",family:"Indo-European",name:"Irish",nativeName:"Gaeilge",wikiUrl:"https://en.wikipedia.org/wiki/Irish_language"},gd:{"639-1":"gd","639-2":"gla",family:"Indo-European",name:"Scottish Gaelic, Gaelic",nativeName:"Gàidhlig",wikiUrl:"https://en.wikipedia.org/wiki/Scottish_Gaelic_language"},gl:{"639-1":"gl","639-2":"glg",family:"Indo-European",name:"Galician",nativeName:"galego",wikiUrl:"https://en.wikipedia.org/wiki/Galician_language"},gn:{"639-1":"gn","639-2":"grn",family:"Tupian",name:"Guaraní",nativeName:"Avañe'ẽ",wikiUrl:"https://en.wikipedia.org/wiki/Guaran%C3%AD_language"},gu:{"639-1":"gu","639-2":"guj",family:"Indo-European",name:"Gujarati",nativeName:"ગુજરાતી",wikiUrl:"https://en.wikipedia.org/wiki/Gujarati_language"},gv:{"639-1":"gv","639-2":"glv",family:"Indo-European",name:"Manx",nativeName:"Gaelg, Gailck",wikiUrl:"https://en.wikipedia.org/wiki/Manx_language"},ha:{"639-1":"ha","639-2":"hau",family:"Afro-Asiatic",name:"Hausa",nativeName:"(Hausa) هَوُسَ",wikiUrl:"https://en.wikipedia.org/wiki/Hausa_language"},he:{"639-1":"he","639-2":"heb",family:"Afro-Asiatic",name:"Hebrew (modern)",nativeName:"עברית",wikiUrl:"https://en.wikipedia.org/wiki/Hebrew_language"},hi:{"639-1":"hi","639-2":"hin",family:"Indo-European",name:"Hindi",nativeName:"हिन्दी, हिंदी",wikiUrl:"https://en.wikipedia.org/wiki/Hindi"},ho:{"639-1":"ho","639-2":"hmo",family:"Austronesian",name:"Hiri Motu",nativeName:"Hiri Motu",wikiUrl:"https://en.wikipedia.org/wiki/Hiri_Motu_language"},hr:{"639-1":"hr","639-2":"hrv",family:"Indo-European",name:"Croatian",nativeName:"hrvatski jezik",wikiUrl:"https://en.wikipedia.org/wiki/Croatian_language"},ht:{"639-1":"ht","639-2":"hat",family:"Creole",name:"Haitian, Haitian Creole",nativeName:"Kreyòl ayisyen",wikiUrl:"https://en.wikipedia.org/wiki/Haitian_Creole_language"},hu:{"639-1":"hu","639-2":"hun",family:"Uralic",name:"Hungarian",nativeName:"magyar",wikiUrl:"https://en.wikipedia.org/wiki/Hungarian_language"},hy:{"639-1":"hy","639-2":"hye","639-2/B":"arm",family:"Indo-European",name:"Armenian",nativeName:"Հայերեն",wikiUrl:"https://en.wikipedia.org/wiki/Armenian_language"},hz:{"639-1":"hz","639-2":"her",family:"Niger–Congo",name:"Herero",nativeName:"Otjiherero",wikiUrl:"https://en.wikipedia.org/wiki/Herero_language"},ia:{"639-1":"ia","639-2":"ina",family:"Constructed",name:"Interlingua",nativeName:"Interlingua",wikiUrl:"https://en.wikipedia.org/wiki/Interlingua"},id:{"639-1":"id","639-2":"ind",family:"Austronesian",name:"Indonesian",nativeName:"Bahasa Indonesia",wikiUrl:"https://en.wikipedia.org/wiki/Indonesian_language"},ie:{"639-1":"ie","639-2":"ile",family:"Constructed",name:"Interlingue",nativeName:"Originally called Occidental; then Interlingue after WWII",wikiUrl:"https://en.wikipedia.org/wiki/Interlingue_language"},ig:{"639-1":"ig","639-2":"ibo",family:"Niger–Congo",name:"Igbo",nativeName:"Asụsụ Igbo",wikiUrl:"https://en.wikipedia.org/wiki/Igbo_language"},ii:{"639-1":"ii","639-2":"iii",family:"Sino-Tibetan",name:"Nuosu",nativeName:"ꆈꌠ꒿ Nuosuhxop",wikiUrl:"https://en.wikipedia.org/wiki/Nuosu_language"},ik:{"639-1":"ik","639-2":"ipk",family:"Eskimo–Aleut",name:"Inupiaq",nativeName:"Iñupiaq, Iñupiatun",wikiUrl:"https://en.wikipedia.org/wiki/Inupiaq_language"},io:{"639-1":"io","639-2":"ido",family:"Constructed",name:"Ido",nativeName:"Ido",wikiUrl:"https://en.wikipedia.org/wiki/Ido_(language)"},is:{"639-1":"is","639-2":"isl","639-2/B":"ice",family:"Indo-European",name:"Icelandic",nativeName:"Íslenska",wikiUrl:"https://en.wikipedia.org/wiki/Icelandic_language"},it:{"639-1":"it","639-2":"ita",family:"Indo-European",name:"Italian",nativeName:"Italiano",wikiUrl:"https://en.wikipedia.org/wiki/Italian_language"},iu:{"639-1":"iu","639-2":"iku",family:"Eskimo–Aleut",name:"Inuktitut",nativeName:"ᐃᓄᒃᑎᑐᑦ",wikiUrl:"https://en.wikipedia.org/wiki/Inuktitut"},ja:{"639-1":"ja","639-2":"jpn",family:"Japonic",name:"Japanese",nativeName:"日本語 (にほんご)",wikiUrl:"https://en.wikipedia.org/wiki/Japanese_language"},jv:{"639-1":"jv","639-2":"jav",family:"Austronesian",name:"Javanese",nativeName:"ꦧꦱꦗꦮ, Basa Jawa",wikiUrl:"https://en.wikipedia.org/wiki/Javanese_language"},ka:{"639-1":"ka","639-2":"kat","639-2/B":"geo",family:"South Caucasian",name:"Georgian",nativeName:"ქართული",wikiUrl:"https://en.wikipedia.org/wiki/Georgian_language"},kg:{"639-1":"kg","639-2":"kon",family:"Niger–Congo",name:"Kongo",nativeName:"Kikongo",wikiUrl:"https://en.wikipedia.org/wiki/Kongo_language"},ki:{"639-1":"ki","639-2":"kik",family:"Niger–Congo",name:"Kikuyu, Gikuyu",nativeName:"Gĩkũyũ",wikiUrl:"https://en.wikipedia.org/wiki/Gikuyu_language"},kj:{"639-1":"kj","639-2":"kua",family:"Niger–Congo",name:"Kwanyama, Kuanyama",nativeName:"Kuanyama",wikiUrl:"https://en.wikipedia.org/wiki/Kwanyama"},kk:{"639-1":"kk","639-2":"kaz",family:"Turkic",name:"Kazakh",nativeName:"қазақ тілі",wikiUrl:"https://en.wikipedia.org/wiki/Kazakh_language"},kl:{"639-1":"kl","639-2":"kal",family:"Eskimo–Aleut",name:"Kalaallisut, Greenlandic",nativeName:"kalaallisut, kalaallit oqaasii",wikiUrl:"https://en.wikipedia.org/wiki/Kalaallisut_language"},km:{"639-1":"km","639-2":"khm",family:"Austroasiatic",name:"Khmer",nativeName:"ខ្មែរ, ខេមរភាសា, ភាសាខ្មែរ",wikiUrl:"https://en.wikipedia.org/wiki/Khmer_language"},kn:{"639-1":"kn","639-2":"kan",family:"Dravidian",name:"Kannada",nativeName:"ಕನ್ನಡ",wikiUrl:"https://en.wikipedia.org/wiki/Kannada_language"},ko:{"639-1":"ko","639-2":"kor",family:"Koreanic",name:"Korean",nativeName:"한국어",wikiUrl:"https://en.wikipedia.org/wiki/Korean_language"},kr:{"639-1":"kr","639-2":"kau",family:"Nilo-Saharan",name:"Kanuri",nativeName:"Kanuri",wikiUrl:"https://en.wikipedia.org/wiki/Kanuri_language"},ks:{"639-1":"ks","639-2":"kas",family:"Indo-European",name:"Kashmiri",nativeName:"कश्मीरी, كشميري‎",wikiUrl:"https://en.wikipedia.org/wiki/Kashmiri_language"},ku:{"639-1":"ku","639-2":"kur",family:"Indo-European",name:"Kurdish",nativeName:"Kurdî, كوردی‎",wikiUrl:"https://en.wikipedia.org/wiki/Kurdish_language"},kv:{"639-1":"kv","639-2":"kom",family:"Uralic",name:"Komi",nativeName:"коми кыв",wikiUrl:"https://en.wikipedia.org/wiki/Komi_language"},kw:{"639-1":"kw","639-2":"cor",family:"Indo-European",name:"Cornish",nativeName:"Kernewek",wikiUrl:"https://en.wikipedia.org/wiki/Cornish_language"},ky:{"639-1":"ky","639-2":"kir",family:"Turkic",name:"Kyrgyz",nativeName:"Кыргызча, Кыргыз тили",wikiUrl:"https://en.wikipedia.org/wiki/Kyrgyz_language"},la:{"639-1":"la","639-2":"lat",family:"Indo-European",name:"Latin",nativeName:"latine, lingua latina",wikiUrl:"https://en.wikipedia.org/wiki/Latin"},lb:{"639-1":"lb","639-2":"ltz",family:"Indo-European",name:"Luxembourgish, Letzeburgesch",nativeName:"Lëtzebuergesch",wikiUrl:"https://en.wikipedia.org/wiki/Luxembourgish_language"},lg:{"639-1":"lg","639-2":"lug",family:"Niger–Congo",name:"Ganda",nativeName:"Luganda",wikiUrl:"https://en.wikipedia.org/wiki/Luganda"},li:{"639-1":"li","639-2":"lim",family:"Indo-European",name:"Limburgish, Limburgan, Limburger",nativeName:"Limburgs",wikiUrl:"https://en.wikipedia.org/wiki/Limburgish_language"},ln:{"639-1":"ln","639-2":"lin",family:"Niger–Congo",name:"Lingala",nativeName:"Lingála",wikiUrl:"https://en.wikipedia.org/wiki/Lingala_language"},lo:{"639-1":"lo","639-2":"lao",family:"Tai–Kadai",name:"Lao",nativeName:"ພາສາລາວ",wikiUrl:"https://en.wikipedia.org/wiki/Lao_language"},lt:{"639-1":"lt","639-2":"lit",family:"Indo-European",name:"Lithuanian",nativeName:"lietuvių kalba",wikiUrl:"https://en.wikipedia.org/wiki/Lithuanian_language"},lu:{"639-1":"lu","639-2":"lub",family:"Niger–Congo",name:"Luba-Katanga",nativeName:"Tshiluba",wikiUrl:"https://en.wikipedia.org/wiki/Tshiluba_language"},lv:{"639-1":"lv","639-2":"lav",family:"Indo-European",name:"Latvian",nativeName:"latviešu valoda",wikiUrl:"https://en.wikipedia.org/wiki/Latvian_language"},mg:{"639-1":"mg","639-2":"mlg",family:"Austronesian",name:"Malagasy",nativeName:"fiteny malagasy",wikiUrl:"https://en.wikipedia.org/wiki/Malagasy_language"},mh:{"639-1":"mh","639-2":"mah",family:"Austronesian",name:"Marshallese",nativeName:"Kajin M̧ajeļ",wikiUrl:"https://en.wikipedia.org/wiki/Marshallese_language"},mi:{"639-1":"mi","639-2":"mri","639-2/B":"mao",family:"Austronesian",name:"Māori",nativeName:"te reo Māori",wikiUrl:"https://en.wikipedia.org/wiki/M%C4%81ori_language"},mk:{"639-1":"mk","639-2":"mkd","639-2/B":"mac",family:"Indo-European",name:"Macedonian",nativeName:"македонски јазик",wikiUrl:"https://en.wikipedia.org/wiki/Macedonian_language"},ml:{"639-1":"ml","639-2":"mal",family:"Dravidian",name:"Malayalam",nativeName:"മലയാളം",wikiUrl:"https://en.wikipedia.org/wiki/Malayalam_language"},mn:{"639-1":"mn","639-2":"mon",family:"Mongolic",name:"Mongolian",nativeName:"Монгол хэл",wikiUrl:"https://en.wikipedia.org/wiki/Mongolian_language"},mr:{"639-1":"mr","639-2":"mar",family:"Indo-European",name:"Marathi (Marāṭhī)",nativeName:"मराठी",wikiUrl:"https://en.wikipedia.org/wiki/Marathi_language"},ms:{"639-1":"ms","639-2":"msa","639-2/B":"may",family:"Austronesian",name:"Malay",nativeName:"bahasa Melayu, بهاس ملايو‎",wikiUrl:"https://en.wikipedia.org/wiki/Malay_language"},mt:{"639-1":"mt","639-2":"mlt",family:"Afro-Asiatic",name:"Maltese",nativeName:"Malti",wikiUrl:"https://en.wikipedia.org/wiki/Maltese_language"},my:{"639-1":"my","639-2":"mya","639-2/B":"bur",family:"Sino-Tibetan",name:"Burmese",nativeName:"ဗမာစာ",wikiUrl:"https://en.wikipedia.org/wiki/Burmese_language"},na:{"639-1":"na","639-2":"nau",family:"Austronesian",name:"Nauruan",nativeName:"Dorerin Naoero",wikiUrl:"https://en.wikipedia.org/wiki/Nauruan_language"},nb:{"639-1":"nb","639-2":"nob",family:"Indo-European",name:"Norwegian Bokmål",nativeName:"Norsk bokmål",wikiUrl:"https://en.wikipedia.org/wiki/Bokm%C3%A5l"},nd:{"639-1":"nd","639-2":"nde",family:"Niger–Congo",name:"Northern Ndebele",nativeName:"isiNdebele",wikiUrl:"https://en.wikipedia.org/wiki/Northern_Ndebele_language"},ne:{"639-1":"ne","639-2":"nep",family:"Indo-European",name:"Nepali",nativeName:"नेपाली",wikiUrl:"https://en.wikipedia.org/wiki/Nepali_language"},ng:{"639-1":"ng","639-2":"ndo",family:"Niger–Congo",name:"Ndonga",nativeName:"Owambo",wikiUrl:"https://en.wikipedia.org/wiki/Ndonga"},nl:{"639-1":"nl","639-2":"nld","639-2/B":"dut",family:"Indo-European",name:"Dutch",nativeName:"Nederlands, Vlaams",wikiUrl:"https://en.wikipedia.org/wiki/Dutch_language"},nn:{"639-1":"nn","639-2":"nno",family:"Indo-European",name:"Norwegian Nynorsk",nativeName:"Norsk nynorsk",wikiUrl:"https://en.wikipedia.org/wiki/Nynorsk"},no:{"639-1":"no","639-2":"nor",family:"Indo-European",name:"Norwegian",nativeName:"Norsk",wikiUrl:"https://en.wikipedia.org/wiki/Norwegian_language"},nr:{"639-1":"nr","639-2":"nbl",family:"Niger–Congo",name:"Southern Ndebele",nativeName:"isiNdebele",wikiUrl:"https://en.wikipedia.org/wiki/Southern_Ndebele_language"},nv:{"639-1":"nv","639-2":"nav",family:"Dené–Yeniseian",name:"Navajo, Navaho",nativeName:"Diné bizaad",wikiUrl:"https://en.wikipedia.org/wiki/Navajo_language"},ny:{"639-1":"ny","639-2":"nya",family:"Niger–Congo",name:"Chichewa, Chewa, Nyanja",nativeName:"chiCheŵa, chinyanja",wikiUrl:"https://en.wikipedia.org/wiki/Chichewa_language"},oc:{"639-1":"oc","639-2":"oci",family:"Indo-European",name:"Occitan",nativeName:"occitan, lenga d'òc",wikiUrl:"https://en.wikipedia.org/wiki/Occitan_language"},oj:{"639-1":"oj","639-2":"oji",family:"Algonquian",name:"Ojibwe, Ojibwa",nativeName:"ᐊᓂᔑᓈᐯᒧᐎᓐ",wikiUrl:"https://en.wikipedia.org/wiki/Ojibwe_language"},om:{"639-1":"om","639-2":"orm",family:"Afro-Asiatic",name:"Oromo",nativeName:"Afaan Oromoo",wikiUrl:"https://en.wikipedia.org/wiki/Oromo_language"},or:{"639-1":"or","639-2":"ori",family:"Indo-European",name:"Oriya",nativeName:"ଓଡ଼ିଆ",wikiUrl:"https://en.wikipedia.org/wiki/Oriya_language"},os:{"639-1":"os","639-2":"oss",family:"Indo-European",name:"Ossetian, Ossetic",nativeName:"ирон æвзаг",wikiUrl:"https://en.wikipedia.org/wiki/Ossetic_language"},pa:{"639-1":"pa","639-2":"pan",family:"Indo-European",name:"(Eastern) Punjabi",nativeName:"ਪੰਜਾਬੀ",wikiUrl:"https://en.wikipedia.org/wiki/Eastern_Punjabi_language"},pi:{"639-1":"pi","639-2":"pli",family:"Indo-European",name:"Pāli",nativeName:"पाऴि",wikiUrl:"https://en.wikipedia.org/wiki/P%C4%81li_language"},pl:{"639-1":"pl","639-2":"pol",family:"Indo-European",name:"Polish",nativeName:"język polski, polszczyzna",wikiUrl:"https://en.wikipedia.org/wiki/Polish_language"},ps:{"639-1":"ps","639-2":"pus",family:"Indo-European",name:"Pashto, Pushto",nativeName:"پښتو",wikiUrl:"https://en.wikipedia.org/wiki/Pashto_language"},pt:{"639-1":"pt","639-2":"por",family:"Indo-European",name:"Portuguese",nativeName:"Português",wikiUrl:"https://en.wikipedia.org/wiki/Portuguese_language"},qu:{"639-1":"qu","639-2":"que",family:"Quechuan",name:"Quechua",nativeName:"Runa Simi, Kichwa",wikiUrl:"https://en.wikipedia.org/wiki/Quechua_language"},rm:{"639-1":"rm","639-2":"roh",family:"Indo-European",name:"Romansh",nativeName:"rumantsch grischun",wikiUrl:"https://en.wikipedia.org/wiki/Romansh_language"},rn:{"639-1":"rn","639-2":"run",family:"Niger–Congo",name:"Kirundi",nativeName:"Ikirundi",wikiUrl:"https://en.wikipedia.org/wiki/Kirundi"},ro:{"639-1":"ro","639-2":"ron","639-2/B":"rum",family:"Indo-European",name:"Romanian",nativeName:"Română",wikiUrl:"https://en.wikipedia.org/wiki/Romanian_language"},ru:{"639-1":"ru","639-2":"rus",family:"Indo-European",name:"Russian",nativeName:"Русский",wikiUrl:"https://en.wikipedia.org/wiki/Russian_language"},rw:{"639-1":"rw","639-2":"kin",family:"Niger–Congo",name:"Kinyarwanda",nativeName:"Ikinyarwanda",wikiUrl:"https://en.wikipedia.org/wiki/Kinyarwanda"},sa:{"639-1":"sa","639-2":"san",family:"Indo-European",name:"Sanskrit (Saṁskṛta)",nativeName:"संस्कृतम्",wikiUrl:"https://en.wikipedia.org/wiki/Sanskrit"},sc:{"639-1":"sc","639-2":"srd",family:"Indo-European",name:"Sardinian",nativeName:"sardu",wikiUrl:"https://en.wikipedia.org/wiki/Sardinian_language"},sd:{"639-1":"sd","639-2":"snd",family:"Indo-European",name:"Sindhi",nativeName:"सिन्धी, سنڌي، سندھی‎",wikiUrl:"https://en.wikipedia.org/wiki/Sindhi_language"},se:{"639-1":"se","639-2":"sme",family:"Uralic",name:"Northern Sami",nativeName:"Davvisámegiella",wikiUrl:"https://en.wikipedia.org/wiki/Northern_Sami"},sg:{"639-1":"sg","639-2":"sag",family:"Creole",name:"Sango",nativeName:"yângâ tî sängö",wikiUrl:"https://en.wikipedia.org/wiki/Sango_language"},si:{"639-1":"si","639-2":"sin",family:"Indo-European",name:"Sinhalese, Sinhala",nativeName:"සිංහල",wikiUrl:"https://en.wikipedia.org/wiki/Sinhalese_language"},sk:{"639-1":"sk","639-2":"slk","639-2/B":"slo",family:"Indo-European",name:"Slovak",nativeName:"slovenčina, slovenský jazyk",wikiUrl:"https://en.wikipedia.org/wiki/Slovak_language"},sl:{"639-1":"sl","639-2":"slv",family:"Indo-European",name:"Slovene",nativeName:"slovenski jezik, slovenščina",wikiUrl:"https://en.wikipedia.org/wiki/Slovene_language"},sm:{"639-1":"sm","639-2":"smo",family:"Austronesian",name:"Samoan",nativeName:"gagana fa'a Samoa",wikiUrl:"https://en.wikipedia.org/wiki/Samoan_language"},sn:{"639-1":"sn","639-2":"sna",family:"Niger–Congo",name:"Shona",nativeName:"chiShona",wikiUrl:"https://en.wikipedia.org/wiki/Shona_language"},so:{"639-1":"so","639-2":"som",family:"Afro-Asiatic",name:"Somali",nativeName:"Soomaaliga, af Soomaali",wikiUrl:"https://en.wikipedia.org/wiki/Somali_language"},sq:{"639-1":"sq","639-2":"sqi","639-2/B":"alb",family:"Indo-European",name:"Albanian",nativeName:"Shqip",wikiUrl:"https://en.wikipedia.org/wiki/Albanian_language"},sr:{"639-1":"sr","639-2":"srp",family:"Indo-European",name:"Serbian",nativeName:"српски језик",wikiUrl:"https://en.wikipedia.org/wiki/Serbian_language"},ss:{"639-1":"ss","639-2":"ssw",family:"Niger–Congo",name:"Swati",nativeName:"SiSwati",wikiUrl:"https://en.wikipedia.org/wiki/Swati_language"},st:{"639-1":"st","639-2":"sot",family:"Niger–Congo",name:"Southern Sotho",nativeName:"Sesotho",wikiUrl:"https://en.wikipedia.org/wiki/Sotho_language"},su:{"639-1":"su","639-2":"sun",family:"Austronesian",name:"Sundanese",nativeName:"Basa Sunda",wikiUrl:"https://en.wikipedia.org/wiki/Sundanese_language"},sv:{"639-1":"sv","639-2":"swe",family:"Indo-European",name:"Swedish",nativeName:"svenska",wikiUrl:"https://en.wikipedia.org/wiki/Swedish_language"},sw:{"639-1":"sw","639-2":"swa",family:"Niger–Congo",name:"Swahili",nativeName:"Kiswahili",wikiUrl:"https://en.wikipedia.org/wiki/Swahili_language"},ta:{"639-1":"ta","639-2":"tam",family:"Dravidian",name:"Tamil",nativeName:"தமிழ்",wikiUrl:"https://en.wikipedia.org/wiki/Tamil_language"},te:{"639-1":"te","639-2":"tel",family:"Dravidian",name:"Telugu",nativeName:"తెలుగు",wikiUrl:"https://en.wikipedia.org/wiki/Telugu_language"},tg:{"639-1":"tg","639-2":"tgk",family:"Indo-European",name:"Tajik",nativeName:"тоҷикӣ, toçikī, تاجیکی‎",wikiUrl:"https://en.wikipedia.org/wiki/Tajik_language"},th:{"639-1":"th","639-2":"tha",family:"Tai–Kadai",name:"Thai",nativeName:"ไทย",wikiUrl:"https://en.wikipedia.org/wiki/Thai_language"},ti:{"639-1":"ti","639-2":"tir",family:"Afro-Asiatic",name:"Tigrinya",nativeName:"ትግርኛ",wikiUrl:"https://en.wikipedia.org/wiki/Tigrinya_language"},tk:{"639-1":"tk","639-2":"tuk",family:"Turkic",name:"Turkmen",nativeName:"Türkmen, Түркмен",wikiUrl:"https://en.wikipedia.org/wiki/Turkmen_language"},tl:{"639-1":"tl","639-2":"tgl",family:"Austronesian",name:"Tagalog",nativeName:"Wikang Tagalog",wikiUrl:"https://en.wikipedia.org/wiki/Tagalog_language"},tn:{"639-1":"tn","639-2":"tsn",family:"Niger–Congo",name:"Tswana",nativeName:"Setswana",wikiUrl:"https://en.wikipedia.org/wiki/Tswana_language"},to:{"639-1":"to","639-2":"ton",family:"Austronesian",name:"Tonga (Tonga Islands)",nativeName:"faka Tonga",wikiUrl:"https://en.wikipedia.org/wiki/Tongan_language"},tr:{"639-1":"tr","639-2":"tur",family:"Turkic",name:"Turkish",nativeName:"Türkçe",wikiUrl:"https://en.wikipedia.org/wiki/Turkish_language"},ts:{"639-1":"ts","639-2":"tso",family:"Niger–Congo",name:"Tsonga",nativeName:"Xitsonga",wikiUrl:"https://en.wikipedia.org/wiki/Tsonga_language"},tt:{"639-1":"tt","639-2":"tat",family:"Turkic",name:"Tatar",nativeName:"татар теле, tatar tele",wikiUrl:"https://en.wikipedia.org/wiki/Tatar_language"},tw:{"639-1":"tw","639-2":"twi",family:"Niger–Congo",name:"Twi",nativeName:"Twi",wikiUrl:"https://en.wikipedia.org/wiki/Twi"},ty:{"639-1":"ty","639-2":"tah",family:"Austronesian",name:"Tahitian",nativeName:"Reo Tahiti",wikiUrl:"https://en.wikipedia.org/wiki/Tahitian_language"},ug:{"639-1":"ug","639-2":"uig",family:"Turkic",name:"Uyghur",nativeName:"ئۇيغۇرچە‎, Uyghurche",wikiUrl:"https://en.wikipedia.org/wiki/Uyghur_language"},uk:{"639-1":"uk","639-2":"ukr",family:"Indo-European",name:"Ukrainian",nativeName:"Українська",wikiUrl:"https://en.wikipedia.org/wiki/Ukrainian_language"},ur:{"639-1":"ur","639-2":"urd",family:"Indo-European",name:"Urdu",nativeName:"اردو",wikiUrl:"https://en.wikipedia.org/wiki/Urdu"},uz:{"639-1":"uz","639-2":"uzb",family:"Turkic",name:"Uzbek",nativeName:"Oʻzbek, Ўзбек, أۇزبېك‎",wikiUrl:"https://en.wikipedia.org/wiki/Uzbek_language"},ve:{"639-1":"ve","639-2":"ven",family:"Niger–Congo",name:"Venda",nativeName:"Tshivenḓa",wikiUrl:"https://en.wikipedia.org/wiki/Venda_language"},vi:{"639-1":"vi","639-2":"vie",family:"Austroasiatic",name:"Vietnamese",nativeName:"Tiếng Việt",wikiUrl:"https://en.wikipedia.org/wiki/Vietnamese_language"},vo:{"639-1":"vo","639-2":"vol",family:"Constructed",name:"Volapük",nativeName:"Volapük",wikiUrl:"https://en.wikipedia.org/wiki/Volap%C3%BCk"},wa:{"639-1":"wa","639-2":"wln",family:"Indo-European",name:"Walloon",nativeName:"walon",wikiUrl:"https://en.wikipedia.org/wiki/Walloon_language"},wo:{"639-1":"wo","639-2":"wol",family:"Niger–Congo",name:"Wolof",nativeName:"Wollof",wikiUrl:"https://en.wikipedia.org/wiki/Wolof_language"},xh:{"639-1":"xh","639-2":"xho",family:"Niger–Congo",name:"Xhosa",nativeName:"isiXhosa",wikiUrl:"https://en.wikipedia.org/wiki/Xhosa_language"},yi:{"639-1":"yi","639-2":"yid",family:"Indo-European",name:"Yiddish",nativeName:"ייִדיש",wikiUrl:"https://en.wikipedia.org/wiki/Yiddish_language"},yo:{"639-1":"yo","639-2":"yor",family:"Niger–Congo",name:"Yoruba",nativeName:"Yorùbá",wikiUrl:"https://en.wikipedia.org/wiki/Yoruba_language"},za:{"639-1":"za","639-2":"zha",family:"Tai–Kadai",name:"Zhuang, Chuang",nativeName:"Saɯ cueŋƅ, Saw cuengh",wikiUrl:"https://en.wikipedia.org/wiki/Zhuang_languages"},zh:{"639-1":"zh","639-2":"zho","639-2/B":"chi",family:"Sino-Tibetan",name:"Chinese",nativeName:"中文 (Zhōngwén), 汉语, 漢語",wikiUrl:"https://en.wikipedia.org/wiki/Chinese_language"},zu:{"639-1":"zu","639-2":"zul",family:"Niger–Congo",name:"Zulu",nativeName:"isiZulu",wikiUrl:"https://en.wikipedia.org/wiki/Zulu_language"}};void 0===(n=function(){var t=function(){};return t.getName=function(t){return r[t]?r[t].name:t},t.getNativeName=function(t){return r[t]?r[t].nativeName:t},t.toISO6392=function(t){return r[t]?r[t]["639-2"]:t},t}.apply(e,[]))||(t.exports=n)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MakeCues=void 0;var _=i(11);e.MakeCues=function(t,e){for(var i=void 0,n=void 0,r=void 0,a=void 0,s=void 0,o=window.VTTCue||window.TextTrackCue,l=0;l<t.length;l++){var u=t[l],h=u.start,c=u.end,d=u.detail;if(e.cues)for(var f=e.cues.length;f--;){var p=e.cues[f],g=Math.min(p.endTime,c)-Math.max(p.startTime,h);if(0<=g&&.5<g/(c-h))return}for(var m=0;m<d.length;m++)if(r=!0,a=0,(s="")!==(i=d[m])){for(var v=0;v<i.length;v++)i[v].match(/\s/)&&r?a++:(s+=i[v],r=!1);if(h===c&&(c+=1e-4),n=new o(h,c,s.trim().replace(/<br(?: \/)?>/gi,"\n")),16<=a?a--:a++,navigator.userAgent.match(/Firefox\//)){var y="Mac OS"===_.AdaptivePlayer.OS.name,b=[[-1,1],[2,1]];n.line=7<m?m+b[1&y][0]:m+b[1&y][1]}else n.line=7<m?m-3:m+1;n.align="left",n.position=Math.max(0,Math.min(100,a/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(n)}}return[]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CCExtractor=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(365));e.CCExtractor=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._ccCallback=t,this.init_=null,this.isLive_=!1,this.presentationTimeOffset_=0,this.closedCaptionParser_=null}return n(e,[{key:"destroy",value:function(){}},{key:"appendInit",value:function(t,e,i){this.init_=t,this.isLive_=!!e,this.presentationTimeOffset_=this.isLive_?0:i,this.closedCaptionParser_=new a.mp4.CaptionParser;var n=a.mp4.probe,r=new Uint8Array(t);this.videoTrackIds_=n.videoTrackIds(r),this.timescales_=n.timescale(r),this.closedCaptionParser_.init()}},{key:"resetData",value:function(){this.closedCaptionParser_&&this.closedCaptionParser_.reset()}},{key:"resetInitSegment",value:function(){this.init_=null}},{key:"appendSegment",value:function(t){var e=new Uint8Array(t),i=this.closedCaptionParser_.parse(e,this.videoTrackIds_,this.timescales_);if(i&&i.captions&&0<i.captions.length){var n=[];i.captions.forEach(function(t){n.push({start:t.startTime-this.presentationTimeOffset_,end:t.endTime-this.presentationTimeOffset_,detail:t.screen})}.bind(this)),this._ccCallback(n)}this.closedCaptionParser_.clearParsedCaptions()}}]),e}()},function(t,e,i){t.exports=function r(a,s,o){function l(i,t){if(!s[i]){if(!a[i]){if(u)return u(i,!0);var e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}var n=s[i]={exports:{}};a[i][0].call(n.exports,function(t){var e=a[i][1][t];return l(e||t)},n,n.exports,r,a,s,o)}return s[i].exports}for(var u=!1,t=0;t<o.length;t++)l(o[t]);return l}({1:[function(t,e,i){"use strict";var n,r=t("../utils/stream.js"),u=t("./utils");(n=function(){var o=new Uint8Array,l=0;n.prototype.init.call(this),this.setTimestamp=function(t){l=t},this.push=function(t){var e,i,n,r,a=0,s=0;for(o.length?(r=o.length,(o=new Uint8Array(t.byteLength+r)).set(o.subarray(0,r)),o.set(t,r)):o=t;3<=o.length-s;)if(o[s]!=="I".charCodeAt(0)||o[s+1]!=="D".charCodeAt(0)||o[s+2]!=="3".charCodeAt(0))if(255!=(255&o[s])||240!=(240&o[s+1]))s++;else{if(o.length-s<7)break;if(a=u.parseAdtsSize(o,s),s+a>o.length)break;n={type:"audio",data:o.subarray(s,s+a),pts:l,dts:l},this.trigger("data",n),s+=a}else{if(o.length-s<10)break;if(a=u.parseId3TagSize(o,s),s+a>o.length)break;i={type:"timed-metadata",data:o.subarray(s,s+a)},this.trigger("data",i),s+=a}e=o.length-s,o=0<e?o.subarray(s):new Uint8Array}}).prototype=new r,e.exports=n},{"../utils/stream.js":36,"./utils":2}],2:[function(t,e,i){"use strict";var n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],c=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},d=function(t,e,i){var n,r="";for(n=e;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r};e.exports={isLikelyAacData:function(t){return t[0]==="I".charCodeAt(0)&&t[1]==="D".charCodeAt(0)&&t[2]==="3".charCodeAt(0)},parseId3TagSize:function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return(16&t[e+5])>>4?i+20:i+10},parseAdtsSize:function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i},parseType:function(t,e){return t[e]==="I".charCodeAt(0)&&t[e+1]==="D".charCodeAt(0)&&t[e+2]==="3".charCodeAt(0)?"timed-metadata":!0&t[e]&&240==(240&t[e+1])?"audio":null},parseSampleRate:function(t){for(var e=0;e+5<t.length;){if(255===t[e]&&240==(246&t[e+1]))return n[(60&t[e+2])>>>2];e++}return null},parseAacTimestamp:function(t){var e,i,n,r,a,s;e=10,64&t[5]&&(e+=4,e+=c(t.subarray(10,14)));do{if((i=c(t.subarray(e+4,e+8)))<1)return null;if("PRIV"===String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3])){n=t.subarray(e+10,e+i+10);for(var o=0;o<n.byteLength;o++)if(0===n[o]){var l=(r=n,a=0,s=o,unescape(d(r,a,s)));if("com.apple.streaming.transportStreamTimestamp"!==l)break;var u=n.subarray(o+1),h=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;return h*=4,h+=3&u[7]}}e+=10,e+=i}while(e<t.byteLength);return null}}},{}],3:[function(t,e,i){"use strict";var n,r=t("../utils/stream.js"),h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(n=function(){var u;n.prototype.init.call(this),this.push=function(t){var e,i,n,r,a,s,o=0,l=0;if("audio"===t.type)for(u?(r=u,(u=new Uint8Array(r.byteLength+t.data.byteLength)).set(r),u.set(t.data,r.byteLength)):u=t.data;o+5<u.length;)if(255===u[o]&&240==(246&u[o+1])){if(i=2*(1&~u[o+1]),e=(3&u[o+3])<<11|u[o+4]<<3|(224&u[o+5])>>5,a=1024*(1+(3&u[o+6])),s=9e4*a/h[(60&u[o+2])>>>2],n=o+e,u.byteLength<n)return;if(this.trigger("data",{pts:t.pts+l*s,dts:t.dts+l*s,sampleCount:a,audioobjecttype:1+(u[o+2]>>>6&3),channelcount:(1&u[o+2])<<2|(192&u[o+3])>>>6,samplerate:h[(60&u[o+2])>>>2],samplingfrequencyindex:(60&u[o+2])>>>2,samplesize:16,data:u.subarray(o+7+i,n)}),u.byteLength===n)return void(u=void 0);l++,u=u.subarray(n)}else o++},this.flush=function(){this.trigger("done")}}).prototype=new r,e.exports=n},{"../utils/stream.js":36}],4:[function(t,e,i){"use strict";var l,u,_,n=t("../utils/stream.js"),T=t("../utils/exp-golomb.js");(u=function(){var i,n,r=0;u.prototype.init.call(this),this.push=function(t){var e;for(n=n?((e=new Uint8Array(n.byteLength+t.data.byteLength)).set(n),e.set(t.data,n.byteLength),e):t.data;r<n.byteLength-3;r++)if(1===n[r+2]){i=r+5;break}for(;i<n.byteLength;)switch(n[i]){case 0:if(0!==n[i-1]){i+=2;break}if(0!==n[i-2]){i++;break}for(r+3!==i-2&&this.trigger("data",n.subarray(r+3,i-2));1!==n[++i]&&i<n.length;);r=i-2,i+=3;break;case 1:if(0!==n[i-1]||0!==n[i-2]){i+=3;break}this.trigger("data",n.subarray(r+3,i-2)),r=i-2,i+=3;break;default:i+=3}n=n.subarray(r),i-=r,r=0},this.flush=function(){n&&3<n.byteLength&&this.trigger("data",n.subarray(r+3)),n=null,r=0,this.trigger("done")}}).prototype=new n,_={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(l=function(){var i,n,r,a,s,o,b,e=new u;l.prototype.init.call(this),(i=this).push=function(t){"video"===t.type&&(n=t.trackId,r=t.pts,a=t.dts,e.push(t))},e.on("data",function(t){var e={trackId:n,pts:r,dts:a,data:t};switch(31&t[0]){case 5:e.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:e.nalUnitType="sei_rbsp",e.escapedRBSP=s(t.subarray(1));break;case 7:e.nalUnitType="seq_parameter_set_rbsp",e.escapedRBSP=s(t.subarray(1)),e.config=o(e.escapedRBSP);break;case 8:e.nalUnitType="pic_parameter_set_rbsp";break;case 9:e.nalUnitType="access_unit_delimiter_rbsp"}i.trigger("data",e)}),e.on("done",function(){i.trigger("done")}),this.flush=function(){e.flush()},b=function(t,e){var i,n,r=8,a=8;for(i=0;i<t;i++)0!==a&&(n=e.readExpGolomb(),a=(r+n+256)%256),r=0===a?r:a},s=function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},o=function(t){var e,i,n,r,a,s,o,l,u,h,c,d,f,p=0,g=0,m=0,v=0,y=1;if(e=new T(t),i=e.readUnsignedByte(),r=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),_[i]&&(3===(a=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(c=3!==a?8:12,f=0;f<c;f++)e.readBoolean()&&b(f<6?16:64,e);if(e.skipUnsignedExpGolomb(),0===(s=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===s)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),o=e.readUnsignedExpGolomb(),f=0;f<o;f++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),l=e.readUnsignedExpGolomb(),u=e.readUnsignedExpGolomb(),0===(h=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(p=e.readUnsignedExpGolomb(),g=e.readUnsignedExpGolomb(),m=e.readUnsignedExpGolomb(),v=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:d=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}d&&(y=d[0]/d[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:Math.ceil((16*(l+1)-2*p-2*g)*y),height:(2-h)*(u+1)*16-2*m-2*v}}}).prototype=new n,e.exports={H264Stream:l,NalByteStream:u}},{"../utils/exp-golomb.js":35,"../utils/stream.js":36}],5:[function(t,e,i){e.exports={adts:t("./adts"),h264:t("./h264")}},{"./adts":3,"./h264":4}],6:[function(t,e,i){var n,r=[33,16,5,32,164,27],a=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],s=function(t){for(var e=[];t--;)e.push(0);return e},o={96e3:[r,[227,64],s(154),[56]],88200:[r,[231],s(170),[56]],64e3:[r,[248,192],s(240),[56]],48e3:[r,[255,192],s(268),[55,148,128],s(54),[112]],44100:[r,[255,192],s(268),[55,163,128],s(84),[112]],32e3:[r,[255,192],s(268),[55,234],s(226),[112]],24e3:[r,[255,192],s(268),[55,255,128],s(268),[111,112],s(126),[224]],16e3:[r,[255,192],s(268),[55,255,128],s(268),[111,255],s(269),[223,108],s(195),[1,192]],12e3:[a,s(268),[3,127,248],s(268),[6,255,240],s(268),[13,255,224],s(268),[27,253,128],s(259),[56]],11025:[a,s(268),[3,127,248],s(268),[6,255,240],s(268),[13,255,224],s(268),[27,255,192],s(268),[55,175,128],s(108),[112]],8e3:[a,s(268),[3,121,16],s(47),[7]]};e.exports=(n=o,Object.keys(n).reduce(function(t,e){return t[e]=new Uint8Array(n[e].reduce(function(t,e){return t.concat(e)},[])),t},{}))},{}],7:[function(t,e,i){"use strict";var n=t("../utils/stream.js"),r=function(t){this.numberOfTracks=0,this.metadataStream=t.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,r.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),void("audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)))}};r.prototype=new n,r.prototype.flush=function(t){var e,i,n,r,a={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(0===this.pendingTracks&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?r=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(r=this.audioTrack.timelineStartInfo.pts),a.tags.videoTags=this.videoTags,a.tags.audioTags=this.audioTags,n=0;n<this.pendingCaptions.length;n++)(i=this.pendingCaptions[n]).startTime=i.startPts-r,i.startTime/=9e4,i.endTime=i.endPts-r,i.endTime/=9e4,a.captionStreams[i.stream]=!0,a.captions.push(i);for(n=0;n<this.pendingMetadata.length;n++)(e=this.pendingMetadata[n]).cueTime=e.pts-r,e.cueTime/=9e4,a.metadata.push(e);a.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",a),this.trigger("done")}},e.exports=r},{"../utils/stream.js":36}],8:[function(t,e,i){"use strict";var l=t("./flv-tag.js");e.exports=function(t,e,i){var n,r,a,s=new Uint8Array(9),o=new DataView(s.buffer);return t=t||0,e=void 0===e||e,i=void 0===i||i,o.setUint8(0,70),o.setUint8(1,76),o.setUint8(2,86),o.setUint8(3,1),o.setUint8(4,(e?4:0)|(i?1:0)),o.setUint32(5,s.byteLength),t<=0?((r=new Uint8Array(s.byteLength+4)).set(s),r.set([0,0,0,0],s.byteLength)):((n=new l(l.METADATA_TAG)).pts=n.dts=0,n.writeMetaDataDouble("duration",t),a=n.finalize().length,(r=new Uint8Array(s.byteLength+a)).set(s),r.set(o.byteLength,a)),r}},{"./flv-tag.js":9}],9:[function(t,e,i){"use strict";var u;(u=function(t,i){var e,n=0,r=16384,a=function(t,e){var i,n=t.position+e;n<t.bytes.byteLength||((i=new Uint8Array(2*n)).set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},s=u.widthBytes||new Uint8Array("width".length),o=u.heightBytes||new Uint8Array("height".length),l=u.videocodecidBytes||new Uint8Array("videocodecid".length);if(!u.widthBytes){for(e=0;e<"width".length;e++)s[e]="width".charCodeAt(e);for(e=0;e<"height".length;e++)o[e]="height".charCodeAt(e);for(e=0;e<"videocodecid".length;e++)l[e]="videocodecid".charCodeAt(e);u.widthBytes=s,u.heightBytes=o,u.videocodecidBytes=l}switch(this.keyFrame=!1,t){case u.VIDEO_TAG:this.length=16,r*=6;break;case u.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case u.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(r),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=i,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var n,r=e||0;i=i||t.byteLength,n=r+i,a(this,i),this.bytes.set(t.subarray(r,n),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){a(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){a(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===n?0:this.length-(n+4)},this.startNalUnit=function(){if(0<n)throw new Error("Attempted to create new NAL wihout closing the old one");n=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===n+4?this.length-=4:0<n&&(e=n+4,i=this.length-e,this.position=n,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),n=0},this.writeMetaDataDouble=function(t,e){var i;if(a(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(s,this.position),this.position+=5;else if("height"===t)this.bytes.set(o,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(l,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++n},this.writeMetaDataBoolean=function(t,e){var i;for(a(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)a(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;a(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++n},this.finalize=function(){var t,e;switch(this.bytes[0]){case u.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||i?16:32),this.bytes[12]=i?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case u.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=i?0:1;break;case u.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,n),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return e=this.length-11,this.bytes[1]=(16711680&e)>>>16,this.bytes[2]=(65280&e)>>>8,this.bytes[3]=(255&e)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,a(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=u.frameTime(this.bytes),this}}).AUDIO_TAG=8,u.VIDEO_TAG=9,u.METADATA_TAG=18,u.isAudioFrame=function(t){return u.AUDIO_TAG===t[0]},u.isVideoFrame=function(t){return u.VIDEO_TAG===t[0]},u.isMetaData=function(t){return u.METADATA_TAG===t[0]},u.isKeyFrame=function(t){return u.isVideoFrame(t)?23===t[11]:!!u.isAudioFrame(t)||!!u.isMetaData(t)},u.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24},e.exports=u},{}],10:[function(t,e,i){e.exports={tag:t("./flv-tag"),Transmuxer:t("./transmuxer"),getFlvHeader:t("./flv-header")}},{"./flv-header":8,"./flv-tag":9,"./transmuxer":12}],11:[function(t,e,i){"use strict";e.exports=function(){var t=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return t.list.length}})}},{}],12:[function(t,e,i){"use strict";var p,g,m,n,o,l,r=t("../utils/stream.js"),u=t("./flv-tag.js"),v=t("../m2ts/m2ts.js"),y=t("../codecs/adts.js"),b=t("../codecs/h264").H264Stream,_=t("./coalesce-stream.js"),h=t("./tag-list.js");n=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},o=function(t,e){var i=new u(u.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},l=function(t,e){var i,n=new u(u.VIDEO_TAG,!0);for(n.dts=e,n.pts=e,n.writeByte(1),n.writeByte(t.profileIdc),n.writeByte(t.profileCompatibility),n.writeByte(t.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(t.sps[0].length),n.writeBytes(t.sps[0]),n.writeByte(t.pps.length),i=0;i<t.pps.length;++i)n.writeShort(t.pps[i].length),n.writeBytes(t.pps[i]);return n},(m=function(r){var a,s=[],o=[];m.prototype.init.call(this),this.push=function(t){n(r,t),r&&(r.audioobjecttype=t.audioobjecttype,r.channelcount=t.channelcount,r.samplerate=t.samplerate,r.samplingfrequencyindex=t.samplingfrequencyindex,r.samplesize=t.samplesize,r.extraData=r.audioobjecttype<<11|r.samplingfrequencyindex<<7|r.channelcount<<3),t.pts=Math.round(t.pts/90),t.dts=Math.round(t.dts/90),s.push(t)},this.flush=function(){var t,e,i,n=new h;if(0!==s.length){for(i=-1/0;s.length;)t=s.shift(),o.length&&t.pts>=o[0]&&(i=o.shift(),this.writeMetaDataTags(n,i)),(r.extraData!==a||1e3<=t.pts-i)&&(this.writeMetaDataTags(n,t.pts),a=r.extraData,i=t.pts),(e=new u(u.AUDIO_TAG)).pts=t.pts,e.dts=t.dts,e.writeBytes(t.data),n.push(e.finalize());o.length=0,a=null,this.trigger("data",{track:r,tags:n.list}),this.trigger("done","AudioSegmentStream")}else this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(t,e){var i;(i=new u(u.METADATA_TAG)).pts=e,i.dts=e,i.writeMetaDataDouble("audiocodecid",10),i.writeMetaDataBoolean("stereo",2===r.channelcount),i.writeMetaDataDouble("audiosamplerate",r.samplerate),i.writeMetaDataDouble("audiosamplesize",16),t.push(i.finalize()),(i=new u(u.AUDIO_TAG,!0)).pts=e,i.dts=e,i.view.setUint16(i.position,r.extraData),i.position+=2,i.length=Math.max(i.length,i.position),t.push(i.finalize())},this.onVideoKeyFrame=function(t){o.push(t)}}).prototype=new r,(g=function(r){var a,s,i=[];g.prototype.init.call(this),this.finishFrame=function(t,e){if(e){if(a&&r&&r.newMetadata&&(e.keyFrame||0===t.length)){var i=o(a,e.dts).finalize(),n=l(r,e.dts).finalize();i.metaDataTag=n.metaDataTag=!0,t.push(i),t.push(n),r.newMetadata=!1,this.trigger("keyframe",e.dts)}e.endNalUnit(),t.push(e.finalize()),s=null}},this.push=function(t){n(r,t),t.pts=Math.round(t.pts/90),t.dts=Math.round(t.dts/90),i.push(t)},this.flush=function(){for(var t,e=new h;i.length&&"access_unit_delimiter_rbsp"!==i[0].nalUnitType;)i.shift();if(0!==i.length){for(;i.length;)"seq_parameter_set_rbsp"===(t=i.shift()).nalUnitType?(r.newMetadata=!0,a=t.config,r.width=a.width,r.height=a.height,r.sps=[t.data],r.profileIdc=a.profileIdc,r.levelIdc=a.levelIdc,r.profileCompatibility=a.profileCompatibility,s.endNalUnit()):"pic_parameter_set_rbsp"===t.nalUnitType?(r.newMetadata=!0,r.pps=[t.data],s.endNalUnit()):"access_unit_delimiter_rbsp"===t.nalUnitType?(s&&this.finishFrame(e,s),(s=new u(u.VIDEO_TAG)).pts=t.pts,s.dts=t.dts):("slice_layer_without_partitioning_rbsp_idr"===t.nalUnitType&&(s.keyFrame=!0),s.endNalUnit()),s.startNalUnit(),s.writeBytes(t.data);s&&this.finishFrame(e,s),this.trigger("data",{track:r,tags:e.list}),this.trigger("done","VideoSegmentStream")}else this.trigger("done","VideoSegmentStream")}}).prototype=new r,(p=function(t){var e,i,n,r,a,s,o,l,u,h,c,d,f=this;p.prototype.init.call(this),t=t||{},this.metadataStream=new v.MetadataStream,t.metadataStream=this.metadataStream,e=new v.TransportPacketStream,i=new v.TransportParseStream,n=new v.ElementaryStream,r=new v.TimestampRolloverStream("video"),a=new v.TimestampRolloverStream("audio"),s=new v.TimestampRolloverStream("timed-metadata"),o=new y,l=new b,d=new _(t),e.pipe(i).pipe(n),n.pipe(r).pipe(l),n.pipe(a).pipe(o),n.pipe(s).pipe(this.metadataStream).pipe(d),c=new v.CaptionStream,l.pipe(c).pipe(d),n.on("data",function(t){var e,i,n;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(n=t.tracks[e]);i&&!u&&(d.numberOfTracks++,u=new g(i),l.pipe(u).pipe(d)),n&&!h&&(d.numberOfTracks++,h=new m(n),o.pipe(h).pipe(d),u&&u.on("keyframe",h.onVideoKeyFrame))}}),this.push=function(t){e.push(t)},this.flush=function(){e.flush()},this.resetCaptions=function(){c.reset()},d.on("data",function(t){f.trigger("data",t)}),d.on("done",function(){f.trigger("done")})}).prototype=new r,e.exports=p},{"../codecs/adts.js":3,"../codecs/h264":4,"../m2ts/m2ts.js":16,"../utils/stream.js":36,"./coalesce-stream.js":7,"./flv-tag.js":9,"./tag-list.js":11}],13:[function(t,e,i){"use strict";var n={codecs:t("./codecs"),mp4:t("./mp4"),flv:t("./flv"),mp2t:t("./m2ts")};n.mp4.tools=t("./tools/mp4-inspector"),n.flv.tools=t("./tools/flv-inspector"),n.mp2t.tools=t("./tools/ts-inspector"),e.exports=n},{"./codecs":5,"./flv":10,"./m2ts":15,"./mp4":24,"./tools/flv-inspector":30,"./tools/mp4-inspector":31,"./tools/ts-inspector":32}],14:[function(t,e,i){"use strict";var n=t("../utils/stream"),r=t("../tools/caption-packet-parser"),a=function(){a.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new o(0,0),new o(0,1),new o(1,0),new o(1,1)],this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("done",this.trigger.bind(this,"done"))},this)};a.prototype=new n,a.prototype.push=function(t){var e,i,n;if("sei_rbsp"===t.nalUnitType&&(e=r.parseSei(t.escapedRBSP)).payloadType===r.USER_DATA_REGISTERED_ITU_T_T35&&(i=r.parseUserData(e)))if(t.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=r.parseCaptionPackets(t.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},a.prototype.flush=function(){this.captionPackets_.length?(this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(function(t){t.type<2&&this.dispatchCea608Packet(t)},this),this.captionPackets_.length=0,this.ccStreams_.forEach(function(t){t.flush()},this)):this.ccStreams_.forEach(function(t){t.flush()},this)},a.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(t){t.reset()})},a.prototype.dispatchCea608Packet=function(t){this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},a.prototype.setsChannel1Active=function(t){return 4096==(30720&t.ccData)},a.prototype.setsChannel2Active=function(t){return 6144==(30720&t.ccData)};var s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},u=function(t){return null===t?"":(t=s[t]||t,String.fromCharCode(t))},h=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],c=function(){for(var t=[],e=15;e--;)t.push("");return t},o=function(t,e){o.prototype.init.call(this),this.field_=t||0,this.dataChannel_=e||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,r,a;if((e=32639&t.ccData)!==this.lastControlCode_){if(4096==(61440&e)?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),n=e>>>8,r=255&e,e!==this.PADDING_)if(e===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(e===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;else if(e===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(t.pts);else if(e===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(t.pts);else if(e===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(t.pts);else if(e===this.CARRIAGE_RETURN_)this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;else if(e===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(e===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(t.pts),this.displayed_=c();else if(e===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=c();else if(e===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=c()),this.mode_="paintOn",this.startPts_=t.pts;else if(this.isSpecialCharacter(n,r))a=u((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=u((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,14==(14&r)&&this.addFormatting(t.pts,["i"]),1==(1&r)&&this.addFormatting(t.pts,["u"]);else if(this.isOffsetControlCode(n,r)){for(var s=3&r,o=0;o<s;o++)this[this.mode_](t.pts," ");this.column_+=s}else if(this.isPAC(n,r)){var l=h.indexOf(7968&e);if("rollUp"===this.mode_&&(l-this.rollUpRows_+1<0&&(l=this.rollUpRows_-1),this.setRollUp(t.pts,l)),l!==this.row_&&(this.clearFormatting(t.pts),this.row_=l),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),16==(16&e)){for(var s=4*((14&e)>>1),o=0;o<s;o++)this[this.mode_](t.pts," ");this.column_=s}this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(t.pts,["i"])}else this.isNormalChar(n)&&(0===r&&(r=null),a=u(n),a+=u(r),this[this.mode_](t.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};o.prototype=new n,o.prototype.flushDisplayed=function(t){var n=-1,e=this.displayed_.map(function(t,e){try{var i=n<0?t:t.trim();return 0<t.length&&n<0&&(n=e),i}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_,row:n,column:this.column_,screen:this.displayed_})},o.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=c(),this.nonDisplayed_=c(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},o.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},o.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&48<=e&&e<=63},o.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&32<=e&&e<=63},o.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&32<=e&&e<=47},o.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&33<=e&&e<=35},o.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&64<=e&&e<=127},o.prototype.isColorPAC=function(t){return 64<=t&&t<=79||96<=t&&t<=127},o.prototype.isNormalChar=function(t){return 32<=t&&t<=127},o.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=c(),this.displayed_=c()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},o.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);var i=e.reduce(function(t,e){return t+"<"+e+">"},"");this[this.mode_](t,i)},o.prototype.clearFormatting=function(t){if(this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,e){return t+"</"+e+">"},"");this.formatting_=[],this[this.mode_](t,e)}},o.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];i+=e,this.nonDisplayed_[this.row_]=i},o.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},o.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},o.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},e.exports={CaptionStream:a,Cea608Stream:o}},{"../tools/caption-packet-parser":29,"../utils/stream":36}],15:[function(t,e,i){e.exports=t("./m2ts")},{"./m2ts":16}],16:[function(t,e,i){"use strict";var n,s,o,r=t("../utils/stream.js"),a=t("./caption-stream"),u=t("./stream-types"),l=t("./timestamp-rollover-stream").TimestampRolloverStream,h=t("./stream-types.js");(n=function(){var r=new Uint8Array(188),a=0;n.prototype.init.call(this),this.push=function(t){var e,i=0,n=188;for(a?((e=new Uint8Array(t.byteLength+a)).set(r.subarray(0,a)),e.set(t,a),a=0):e=t;n<e.byteLength;)71!==e[i]||71!==e[n]?(i++,n++):(this.trigger("data",e.subarray(i,n)),i+=188,n+=188);i<e.byteLength&&(r.set(e.subarray(i),0),a=e.byteLength-i)},this.flush=function(){188===a&&71===r[0]&&(this.trigger("data",r),a=0),this.trigger("done")}}).prototype=new r,(s=function(){var n,r,a,l;s.prototype.init.call(this),(l=this).packetsWaitingForPmt=[],this.programMapTable=void 0,n=function(t,e){var i=0;e.payloadUnitStartIndicator&&(i+=t[i]+1),"pat"===e.type?r(t.subarray(i),e):a(t.subarray(i),e)},r=function(t,e){e.section_number=t[7],e.last_section_number=t[8],l.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=l.pmtPid},a=function(t,e){var i,n,r,a;if(1&t[5]){for(l.programMapTable={video:null,audio:null,"timed-metadata":{}},i=(15&t[1])<<8|t[2],n=3+i-4,r=(15&t[10])<<8|t[11],a=12+r;a<n;){var s=t[a],o=(31&t[a+1])<<8|t[a+2];s===u.H264_STREAM_TYPE&&null===l.programMapTable.video?l.programMapTable.video=o:s===u.ADTS_STREAM_TYPE&&null===l.programMapTable.audio?l.programMapTable.audio=o:s===u.METADATA_STREAM_TYPE&&(l.programMapTable["timed-metadata"][o]=s),a+=5+((15&t[a+3])<<8|t[a+4])}e.programMapTable=l.programMapTable}},this.push=function(t){var e={},i=4;if(e.payloadUnitStartIndicator=!!(64&t[1]),e.pid=31&t[1],e.pid<<=8,e.pid|=t[2],1<(48&t[3])>>>4&&(i+=t[i]+1),0===e.pid)e.type="pat",n(t.subarray(i),e),this.trigger("data",e);else if(e.pid===this.pmtPid)for(e.type="pmt",n(t.subarray(i),e),this.trigger("data",e);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,e]):this.processPes_(t,i,e)},this.processPes_=function(t,e,i){i.pid===this.programMapTable.video?i.streamType=u.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=u.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}}).prototype=new r,s.STREAM_TYPES={h264:27,adts:15},(o=function(){var d=this,n={data:[],size:0},r={data:[],size:0},a={data:[],size:0},s=function(t,e,i){var n,r,a,s,o=new Uint8Array(t.size),l={type:e},u=0,h=0,c=!1;if(t.data.length&&!(t.size<9)){for(l.trackId=t.data[0].pid,u=0;u<t.data.length;u++)n=t.data[u],o.set(n.data,h),h+=n.data.byteLength;r=o,(a=l).packetLength=6+(r[4]<<8|r[5]),a.dataAlignmentIndicator=0!=(4&r[6]),192&(s=r[7])&&(a.pts=(14&r[9])<<27|(255&r[10])<<20|(254&r[11])<<12|(255&r[12])<<5|(254&r[13])>>>3,a.pts*=4,a.pts+=(6&r[13])>>>1,a.dts=a.pts,64&s&&(a.dts=(14&r[14])<<27|(255&r[15])<<20|(254&r[16])<<12|(255&r[17])<<5|(254&r[18])>>>3,a.dts*=4,a.dts+=(6&r[18])>>>1)),a.data=r.subarray(9+r[8]),c="video"===e||l.packetLength<=t.size,(i||c)&&(t.size=0,t.data.length=0),c&&d.trigger("data",l)}};o.prototype.init.call(this),this.push=function(i){({pat:function(){},pes:function(){var t,e;switch(i.streamType){case u.H264_STREAM_TYPE:case h.H264_STREAM_TYPE:t=n,e="video";break;case u.ADTS_STREAM_TYPE:t=r,e="audio";break;case u.METADATA_STREAM_TYPE:t=a,e="timed-metadata";break;default:return}i.payloadUnitStartIndicator&&s(t,e,!0),t.data.push(i),t.size+=i.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},e=i.programMapTable;null!==e.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),d.trigger("data",t)}})[i.type]()},this.flush=function(){s(n,"video"),s(r,"audio"),s(a,"timed-metadata"),this.trigger("done")}}).prototype=new r;var c={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:n,TransportParseStream:s,ElementaryStream:o,TimestampRolloverStream:l,CaptionStream:a.CaptionStream,Cea608Stream:a.Cea608Stream,MetadataStream:t("./metadata-stream")};for(var d in u)u.hasOwnProperty(d)&&(c[d]=u[d]);e.exports=c},{"../utils/stream.js":36,"./caption-stream":14,"./metadata-stream":17,"./stream-types":19,"./stream-types.js":19,"./timestamp-rollover-stream":20}],17:[function(t,e,i){"use strict";var n,r=t("../utils/stream"),a=t("./stream-types"),s=function(t,e,i){var n,r="";for(n=e;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r},o=function(t,e,i){return decodeURIComponent(s(t,e,i))},f=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},p={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=o(t.data,1,e),t.value=o(t.data,e+1,t.data.length).replace(/\0*$/,"");break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=o(t.data,1,e),t.url=o(t.data,e+1,t.data.length);break}},PRIV:function(t){var e,i;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=(i=t.data,unescape(s(i,0,e)));break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};(n=function(t){var e,u={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},h=0,c=[],d=0;if(n.prototype.init.call(this),this.dispatchType=a.METADATA_STREAM_TYPE.toString(16),u.descriptor)for(e=0;e<u.descriptor.length;e++)this.dispatchType+=("00"+u.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,i,n,r,a,s;if("timed-metadata"===t.type)if(t.dataAlignmentIndicator&&(d=0,c.length=0),0===c.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))u.debug&&console.log("Skipping unrecognized metadata packet");else if(c.push(t),d+=t.data.byteLength,1===c.length&&(h=f(t.data.subarray(6,10)),h+=10),!(d<h)){for(e={data:new Uint8Array(h),frames:[],pts:c[0].pts,dts:c[0].dts},a=0;a<h;)e.data.set(c[0].data.subarray(0,h-a),a),a+=c[0].data.byteLength,d-=c[0].data.byteLength,c.shift();i=10,64&e.data[5]&&(i+=4,i+=f(e.data.subarray(10,14)),h-=f(e.data.subarray(16,20)));do{if((n=f(e.data.subarray(i+4,i+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if(s=String.fromCharCode(e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]),(r={id:s,data:e.data.subarray(i+10,i+n+10)}).key=r.id,p[r.id]&&(p[r.id](r),"com.apple.streaming.transportStreamTimestamp"===r.owner)){var o=r.data,l=(1&o[3])<<30|o[4]<<22|o[5]<<14|o[6]<<6|o[7]>>>2;l*=4,l+=3&o[7],r.timeStamp=l,void 0===e.pts&&void 0===e.dts&&(e.pts=r.timeStamp,e.dts=r.timeStamp),this.trigger("timestamp",r)}e.frames.push(r),i+=10,i+=n}while(i<h);this.trigger("data",e)}}}).prototype=new r,e.exports=n},{"../utils/stream":36,"./stream-types":19}],18:[function(t,e,i){"use strict";var n=t("./stream-types.js"),r=function(t){var e=31&t[1];return e<<=8,e|=t[2]},l=function(t){return!!(64&t[1])},u=function(t){var e=0;return 1<(48&t[3])>>>4&&(e+=t[4]+1),e},s=function(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}};e.exports={parseType:function(t,e){var i=r(t);return 0===i?"pat":i===e?"pmt":e?"pes":null},parsePat:function(t){var e=l(t),i=4+u(t);return e&&(i+=t[i]+1),(31&t[i+10])<<8|t[i+11]},parsePmt:function(t){var e,i,n={},r=l(t),a=4+u(t);if(r&&(a+=t[a]+1),1&t[a+5]){e=(15&t[a+1])<<8|t[a+2],i=3+e-4;for(var s=12+((15&t[a+10])<<8|t[a+11]);s<i;){var o=a+s;n[(31&t[o+1])<<8|t[o+2]]=t[o],s+=5+((15&t[o+3])<<8|t[o+4])}return n}},parsePayloadUnitStartIndicator:l,parsePesType:function(t,e){var i=r(t);switch(e[i]){case n.H264_STREAM_TYPE:return"video";case n.ADTS_STREAM_TYPE:return"audio";case n.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(t){if(!l(t))return null;var e=4+u(t);if(e>=t.byteLength)return null;var i,n=null;return 192&(i=t[e+7])&&((n={}).pts=(14&t[e+9])<<27|(255&t[e+10])<<20|(254&t[e+11])<<12|(255&t[e+12])<<5|(254&t[e+13])>>>3,n.pts*=4,n.pts+=(6&t[e+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&t[e+14])<<27|(255&t[e+15])<<20|(254&t[e+16])<<12|(255&t[e+17])<<5|(254&t[e+18])>>>3,n.dts*=4,n.dts+=(6&t[e+18])>>>1)),n},videoPacketContainsKeyFrame:function(t){for(var e=4+u(t),i=t.subarray(e),n=0,r=0,a=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}for(r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===s(31&i[r+3])&&(a=!0);1!==i[++n]&&n<i.length;);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===s(31&i[r+3])&&(a=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,i&&3<i.byteLength&&"slice_layer_without_partitioning_rbsp_idr"===s(31&i[r+3])&&(a=!0),a}}},{"./stream-types.js":19}],19:[function(t,e,i){"use strict";e.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],20:[function(t,e,i){"use strict";var n=t("../utils/stream"),r=function(t,e){var i=1;for(e<t&&(i=-1);4294967296<Math.abs(e-t);)t+=8589934592*i;return t},a=function(t){var e,i;a.prototype.init.call(this),this.type_=t,this.push=function(t){t.type===this.type_&&(void 0===i&&(i=t.dts),t.dts=r(t.dts,i),t.pts=r(t.pts,i),e=t.dts,this.trigger("data",t))},this.flush=function(){i=e,this.trigger("done")},this.discontinuity=function(){e=i=void 0}};a.prototype=new n,e.exports={TimestampRolloverStream:a,handleRollover:r}},{"../utils/stream":36}],21:[function(t,e,i){var c=t("../data/silence"),d=t("../utils/clock"),a=function(t){var e,i,n=0;for(e=0;e<t.length;e++)i=t[e],n+=i.data.byteLength;return n};e.exports={prefixWithSilence:function(t,e,i,n){var r,a,s,o=0,l=0,u=0,h=0;if(e.length&&(r=d.audioTsToVideoTs(t.baseMediaDecodeTime,t.samplerate),o=Math.ceil(9e4/(t.samplerate/1024)),i&&n&&(l=r-Math.max(i,n),u=Math.floor(l/o),h=u*o),!(u<1||45e3<h))){for((a=c[t.samplerate])||(a=e[0].data),s=0;s<u;s++)e.splice(s,0,{data:a});t.baseMediaDecodeTime-=Math.floor(d.videoTsToAudioTs(h,t.samplerate))}},trimAdtsFramesByEarliestDts:function(t,e,i){return e.minSegmentDts>=i?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=i&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))},generateSampleTable:function(t){var e,i,n=[];for(e=0;e<t.length;e++)i=t[e],n.push({size:i.data.byteLength,duration:1024});return n},concatenateFrameData:function(t){var e,i,n=0,r=new Uint8Array(a(t));for(e=0;e<t.length;e++)i=t[e],r.set(i.data,n),n+=i.data.byteLength;return r}}},{"../data/silence":6,"../utils/clock":34}],22:[function(t,e,i){"use strict";var b=t("../tools/caption-packet-parser").discardEmulationPreventionBytes,n=t("../m2ts/caption-stream").CaptionStream,_=t("./probe"),T=t("../tools/mp4-inspector"),E=function(t,e){for(var i=t,n=0;n<e.length;n++){var r=e[n];if(i<r.size)return r;i-=r.size}return null},d=function(t,v){var n=_.findBox(t,["moof","traf"]),e=_.findBox(t,["mdat"]),y={},r=[];return e.forEach(function(t,e){var i=n[e];r.push({mdat:t,traf:i})}),r.forEach(function(t){var e,i,n,r,a,s,o,l,u=t.mdat,h=t.traf,c=_.findBox(h,["tfhd"]),d=T.parseTfhd(c[0]),f=d.trackId,p=_.findBox(h,["tfdt"]),g=0<p.length?T.parseTfdt(p[0]).baseMediaDecodeTime:0,m=_.findBox(h,["trun"]);v===f&&0<m.length&&(i=m,r=g,a=(n=d).defaultSampleDuration||0,s=n.defaultSampleSize||0,o=n.trackId,l=[],i.forEach(function(t){var e=T.parseTrun(t).samples;e.forEach(function(t){void 0===t.duration&&(t.duration=a),void 0===t.size&&(t.size=s),t.trackId=o,t.dts=r,void 0===t.compositionTimeOffset&&(t.compositionTimeOffset=0),t.pts=r+t.compositionTimeOffset,r+=t.duration}),l=l.concat(e)}),e=function(t,e,i){var n,r,a,s,o=new DataView(t.buffer,t.byteOffset,t.byteLength),l=[];for(r=0;r+4<t.length;r+=a)if(a=o.getUint32(r),r+=4,!(a<=0))switch(31&t[r]){case 6:var u=t.subarray(r+1,r+1+a),h=E(r,e);n={nalUnitType:"sei_rbsp",size:a,data:u,escapedRBSP:b(u),trackId:i},h?(n.pts=h.pts,n.dts=h.dts,s=h):(n.pts=s.pts,n.dts=s.dts),l.push(n)}return l}(u,l,f),y[f]||(y[f]=[]),y[f]=y[f].concat(e))}),y};e.exports=function(){var e,l,u,h,c,t=!1;this.isInitialized=function(){return t},this.init=function(){e=new n,t=!0,e.on("data",function(t){t.startTime=t.startPts/h,t.endTime=t.endPts/h,c.captions.push(t),c.captionStreams[t.stream]=!0})},this.isNewInit=function(t,e){return!(t&&0===t.length||e&&"object"==typeof e&&0===Object.keys(e).length||u===t[0]&&h===e[u])},this.parse=function(t,e,i){var n,r,a,s;if(!this.isInitialized())return null;if(!e||!i)return null;if(this.isNewInit(e,i))u=e[0],h=i[u];else if(!u||!h)return l.push(t),null;for(;0<l.length;){var o=l.shift();this.parse(o,e,i)}return r=t,s=h,null!==(n=(a=u)?{seiNals:d(r,a)[a],timescale:s}:null)&&n.seiNals?(this.pushNals(n.seiNals),this.flushStream(),c):null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;e.flush()},this.clearParsedCaptions=function(){c.captions=[],c.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){l=[],h=u=null,c?this.clearParsedCaptions():c={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()}},{"../m2ts/caption-stream":14,"../tools/caption-packet-parser":29,"../tools/mp4-inspector":31,"./probe":26}],23:[function(t,e,i){e.exports={groupNalsIntoFrames:function(t){var e,i,n=[],r=[];for(n.byteLength=0,e=0;e<t.length;e++)"access_unit_delimiter_rbsp"===(i=t[e]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.push(n),r},groupFramesIntoGops:function(t){var e,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=t[0].pts,r.dts=t[0].dts,e=0;e<t.length;e++)(i=t[e]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},extendFirstKeyFrame:function(t){var e;return!t[0][0].keyFrame&&1<t.length&&(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t},generateSampleTable:function(t,e){var i,n,r,a,s,o,l,u=[];for(i=0;i<t.length;i++)for(a=t[i],n=0;n<a.length;n++)s=a[n],o=s,l=void 0,(l={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}).dataOffset=kHc,l.compositionTimeOffset=o.pts-o.dts,l.duration=o.duration,l.size=4*o.length,l.size+=o.byteLength,o.keyFrame&&(l.flags.dependsOn=2,l.flags.isNonSyncSample=0),(r=l).size,u.push(r);return u},concatenateNalData:function(t){var e,i,n,r,a,s,o=0,l=t.byteLength,u=t.nalCount,h=new Uint8Array(l+4*u),c=new DataView(h.buffer);for(e=0;e<t.length;e++)for(r=t[e],i=0;i<r.length;i++)for(a=r[i],n=0;n<a.length;n++)s=a[n],c.setUint32(o,s.data.byteLength),o+=4,h.set(s.data,o),o+=s.data.byteLength;return h}}},{}],24:[function(t,e,i){e.exports={generator:t("./mp4-generator"),probe:t("./probe"),Transmuxer:t("./transmuxer").Transmuxer,AudioSegmentStream:t("./transmuxer").AudioSegmentStream,VideoSegmentStream:t("./transmuxer").VideoSegmentStream,CaptionParser:t("./caption-parser")}},{"./caption-parser":22,"./mp4-generator":25,"./probe":26,"./transmuxer":28}],25:[function(t,e,i){"use strict";var o,n,r,a,s,l,u,h,c,d,f,p,g,m,v,y,b,_,T,E,S,w,k,A,L,P,C,x,I,R,D,N,O,M,U,F,B,G,j,H,V,W=Math.pow(2,32)-1;!function(){var t;if(k={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(t in k)k.hasOwnProperty(t)&&(k[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);A=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),P=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),L=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),x=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),I={video:C,audio:x},N=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),D=new Uint8Array([0,0,0,0,0,0,0,0]),O=new Uint8Array([0,0,0,0,0,0,0,0]),M=O,U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F=O,R=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),o=function(t){var e,i,n=[],r=0;for(e=1;e<arguments.length;e++)n.push(arguments[e]);for(e=n.length;e--;)r+=n[e].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(t,4),e=0,r=8;e<n.length;e++)i.set(n[e],r),r+=n[e].byteLength;return i},n=function(){return o(k.dinf,o(k.dref,N))},r=function(t){return o(k.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},a=function(){return o(k.ftyp,A,L,A,P)},y=function(t){return o(k.hdlr,I[t])},s=function(t){return o(k.mdat,t)},v=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),o(k.mdhd,e)},m=function(t){return o(k.mdia,v(t),y(t.type),u(t))},l=function(t){return o(k.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},u=function(t){return o(k.minf,"video"===t.type?o(k.vmhd,R):o(k.smhd,D),n(),_(t))},h=function(t,e){for(var i=[],n=e.length;n--;)i[n]=E(e[n]);return o.apply(null,[k.moof,l(t)].concat(i))},c=function(t){for(var e=t.length,i=[];e--;)i[e]=p(t[e]);return o.apply(null,[k.moov,f(4294967295)].concat(i).concat(d(t)))},d=function(t){for(var e=t.length,i=[];e--;)i[e]=S(t[e]);return o.apply(null,[k.mvex].concat(i))},f=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o(k.mvhd,e)},b=function(t){var e,i,n=t.samples||[],r=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)e=n[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return o(k.sdtp,r)},_=function(t){return o(k.stbl,T(t),o(k.stts,F),o(k.stsc,M),o(k.stsz,U),o(k.stco,O))},T=function(t){return o(k.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?B(t):G(t))},B=function(t){var e,i=t.sps||[],n=t.pps||[],r=[],a=[];for(e=0;e<i.length;e++)r.push((65280&i[e].byteLength)>>>8),r.push(255&i[e].byteLength),r=r.concat(Array.prototype.slice.call(i[e]));for(e=0;e<n.length;e++)a.push((65280&n[e].byteLength)>>>8),a.push(255&n[e].byteLength),a=a.concat(Array.prototype.slice.call(n[e]));return o(k.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o(k.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([i.length]).concat(r).concat([n.length]).concat(a))),o(k.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},G=function(t){return o(k.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),r(t))},g=function(t){var e=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return o(k.tkhd,e)},E=function(t){var e,i,n,r,a,s;return e=o(k.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(t.baseMediaDecodeTime/(W+1)),s=Math.floor(t.baseMediaDecodeTime%(W+1)),i=o(k.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),"audio"===t.type?(n=w(t,92),o(k.traf,e,i,n)):(r=b(t),n=w(t,r.length+92),o(k.traf,e,i,n,r))},p=function(t){return t.duration=t.duration||4294967295,o(k.trak,g(t),m(t))},S=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),o(k.trex,e)},V=function(t,e){var i=0,n=0,r=0,a=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(r=4),void 0!==t[0].compositionTimeOffset&&(a=8)),[0,0,i|n|r|a,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},H=function(t,e){var i,n,r,a;for(n=t.samples||[],e+=20+16*n.length,i=V(n,e),a=0;a<n.length;a++)r=n[a],i=i.concat([(4278190080&r.duration)>>>24,(16711680&r.duration)>>>16,(65280&r.duration)>>>8,255&r.duration,(4278190080&r.size)>>>24,(16711680&r.size)>>>16,(65280&r.size)>>>8,255&r.size,r.flags.isLeading<<2|r.flags.dependsOn,r.flags.isDependedOn<<6|r.flags.hasRedundancy<<4|r.flags.paddingValue<<1|r.flags.isNonSyncSample,61440&r.flags.degradationPriority,15&r.flags.degradationPriority,(4278190080&r.compositionTimeOffset)>>>24,(16711680&r.compositionTimeOffset)>>>16,(65280&r.compositionTimeOffset)>>>8,255&r.compositionTimeOffset]);return o(k.trun,new Uint8Array(i))},j=function(t,e){var i,n,r,a;for(n=t.samples||[],e+=20+8*n.length,i=V(n,e),a=0;a<n.length;a++)r=n[a],i=i.concat([(4278190080&r.duration)>>>24,(16711680&r.duration)>>>16,(65280&r.duration)>>>8,255&r.duration,(4278190080&r.size)>>>24,(16711680&r.size)>>>16,(65280&r.size)>>>8,255&r.size]);return o(k.trun,new Uint8Array(i))},w=function(t,e){return"audio"===t.type?j(t,e):H(t,e)},e.exports={ftyp:a,mdat:s,moof:h,moov:c,initSegment:function(t){var e,i=a(),n=c(t);return(e=new Uint8Array(i.byteLength+n.byteLength)).set(i),e.set(n,i.byteLength),e}}},{}],26:[function(t,e,i){"use strict";var u,h,n,r,a,l=t("../utils/bin").toUnsigned;u=function(t,e){var i,n,r,a,s,o=[];if(!e.length)return null;for(i=0;i<t.byteLength;)n=l(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3]),r=h(t.subarray(i+4,i+8)),a=1<n?i+n:t.byteLength,r===e[0]&&(1===e.length?o.push(t.subarray(i+8,a)):(s=u(t.subarray(i+8,a),e.slice(1))).length&&(o=o.concat(s))),i=a;return o},h=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),e+=String.fromCharCode(t[2]),e+=String.fromCharCode(t[3])},n=function(t){var e=u(t,["moov","trak"]);return e.reduce(function(t,e){var i,n,r,a,s;return(i=u(e,["tkhd"])[0])?(n=i[0],a=l(i[r=0===n?12:20]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3]),(s=u(e,["mdia","mdhd"])[0])?(n=s[0],r=0===n?12:20,t[a]=l(s[r]<<24|s[r+1]<<16|s[r+2]<<8|s[r+3]),t):null):null},{})},r=function(r,t){var e,i,n;return e=u(t,["moof","traf"]),i=[].concat.apply([],e.map(function(n){return u(n,["tfhd"]).map(function(t){var e,i;return e=l(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),i=r[e]||9e4,(u(n,["tfdt"]).map(function(t){var e,i;return e=t[0],i=l(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),1===e&&(i*=Math.pow(2,32),i+=l(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),i})[0]||1/0)/i})})),n=Math.min.apply(null,i),isFinite(n)?n:0},a=function(t){var e=u(t,["moov","trak"]),l=[];return e.forEach(function(t){var e=u(t,["mdia","hdlr"]),o=u(t,["tkhd"]);e.forEach(function(t,e){var i,n,r,a=h(t.subarray(8,12)),s=o[e];"vide"===a&&(i=new DataView(s.buffer,s.byteOffset,s.byteLength),n=i.getUint8(0),r=0===n?i.getUint32(12):i.getUint32(20),l.push(r))})}),l},e.exports={findBox:u,parseType:h,timescale:n,startTime:r,videoTrackIds:a}},{"../utils/bin":33}],27:[function(t,e,i){e.exports={clearDtsInfo:function(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(t,e){var i,n,r=t.minSegmentDts;return e||(r-=t.timelineStartInfo.dts),i=t.timelineStartInfo.baseMediaDecodeTime,i+=r,i=Math.max(0,i),"audio"===t.type&&(n=t.samplerate/9e4,i*=n,i=Math.floor(i)),i},collectDtsInfo:function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))}}},{}],28:[function(t,e,i){"use strict";var o,c,l,u,n=t("../utils/stream.js"),g=t("./mp4-generator.js"),m=t("./frame-utils"),d=t("./audio-frame-utils"),v=t("./track-decode-info"),h=t("../m2ts/m2ts.js"),f=t("../codecs/adts.js"),p=t("../codecs/h264").H264Stream,y=t("../aac"),b=t("../aac/utils").isLikelyAacData,_=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],T=["width","height","profileIdc","levelIdc","profileCompatibility"],E=function(t,e){var i;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},S=function(t,e,i,n,r){return{start:{dts:t,pts:e},end:{dts:i,pts:n},prependedContentDuration:r}};(c=function(r,a){var s=[],o=0,l=0,u=0,h=1/0;a=a||{},c.prototype.init.call(this),this.push=function(e){v.collectDtsInfo(r,e),r&&_.forEach(function(t){r[t]=e[t]}),s.push(e)},this.setEarliestDts=function(t){l=t-r.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(t){h=t},this.setAudioAppendStart=function(t){u=t},this.flush=function(){var t,e,i,n;0!==s.length&&(t=d.trimAdtsFramesByEarliestDts(s,r,l),r.baseMediaDecodeTime=v.calculateTrackBaseMediaDecodeTime(r,a.keepOriginalTimestamps),d.prefixWithSilence(r,t,u,h),r.samples=d.generateSampleTable(t),i=g.mdat(d.concatenateFrameData(t)),s=[],e=g.moof(o,[r]),n=new Uint8Array(e.byteLength+i.byteLength),o++,n.set(e),n.set(i,e.byteLength),v.clearDtsInfo(r),this.trigger("data",{track:r,boxes:n})),this.trigger("done","AudioSegmentStream")}}).prototype=new n,(o=function(h,c){var e,i,d=0,f=[],p=[];c=c||{},o.prototype.init.call(this),delete h.minPTS,this.gopCache_=[],this.push=function(t){v.collectDtsInfo(h,t),"seq_parameter_set_rbsp"!==t.nalUnitType||e||(e=t.config,h.sps=[t.data],T.forEach(function(t){h[t]=e[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.data,h.pps=[t.data]),f.push(t)},this.flush=function(){for(var t,e,i,n,r,a,s,o,l=0;f.length&&"access_unit_delimiter_rbsp"!==f[0].nalUnitType;)f.shift();if(0===f.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(t=m.groupNalsIntoFrames(f),(i=m.groupFramesIntoGops(t))[0][0].keyFrame||((e=this.getGopForFusion_(f[0],h))?(l=e.duration,i.unshift(e),i.byteLength+=e.byteLength,i.nalCount+=e.nalCount,i.pts=e.pts,i.dts=e.dts,i.duration+=e.duration):i=m.extendFirstKeyFrame(i)),p.length){var u;if(!(u=c.alignGopsAtEnd?this.alignGopsAtEnd_(i):this.alignGopsAtStart_(i)))return this.gopCache_.unshift({gop:i.pop(),pps:h.pps,sps:h.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),f=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");v.clearDtsInfo(h),i=u}v.collectDtsInfo(h,i),h.samples=m.generateSampleTable(i),r=g.mdat(m.concatenateNalData(i)),h.baseMediaDecodeTime=v.calculateTrackBaseMediaDecodeTime(h,c.keepOriginalTimestamps),this.trigger("processedGopsInfo",i.map(function(t){return{pts:t.pts,dts:t.dts,byteLength:t.byteLength}})),s=i[0],o=i[i.length-1],this.trigger("segmentTimingInfo",S(s.dts,s.pts,o.dts+o.duration,o.pts+o.duration,l)),this.gopCache_.unshift({gop:i.pop(),pps:h.pps,sps:h.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),f=[],this.trigger("baseMediaDecodeTime",h.baseMediaDecodeTime),this.trigger("timelineStartInfo",h.timelineStartInfo),n=g.moof(d,[h]),a=new Uint8Array(n.byteLength+r.byteLength),d++,a.set(n),a.set(r,n.byteLength),this.trigger("data",{track:h,boxes:a}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){v.clearDtsInfo(h),i=e=void 0},this.getGopForFusion_=function(t){var e,i,n,r,a,s=1/0;for(a=0;a<this.gopCache_.length;a++)r=this.gopCache_[a],n=r.gop,h.pps&&E(h.pps[0],r.pps[0])&&h.sps&&E(h.sps[0],r.sps[0])&&(n.dts<h.timelineStartInfo.dts||-1e4<=(e=t.dts-n.dts-n.duration)&&e<=45e3&&(!i||e<s)&&(i=r,s=e));return i?i.gop:null},this.alignGopsAtStart_=function(t){var e,i,n,r,a,s,o,l;for(a=t.byteLength,s=t.nalCount,o=t.duration,e=i=0;e<p.length&&i<t.length&&(n=p[e],r=t[i],n.pts!==r.pts);)r.pts>n.pts?e++:(i++,a-=r.byteLength,s-=r.nalCount,o-=r.duration);return 0===i?t:i===t.length?null:((l=t.slice(i)).byteLength=a,l.duration=o,l.nalCount=s,l.pts=l[0].pts,l.dts=l[0].dts,l)},this.alignGopsAtEnd_=function(t){var e,i,n,r,a,s,o;for(e=p.length-1,i=t.length-1,a=null,s=!1;0<=e&&0<=i;){if(n=p[e],r=t[i],n.pts===r.pts){s=!0;break}n.pts>r.pts?e--:(e===p.length-1&&(a=i),i--)}if(!s&&null===a)return null;if(0===(o=s?i:a))return t;var l=t.slice(o),u=l.reduce(function(t,e){return t.byteLength+=e.byteLength,t.duration+=e.duration,t.nalCount+=e.nalCount,t},{byteLength:0,duration:0,nalCount:0});return l.byteLength=u.byteLength,l.duration=u.duration,l.nalCount=u.nalCount,l.pts=l[0].pts,l.dts=l[0].dts,l},this.alignGopsWith=function(t){p=t}}).prototype=new n,(u=function(t,e){this.numberOfTracks=0,this.metadataStream=e,void 0!==(t=t||{}).remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,"boolean"==typeof t.keepOriginalTimestamps&&(this.keepOriginalTimestamps=t.keepOriginalTimestamps),this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,u.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBoxes.push(t.boxes),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track),void("audio"===t.track.type&&(this.audioTrack=t.track)))}}).prototype=new n,u.prototype.flush=function(t){var e,i,n,r,a=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,T.forEach(function(t){s.info[t]=this.videoTrack[t]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,_.forEach(function(t){s.info[t]=this.audioTrack[t]},this)),1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=g.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)s.data.set(this.pendingBoxes[r],a),a+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(e=this.pendingCaptions[r]).startTime=e.startPts,this.keepOriginalTimestamps||(e.startTime-=o),e.startTime/=9e4,e.endTime=e.endPts,this.keepOriginalTimestamps||(e.endTime-=o),e.endTime/=9e4,s.captionStreams[e.stream]=!0,s.captions.push(e);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=i.pts,this.keepOriginalTimestamps||(i.cueTime-=o),i.cueTime/=9e4,s.metadata.push(i);s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},(l=function(n){var r,a,s=this,i=!0;l.prototype.init.call(this),n=n||{},this.baseMediaDecodeTime=n.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var e={};(this.transmuxPipeline_=e).type="aac",e.metadataStream=new h.MetadataStream,e.aacStream=new y,e.audioTimestampRolloverStream=new h.TimestampRolloverStream("audio"),e.timedMetadataTimestampRolloverStream=new h.TimestampRolloverStream("timed-metadata"),e.adtsStream=new f,e.coalesceStream=new u(n,e.metadataStream),e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioTimestampRolloverStream).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataTimestampRolloverStream).pipe(e.metadataStream).pipe(e.coalesceStream),e.metadataStream.on("timestamp",function(t){e.aacStream.setTimestamp(t.timeStamp)}),e.aacStream.on("data",function(t){"timed-metadata"!==t.type||e.audioSegmentStream||(a=a||{timelineStartInfo:{baseMediaDecodeTime:s.baseMediaDecodeTime},codec:"adts",type:"audio"},e.coalesceStream.numberOfTracks++,e.audioSegmentStream=new c(a,n),e.adtsStream.pipe(e.audioSegmentStream).pipe(e.coalesceStream))}),e.coalesceStream.on("data",this.trigger.bind(this,"data")),e.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var i={};(this.transmuxPipeline_=i).type="ts",i.metadataStream=new h.MetadataStream,i.packetStream=new h.TransportPacketStream,i.parseStream=new h.TransportParseStream,i.elementaryStream=new h.ElementaryStream,i.videoTimestampRolloverStream=new h.TimestampRolloverStream("video"),i.audioTimestampRolloverStream=new h.TimestampRolloverStream("audio"),i.timedMetadataTimestampRolloverStream=new h.TimestampRolloverStream("timed-metadata"),i.adtsStream=new f,i.h264Stream=new p,i.captionStream=new h.CaptionStream,i.coalesceStream=new u(n,i.metadataStream),i.headOfPipeline=i.packetStream,i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream),i.elementaryStream.pipe(i.videoTimestampRolloverStream).pipe(i.h264Stream),i.elementaryStream.pipe(i.audioTimestampRolloverStream).pipe(i.adtsStream),i.elementaryStream.pipe(i.timedMetadataTimestampRolloverStream).pipe(i.metadataStream).pipe(i.coalesceStream),i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream),i.elementaryStream.on("data",function(t){var e;if("metadata"===t.type){for(e=t.tracks.length;e--;)r||"video"!==t.tracks[e].type?a||"audio"!==t.tracks[e].type||((a=t.tracks[e]).timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime):(r=t.tracks[e]).timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime;r&&!i.videoSegmentStream&&(i.coalesceStream.numberOfTracks++,i.videoSegmentStream=new o(r,n),i.videoSegmentStream.on("timelineStartInfo",function(t){a&&(a.timelineStartInfo=t,i.audioSegmentStream.setEarliestDts(t.dts))}),i.videoSegmentStream.on("processedGopsInfo",s.trigger.bind(s,"gopInfo")),i.videoSegmentStream.on("segmentTimingInfo",s.trigger.bind(s,"videoSegmentTimingInfo")),i.videoSegmentStream.on("baseMediaDecodeTime",function(t){a&&i.audioSegmentStream.setVideoBaseMediaDecodeTime(t)}),i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)),a&&!i.audioSegmentStream&&(i.coalesceStream.numberOfTracks++,i.audioSegmentStream=new c(a,n),i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream))}}),i.coalesceStream.on("data",this.trigger.bind(this,"data")),i.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(t){var e=this.transmuxPipeline_;n.keepOriginalTimestamps||(this.baseMediaDecodeTime=t),a&&(a.timelineStartInfo.dts=void 0,a.timelineStartInfo.pts=void 0,v.clearDtsInfo(a),n.keepOriginalTimestamps||(a.timelineStartInfo.baseMediaDecodeTime=t),e.audioTimestampRolloverStream&&e.audioTimestampRolloverStream.discontinuity()),r&&(e.videoSegmentStream&&(e.videoSegmentStream.gopCache_=[],e.videoTimestampRolloverStream.discontinuity()),r.timelineStartInfo.dts=void 0,r.timelineStartInfo.pts=void 0,v.clearDtsInfo(r),e.captionStream.reset(),n.keepOriginalTimestamps||(r.timelineStartInfo.baseMediaDecodeTime=t)),e.timedMetadataTimestampRolloverStream&&e.timedMetadataTimestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(t){a&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(t)},this.alignGopsWith=function(t){r&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(t)},this.push=function(t){if(i){var e=b(t);e&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),i=!1}this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){i=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new n,e.exports={Transmuxer:l,VideoSegmentStream:o,AudioSegmentStream:c,AUDIO_PROPERTIES:_,VIDEO_PROPERTIES:T,generateVideoSegmentTimingInfo:S}},{"../aac":1,"../aac/utils":2,"../codecs/adts.js":3,"../codecs/h264":4,"../m2ts/m2ts.js":16,"../utils/stream.js":36,"./audio-frame-utils":21,"./frame-utils":23,"./mp4-generator.js":25,"./track-decode-info":27}],29:[function(t,e,i){"use strict";e.exports={parseSei:function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,r=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)r+=255,e++;if(r+=t[e++],!i.payload&&4===n){i.payloadType=n,i.payloadSize=r,i.payload=t.subarray(e,e+r);break}e+=r,r=n=0}return i},parseUserData:function(t){return 181===t.payload[0]&&49==(t.payload[1]<<8|t.payload[2])&&"GA94"===String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])&&3===t.payload[7]?t.payload.subarray(8,t.payload.length-1):null},parseCaptionPackets:function(t,e){var i,n,r,a,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)a={type:3&e[2+(r=3*i)],pts:t},4&e[r+2]&&(a.ccData=e[r+3]<<8|e[r+4],s.push(a));return s},discardEmulationPreventionBytes:function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},USER_DATA_REGISTERED_ITU_T_T35:4}},{}],30:[function(t,e,i){"use strict";var n={8:"audio",9:"video",18:"metadata"},o=function(t){for(var e,i=[];0<t.byteLength;)e=0,i.push("0x"+("00"+t[e++].toString(16)).slice(-2).toUpperCase()),t=t.subarray(1);return i.join(" ")},r=function(t,e){var i,n,r,a,s=t[0]&parseInt("00001111",2);return(e=e||{}).frameType=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"][(t[0]&parseInt("11110000",2))>>>4],7===(e.codecID=s)?(i=t.subarray(1),n=e,r=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],a=i[1]&parseInt("01111111",2)<<16|i[2]<<8|i[3],(n=n||{}).avcPacketType=r[i[0]],n.CompositionTime=i[1]&parseInt("10000000",2)?-a:a,1===i[0]?n.nalUnitTypeRaw=o(i.subarray(4,100)):n.data=o(i.subarray(4)),n):e},a=function(t,e){var i,n,r,a=(t[0]&parseInt("11110000",2))>>>4;return(e=e||{}).soundFormat=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"][a],e.soundRate=["5.5-kHz","11-kHz","22-kHz","44-kHz"][(t[0]&parseInt("00001100",2))>>>2],e.soundSize=(t[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",e.soundType=t[0]&parseInt("00000001",2)?"Stereo":"Mono",10===a?(i=t.subarray(1),r=["AAC Sequence Header","AAC Raw"],(n=(n=e)||{}).aacPacketType=r[i[0]],n.data=o(i.subarray(1)),n):e},s=function(t){var e,i={tagType:n[(e=t)[0]],dataSize:e[1]<<16|e[2]<<8|e[3],timestamp:e[7]<<24|e[4]<<16|e[5]<<8|e[6],streamID:e[8]<<16|e[9]<<8|e[10]};switch(t[0]){case 8:a(t.subarray(11),i);break;case 9:r(t.subarray(11),i)}return i};e.exports={inspectTag:s,inspect:function(t){var e,i,n=9,r=[];for(n+=4;n<t.byteLength;)e=t[n+1]<<16,e|=t[n+2]<<8,e|=t[n+3],e+=11,i=t.subarray(n,n+e),r.push(s(i)),n+=e+4;return r},textify:function(t){return JSON.stringify(t,null,2)}}},{}],31:[function(t,e,i){"use strict";var n,s,r=t("../utils/bin").toUnsigned,c=t("../mp4/probe").parseType,a=function(t){return new Date(1e3*t-20828448e5)},d=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},f={avc1:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:n(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,r,a=new DataView(t.buffer,t.byteOffset,t.byteLength),s={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},o=31&t[5];for(n=6,r=0;r<o;r++)i=a.getUint16(n),n+=2,s.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,r=0;r<e;r++)i=a.getUint16(n),n+=2,s.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return s},btrt:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:c(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(c(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:n(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:n(t.subarray(8))}},hdlr:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),handlerType:c(t.subarray(8,12)),name:""},n=8;for(n=24;n<t.byteLength;n++){if(0===t[n]){n++;break}i.name+=String.fromCharCode(t[n])}return i.name=decodeURIComponent(escape(i.name)),i},mdat:function(t){return{byteLength:t.byteLength,nals:function(t){var e,i,n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[];for(e=0;e+4<t.length;e+=i)if(i=n.getUint32(e),e+=4,i<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&t[e]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+t[e]&31)}return r}(t)}},mdhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=4,r={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===r.version?(n+=4,r.creationTime=a(i.getUint32(n)),n+=8,r.modificationTime=a(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=8):(r.creationTime=a(i.getUint32(n)),n+=4,r.modificationTime=a(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=4),r.duration=i.getUint32(n),n+=4,e=i.getUint16(n),r.language+=String.fromCharCode(96+(e>>10)),r.language+=String.fromCharCode(96+((992&e)>>5)),r.language+=String.fromCharCode(96+(31&e)),r},mdia:function(t){return{boxes:n(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:n(t)}},mp4a:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return 28<t.byteLength&&(i.streamDescriptor=n(t.subarray(28))[0]),i},moof:function(t){return{boxes:n(t)}},moov:function(t){return{boxes:n(t)}},mvex:function(t){return{boxes:n(t)}},mvhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=a(e.getUint32(i)),i+=8,n.modificationTime=a(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8):(n.creationTime=a(e.getUint32(i)),i+=4,n.modificationTime=a(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4),n.duration=e.getUint32(i),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,i+=8,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,i+=24,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},r=i.getUint16(22);for(e=24;r;e+=12,r--)n.references.push({referenceType:(128&t[e])>>>7,referencedSize:2147483647&i.getUint32(e),subsegmentDuration:i.getUint32(e+4),startsWithSap:!!(128&t[e+8]),sapType:(112&t[e+8])>>>4,sapDeltaTime:268435455&i.getUint32(e+8)});return n},smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:n(t)}},stco:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},r=i.getUint32(4);for(e=8;r;e+=4,r--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),r={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)r.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return r},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:n(t.subarray(8))}},stsz:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},r=i.getUint32(4);for(e=8;r;e+=8,r--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return f.ftyp(t)},tfdt:function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:r(t[4]<<24|t[5]<<16|t[6]<<8|t[7])};return 1===e.version&&(e.baseMediaDecodeTime*=Math.pow(2,32),e.baseMediaDecodeTime+=r(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),e},tfhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],a=2&n.flags[2],s=8&n.flags[2],o=16&n.flags[2],l=32&n.flags[2],u=65536&n.flags[0],h=131072&n.flags[0];return e=8,r&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),a&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),s&&(n.defaultSampleDuration=i.getUint32(e),e+=4),o&&(n.defaultSampleSize=i.getUint32(e),e+=4),l&&(n.defaultSampleFlags=i.getUint32(e)),u&&(n.durationIsEmpty=!0),!r&&h&&(n.baseDataOffsetIsMoof=!0),n},tkhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=a(e.getUint32(i)),i+=8,n.modificationTime=a(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=8):(n.creationTime=a(e.getUint32(i)),i+=4,n.modificationTime=a(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=4),n.duration=e.getUint32(i),i+=4,i+=8,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/16,n},traf:function(t){return{boxes:n(t)}},trak:function(t){return{boxes:n(t)}},trex:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],l=4&i.flags[1],u=8&i.flags[1],h=n.getUint32(4),c=8;for(r&&(i.dataOffset=n.getInt32(c),c+=4),a&&h&&(e={flags:d(t.subarray(c,c+4))},c+=4,s&&(e.duration=n.getUint32(c),c+=4),o&&(e.size=n.getUint32(c),c+=4),u&&(e.compositionTimeOffset=n.getUint32(c),c+=4),i.samples.push(e),h--);h--;)e={},s&&(e.duration=n.getUint32(c),c+=4),o&&(e.size=n.getUint32(c),c+=4),l&&(e.flags=d(t.subarray(c,c+4)),c+=4),u&&(e.compositionTimeOffset=n.getUint32(c),c+=4),i.samples.push(e);return i},"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}};n=function(t){for(var e,i,n,r,a,s=0,o=[],l=new ArrayBuffer(t.length),u=new Uint8Array(l),h=0;h<t.length;++h)u[h]=t[h];for(e=new DataView(l);s<t.byteLength;)i=e.getUint32(s),n=c(t.subarray(s+4,s+8)),r=1<i?s+i:t.byteLength,(a=(f[n]||function(t){return{data:t}})(t.subarray(s+8,r))).size=i,a.type=n,o.push(a),s=r;return o},s=function(t,e){var a;return e=e||0,a=new Array(2*e+1).join(" "),t.map(function(r,t){return a+r.type+"\n"+Object.keys(r).filter(function(t){return"type"!==t&&"boxes"!==t}).map(function(t){var e=a+"  "+t+": ",i=r[t];if(i instanceof Uint8Array||i instanceof Uint32Array){var n=Array.prototype.slice.call(new Uint8Array(i.buffer,i.byteOffset,i.byteLength)).map(function(t){return" "+("00"+t.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return n?1===n.length?e+"<"+n.join("").slice(1)+">":e+"<\n"+n.map(function(t){return a+"  "+t}).join("\n")+"\n"+a+"  >":e+"<>"}return e+JSON.stringify(i,null,2).split("\n").map(function(t,e){return 0===e?t:a+"  "+t}).join("\n")}).join("\n")+(r.boxes?"\n"+s(r.boxes,e+1):"")}).join("\n")},e.exports={inspect:n,textify:s,parseTfdt:f.tfdt,parseHdlr:f.hdlr,parseTfhd:f.tfhd,parseTrun:f.trun,parseSidx:f.sidx}},{"../mp4/probe":26,"../utils/bin":33}],32:[function(t,e,i){"use strict";var a=t("../m2ts/stream-types.js"),s=t("../m2ts/timestamp-rollover-stream.js").handleRollover,p={};p.ts=t("../m2ts/probe.js"),p.aac=t("../aac/utils.js");var o=function(t,e,i){for(var n,r,a,s,o=0,l=188,u=!1;l<=t.byteLength;)if(71!==t[o]||71!==t[l]&&l!==t.byteLength)o++,l++;else{switch(n=t.subarray(o,l),p.ts.parseType(n,e.pid)){case"pes":r=p.ts.parsePesType(n,e.table),a=p.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=p.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),u=!0)}if(u)break;o+=188,l+=188}for(l=t.byteLength,o=l-188,u=!1;0<=o;)if(71!==t[o]||71!==t[l]&&l!==t.byteLength)o--,l--;else{switch(n=t.subarray(o,l),p.ts.parseType(n,e.pid)){case"pes":r=p.ts.parsePesType(n,e.table),a=p.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=p.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),u=!0)}if(u)break;o-=188,l-=188}},l=function(t,e,i){for(var n,r,a,s,o,l,u,h=0,c=188,d=!1,f={data:[],size:0};c<t.byteLength;)if(71!==t[h]||71!==t[c])h++,c++;else{switch(n=t.subarray(h,c),p.ts.parseType(n,e.pid)){case"pes":if(r=p.ts.parsePesType(n,e.table),a=p.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(a&&!d&&(s=p.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),d=!0),!i.firstKeyFrame)){if(a&&0!==f.size){for(o=new Uint8Array(f.size),l=0;f.data.length;)u=f.data.shift(),o.set(u,l),l+=u.byteLength;p.ts.videoPacketContainsKeyFrame(o)&&(i.firstKeyFrame=p.ts.parsePesTime(o),i.firstKeyFrame.type="video"),f.size=0}f.data.push(n),f.size+=n.byteLength}}if(d&&i.firstKeyFrame)break;h+=188,c+=188}for(c=t.byteLength,h=c-188,d=!1;0<=h;)if(71!==t[h]||71!==t[c])h--,c--;else{switch(n=t.subarray(h,c),p.ts.parseType(n,e.pid)){case"pes":r=p.ts.parsePesType(n,e.table),a=p.ts.parsePayloadUnitStartIndicator(n),"video"===r&&a&&(s=p.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),d=!0)}if(d)break;h-=188,c-=188}},n=function(t,e){if(t.audio&&t.audio.length){var i=e;void 0===i&&(i=t.audio[0].dts),t.audio.forEach(function(t){t.dts=s(t.dts,i),t.pts=s(t.pts,i),t.dtsTime=t.dts/9e4,t.ptsTime=t.pts/9e4})}if(t.video&&t.video.length){var n=e;if(void 0===n&&(n=t.video[0].dts),t.video.forEach(function(t){t.dts=s(t.dts,n),t.pts=s(t.pts,n),t.dtsTime=t.dts/9e4,t.ptsTime=t.pts/9e4}),t.firstKeyFrame){var r=t.firstKeyFrame;r.dts=s(r.dts,n),r.pts=s(r.pts,n),r.dtsTime=r.dts/9e4,r.ptsTime=r.dts/9e4}}},r=function(t){for(var e,i=!1,n=0,r=null,a=null,s=0,o=0;3<=t.length-o;){var l=p.aac.parseType(t,o);switch(l){case"timed-metadata":if(t.length-o<10){i=!0;break}if((s=p.aac.parseId3TagSize(t,o))>t.length){i=!0;break}null===a&&(e=t.subarray(o,o+s),a=p.aac.parseAacTimestamp(e)),o+=s;break;case"audio":if(t.length-o<7){i=!0;break}if((s=p.aac.parseAdtsSize(t,o))>t.length){i=!0;break}null===r&&(e=t.subarray(o,o+s),r=p.aac.parseSampleRate(e)),n++,o+=s;break;default:o++}if(i)return null}if(null===r||null===a)return null;var u=9e4/r,h={audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*n*u,pts:a+1024*n*u}]};return h},u=function(t){var e={pid:null,table:null},i={};for(var n in function(t,e){for(var i,n=0,r=188;r<t.byteLength;)if(71!==t[n]||71!==t[r])n++,r++;else{switch(i=t.subarray(n,r),p.ts.parseType(i,e.pid)){case"pat":e.pid||(e.pid=p.ts.parsePat(i));break;case"pmt":e.table||(e.table=p.ts.parsePmt(i))}if(e.pid&&e.table)return;n+=188,r+=188}}(t,e),e.table)if(e.table.hasOwnProperty(n)){var r=e.table[n];switch(r){case a.H264_STREAM_TYPE:i.video=[],l(t,e,i),0===i.video.length&&delete i.video;break;case a.ADTS_STREAM_TYPE:i.audio=[],o(t,e,i),0===i.audio.length&&delete i.audio}}return i};e.exports={inspect:function(t,e){var i;return(i=p.aac.isLikelyAacData(t)?r(t):u(t))&&(i.audio||i.video)?(n(i,e),i):null},parseAudioPes_:o}},{"../aac/utils.js":2,"../m2ts/probe.js":18,"../m2ts/stream-types.js":19,"../m2ts/timestamp-rollover-stream.js":20}],33:[function(t,e,i){e.exports={toUnsigned:function(t){return t>>>0}}},{}],34:[function(t,e,i){var n,r,a,s,o,l;n=function(t){return 9e4*t},r=function(t,e){return t*e},a=function(t){return t/9e4},s=function(t,e){return t/e},o=function(t,e){return n(s(t,e))},l=function(t,e){return r(a(t),e)},e.exports={secondsToVideoTs:n,secondsToAudioTs:r,videoTsToSeconds:a,audioTsToSeconds:s,audioTsToVideoTs:o,videoTsToAudioTs:l}},{}],35:[function(t,e,i){"use strict";var n;n=function(n){var r=n.byteLength,a=0,s=0;this.length=function(){return 8*r},this.bitsAvailable=function(){return 8*r+s},this.loadWord=function(){var t=n.byteLength-r,e=new Uint8Array(4),i=Math.min(4,r);if(0===i)throw new Error("no bytes available");e.set(n.subarray(t,t+i)),a=new DataView(e.buffer).getUint32(0),s=8*i,r-=i},this.skipBits=function(t){var e;t<s||(t-=s,e=Math.floor(t/8),t-=8*e,r-=e,this.loadWord()),a<<=t,s-=t},this.readBits=function(t){var e=Math.min(s,t),i=a>>>32-e;return 0<(s-=e)?a<<=e:0<r&&this.loadWord(),0<(e=t-e)?i<<e|this.readBits(e):i},this.skipLeadingZeros=function(){var t;for(t=0;t<s;++t)if(0!=(a&2147483648>>>t))return a<<=t,s-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},e.exports=n},{}],36:[function(t,e,i){"use strict";var n=function(){this.init=function(){var a={};this.on=function(t,e){a[t]||(a[t]=[]),a[t]=a[t].concat(e)},this.off=function(t,e){var i;return!!a[t]&&(i=a[t].indexOf(e),a[t]=a[t].slice(),a[t].splice(i,1),-1<i)},this.trigger=function(t){var e,i,n,r;if(e=a[t])if(2===arguments.length)for(n=e.length,i=0;i<n;++i)e[i].call(this,arguments[1]);else{for(r=[],i=arguments.length,i=1;i<arguments.length;++i)r.push(arguments[i]);for(n=e.length,i=0;i<n;++i)e[i].apply(this,r)}},this.dispose=function(){a={}}}};n.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),e},n.prototype.push=function(t){this.trigger("data",t)},n.prototype.flush=function(t){this.trigger("done",t)},e.exports=n},{}]},{},[13])(13)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=i(367),s=(n=a)&&n.__esModule?n:{default:n},p=i(11),o=i(75),l=i(34),g=i(28),u=i(76),h=i(46),c=f(i(143)),d=f(i(57));function f(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var m="undefined"==typeof Hls?s.default:Hls,v=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i._player=null,i._isLive=!1,i._userConfig={},i._config={},i._currentLevel=-1,i._startLevel=-1,i._switchInfo=[],i._firstSeekforLTECVOD=!1,i.streamType=p.AdaptivePlayer.StreamType.HLS,i._timeline={init:!1,targetDuration:0,absStart:0,curAbsStart:0,curAbsEnd:0,timeRanges:[]},i.type=p.AdaptivePlayer.PlayerType.HLSJS,i.streamType=p.AdaptivePlayer.StreamType.HLS,i._seekEndTime=0,i._seekBeginTime=0,i.print(p.AdaptivePlayer.LogLevel.INFO,"HlsPlayer","Instance created!"),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,o.PlayerBase),r(n,[{key:"destroy",value:function(){return this.print(p.AdaptivePlayer.LogLevel.INFO,"HlsPlayer","Instance destroyed!"),this.unload()}},{key:"configure",value:function(t){this.print(p.AdaptivePlayer.LogLevel.INFO,"HlsPlayer","configure called!"),this._userConfig=t,this._config={startFragPrefetch:!0,maxMaxBufferLength:60,abrMaxWithRealBitrate:!0,maxBufferLength:30,startBitrate:-1,startPosition:-1,autoLevelEnabled:!0,liveSyncDurationCount:4,withCredentialsFragmentPattern:[],nudgeMaxRetry:10,fragLoadingMaxRetry:6,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",lteMode:!1},t&&(this._config.debug=!!t.debug,t.abr&&(this._config.autoLevelEnabled=!!t.abr.enabled,t.abr.startBitrate&&(this._config.startBitrate=t.abr.startBitrate)),t.preferredAudioLanguage&&(this._config.preferredAudioLanguage=t.preferredAudioLanguage.toLowerCase()),t.preferredTextLanguage&&(this._config.preferredTextLanguage=t.preferredTextLanguage.toLowerCase()),t.withCredentialsFragmentPattern&&(this._config.withCredentialsFragmentPattern=t.withCredentialsFragmentPattern),t.withCredentials&&(this._config.xhrSetup=function(t,e){t.withCredentials=!0}),t.closedCaption&&(t.closedCaption.label&&(this._config.captionsTextTrack1Label=t.closedCaption.label),t.closedCaption.language&&(this._config.captionsTextTrack1LanguageCode=t.closedCaption.language)),t.debugConfig.logServer&&(this._config.logServer=t.debugConfig.logServer),this._config.lteMode=!!t.enableLTEmode,this._config.lteMode&&(this._config.maxBufferLength=120,this._config.maxFragLookUpTolerance=.15))}},{key:"load",value:function(t,e){return this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","load called!"),this._url=t,this._clearTextTracks(),this._currentLevel=-1,this._startLevel=-1,this._switchInfo=[],this._firstSeekforLTECVOD=!1,"number"==typeof e&&0<=e&&(this._config.startPosition=e,this._userConfig&&this._userConfig.enableLTEmode&&(this._userConfig.startPosition=e)),this._player=new m(this._config),this._player.attachMedia(this._video),this._player.setSysInfo(p.AdaptivePlayer.browserType,p.AdaptivePlayer.OS),this._player.on(m.Events.MEDIA_ATTACHED,function(){this._player.loadSource(t),!this._config.autoLevelEnabled&&this.setAdaptation(this._config.autoLevelEnabled),this._player.on(m.Events.ERROR,this._onError.bind(this)),[m.Events.MEDIA_ATTACHING,m.Events.MEDIA_ATTACHED,m.Events.MEDIA_DETACHING,m.Events.MEDIA_DETACHED,m.Events.BUFFER_RESET,m.Events.BUFFER_CODECS,m.Events.BUFFER_CREATED,m.Events.BUFFER_APPENDING,m.Events.BUFFER_APPENDED,m.Events.BUFFER_EOS,m.Events.BUFFER_FLUSHING,m.Events.BUFFER_FLUSHED,m.Events.MANIFEST_LOADING,m.Events.MANIFEST_LOADED,m.Events.MANIFEST_PARSED,m.Events.LEVEL_LOADING,m.Events.LEVEL_UPDATED,m.Events.LEVEL_PTS_UPDATED,m.Events.LEVEL_SWITCHING,m.Events.LEVEL_SWITCHED,m.Events.AUDIO_TRACKS_UPDATED,m.Events.AUDIO_TRACK_LOADING,m.Events.AUDIO_TRACK_LOADED,m.Events.FRAG_LOADING,m.Events.FRAG_LOAD_PROGRESS,m.Events.FRAG_LOAD_EMERGENCY_ABORTED,m.Events.FRAG_LOADED,m.Events.FRAG_PARSING_INIT_SEGMENT,m.Events.FRAG_PARSING_USERDATA,m.Events.FRAG_PARSING_DATA,m.Events.FRAG_PARSED,m.Events.FRAG_BUFFERED,m.Events.FRAG_DECRYPTED,m.Events.FPS_DROP,m.Events.FPS_DROP_LEVEL_CAPPING,m.Events.DESTROYING,m.Events.KEY_LOADING,m.Events.KEY_LOADED,m.Events.INIT_PTS_FOUND,m.Events.STREAM_STATE_TRANSITION].forEach(function(t){this._player.on(t,this._onHlsjsEvent.bind(this))}.bind(this)),this._player.on(m.Events.FRAG_CHANGED,this._onFragChanged.bind(this)),this._player.on(m.Events.MANIFEST_PARSED,this._onManifestParsed.bind(this)),this._player.on(m.Events.LEVEL_LOADED,this._onLevelLoaded.bind(this)),this._player.on(m.Events.LEVEL_SWITCHING,function(t,e){this._switchInfo.push({type:"variant",timestamp:((new Date).getTime()/1e3).toFixed(2),bandwidth:e.bitrate,fromAdaptation:this._player.autoLevelEnabled})}.bind(this)),this._cuepointManager.cleanup(),this._player.on(m.Events.FRAG_PARSING_METADATA,this._onID3.bind(this)),this._player.on(m.Events.THUMBNAIL_IMAGE_ASSEMBLED,this._onThumbnailImageLoaded.bind(this)),this._player.on(m.Events.ADVERTISEMENT_UPLOAD,this._onAdvertisement.bind(this)),this._player.on(m.Events.EMPTY_ADVERTISEMENT_UPLOAD,this._onEmptyAdvertisement.bind(this)),this._player.on(m.Events.ADVERTISEMENT_RANGE_UPDATE,this._onAdRangesUpdate.bind(this)),this._player.on(m.Events.FRAG_REMUXED,this._onFragRemuxed.bind(this)),this._video.addEventListener("seeked",function(t){this._seekEndTime=Date.now(),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","_seekBeginTime="+this._seekBeginTime+", _seekEndTime="+this._seekEndTime+", cost="+(this._seekEndTime-this._seekBeginTime))}.bind(this))}.bind(this)),Promise.resolve()}},{key:"unload",value:function(){return this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","unload called!"),this._id3Cues=[],this._clearTextTracks(),this._player&&(this._player.stopLoad(),this._player.destroy(),this._player.detachMedia()),this._player=null,this._isLive=!1,this._userConfig=null,this._config=null,this._currentLevel=-1,this._timeline={init:!1,targetDuration:0,absStart:0,curAbsStart:0,curAbsEnd:0,timeRanges:[]},this._seekEndTime=0,this._seekBeginTime=0,Promise.resolve()}},{key:"getStats",value:function(){if(!this._player)return{bytesLoaded:NaN,currentCdnIndex:-1,bandwidth:NaN,bitrate:NaN,switchInfo:NaN,isAutoSwitch:!0,livePointOffest:-1};var t=0,e=0,i="",n=!0,r=-1,a=[],s=[];if(this._player)try{if(t=this._player.streamController.fragLastKbps,null!=this._player.currentLevel&&this._player.levels[this._player.currentLevel]&&this._player.levels[this._player.currentLevel].bitrate&&(e=Math.floor(this._player.levels[this._player.currentLevel].bitrate/1e3)),(s=this._switchInfo)&&0<s.length){for(var o=void 0,l=void 0,u=void 0,h=void 0,c=s.length-1;0<=c;c--)if("variant"===s[c].type){if(null==o){o=s[c].bandwidth,u=s[c].fromAdaptation,h=s[c].timestamp;continue}if(null!=o&&null==l&&h!==s[c].timestamp){l=s[c].bandwidth;break}}i={from:l,to:o,fromAdaptation:u}}n=this._config.autoLevelEnabled,a=this._player.cdnsLoadBytes,r=this._player.currentCdnIndex;var d=this._player.liveEdge;return{bandwidth:t,bitrate:e,switchInfo:i,switchHistory:s,isAutoSwitch:n,bytesLoaded:a,currentCdnIndex:r,livePointOffest:this._isLive?d-this._video.currentTime:this._player.vodDuration-this._video.currentTime}}catch(t){}}},{key:"setAdaptation",value:function(t){if(this._player)if(this._config.autoLevelEnabled=t)this._player.autoLevelCapping=-1,this._player.nextLevel=-1;else{var e=this._player.currentLevel;this._player.autoLevelCapping=e,this._player.currentLevel=e}}},{key:"isLive",value:function(){return this._isLive}},{key:"gotoLive",value:function(){0<this._timeline.timeRanges.length&&(this.currentTime=c.relTimeToAbsTime(this._getRelEndLimit(),this._timeline.timeRanges,this._timeline.absStart))}},{key:"audioTracks",value:function(){if(this._player){var i=[],t=this._player.audioTracks;return t&&t.forEach(function(t,e){i.push(new u.NLTrack(p.AdaptivePlayer.Kind.AUDIO,t,p.AdaptivePlayer.PlayerType.HLSJS,{id:e,player:this,audioTrack:this._player.audioTrack}))}.bind(this)),i}}},{key:"textTracks",value:function(){if(this._player){for(var t=[],e=this._video.textTracks,i=0;i<e.length;i++){var n=this._video.textTracks[i];n.label!==h.Settings.DASHPLAYER.DEFAULT_SUBTITLE_TRACK_NAME&&"disabled"!==n.mode&&n.hashId&&("captions"===n.kind?t.push(new u.NLTrack(p.AdaptivePlayer.Kind.TEXT,n,p.AdaptivePlayer.PlayerType.NATIVE,{id:n.hashId,player:this._video,ccInfos:this._player.getHlsCC()})):"subtitles"===n.kind&&t.push(new u.NLTrack(p.AdaptivePlayer.Kind.TEXT,n,p.AdaptivePlayer.PlayerType.HLSJS,{id:n.hashId,player:this,subtitleTrack:this._player.subtitleTrack})))}return t}}},{key:"ccTracks",value:function(){for(var t=[],e=this._video.textTracks.length-1;0<=e;e--){var i=this._video.textTracks[e];i.label!==h.Settings.DASHPLAYER.DEFAULT_SUBTITLE_TRACK_NAME&&"disabled"!==i.mode&&"captions"===i.kind&&t.push(i)}return t}},{key:"videoTracks",value:function(){if(this._player){var i=[],t=this._player.levels;return t&&t.forEach(function(t,e){i.push(new u.NLTrack(p.AdaptivePlayer.Kind.VIDEO,t,p.AdaptivePlayer.PlayerType.HLSJS,{id:e,player:this,startLevel:0<=this._player.currentLevel?this._startLevel:null,currentLevel:this._player.currentLevel,levels:this._player.levels||[]}))}.bind(this)),i}}},{key:"selectTrack",value:function(t,e){if(t)if(t.kind===p.AdaptivePlayer.Kind.AUDIO)this._player.audioTrack=t.id;else if(t.kind===p.AdaptivePlayer.Kind.TEXT){for(var i=0;i<this._video.textTracks.length;i++){var n=this._video.textTracks[i];"showing"===n.mode&&(n.mode="hidden")}t.type===p.AdaptivePlayer.PlayerType.HLSJS?this._player.subtitleTrack=t.id:this._player.subtitleTrack=-1,t.base.mode="showing"}else t.kind===p.AdaptivePlayer.Kind.VIDEO&&(e?this._player.currentLevel=t.id:this._player.nextLevel=t.id,this._player.autoLevelCapping=t.id,this._config.autoLevelEnabled=!1)}},{key:"getThumbnailStreams",value:function(){if(this.print(p.AdaptivePlayer.LogLevel.TRACE,"HlsPlayer","getThumbnailStreams!"),this._player)return this._player.getThumbnailStreams()}},{key:"getThumbnailStreamImages",value:function(t,e,i){this._player&&!isNaN(e)&&(this._player.isCVodStream&&this._player.timelineInfo&&this._player.timelineInfo.init&&0<this._player.timelineInfo.absStart&&(e=c.relTimeToAbsTime(e,this._player.timelineInfo.timeRanges,this._player.timelineInfo.absStart)),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","getThumbnailStreamImages! time="+e),c.vacancyTime(e,this._player.timelineInfo.timeRanges)?this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","getThumbnailStreamImages: time is out of ranges."):this._player.getThumbnailStreamImages(t,e,i))}},{key:"getNormalizeCurrentTime",value:function(){var t=this.currentTime;if(this._userConfig&&this._userConfig.enableLTEmode){var e=this._player.getLteStreamInfos(this._player.currentLevel);e&&(t<0&&(t=0),t=this._normalize(t,e.fixFrameOffset))}return t}},{key:"setNormalizeCurrentTime",value:function(){var t=this._player.currentTime;this._player.currentTime=t}},{key:"_normalize",value:function(t,e){var i=t;if(!isNaN(e)&&0<e){var n=Math.floor(t/e),r=n*e,a=(n+1)*e;i=t-r<=a-t?r:a}return i}},{key:"notifyPlayStarted",value:function(){if(this._player&&this._player.timelineInfo&&0<this._player.timelineInfo.timeRanges.length&&0<this._player.timelineInfo.absStart){var t={start:this._player.timelineInfo.absStart,end:this._player.timelineInfo.timeRanges[this._player.timelineInfo.timeRanges.length-1].end,ranges:this._player.timelineInfo.curTimeRanges};this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.SeekRangeChange,{details:t,data:t})),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","Fired SeekRangeChange for CVOD: ["+JSON.stringify(t)+"]")}}},{key:"notifyProfileChanged",value:function(t){}},{key:"_onID3",value:function(e,t){t.samples&&(t.samples.sort(function(t,e){return t.pts-e.pts}),t.samples.forEach(function(t){t.pts=c.relTimeToAbsTime(t.pts,this._timeline.timeRanges,this._timeline.absStart),t.dts=c.relTimeToAbsTime(t.dts,this._timeline.timeRanges,this._timeline.absStart),this._cuepointManager.onID3(t),this.print(p.AdaptivePlayer.LogLevel.TRACE,"HlsPlayer","Got ID3 from Player: "+e+"["+t.pts+"]")}.bind(this)))}},{key:"_onThumbnailImageLoaded",value:function(t,e){this.print(p.AdaptivePlayer.LogLevel.TRACE,"HlsPlayer","_onThumbnailImageLoaded: id="+e.streamId+" requestTime="+e.requestTime+" baseTime="+e.baseTime),e.thumbnails.images.forEach(function(t){this.print(p.AdaptivePlayer.LogLevel.TRACE,"HlsPlayer","_onThumbnailImageLoaded: url="+t.url+" startTime="+t.startTime+" endTime="+t.endTime)}.bind(this));var i=e.cb,n=e.thumbnails;null!=i&&i(n)}},{key:"_onAdvertisement",value:function(t,e){e&&e.type&&this._eventHandler._onAdvertisement(e)}},{key:"_onEmptyAdvertisement",value:function(t,e){e&&this._eventHandler._onEmptyAdvertisement(e)}},{key:"_onAdRangesUpdate",value:function(t,e){e&&this._eventHandler._onAdRangesUpdate(e)}},{key:"_onFragRemuxed",value:function(t,e){if(e&&this._config.logServer){var i={url:this._config.logServer+"/addStreams?name="+e.name+"&type="+e.type,method:"POST",headers:{"Content-Type":"application/octet-stream"},params:e.remuxedData.buffer};d.createXHR(i).catch(function(t){})}}},{key:"_onFragChanged",value:function(t,e){var i=-1===this._player.currentLevel?e.frag.level:this._player.currentLevel;this._currentLevel!==this._player.currentLevel&&(this._currentLevel=this._player.currentLevel,this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.ProfileChange,{id:this._currentLevel,videoWidth:this._player.levels[i].width,videoHeight:this._player.levels[i].height})),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","Fired ProfileChange"))}},{key:"_onHlsjsEvent",value:function(t,e){this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.StreamingEvent,{data:{from:p.AdaptivePlayer.PlayerType.HLSJS,data:e}})),this.print(p.AdaptivePlayer.LogLevel.TRACE,"HlsPlayer","Fired streaming event: "+t+"["+e+"]")}},{key:"_onManifestParsed",value:function(t,e){if(0<this._config.startBitrate){var i=this.videoTracks(),n=-1,r=-1,a=1/0;i.sort(function(t,e){return t.bandwidth-e.bandwidth}).forEach(function(t,e){t.bandwidth<=this._config.startBitrate&&(n=t.id),t.bandwidth<=a&&(a=t.bandwidth,r=t.id)}.bind(this)),0<=n?this._player.currentLevel=this._startLevel=n:0<this._config.startBitrate&&0<=r&&(this._player.currentLevel=this._startLevel=r)}}},{key:"_onLevelLoaded",value:function(t,e){this._isLive=e.details.live,this._mergeProgrameTime(e),this._isLive?this._updateSeekRange():!this._firstSeekforLTECVOD&&this._userConfig&&this._userConfig.enableLTEmode&&0<this._userConfig.startPosition&&(this.currentTime=this._userConfig.startPosition,this._firstSeekforLTECVOD=!0),this._onHlsjsEvent(t,e)}},{key:"_updateSeekRange",value:function(){if(this._isLive){var t=this._getRelEndLimit(),e={start:this._timeline.curAbsStart,end:c.relTimeToAbsTime(t,this._timeline.timeRanges,this._timeline.absStart),ranges:this._timeline.curTimeRanges};this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.SeekRangeChange,{details:e,data:e})),this._userConfig.enableLTEmode&&this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.LTEEvent,{details:{type:"ranges",data:this._player.timelineInfo.timeRanges}})),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","Fired SeekRangeChange: ["+JSON.stringify(e)+"]")}else if(this._userConfig&&this._userConfig.enableLTEmode&&0<this._player.timelineInfo.timeRanges.length&&0<this._player.timelineInfo.absStart){var i={start:this._player.timelineInfo.absStart,end:this._player.timelineInfo.timeRanges[this._player.timelineInfo.timeRanges.length-1].end,ranges:this._timeline.curTimeRanges};this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.SeekRangeChange,{details:i,data:i})),this._eventHandler.dispatchEvent(new l.FakeEvent(p.AdaptivePlayer.EventType.LTEEvent,{details:{type:"ranges",data:this._player.timelineInfo.timeRanges}})),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","Fired SeekRangeChange for CVOD: ["+JSON.stringify(i)+"]")}}},{key:"_onError",value:function(t,e){var i=void 0,n="",r=[{name:"manifest",code:g.NLError.Code.Get_Primary_Manifest_Failed},{name:"level",code:g.NLError.Code.Get_Single_Bitrate_Manifest_Failed},{name:"frag",code:g.NLError.Code.Get_Chunk_Failed},{name:"key",code:g.NLError.Code.Get_Key_License_Failed}],a=[{name:"LoadError",code:g.NLError.NetworkDetailCode.Http_Error},{name:"LoadTimeOut",code:g.NLError.NetworkDetailCode.Timeout},{name:"ParsingError",code:g.NLError.NetworkDetailCode.Content_Error},{name:"DecryptError",code:g.NLError.NetworkDetailCode.Content_Error}];switch(e.type){case m.ErrorTypes.NETWORK_ERROR:var s=e.details,o=r.filter(function(t){if(0<=s.indexOf(t.name))return!0})[0],l=a.filter(function(t){if(0<=s.indexOf(t.name))return!0})[0];if(!o||!l)break;n=o&&o.code===g.NLError.Code.Get_Chunk_Failed?e.frag?e.frag.url:"":e.url?e.url:this._url,l&&l.code===g.NLError.NetworkDetailCode.Http_Error&&(l.code=e.response?e.response.code:g.NLError.NetworkDetailCode.Http_Error,l.code=0<l.code&&l.code<600?l.code:g.NLError.NetworkDetailCode.Connect_Failed);var u=o.code+l.code,h=void 0;h="manifest"===o.name?e.fatal?g.NLError.SeverityLevel.Fatal:g.NLError.SeverityLevel.Warning:e.fatal?g.NLError.SeverityLevel.Error:g.NLError.SeverityLevel.Warning,i=g.NLError.create(u,h,n,e.details),this._statisticManager.reportError(i);break;case m.ErrorTypes.MEDIA_ERROR:if(!e.fatal)return;if(e.details===m.ErrorDetails.FRAG_LOOP_LOADING_ERROR)return this.print(p.AdaptivePlayer.LogLevel.WARNING,"HlsPlayer","FRAG_LOOP_LOADING_ERROR fatal error encountered, try to recover"),void this._player.recoverMediaError();var c=g.NLError.Code.Playback_Generic_Error,d=g.NLError.SeverityLevel.Error;e.details===m.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR&&(c=g.NLError.Code.Incompatible_Codecs_Error,d=g.NLError.SeverityLevel.Fatal),i=g.NLError.create(c,d,this._url,e.details),this._statisticManager.reportError(i);break;case m.ErrorTypes.MUX_ERROR:break;case m.ErrorTypes.OTHER_ERROR:if(0<[m.ErrorDetails.LTE_PARSE_ERROR].filter(function(t){if(0<=e.details.indexOf(t))return!0}).length){var f=e.fatal?g.NLError.SeverityLevel.Fatal:g.NLError.SeverityLevel.Warning;this._statisticManager.reportError(g.NLError.create(g.NLError.Code.Manifest_Not_For_LTE,f,this._url,e.details))}}this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","HLS Error: ["+JSON.stringify(e.details)+"]")}},{key:"_clearTextTracks",value:function(){if(this._video)for(var t=this._video.textTracks,e=t.length-1;0<=e;e--){if(t[e].cues&&0<t[e].cues.length)for(var i=t[e].cues.length-1;0<=i;i--)t[e].removeCue(t[e].cues[i]);t[e].hashId&&(t[e].hashId=null,t[e].mode="disabled")}}},{key:"_mergeProgrameTime",value:function(t){this._timeline=this._player.timelineInfo}},{key:"_getRelStartLimit",value:function(){return c.absTimeToRelTime(this._timeline.curAbsStart,this._timeline.timeRanges,this._timeline.absStart)}},{key:"_getRelEndLimit",value:function(){var t=c.absTimeToRelTime(this._timeline.curAbsEnd,this._timeline.timeRanges,this._timeline.absStart);return this._player&&this._player.liveSyncPosition?t=this._player.liveSyncPosition:t-=3*this._timeline.targetDuration,t}},{key:"_printTimeline",value:function(){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","Print timeline:"),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","\tabsStart="+this._timeline.absStart+" curAbsStart="+this._timeline.curAbsStart+" curAbsEnd="+this._timeline.curAbsEnd);for(var t=this._timeline.timeRanges.length-1;0<=t;t--)this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","\t\t begin="+this._timeline.timeRanges[t].begin+" end="+this._timeline.timeRanges[t].end)}},{key:"currentTime",get:function(){var t=this._video.currentTime;if((this._isLive||this._userConfig&&this._userConfig.enableLTEmode)&&(t=c.relTimeToAbsTime(this._video.currentTime,this._timeline.timeRanges,this._timeline.absStart)),this._userConfig&&this._userConfig.enableLTEmode){var e=this._player.getLteStreamInfos(this._player.currentLevel);e&&(t-=e.fixFrameOffset)}return t},set:function(t){var e=t;if(this._isLive||this._userConfig&&this._userConfig.enableLTEmode){var i=c.absTimeToRelTime(t,this._timeline.timeRanges,this._timeline.absStart);i>this._getRelEndLimit()&&(i=this._getRelEndLimit()),i<this._getRelStartLimit()&&(i=this._getRelStartLimit()),t=i}var n=t,r=t,a=t;if(this._userConfig&&this._userConfig.enableLTEmode){var s=this._player.getLteStreamInfos(this._player.currentLevel);if(s){var o=this._normalize(t,s.fixFrameOffset);(a=(t=o)+s.fixFrameOffset)<0&&(a=0),t=a}}this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","rawAbsTime="+e+", rawRelTime="+n+", modRelTime="+r+", offsetModRelTime="+a),this._seekBeginTime=Date.now(),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"HlsPlayer","seekBegin="+this._seekBeginTime),this._video.currentTime=t}},{key:"sampleDuration",get:function(){if(this._userConfig&&this._userConfig.enableLTEmode){var t=this._player.getLteStreamInfos(this._player.currentLevel);if(t)return t.frameDuration}return 0}}]),n}();(e.default=v).version="v"+m.version},function(t,e,i){var n;void 0===(n=function(){return function(i){function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r={};return n.m=i,n.c=r,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=10)}([function(t,e,i){"use strict";function r(){}function n(e){for(var t=arguments.length,i=Array(1<t?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach(function(t){var a,s;o[t]=e[t]?e[t].bind(e):(a=t,(s=self.console[a])?function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var n,r;e[0]&&(e[0]=(n=a,r=e[0],"["+n+"] > "+r)),s.apply(self.console,e)}:r)})}i.d(e,"a",function(){return l}),i.d(e,"b",function(){return u});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s={trace:r,debug:r,log:r,warn:r,info:r,error:r},o=s,l=function(t){if(!0===t||"object"===(void 0===t?"undefined":a(t))){n(t,"debug","log","info","warn","error");try{o.log()}catch(t){o=s}}else o=s},u=s},function(t,e,i){"use strict";e.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",INIT_FPS_FOUND:"hlsInitFpsFound",FRAG_PARSED_EXTEND:"hlsFragParsedExtend",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",THUMBNAILS_TRACK_LOADING:"hlsThumbnailsTrackLoading",THUMBNAILS_TRACK_LOADED:"hlsThumbnailsTrackLoaded",THUMBNAILS_IMAGE_LOADING:"hlsThumbnailImageLoading",THUMBNAIL_IMAGE_LOADED:"hlsThumbnailImageLoaded",THUMBNAIL_IMAGE_ASSEMBLED:"hlsThumbnailImageAssembled",ADVERTISEMENT_LOADING:"hlsAdvertisementLoading",ADVERTISEMENT_LOADED:"hlsAdvertisementLoaded",ADVERTISEMENT_UPLOAD:"hlsAdvertisementUpload",ADVERTISEMENT_RANGE_UPDATE:"hlsAdvertisementRangeUpdate",FRAG_REMUXED:"hlsFragRemuxed"}},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return r});var n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},r={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",THUMBNAIL_IMAGE_LOAD_ERROR:"thumbnailImageLoadError",THUMBNAIL_IMAGE_LOAD_TIMEOUT:"thumbnailImageLoadTimeout",THUMBNAIL_TRACK_LOAD_ERROR:"thumbnailTrackLoadError",THUMBNAIL_TRACK_LOAD_TIMEOUT:"thumbnailTrackLoadTimeout",SUBTITLE_TRACK_LOAD_ERROR:"subtitleTrackLoadError",FRAG_LOAD_SLOW:"fragLoadSlow",LTE_PARSE_ERROR:"lteParseError"}},function(t,e,i){"use strict";i.d(e,"b",function(){return r});var n=function(){function o(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o)}return o.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},o.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},o.getID3Data=function(t,e){for(var i=e,n=0;o.isHeader(t,e);)n+=10,n+=o._readSize(t,e+6),o.isFooter(t,e+10)&&(n+=10),e+=n;if(0<n)return t.subarray(i,i+n)},o._readSize=function(t,e){var i=0;return i=(127&t[e])<<21,i|=(127&t[e+1])<<14,(i|=(127&t[e+2])<<7)|127&t[e+3]},o.getTimeStamp=function(t){for(var e=o.getID3Frames(t),i=0;i<e.length;i++){var n=e[i];if(o.isTimeStampFrame(n))return o._readTimeStamp(n)}},o.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},o.isGeobFrame=function(t){return t&&"GEOB"===t.key},o._getFrameData=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),i=o._readSize(t,4);return{type:e,size:i,data:t.subarray(10,10+i)}},o.getID3Frames=function(t){for(var e=0,i=[];o.isHeader(t,e);){for(var n=o._readSize(t,e+6),r=(e+=10)+n;e+8<r;){var a=o._getFrameData(t.subarray(e)),s=o._decodeFrame(a);s&&i.push(s),e+=a.size+10}o.isFooter(t,e)&&(e+=10)}return i},o._decodeFrame=function(t){return"PRIV"===t.type?o._decodePrivFrame(t):"T"===t.type[0]?o._decodeTextFrame(t):"W"===t.type[0]?o._decodeURLFrame(t):"GEOB"===t.type?o._decodeGEOBFrame(t):void 0},o._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),i=1&e[3],n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}},o._decodePrivFrame=function(t){if(!(t.size<2)){var e=o._utf8ArrayToStr(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:i.buffer}}},o._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,i=o._utf8ArrayToStr(t.data.subarray(e));e+=i.length+1;var n=o._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:i,data:n}}var r=o._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:r}}},o._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,i=o._utf8ArrayToStr(t.data.subarray(e));e+=i.length+1;var n=o._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:i,data:n}}var r=o._utf8ArrayToStr(t.data);return{key:t.type,data:r}},o._decodeGEOBFrame=function(t){return{key:t.type,data:t.data}},o._utf8ArrayToStr=function(t){for(var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=t.length,n=void 0,r=void 0,a=void 0,s="",o=0;o<i;){if(0===(n=t[o++])&&e)return s;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(n);break;case 12:case 13:r=t[o++],s+=String.fromCharCode((31&n)<<6|63&r);break;case 14:r=t[o++],a=t[o++],s+=String.fromCharCode((15&n)<<12|(63&r)<<6|(63&a)<<0)}}return s},o}(),r=n._utf8ArrayToStr;e.a=n},function(t,e,i){"use strict";var o=function(){function i(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,i),this.subtle=t,this.aesIV=e}return i.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},i}(),l=function(){function i(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,i),this.subtle=t,this.key=e}return i.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},i}(),u=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),i=new Uint32Array(4),n=0;n<4;n++)i[n]=e.getUint32(4*n);return i},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,i=this.subMix,n=i[0],r=i[1],a=i[2],s=i[3],o=this.invSubMix,l=o[0],u=o[1],h=o[2],c=o[3],d=new Uint32Array(256),f=0,p=0,g=0;for(g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99;var v=d[e[t[f]=m]=f],y=d[v],b=d[y],_=257*d[m]^16843008*m;n[f]=_<<24|_>>>8,r[f]=_<<16|_>>>16,a[f]=_<<8|_>>>24,s[f]=_,_=16843009*b^65537*y^257*v^16843008*f,l[m]=_<<24|_>>>8,u[m]=_<<16|_>>>16,h[m]=_<<8|_>>>24,c[m]=_,f?(f=v^d[d[d[b^v]]],p^=d[d[p]]):f=p=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,n=0;n<e.length&&i;)i=e[n]===this.key[n],n++;if(!i){this.key=e;var r=this.keySize=e.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a=this.ksRows=4*(r+6+1),s=void 0,o=void 0,l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),h=this.sBox,c=this.rcon,d=this.invSubMix,f=d[0],p=d[1],g=d[2],m=d[3],v=void 0,y=void 0;for(s=0;s<a;s++)s<r?v=l[s]=e[s]:(y=v,s%r==0?(y=h[(y=y<<8|y>>>24)>>>24]<<24|h[y>>>16&255]<<16|h[y>>>8&255]<<8|h[255&y],y^=c[s/r|0]<<24):6<r&&s%r==4&&(y=h[y>>>24]<<24|h[y>>>16&255]<<16|h[y>>>8&255]<<8|h[255&y]),l[s]=v=(l[s-r]^y)>>>0);for(o=0;o<a;o++)s=a-o,y=3&o?l[s]:l[s-4],u[o]=o<4||s<=4?y:f[h[y>>>24]]^p[h[y>>>16&255]]^g[h[y>>>8&255]]^m[h[255&y]],u[o]=u[o]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,i){for(var n,r,a=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,l=this.invSubMix,u=l[0],h=l[1],c=l[2],d=l[3],f=this.uint8ArrayToUint32Array_(i),p=f[0],g=f[1],m=f[2],v=f[3],y=new Int32Array(t),b=new Int32Array(y.length),_=void 0,T=void 0,E=void 0,S=void 0,w=void 0,k=void 0,A=void 0,L=void 0,P=void 0,C=void 0,x=void 0,I=void 0,R=this.networkToHostOrderSwap;e<y.length;){for(P=R(y[e]),C=R(y[e+1]),x=R(y[e+2]),I=R(y[e+3]),w=P^s[0],k=I^s[1],A=x^s[2],L=C^s[3],n=4,r=1;r<a;r++)_=u[w>>>24]^h[k>>16&255]^c[A>>8&255]^d[255&L]^s[n],T=u[k>>>24]^h[A>>16&255]^c[L>>8&255]^d[255&w]^s[n+1],E=u[A>>>24]^h[L>>16&255]^c[w>>8&255]^d[255&k]^s[n+2],S=u[L>>>24]^h[w>>16&255]^c[k>>8&255]^d[255&A]^s[n+3],w=_,k=T,A=E,L=S,n+=4;_=o[w>>>24]<<24^o[k>>16&255]<<16^o[A>>8&255]<<8^o[255&L]^s[n],T=o[k>>>24]<<24^o[A>>16&255]<<16^o[L>>8&255]<<8^o[255&w]^s[n+1],E=o[A>>>24]<<24^o[L>>16&255]<<16^o[w>>8&255]<<8^o[255&k]^s[n+2],S=o[L>>>24]<<24^o[w>>16&255]<<16^o[k>>8&255]<<8^o[255&A]^s[n+3],n+=3,b[e]=R(_^p),b[e+1]=R(S^g),b[e+2]=R(E^m),b[e+3]=R(T^v),p=P,g=C,m=x,v=I,e+=4}return b.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),a=i(2),h=i(0),n=function(){function n(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,n),this.observer=t,this.config=e,this.logEnabled=!0;try{var i=crypto||self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}return n.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},n.prototype.decrypt=function(e,i,n,r){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(h.b.log("JS AES decrypt"),this.logEnabled=!1);var t=this.decryptor;t||(this.decryptor=t=new u),t.expandKey(i),r(t.decrypt(e,0,n))}else{this.logEnabled&&(h.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var s=this.subtle;this.key!==i&&(this.key=i,this.fastAesKey=new l(s,i)),this.fastAesKey.expandKey().then(function(t){new o(s,n).decrypt(e,t).catch(function(t){a.onWebCryptoError(t,e,i,n,r)}).then(function(t){r(t)})}).catch(function(t){a.onWebCryptoError(t,e,i,n,r)})}},n.prototype.onWebCryptoError=function(t,e,i,n,r){this.config.enableSoftwareAES?(h.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,i,n,r)):(h.b.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:a.b.MEDIA_ERROR,details:a.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},n.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},n}();e.a=n},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(t){return"function"==typeof t}function u(t){return"object"==typeof t&&null!==t}function h(t){return void 0===t}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,i,n,r,a,s;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var o=new Error('Uncaught, unspecified "error" event. ('+e+")");throw o.context=e,o}if(h(i=this._events[t]))return!1;if(l(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),i.apply(this,r)}else if(u(i))for(r=Array.prototype.slice.call(arguments,1),n=(s=i.slice()).length,a=0;a<n;a++)s[a].apply(this,r);return!0},n.prototype.on=n.prototype.addListener=function(t,e){var i;if(!l(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,l(e.listener)?e.listener:e),this._events[t]?u(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,u(this._events[t])&&!this._events[t].warned&&(i=h(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<i&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!l(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var i,n,r,a;if(!l(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=(i=this._events[t]).length,n=-1,i===e||l(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(u(i)){for(a=r;0<a--;)if(i[a]===e||i[a].listener&&i[a].listener===e){n=a;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(l(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?l(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(l(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){var i={intValue:function(t){return 2147483647<t||t<-2147483648?t&=4294967295:t},hashCode:function(t){var e=0;if(null!=t&&""!==t)for(var i=0;i<t.length;i++)e=31*e+t.charCodeAt(i),e=this.intValue(e);return e},createHashName:function(t,e,i){return t+"_"+e+"_"+i+"_"+performance.now().toFixed(5)}};t.exports=i},function(t,e,i){var n,h,r,a,c;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,h=/^([^\/?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,c={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=c.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=c.normalizePath(n.path),c.buildURLFromParts(n)}var r=c.parseURL(e);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=c.normalizePath(r.path),c.buildURLFromParts(r)):e;var a=c.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var s=h.exec(a.path);a.netLoc=s[1],a.path=s[2]}a.netLoc&&!a.path&&(a.path="/");var o={scheme:a.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=a.netLoc,"/"!==r.path[0]))if(r.path){var l=a.path,u=l.substring(0,l.lastIndexOf("/")+1)+r.path;o.path=c.normalizePath(u)}else o.path=a.path,r.params||(o.params=a.params,r.query||(o.query=a.query));return null===o.path&&(o.path=i.alwaysNormalize?c.normalizePath(r.path):r.path),c.buildURLFromParts(o)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(r,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=c},function(t,e,i){"use strict";function r(t,e){return 255===t[e]&&240==(246&t[e+1])}function h(t,e){return 1&t[e+1]?7:9}function c(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function m(t,e){return!!(e+1<t.length&&r(t,e))}function a(t,e){if(e+1<t.length&&r(t,e)){var i=h(t,e);e+5<t.length&&(i=c(t,e));var n=e+i;if(n===t.length||n+1<t.length&&r(t,n))return!0}return!1}function v(t,e,i,n,r){if(!t.samplerate){var a=(s=e,o=i,l=n,u=r,g=navigator.userAgent.toLowerCase(),m=u,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],h=1+((192&o[l+2])>>>6),(c=(60&o[l+2])>>>2)>v.length-1?void s.trigger(Event.ERROR,{type:et.b.MEDIA_ERROR,details:et.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+c}):(f=(1&o[l+2])<<2,f|=(192&o[l+3])>>>6,it.b.log("manifest codec:"+u+",ADTS data:type:"+h+",sampleingIndex:"+c+"["+v[c]+"Hz],channelConfig:"+f),d=/firefox/i.test(g)?6<=c?(h=5,p=new Array(4),c-3):(h=2,p=new Array(2),c):-1!==g.indexOf("android")?(h=2,p=new Array(2),c):(h=5,p=new Array(4),u&&(-1!==u.indexOf("mp4a.40.29")||-1!==u.indexOf("mp4a.40.5"))||!u&&6<=c?c-3:((u&&-1!==u.indexOf("mp4a.40.2")&&(6<=c&&1===f||/vivaldi/i.test(g))||!u&&1===f)&&(h=2,p=new Array(2)),c)),p[0]=h<<3,p[0]|=(14&c)>>1,p[1]|=(1&c)<<7,p[1]|=f<<3,5===h&&(p[1]|=(14&d)>>1,p[2]=(1&d)<<7,p[2]|=8,p[3]=0),{config:p,samplerate:v[c],channelCount:f,codec:"mp4a.40."+h,manifestCodec:m}));t.config=a.config,t.samplerate=a.samplerate,t.channelCount=a.channelCount,t.codec=a.codec,t.manifestCodec=a.manifestCodec,it.b.log("parsed codec:"+t.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}var s,o,l,u,h,c,d,f,p,g,m,v}function y(t){return 9216e4/t}function b(t,e,i,n,r){var a=function(t,e,i,n,r){var a,s,o=t.length;if(a=h(t,e),s=c(t,e),0<(s-=a)&&e+a+s<=o)return{headerLength:a,frameLength:s,stamp:i+n*r}}(e,i,n,r,y(t.samplerate));if(a){var s=a.stamp,o=a.headerLength,l=a.frameLength,u={unit:e.subarray(i+o,i+o+l),pts:s,dts:s};return t.samples.push(u),t.len+=l,{sample:u,length:l+o}}}function n(t,e,i,n){if(1===arguments.length)return t;e=Math.max(e,0),i=Math.max(i,0),n=n||[];var r=t.length-i+n.length,a=new t.constructor(r);return a.set(t.subarray(0,e)),a.set(n,e),a.set(t.subarray(e+i),e+n.length),a}var tt=i(1),et=i(2),g=i(4),it=i(0),p=i(3),S=function(){function n(t,e,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,n),this.observer=t,this.config=i,this.remuxer=e}return n.prototype.resetInitSegment=function(t,e,i,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:n,inputTimeScale:9e4}},n.prototype.resetTimeStamp=function(){},n.probe=function(t){if(!t)return!1;for(var e=(p.a.getID3Data(t,0)||[]).length,i=t.length;e<i;e++)if(a(t,e))return it.b.log("ADTS sync word found !"),!0;return!1},n.prototype.append=function(t,e,i,n){for(var r=this._audioTrack,a=p.a.getID3Data(t,0)||[],s=p.a.getTimeStamp(a),o=s?90*s:9e4*e,l=0,u=o,h=t.length,c=a.length,d=[{pts:u,dts:u,data:a}];c<h-1;)if(m(t,c)&&c+5<h){v(r,this.observer,t,c,r.manifestCodec);var f=b(r,t,c,o,l);if(!f){it.b.log("Unable to parse AAC frame");break}c+=f.length,u=f.sample.pts,l++}else p.a.isHeader(t,c)?(a=p.a.getID3Data(t,c),d.push({pts:u,dts:u,data:a}),c+=a.length):c++;this.remuxer.remux(r,{samples:[]},{samples:d,inputTimeScale:9e4},{samples:[]},e,i,n)},n.prototype.destroy=function(){},n}(),o=Math.pow(2,32)-1,w=function(){function d(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,d),this.observer=t,this.remuxer=e}return d.prototype.resetTimeStamp=function(t){this.initPTS=t},d.prototype.resetInitSegment=function(t,e,i,n){if(t&&t.byteLength){var r=this.initData=d.parseInitSegment(t);null==e&&(e="mp4a.40.5"),null==i&&(i="avc1.42e01e");var a={};r.audio&&r.video?a.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:n?t:null}:(r.audio&&(a.audio={container:"audio/mp4",codec:e,initSegment:n?t:null}),r.video&&(a.video={container:"video/mp4",codec:i,initSegment:n?t:null})),this.observer.trigger(tt.a.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else e&&(this.audioCodec=e),i&&(this.videoCodec=i)},d.probe=function(t){return 0<d.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},d.bin2str=function(t){return String.fromCharCode.apply(null,t)},d.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var i=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return i<0?4294967296+i:i},d.writeUint32=function(t,e,i){t.data&&(e+=t.start,t=t.data),t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i},d.findBox=function(t,e){var i,n,r,a,s,o,l=[];if(t.data?(s=t.start,r=t.end,t=t.data):(s=0,r=t.byteLength),!e.length)return null;for(i=s;i<r;)o=1<(n=d.readUint32(t,i))?i+n:r,d.bin2str(t.subarray(i+4,i+8))===e[0]&&(1===e.length?l.push({data:t,start:i+8,end:o}):(a=d.findBox({data:t,start:i+8,end:o},e.slice(1))).length&&(l=l.concat(a))),i=o;return l},d.parseInitSegment=function(t){var c=[];return d.findBox(t,["moov","trak"]).forEach(function(t){var e=d.findBox(t,["tkhd"])[0];if(e){var i=e.data[e.start],n=0===i?12:20,r=d.readUint32(e,n),a=d.findBox(t,["mdia","mdhd"])[0];if(a){i=a.data[a.start];var s=d.readUint32(a,n=0===i?12:20),o=d.findBox(t,["mdia","hdlr"])[0];if(o){var l={soun:"audio",vide:"video"}[d.bin2str(o.data.subarray(o.start+8,o.start+12))];if(l){var u=d.findBox(t,["mdia","minf","stbl","stsd"]);if(u.length){u=u[0];var h=d.bin2str(u.data.subarray(u.start+12,u.start+16));it.b.log("MP4Demuxer:"+l+":"+h+" found")}c[r]={timescale:s,type:l},c[l]={timescale:s,id:r}}}}}}),c},d.getStartDTS=function(r,t){var e,i,n;return e=d.findBox(t,["moof","traf"]),i=[].concat.apply([],e.map(function(n){return d.findBox(n,["tfhd"]).map(function(t){var e,i;return e=d.readUint32(t,4),i=r[e].timescale||9e4,d.findBox(n,["tfdt"]).map(function(t){var e,i;return e=t.data[t.start],i=d.readUint32(t,4),1===e&&(i*=Math.pow(2,32),i+=d.readUint32(t,8)),i})[0]/i})})),n=Math.min.apply(null,i),isFinite(n)?n:0},d.offsetStartDTS=function(n,t,s){d.findBox(t,["moof","traf"]).map(function(i){return d.findBox(i,["tfhd"]).map(function(t){var e=d.readUint32(t,4),a=n[e].timescale||9e4;d.findBox(i,["tfdt"]).map(function(t){var e=t.data[t.start],i=d.readUint32(t,4);if(0===e)d.writeUint32(t,4,i-s*a);else{i*=Math.pow(2,32),i+=d.readUint32(t,8),i-=s*a,i=Math.max(i,0);var n=Math.floor(i/(o+1)),r=Math.floor(i%(o+1));d.writeUint32(t,4,n),d.writeUint32(t,8,r)}})})})},d.prototype.append=function(t,e,i,n){var r=this.initData;r||(this.resetInitSegment(t,this.audioCodec,this.videoCodec),r=this.initData);var a,s=this.initPTS;if(void 0===s){var o=d.getStartDTS(r,t);this.initPTS=s=o-e,this.observer.trigger(tt.a.INIT_PTS_FOUND,{initPTS:s})}d.offsetStartDTS(r,t,s),a=d.getStartDTS(r,t),this.remuxer.remux(r.audio,r.video,null,null,a,i,n,t)},d.prototype.destroy=function(){},d}(),_={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,i,n,r){if(!(i+24>e.length)){var a=this.parseHeader(e,i);if(a&&i+a.frameLength<=e.length){var s=n+r*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:e.subarray(i,i+a.frameLength),pts:s,dts:s};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(o),t.len+=a.frameLength,{sample:o,length:a.frameLength}}}},parseHeader:function(t,e){var i=t[e+1]>>3&3,n=t[e+1]>>1&3,r=t[e+2]>>4&15,a=t[e+2]>>2&3,s=t[e+2]>>1&1;if(1!==i&&0!==r&&15!==r&&3!==a){var o=3===i?3-n:3===n?3:4,l=1e3*_.BitratesMap[14*o+r-1],u=3===i?0:2===i?1:2,h=_.SamplingRateMap[3*u+a],c=t[e+3]>>6==3?1:2,d=_.SamplesCoefficients[i][n],f=_.BytesInSlot[n],p=8*d*f;return{sampleRate:h,channelCount:c,frameLength:parseInt(d*l/h+s,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var i=this.parseHeader(t,e),n=4;i&&i.frameLength&&(n=i.frameLength);var r=e+n;if(r===t.length||r+1<t.length&&this.isHeaderPattern(t,r))return!0}return!1}},T=_,k=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);try{this.data=function(t){for(var e=0;e<t.length-3;)0===t[e]&&0===t[e+1]&&3===t[e+2]&&(t=n(t,e+2,1)),e++;return t}(e)}catch(t){this.data=e}this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,n=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");n.set(t.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},t.prototype.skipBits=function(t){var e;this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return 32<t&&it.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?i<<e|this.readBits(e):i},t.prototype.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e,i=8,n=8;for(e=0;e<t;e++)0!==n&&(n=(i+this.readEG()+256)%256),i=0===n?i:n},t.prototype.readSPS=function(){var t,e,i,n,r,a,s,o,l=0,u=0,h=0,c=0,d=this.readUInt.bind(this),f=this.readUByte.bind(this),p=this.readBits.bind(this),g=this.readUEG.bind(this),m=this.readBoolean.bind(this),v=this.skipBits.bind(this),y=this.skipEG.bind(this),b=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(f(),t=f(),p(5),v(3),f(),b(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var T=g();if(3===T&&v(1),b(),b(),v(1),m())for(s=3!==T?8:12,o=0;o<s;o++)m()&&_(o<6?16:64)}b();var E=g();if(0===E)g();else if(1===E)for(v(1),y(),y(),i=g(),o=0;o<i;o++)y();b(),v(1),n=g(),r=g(),0===(a=p(1))&&v(1),v(1),m()&&(l=g(),u=g(),h=g(),c=g());var S=[1,1];if(m()){if(m())switch(f()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[f()<<8|f(),f()<<8|f()]}m()&&p(1),m()&&(p(3),p(1),m()&&(f(),f(),f())),m()&&(g(),g()),m()&&(e={num_units_in_tick:d(),time_scale:d(),fixed_frame_rate_flag:m()})}return{width:Math.ceil(16*(n+1)-2*l-2*u),height:(2-a)*(r+1)*16-(a?2:4)*(h+c),pixelRatio:S,fps:e}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),s=function(){function r(t,e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,r),this.decryptdata=i,this.discardEPB=n,this.decrypter=new g.a(t,e)}return r.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},r.prototype.decryptAacSample=function(e,i,n,r){var a=e[i].unit,t=a.subarray(16,a.length-a.length%16),s=t.buffer.slice(t.byteOffset,t.byteOffset+t.length),o=this;this.decryptBuffer(s,function(t){t=new Uint8Array(t),a.set(t,16),r||o.decryptAacSamples(e,i+1,n)})},r.prototype.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,n),!n)return}}},r.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),n=0,r=32;r<=t.length-16;r+=160,n+=16)i.set(t.subarray(r,r+16),n);return i},r.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var i=0,n=32;n<=t.length-16;n+=160,i+=16)t.set(e.subarray(i,i+16),n);return t},r.prototype.decryptAvcSample=function(e,i,n,r,a,s){var o=this.discardEPB(a.data),t=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(t.buffer,function(t){a.data=l.getAvcDecryptedUnit(o,t),s||l.decryptAvcSamples(e,i,n+1,r)})},r.prototype.decryptAvcSamples=function(t,e,i,n){for(;;e++,i=0){if(e>=t.length)return void n();for(var r=t[e].units;!(i>=r.length);i++){var a=r[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,n,a,s),!s)return}}}},r}(),l={video:0,audio:1,id3:2,text:3},A=function(){function I(t,e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,I),this.observer=t,this.config=i,this.typeSupported=n,this.remuxer=e,this.sampleAes=null}return I.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new s(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},I.probe=function(t){var e=I._syncOffset(t);return!(e<0||(e&&it.b.warn("MPEG2-TS detected but first sync word found @ offset "+e+", junk ahead ?"),0))},I._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),i=0;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1},I.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:l[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},I.prototype.resetInitSegment=function(t,e,i,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=I.createTrack("video",n),this._audioTrack=I.createTrack("audio",n),this._id3Track=I.createTrack("id3",n),this._txtTrack=I.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=i,this._duration=n},I.prototype.resetTimeStamp=function(){},I.prototype.append=function(t,e,i,n){var r,a,s,o,l,u=t.length,h=!1;this.contiguous=i;var c=this.pmtParsed,d=this._avcTrack,f=this._audioTrack,p=this._id3Track,g=d.pid,m=f.pid,v=p.pid,y=this._pmtId,b=d.pesData,_=f.pesData,T=p.pesData,E=this._parsePAT,S=this._parsePMT,w=this._parsePES,k=this._parseAVCPES.bind(this),A=this._parseAACPES.bind(this),L=this._parseMPEGPES.bind(this),P=this._parseID3PES.bind(this),C=I._syncOffset(t);for(u-=(u+C)%188,r=C;r<u;r+=188)if(71===t[r]){if(a=!!(64&t[r+1]),s=((31&t[r+1])<<8)+t[r+2],1<(48&t[r+3])>>4){if((o=r+5+t[r+4])===r+188)continue}else o=r+4;switch(s){case g:a&&(b&&(l=w(b))&&k(l,!1),b={data:[],size:0}),b&&(b.data.push(t.subarray(o,r+188)),b.size+=r+188-o);break;case m:a&&(_&&(l=w(_))&&(f.isAAC?A(l):L(l)),_={data:[],size:0}),_&&(_.data.push(t.subarray(o,r+188)),_.size+=r+188-o);break;case v:a&&(T&&(l=w(T))&&P(l),T={data:[],size:0}),T&&(T.data.push(t.subarray(o,r+188)),T.size+=r+188-o);break;case 0:a&&(o+=t[o]+1),y=this._pmtId=E(t,o);break;case y:a&&(o+=t[o]+1);var x=S(t,o,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(g=x.avc)&&(d.pid=g),0<(m=x.audio)&&(f.pid=m,f.isAAC=x.isAAC),0<(v=x.id3)&&(p.pid=v),h&&!c&&(it.b.log("reparse from beginning"),h=!1,r=C-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(tt.a.ERROR,{type:et.b.MEDIA_ERROR,details:et.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});b&&(l=w(b))?(k(l,!0),d.pesData=null):d.pesData=b,_&&(l=w(_))?(f.isAAC?A(l):L(l),f.pesData=null):(_&&_.size&&it.b.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=_),T&&(l=w(T))?(P(l),p.pesData=null):p.pesData=T,null==this.sampleAes?(f&&f.samples&&0<f.samples.length&&it.b.log("audio pts: firstpts="+f.samples[0].pts+", lastpts="+f.samples[f.samples.length-1].pts),d&&d.samples&&0<d.samples.length&&it.b.log("video pts: firstpts="+d.samples[0].pts+", lastpts="+d.samples[d.samples.length-1].pts),it.b.log("timeOffset="+e+", contiguous="+i+", accurateTimeOffset="+n),d&&d.samples&&0<d.samples.length&&it.b.log("search: dts="+d.samples[0].dts+", pts="+d.samples[0].pts),this.remuxer.remux(f,d,p,this._txtTrack,e,i,n)):this.decryptAndRemux(f,d,p,this._txtTrack,e,i,n)},I.prototype.decryptAndRemux=function(t,e,i,n,r,a,s){if(t.samples&&t.isAAC){var o=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,i,n,r,a,s)})}else this.decryptAndRemuxAvc(t,e,i,n,r,a,s)},I.prototype.decryptAndRemuxAvc=function(t,e,i,n,r,a,s){if(e.samples){var o=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,i,n,r,a,s)})}else this.remuxer.remux(t,e,i,n,r,a,s)},I.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},I.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},I.prototype._parsePMT=function(t,e,i,n){var r,a,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=e+3+((15&t[e+1])<<8|t[e+2])-4,e+=12+((15&t[e+10])<<8|t[e+11]);e<r;){switch(a=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!n){it.b.log("unkown stream type:"+t[e]);break}case 15:-1===s.audio&&(s.audio=a);break;case 21:-1===s.id3&&(s.id3=a);break;case 219:if(!n){it.b.log("unkown stream type:"+t[e]);break}case 27:-1===s.avc&&(s.avc=a);break;case 3:case 4:i?-1===s.audio&&(s.audio=a,s.isAAC=!1):it.b.log("MPEG audio found, not supported in this browser for now");break;case 36:it.b.warn("HEVC stream type found, not supported for now");break;default:it.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return s},I.prototype._parsePES=function(t){var e,i,n,r,a,s,o,l,u=0,h=t.data;if(!t||0===t.size)return null;for(;h[0].length<19&&1<h.length;){var c=new Uint8Array(h[0].length+h[1].length);c.set(h[0]),c.set(h[1],h[0].length),h[0]=c,h.splice(1,1)}if(1!==((e=h[0])[0]<<16)+(e[1]<<8)+e[2])return null;if((n=(e[4]<<8)+e[5])&&n>t.size-6)return null;192&(i=e[7])&&(4294967295<(s=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2)&&(s-=8589934592),64&i?(4294967295<(o=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(o-=8589934592),54e5<s-o&&(it.b.warn(Math.round((s-o)/9e4)+"s delta between PTS and DTS, align them"),s=o)):o=s),l=(r=e[8])+9,t.size-=l,a=new Uint8Array(t.size);for(var d=0,f=h.length;d<f;d++){var p=(e=h[d]).byteLength;if(l){if(p<l){l-=p;continue}e=e.subarray(l),p-=l,l=0}a.set(e,u),u+=p}return n&&(n-=r+3),{data:a,pts:s,dts:o,len:n}},I.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var i=e.samples,n=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(n||this.contiguous)?(t.id=n,i.push(t)):e.dropped++}t.debug.length&&it.b.log(t.pts+"/"+t.dts+":"+t.debug)},I.prototype._parseAVCPES=function(p,t){var g,m,v,y=this,b=this._avcTrack,e=this._parseAVCNALu(p.data),_=this.avcSample,T=!1,E=this.pushAccesUnit.bind(this),S=function(t,e,i,n){return{key:t,pts:e,dts:i,units:[],debug:n}};p.data=null,_&&e.length&&!b.audFound&&(E(_,b),_=this.avcSample=S(!1,p.pts,p.dts,"")),e.forEach(function(t){switch(t.type){case 1:m=!0,_||(_=y.avcSample=S(!0,p.pts,p.dts,"")),_.frame=!0;var e=t.data;if(T&&4<e.length){var i=new k(e).readSliceType();2!==i&&4!==i&&7!==i&&9!==i||(_.key=!0)}break;case 5:m=!0,_||(_=y.avcSample=S(!0,p.pts,p.dts,"")),_.key=!0,_.frame=!0;break;case 6:m=!0,(g=new k(y.discardEPB(t.data))).readUByte();for(var n=0,r=0,a=!1,s=0;!a&&1<g.bytesAvailable;){for(n=0;n+=s=g.readUByte(),255===s;);for(r=0;r+=s=g.readUByte(),255===s;);if(4===n&&0!==g.bytesAvailable){if(a=!0,181===g.readUByte()&&49===g.readUShort()&&1195456820===g.readUInt()&&3===g.readUByte()){var o=g.readUByte(),l=31&o,u=[o,g.readUByte()];for(v=0;v<l;v++)u.push(g.readUByte()),u.push(g.readUByte()),u.push(g.readUByte());y._insertSampleInOrder(y._txtTrack.samples,{type:3,pts:p.pts,bytes:u})}}else if(r<g.bytesAvailable)for(v=0;v<r;v++)g.readUByte()}break;case 7:if(T=m=!0,!b.sps){var h=(g=new k(t.data)).readSPS();b.width=h.width,b.height=h.height,b.pixelRatio=h.pixelRatio,b.sps=[t.data],b.duration=y._duration,y.observer.trigger(tt.a.INIT_FPS_FOUND,{fps:h.fps});var c=t.data.subarray(1,4),d="avc1.";for(v=0;v<3;v++){var f=c[v].toString(16);f.length<2&&(f="0"+f),d+=f}b.codec=d}break;case 8:m=!0,b.pps||(b.pps=[t.data]);break;case 9:m=!1,b.audFound=!0,_&&E(_,b),_=y.avcSample=S(!1,p.pts,p.dts,"");break;case 12:m=!1;break;default:m=!1,_&&(_.debug+="unknown NAL "+t.type+" ")}_&&m&&_.units.push(t)}),t&&_&&(E(_,b),this.avcSample=null)},I.prototype._insertSampleInOrder=function(t,e){var i=t.length;if(0<i){if(e.pts>=t[i-1].pts)t.push(e);else for(var n=i-1;0<=n;n--)if(e.pts<t[n].pts){t.splice(n,0,e);break}}else t.push(e)},I.prototype._getLastNalUnit=function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},I.prototype._parseAVCNALu=function(t){var e,i,n,r,a=0,s=t.byteLength,o=this._avcTrack,l=o.naluState||0,u=l,h=[],c=-1;for(-1===l&&(r=31&t[c=0],l=0,a=1);a<s;)if(e=t[a++],l)if(1!==l)if(e)if(1===e){if(0<=c)n={data:t.subarray(c,a-l-1),type:r},h.push(n);else{var d=this._getLastNalUnit();if(d&&(u&&a<=4-u&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-u)),0<(i=a-l-1))){var f=new Uint8Array(d.data.byteLength+i);f.set(d.data,0),f.set(t.subarray(0,i),d.data.byteLength),d.data=f}}l=a<s?(r=31&t[c=a],0):-1}else l=0;else l=3;else l=e?0:2;else l=e?0:1;if(0<=c&&0<=l&&(n={data:t.subarray(c,s),type:r,state:l},h.push(n)),0===h.length){var p=this._getLastNalUnit();if(p){var g=new Uint8Array(p.data.byteLength+t.byteLength);g.set(p.data,0),g.set(t,p.data.byteLength),p.data=g}}return o.naluState=l,h},I.prototype.discardEPB=function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},I.prototype._parseAACPES=function(t){var e,i,n,r,a,s,o,l=this._audioTrack,u=t.data,h=t.pts,c=this.aacOverFlow,d=this.aacLastPTS;if(c){var f=new Uint8Array(c.byteLength+u.byteLength);f.set(c,0),f.set(u,c.byteLength),u=f}for(n=0,a=u.length;n<a-1&&!m(u,n);n++);if(n&&(o=n<a-1?(s="AAC PES did not start with ADTS header,offset:"+n,!1):(s="no ADTS header found in AAC PES",!0),it.b.warn("parsing error:"+s),this.observer.trigger(tt.a.ERROR,{type:et.b.MEDIA_ERROR,details:et.a.FRAG_PARSING_ERROR,fatal:o,reason:s}),o))return;if(v(l,this.observer,u,n,this.audioCodec),i=0,e=y(l.samplerate),c&&d){var p=d+e;1<Math.abs(p-h)&&(it.b.log("AAC: align PTS for overlapping frames by "+Math.round((p-h)/90)),h=p)}for(;n<a;)if(m(u,n)&&n+5<a){var g=b(l,u,n,h,i);if(!g)break;n+=g.length,r=g.sample.pts,i++}else n++;c=n<a?u.subarray(n,a):null,this.aacOverFlow=c,this.aacLastPTS=r},I.prototype._parseMPEGPES=function(t){for(var e=t.data,i=e.length,n=0,r=0,a=t.pts;r<i;)if(T.isHeader(e,r)){var s=T.appendFrame(this._audioTrack,e,r,a,n);if(!s)break;r+=s.length,n++}else r++},I.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},I}(),L=function(){function n(t,e,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,n),this.observer=t,this.config=i,this.remuxer=e}return n.prototype.resetInitSegment=function(t,e,i,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:n,inputTimeScale:9e4}},n.prototype.resetTimeStamp=function(){},n.probe=function(t){var e,i,n=p.a.getID3Data(t,0);if(n&&void 0!==p.a.getTimeStamp(n))for(e=n.length,i=Math.min(t.length-1,e+100);e<i;e++)if(T.probe(t,e))return it.b.log("MPEG Audio sync word found !"),!0;return!1},n.prototype.append=function(t,e,i,n){for(var r=p.a.getID3Data(t,0),a=p.a.getTimeStamp(r),s=a?90*a:9e4*e,o=r.length,l=t.length,u=0,h=0,c=this._audioTrack,d=[{pts:s,dts:s,data:r}];o<l;)if(T.isHeader(t,o)){var f=T.appendFrame(c,t,o,s,u);if(!f)break;o+=f.length,h=f.sample.pts,u++}else p.a.isHeader(t,o)?(r=p.a.getID3Data(t,o),d.push({pts:h,dts:h,data:r}),o+=r.length):o++;this.remuxer.remux(c,{samples:[]},{samples:d,inputTimeScale:9e4},{samples:[]},e,i,n)},n.prototype.destroy=function(){},n}(),z=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),u=Math.pow(2,32)-1,nt=function(){function d(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d)}return d.init=function(){var t;for(t in d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})d.types.hasOwnProperty(t)&&(d.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);d.HDLR_TYPES={video:e,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);d.STTS=d.STSC=d.STCO=r,d.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),d.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),d.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),d.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);d.FTYP=d.box(d.types.ftyp,a,o,a,s),d.DINF=d.box(d.types.dinf,d.box(d.types.dref,n))},d.box=function(t){for(var e,i=Array.prototype.slice.call(arguments,1),n=8,r=i.length,a=r;r--;)n+=i[r].byteLength;for((e=new Uint8Array(n))[0]=n>>24&255,e[1]=n>>16&255,e[2]=n>>8&255,e[3]=255&n,e.set(t,4),r=0,n=8;r<a;r++)e.set(i[r],n),n+=i[r].byteLength;return e},d.hdlr=function(t){return d.box(d.types.hdlr,d.HDLR_TYPES[t])},d.mdat=function(t){return d.box(d.types.mdat,t)},d.mdhd=function(t,e){e*=t;var i=Math.floor(e/(u+1)),n=Math.floor(e%(u+1));return d.box(d.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},d.mdia=function(t){return d.box(d.types.mdia,d.mdhd(t.timescale,t.duration),d.hdlr(t.type),d.minf(t))},d.mfhd=function(t){return d.box(d.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},d.minf=function(t){return"audio"===t.type?d.box(d.types.minf,d.box(d.types.smhd,d.SMHD),d.DINF,d.stbl(t)):d.box(d.types.minf,d.box(d.types.vmhd,d.VMHD),d.DINF,d.stbl(t))},d.moof=function(t,e,i){return d.box(d.types.moof,d.mfhd(t),d.traf(i,e))},d.moov=function(t){for(var e=t.length,i=[];e--;)i[e]=d.trak(t[e]);return d.box.apply(null,[d.types.moov,d.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(d.mvex(t)))},d.mvex=function(t){for(var e=t.length,i=[];e--;)i[e]=d.trex(t[e]);return d.box.apply(null,[d.types.mvex].concat(i))},d.mvhd=function(t,e){e*=t;var i=Math.floor(e/(u+1)),n=Math.floor(e%(u+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d.box(d.types.mvhd,r)},d.sdtp=function(t){var e,i,n=t.samples||[],r=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)e=n[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return d.box(d.types.sdtp,r)},d.stbl=function(t){return d.box(d.types.stbl,d.stsd(t),d.box(d.types.stts,d.STTS),d.box(d.types.stsc,d.STSC),d.box(d.types.stsz,d.STSZ),d.box(d.types.stco,d.STCO))},d.avc1=function(t){var e,i,n,r=[],a=[];for(e=0;e<t.sps.length;e++)n=(i=t.sps[e]).byteLength,r.push(n>>>8&255),r.push(255&n),r=r.concat(Array.prototype.slice.call(i));for(e=0;e<t.pps.length;e++)n=(i=t.pps[e]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));var s=d.box(d.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(a))),o=t.width,l=t.height,u=t.pixelRatio[0],h=t.pixelRatio[1];return d.box(d.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,d.box(d.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),d.box(d.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))},d.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},d.mp4a=function(t){var e=t.samplerate;return d.box(d.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),d.box(d.types.esds,d.esds(t)))},d.mp3=function(t){var e=t.samplerate;return d.box(d.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},d.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?d.box(d.types.stsd,d.STSD,d.mp4a(t)):d.box(d.types.stsd,d.STSD,d.mp3(t)):d.box(d.types.stsd,d.STSD,d.avc1(t))},d.tkhd=function(t){var e=t.id,i=t.duration*t.timescale,n=t.width,r=t.height,a=Math.floor(i/(u+1)),s=Math.floor(i%(u+1));return d.box(d.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,r>>8&255,255&r,0,0]))},d.traf=function(t,e){var i=d.sdtp(t),n=t.id,r=Math.floor(e/(u+1)),a=Math.floor(e%(u+1));return d.box(d.types.traf,d.box(d.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),d.box(d.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a])),d.trun(t,i.length+16+20+8+16+8+8),i)},d.trak=function(t){return t.duration=t.duration||4294967295,d.box(d.types.trak,d.tkhd(t),d.mdia(t))},d.trex=function(t){var e=t.id;return d.box(d.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},d.trun=function(t,e){var i,n,r,a,s,o,l=t.samples||[],u=l.length,h=12+16*u,c=new Uint8Array(h);for(e+=8+h,c.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),i=0;i<u;i++)r=(n=l[i]).duration,a=n.size,s=n.flags,o=n.cts,c.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*i);return d.box(d.types.trun,c)},d.initSegment=function(t){d.types||d.init();var e,i=d.moov(t);return(e=new Uint8Array(d.FTYP.byteLength+i.byteLength)).set(d.FTYP),e.set(i,d.FTYP.byteLength),e},d}(),P=function(){function a(t,e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,a),this.observer=t,this.config=e,this.typeSupported=i;var r=navigator.userAgent;this.isSafari=n&&-1<n.indexOf("Apple")&&r&&!r.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.dumpSamples=function(t){for(var e=0;e<t.length;e++){var i=t[e].pts-t[e].dts;it.b.log("dump pts: dts="+t[e].dts+", pts="+t[e].pts+", cts="+i)}},a.prototype.remux=function(t,e,i,n,r,a,s){if(this.ISGenerated||this.generateIS(t,e,r),this.ISGenerated){var o=t.samples.length,l=e.samples.length,u=r,h=r;if(o&&l){var c=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;u+=Math.max(0,c),h+=Math.max(0,-c)}if(o){t.timescale||(it.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,r));var d=this.remuxAudio(t,u,a,s);if(l){var f=void 0;d&&(f=d.endPTS-d.startPTS),e.timescale||(it.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,r)),this.remuxVideo(e,h,a,f,s)}}else{var p=void 0;l&&(p=this.remuxVideo(e,h,a,s)),p&&t.codec&&this.remuxEmptyAudio(t,u,a,p)}}i.samples.length&&this.remuxID3(i,r),n.samples.length&&this.remuxText(n,r),this.observer.trigger(tt.a.FRAG_PARSED)},a.prototype.generateIS=function(t,e,i){var n,r,a=this.observer,s=t.samples,o=e.samples,l=this.typeSupported,u="audio/mp4",h={},c={tracks:h},d=void 0===this._initPTS;if(d&&(n=r=1/0),t.config&&s.length&&(t.timescale=t.samplerate,it.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(l.mpeg?(u="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),h.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array:nt.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(n=r=s[0].pts-t.inputTimeScale*i)),e.sps&&e.pps&&o.length){var f=e.inputTimeScale;e.timescale=f,h.video={container:"video/mp4",codec:e.codec,initSegment:nt.initSegment([e]),metadata:{width:e.width,height:e.height}},d&&(n=Math.min(n,o[0].pts-f*i),r=Math.min(r,o[0].dts-f*i),this.observer.trigger(tt.a.INIT_PTS_FOUND,{initPTS:n}))}Object.keys(h).length?(a.trigger(tt.a.FRAG_PARSING_INIT_SEGMENT,c),this.ISGenerated=!0,d&&(this._initPTS=n,this._initDTS=r)):a.trigger(tt.a.ERROR,{type:et.b.MEDIA_ERROR,details:et.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(t,e,i,n,r){var a,s,o,l,u,h,c,d=8,f=t.timescale,p=t.samples,g=[],m=p.length,v=this._PTSNormalize,y=this._initDTS,b=this.nextAvcDts,_=this.isSafari;_&&(i|=p.length&&b&&(r&&Math.abs(e-b/f)<.1||Math.abs(p[0].pts-b-y)<f/5)),i||(b=e*f),p.forEach(function(t){t.pts=v(t.pts-y,b),t.dts=v(t.dts-y,b)}),p.sort(function(t,e){var i=t.dts-e.dts,n=t.pts-e.pts;return i||n||t.id-e.id});var T=p.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(T<0){it.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var E=0;E<p.length;E++)p[E].dts+=T}var S=p[0];u=Math.max(S.dts,0),l=Math.max(S.pts,0);var w=Math.round((u-b)/90);i&&w&&(1<w?it.b.log("AVC:"+w+" ms hole between fragments detected,filling it"):w<-1&&it.b.log("AVC:"+-w+" ms overlapping between fragments detected"),u=b,p[0].dts=u,l=Math.max(l-w,b),p[0].pts=l,it.b.log("Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(u/90)+",delta:"+w+" ms")),S=p[p.length-1],c=Math.max(S.dts,0),h=Math.max(S.pts,0,c),_&&(a=Math.round((c-u)/(p.length-1)));for(var k=0,A=0,L=0;L<m;L++){for(var P=p[L],C=P.units,x=C.length,I=0,R=0;R<x;R++)I+=C[R].data.length;A+=I,k+=x,P.length=I,P.dts=_?u+L*a:Math.max(P.dts,u),P.pts=Math.max(P.pts,P.dts)}var D=A+4*k+8;try{s=new Uint8Array(D)}catch(t){return void this.observer.trigger(tt.a.ERROR,{type:et.b.MUX_ERROR,details:et.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating video mdat "+D})}var N=new DataView(s.buffer);N.setUint32(0,D),s.set(nt.types.mdat,4);for(var O=0;O<m;O++){for(var M=p[O],U=M.units,F=0,B=void 0,G=0,j=U.length;G<j;G++){var H=U[G],V=H.data,W=H.data.byteLength;N.setUint32(d,W),d+=4,s.set(V,d),d+=W,F+=4+W}if(_)B=Math.max(0,a*Math.round((M.pts-M.dts)/a));else{if(O<m-1)a=p[O+1].dts-M.dts;else{var z=this.config,K=M.dts-p[0<O?O-1:O].dts;if(z.stretchShortVideoTrack){var Y=z.maxBufferHole,X=z.maxSeekHole,q=Math.floor(Math.min(Y,X)*f),Z=(n?l+n*f:this.nextAudioPts)-M.pts;q<Z?((a=Z-K)<0&&(a=K),it.b.log("It is approximately "+Z/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=K}else a=K}B=Math.round(M.pts-M.dts)}g.push({size:F,duration:a,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:M.key?2:1,isNonSync:M.key?0:1}})}this.nextAvcDts=c+a;var Q=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,g.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var J=g[0].flags;J.dependsOn=2,J.isNonSync=0}t.samples=g,o=nt.moof(t.sequenceNumber++,u,t),t.samples=[];var $={data1:o,data2:s,startPTS:l/f,endPTS:(h+a)/f,startDTS:u/f,endDTS:this.nextAvcDts/f,type:"video",nb:g.length,dropped:Q};return this.observer.trigger(tt.a.FRAG_PARSING_DATA,$),$},a.prototype.remuxAudio=function(t,e,i,n){var r,a,s,o,l,u,h,c=t.inputTimeScale,d=t.timescale,f=c/d,p=(t.isAAC?1024:1152)*f,g=this._PTSNormalize,m=this._initDTS,v=!t.isAAC&&this.typeSupported.mpeg,y=t.samples,b=[],_=this.nextAudioPts;if(i|=y.length&&_&&(n&&Math.abs(e-_/c)<.1||Math.abs(y[0].pts-_-m)<20*p),y.forEach(function(t){t.pts=t.dts=g(t.pts-m,e*c)}),0!==(y=y.filter(function(t){return 0<=t.pts})).length){if(i||(_=n?e*c:y[0].pts),t.isAAC)for(var T=this.config.maxAudioFramesDrift,E=0,S=_;E<y.length;){var w,k=y[E];w=k.pts-S;var A=Math.abs(1e3*w/c);if(w<=-T*p)it.b.warn("Dropping 1 audio frame @ "+(S/c).toFixed(3)+"s due to "+Math.round(A)+" ms overlap."),y.splice(E,1),t.len-=k.unit.length;else if(T*p<=w&&A<1e4&&S){var L=Math.round(w/p);it.b.warn("Injecting "+L+" audio frame @ "+(S/c).toFixed(3)+"s due to "+Math.round(1e3*w/c)+" ms gap.");for(var P=0;P<L;P++){var C=Math.max(S,0);(s=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(it.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),s=k.unit.subarray()),y.splice(E,0,{unit:s,pts:C,dts:C}),t.len+=s.length,S+=p,E++}k.pts=k.dts=S,S+=p,E++}else Math.abs(w),k.pts=k.dts=S,S+=p,E++}for(var x=0,I=y.length;x<I;x++){var R=y[x],D=R.unit,N=R.pts;if(void 0!==h)a.duration=Math.round((N-h)/f);else{var O=Math.round(1e3*(N-_)/c),M=0;if(i&&t.isAAC&&O){if(0<O&&O<1e4)M=Math.round((N-_)/p),it.b.log(O+" ms hole between AAC samples detected,filling it"),0<M&&((s=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(s=D.subarray()),t.len+=M*s.length);else if(O<-12){it.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(_/c).toFixed(3)+"s/"+(N/c).toFixed(3)+"s/"+-O+"ms"),t.len-=D.byteLength;continue}N=_}if(u=N,!(0<t.len))return;var U=v?t.len:t.len+8;r=v?0:8;try{o=new Uint8Array(U)}catch(t){return void this.observer.trigger(tt.a.ERROR,{type:et.b.MUX_ERROR,details:et.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating audio mdat "+U})}v||(new DataView(o.buffer).setUint32(0,U),o.set(nt.types.mdat,4));for(var F=0;F<M;F++)(s=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(it.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),s=D.subarray()),o.set(s,r),r+=s.byteLength,a={size:s.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(a)}o.set(D,r);var B=D.byteLength;r+=B,a={size:B,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(a),h=N}var G=0,j=b.length;if(2<=j&&(G=b[j-2].duration,a.duration=G),j){this.nextAudioPts=_=h+f*G,t.len=0,t.samples=b,l=v?new Uint8Array:nt.moof(t.sequenceNumber++,u/f,t),t.samples=[];var H=u/c,V=_/c,W={data1:l,data2:o,startPTS:H,endPTS:V,startDTS:H,endDTS:V,type:"audio",nb:j};return this.observer.trigger(tt.a.FRAG_PARSING_DATA,W),W}return null}},a.prototype.remuxEmptyAudio=function(t,e,i,n){var r=t.inputTimeScale,a=r/(t.samplerate?t.samplerate:r),s=this.nextAudioPts,o=(void 0!==s?s:n.startDTS*r)+this._initDTS,l=n.endDTS*r+this._initDTS,u=1024*a,h=Math.ceil((l-o)/u),c=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(it.b.warn("remux empty Audio"),c){for(var d=[],f=0;f<h;f++){var p=o+f*u;d.push({unit:c,pts:p,dts:p}),t.len+=c.length}t.samples=d,this.remuxAudio(t,e,i)}else it.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},a.prototype.remuxID3=function(t,e){var i,n=t.samples.length,r=t.inputTimeScale,a=this._initPTS,s=this._initDTS;if(n){for(var o=0;o<n;o++)(i=t.samples[o]).pts=(i.pts-a)/r,i.dts=(i.dts-s)/r;this.observer.trigger(tt.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},a.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var i,n=t.samples.length,r=t.inputTimeScale,a=this._initPTS;if(n){for(var s=0;s<n;s++)(i=t.samples[s]).pts=(i.pts-a)/r;this.observer.trigger(tt.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},a.prototype._PTSNormalize=function(t,e){var i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=i;return t},a}(),C=function(){function a(t,e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,a),this.observer=t,this.config=e,this.typeSupported=i;var r=navigator.userAgent;this.isSafari=n&&-1<n.indexOf("Apple")&&r&&!r.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.dumpSamples=function(t){for(var e=0;e<t.length;e++){var i=t[e].pts-t[e].dts;it.b.log("dump pts: dts="+t[e].dts+", pts="+t[e].pts+", cts="+i)}},a.prototype.remux=function(t,e,i,n,r,a,s){if(this.ISGenerated||this.generateIS(t,e,r),this.ISGenerated){var o=t.samples.length,l=e.samples.length,u=r,h=r;if(o&&l){var c=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;u+=Math.max(0,c),h+=Math.max(0,-c)}if(o){t.timescale||(it.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,r));var d=this.remuxAudio(t,u,a,s);if(l){var f=void 0;d&&(f=d.endPTS-d.startPTS),e.timescale||(it.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,r)),this.remuxVideo(e,h,a,f,s)}}else{var p=void 0;l&&(p=this.remuxVideo(e,h,a,s)),p&&t.codec&&this.remuxEmptyAudio(t,u,a,p)}}i.samples.length&&this.remuxID3(i,r),n.samples.length&&this.remuxText(n,r),this.observer.trigger(tt.a.FRAG_PARSED)},a.prototype.generateIS=function(t,e,i){var n,r,a=this.observer,s=t.samples,o=e.samples,l=this.typeSupported,u="audio/mp4",h={},c={tracks:h},d=void 0===this._initPTS;if(d&&(n=r=1/0),e.sps&&e.pps&&o.length){var f=e.inputTimeScale;e.timescale=f,h.video={container:"video/mp4",codec:e.codec,initSegment:nt.initSegment([e]),metadata:{width:e.width,height:e.height}},d&&(n=o[0].pts-f*i,r=o[0].dts-f*i)}if(t.config&&s.length&&(t.timescale=t.samplerate,it.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(l.mpeg?(u="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),h.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array:nt.initSegment([t]),metadata:{channelCount:t.channelCount}},d)){for(n=r=s[0].pts-t.inputTimeScale*i;0<s.length&&s[0].pts<n;)s.shift();this.observer.trigger(tt.a.INIT_PTS_FOUND,{initPTS:n})}Object.keys(h).length?(a.trigger(tt.a.FRAG_PARSING_INIT_SEGMENT,c),this.ISGenerated=!0,d&&(this._initPTS=n,this._initDTS=r)):a.trigger(tt.a.ERROR,{type:et.b.MEDIA_ERROR,details:et.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(t,e,i,n,r){var a,s,o,l,u,h,c,d=8,f=t.timescale,p=t.samples,g=[],m=p.length,v=this._PTSNormalize,y=this._initDTS,b=this.nextAvcDts,_=this.isSafari;_&&(i|=p.length&&b&&(r&&Math.abs(e-b/f)<.1||Math.abs(p[0].pts-b-y)<f/5)),i||(b=e*f),p.forEach(function(t){t.pts=v(t.pts-y,b),t.dts=v(t.dts-y,b)}),p.sort(function(t,e){var i=t.dts-e.dts,n=t.pts-e.pts;return i||n||t.id-e.id});var T=p[0];u=Math.max(T.dts,0),l=Math.max(T.pts,0);var E=Math.round((u-b)/90);i&&E&&(1<E?it.b.log("AVC:"+E+" ms hole between fragments detected,filling it"):E<-1&&it.b.log("AVC:"+-E+" ms overlapping between fragments detected"),p[0].dts=u,p[0].pts=l,it.b.log("Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(u/90)+",delta:"+E+" ms")),T=p[p.length-1],c=Math.max(T.dts,0),h=Math.max(T.pts,0,c),_&&(a=Math.round((c-u)/(p.length-1)));for(var S=0,w=0,k=0;k<m;k++){for(var A=p[k],L=A.units,P=L.length,C=0,x=0;x<P;x++)C+=L[x].data.length;w+=C,S+=P,A.length=C,A.dts=_?u+k*a:Math.max(A.dts,u),A.pts=Math.max(A.pts,A.dts)}var I=w+4*S+8;try{s=new Uint8Array(I)}catch(t){return void this.observer.trigger(tt.a.ERROR,{type:et.b.MUX_ERROR,details:et.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I})}var R=new DataView(s.buffer);R.setUint32(0,I),s.set(nt.types.mdat,4);for(var D=0;D<m;D++){for(var N=p[D],O=N.units,M=0,U=void 0,F=0,B=O.length;F<B;F++){var G=O[F],j=G.data,H=G.data.byteLength;R.setUint32(d,H),d+=4,s.set(j,d),d+=H,M+=4+H}if(_)U=Math.max(0,a*Math.round((N.pts-N.dts)/a));else{if(D<m-1)a=p[D+1].dts-N.dts;else{var V=this.config,W=N.dts-p[0<D?D-1:D].dts;if(V.stretchShortVideoTrack){var z=V.maxBufferHole,K=V.maxSeekHole,Y=Math.floor(Math.min(z,K)*f),X=(n?l+n*f:this.nextAudioPts)-N.pts;Y<X?((a=X-W)<0&&(a=W),it.b.log("It is approximately "+X/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=W}else a=W}U=Math.round(N.pts-N.dts)}g.push({size:M,duration:a,cts:U,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:N.key?2:1,isNonSync:N.key?0:1}})}this.nextAvcDts=c+a;var q=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,g.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var Z=g[0].flags;Z.dependsOn=2,Z.isNonSync=0}t.samples=g,o=nt.moof(t.sequenceNumber++,u,t),t.samples=[];var Q={data1:o,data2:s,startPTS:l/f,endPTS:(h+a)/f,startDTS:u/f,endDTS:this.nextAvcDts/f,type:"video",nb:g.length,dropped:q};return this.observer.trigger(tt.a.FRAG_PARSING_DATA,Q),Q},a.prototype.remuxAudio=function(t,e,i,n){var r,a,s,o,l,u,h,c=t.inputTimeScale,d=t.timescale,f=c/d,p=(t.isAAC?1024:1152)*f,g=this._PTSNormalize,m=this._initDTS,v=!t.isAAC&&this.typeSupported.mpeg,y=t.samples,b=[],_=this.nextAudioPts;if(i|=y.length&&_&&(n&&Math.abs(e-_/c)<.1||Math.abs(y[0].pts-_-m)<20*p),y.forEach(function(t){t.pts=t.dts=g(t.pts-m,e*c)}),0!==(y=y.filter(function(t){return 0<=t.pts})).length){if(i||(_=n?e*c:y[0].pts),t.isAAC)for(var T=this.config.maxAudioFramesDrift,E=0,S=_;E<y.length;){var w,k=y[E];w=k.pts-S;var A=Math.abs(1e3*w/c);if(w<=-T*p)it.b.warn("Dropping 1 audio frame @ "+(S/c).toFixed(3)+"s due to "+Math.round(A)+" ms overlap."),y.splice(E,1),t.len-=k.unit.length;else if(T*p<=w&&A<1e4&&S){var L=Math.round(w/p);it.b.warn("Injecting "+L+" audio frame @ "+(S/c).toFixed(3)+"s due to "+Math.round(1e3*w/c)+" ms gap.");for(var P=0;P<L;P++){var C=Math.max(S,0);(s=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(it.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),s=k.unit.subarray()),y.splice(E,0,{unit:s,pts:C,dts:C}),t.len+=s.length,S+=p,E++}k.pts=k.dts=S,S+=p,E++}else Math.abs(w),k.pts=k.dts=S,S+=p,E++}for(var x=0,I=y.length;x<I;x++){var R=y[x],D=R.unit,N=R.pts;if(void 0!==h)a.duration=Math.round((N-h)/f);else{var O=Math.round(1e3*(N-_)/c),M=0;if(i&&t.isAAC&&O){if(0<O&&O<1e4)M=Math.round((N-_)/p),it.b.log(O+" ms hole between AAC samples detected,filling it"),0<M&&((s=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(s=D.subarray()),t.len+=M*s.length);else if(O<-12){it.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(_/c).toFixed(3)+"s/"+(N/c).toFixed(3)+"s/"+-O+"ms"),t.len-=D.byteLength;continue}N=_}if(u=N,!(0<t.len))return;var U=v?t.len:t.len+8;r=v?0:8;try{o=new Uint8Array(U)}catch(t){return void this.observer.trigger(tt.a.ERROR,{type:et.b.MUX_ERROR,details:et.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating audio mdat "+U})}v||(new DataView(o.buffer).setUint32(0,U),o.set(nt.types.mdat,4));for(var F=0;F<M;F++)(s=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(it.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),s=D.subarray()),o.set(s,r),r+=s.byteLength,a={size:s.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(a)}o.set(D,r);var B=D.byteLength;r+=B,a={size:B,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(a),h=N}var G=0,j=b.length;if(2<=j&&(G=b[j-2].duration,a.duration=G),j){this.nextAudioPts=_=h+f*G,t.len=0,t.samples=b,l=v?new Uint8Array:nt.moof(t.sequenceNumber++,u/f,t),t.samples=[];var H=u/c,V=_/c,W={data1:l,data2:o,startPTS:H,endPTS:V,startDTS:H,endDTS:V,type:"audio",nb:j};return this.observer.trigger(tt.a.FRAG_PARSING_DATA,W),W}return null}},a.prototype.remuxEmptyAudio=function(t,e,i,n){var r=t.inputTimeScale,a=r/(t.samplerate?t.samplerate:r),s=this.nextAudioPts,o=(void 0!==s?s:n.startDTS*r)+this._initDTS,l=n.endDTS*r+this._initDTS,u=1024*a,h=Math.ceil((l-o)/u),c=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(it.b.warn("remux empty Audio"),c){for(var d=[],f=0;f<h;f++){var p=o+f*u;d.push({unit:c,pts:p,dts:p}),t.len+=c.length}t.samples=d,this.remuxAudio(t,e,i)}else it.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},a.prototype.remuxID3=function(t,e){var i,n=t.samples.length,r=t.inputTimeScale,a=this._initPTS,s=this._initDTS;if(n){for(var o=0;o<n;o++)(i=t.samples[o]).pts=(i.pts-a)/r,i.dts=(i.dts-s)/r;this.observer.trigger(tt.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},a.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var i,n=t.samples.length,r=t.inputTimeScale,a=this._initPTS;if(n){for(var s=0;s<n;s++)(i=t.samples[s]).pts=(i.pts-a)/r;this.observer.trigger(tt.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},a.prototype._PTSNormalize=function(t,e){var i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=i;return t},a}(),x=function(){function e(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(t,e,i,n,r,a,s,o){var l=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),l.trigger(tt.a.FRAG_PARSING_DATA,{data1:o,startPTS:r,startDTS:r,type:u,nb:1,dropped:0}),l.trigger(tt.a.FRAG_PARSED)},e}(),d=function(){function r(t,e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,r),this.observer=t,this.typeSupported=e,this.config=i,this.vendor=n}return r.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},r.prototype.push=function(t,i,n,r,a,s,o,l,u,h,c,d){if(0<t.byteLength&&null!=i&&null!=i.key&&"AES-128"===i.method){var e=this.decrypter;null==e&&(e=this.decrypter=new g.a(this.observer,this.config));var f,p=this;try{f=performance.now()}catch(t){f=Date.now()}e.decrypt(t,i.key.buffer,i.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}p.observer.trigger(tt.a.FRAG_DECRYPTED,{stats:{tstart:f,tdecrypt:e}}),p.pushDecrypted(new Uint8Array(t),i,new Uint8Array(n),r,a,s,o,l,u,h,c,d)})}else this.pushDecrypted(new Uint8Array(t),i,new Uint8Array(n),r,a,s,o,l,u,h,c,d)},r.prototype.pushDecrypted=function(t,e,i,n,r,a,s,o,l,u,h,c){var d=this.demuxer;if(!d||s&&!this.probe(t)){var f=this.observer,p=this.typeSupported,g=this.config,m=[{demux:A,remux:P},{demux:w,remux:x},{demux:S,remux:P},{demux:L,remux:P}];g.lteMode&&(m=[{demux:A,remux:C},{demux:w,remux:x},{demux:S,remux:C},{demux:L,remux:C}]);for(var v=0,y=m.length;v<y;v++){var b=m[v],_=b.demux.probe;if(_(t)){var T=this.remuxer=new b.remux(f,g,p,this.vendor);d=new b.demux(f,T,g,p),this.probe=_;break}}if(!d)return void f.trigger(tt.a.ERROR,{type:et.b.MEDIA_ERROR,details:et.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=d}var E=this.remuxer;it.b.debug("discontinuity="+s+", trackSwitch="+o+", timeOffset="+a+", contiguous="+l+", accurateTimeOffset="+h+", duration="+u),(s||o)&&(d.resetInitSegment(i,n,r,u),E.resetInitSegment()),s&&(d.resetTimeStamp(c),E.resetTimeStamp(c)),"function"==typeof d.setDecryptData&&d.setDecryptData(e),d.append(t,a,l,h)},r}();e.a=d},function(t,e){var f={buildAbsoluteURL:function(t,e){if(e=e.trim(),/^[a-z]+:/i.test(e))return e;var i=null,n=null,r=/^([^#]*)(.*)$/.exec(e);r&&(n=r[2],e=r[1]);var a=/^([^\?]*)(.*)$/.exec(e);a&&(i=a[2],e=a[1]);var s=/^([^#]*)(.*)$/.exec(t);s&&(t=s[1]);var o=/^([^\?]*)(.*)$/.exec(t);o&&(t=o[1]);var l=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(t);if(!l)throw new Error("Error trying to parse base URL.");var u=l[2]||"",h=l[1]||"",c=l[4],d=null;return d=/^\/\//.test(e)?u+"//"+f.buildAbsolutePath("",e.substring(2)):/^\//.test(e)?h+"/"+f.buildAbsolutePath("",e.substring(1)):f.buildAbsolutePath(h+c,e),i&&(d+=i),n&&(d+=n),d},buildAbsolutePath:function(t,e){for(var i,n,r=e,a="",s=t.replace(/[^\/]*$/,r.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),o=0;-1<(n=s.indexOf("/../",o));o=n+i)i=/^\/(?:\.\.\/)*/.exec(s.slice(n))[0].length,a=(a+s.substring(o,n)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");return a+s.substr(o)},parseUri:function(t){for(var e=["url","protocol","host","port","path","query","hash"],i=new RegExp("^(?:([A-Za-z]+):)?(?:\\/{0,3})([0-9.\\-A-Za-z]+)(?::(\\d+))?(?:\\/([^?#]*))?(?:\\?([^#]*))?(?:#(.*))?$").exec(t),n={},r=7;r--;)n[e[r]]=i[r]||"";return n},parseUrlPath:function(t){for(var e=["path","fullName","name","suffix"],i=new RegExp("^((\\/).*\\/)(([^\\.]*)(?:\\.?(.*))?)$").exec(t),n={},r=4;r--;)n[e[r]]=i[r]||"";return n},isAbsoluteURL:function(t){return/^[a-z]+:/i.test(t.trim())}};t.exports=f},function(t,e,i){"use strict";function p(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!t)return null;for(var i=null,n=0;n<t.length;n++){var r=t[n];r.id===e&&(i=r)}return i}function u(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function f(t,e,i){var n=t[e],r=t[i],a=r.startPTS;isNaN(a)?r.start=e<i?n.start+n.duration:Math.max(n.start-r.duration,0):e<i?(n.duration=a-n.start,n.duration<0&&Y.b.warn("One: negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(r.duration=n.start-a,r.duration<0&&Y.b.warn("Two: negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"))}function g(t,e,i,n,r,a){var s=i;if(!isNaN(e.startPTS)){var o=Math.abs(e.startPTS-i);isNaN(e.deltaPTS)?e.deltaPTS=o:e.deltaPTS=Math.max(o,e.deltaPTS),s=Math.max(i,e.startPTS),i=Math.min(i,e.startPTS),n=Math.max(n,e.endPTS),r=Math.min(r,e.startDTS),a=Math.max(a,e.endDTS)}var l=i-e.start;e.start=e.startPTS=i,e.maxStartPTS=s,e.endPTS=n,e.startDTS=r,e.endDTS=a,e.duration=n-i;var u,h,c,d=e.sn;if(!t||d<t.startSN||d>t.endSN)return 0;for(u=d-t.startSN,(h=t.fragments)[u]=e,c=u;0<c;c--)f(h,c,c-1);for(c=u;c<h.length-1;c++)f(h,c,c+1);return t.PTSKnown=!0,l}function m(t,e){var i,n=Math.max(t.startSN,e.startSN)-e.startSN,r=Math.min(t.endSN,e.endSN)-e.startSN,a=e.startSN-t.startSN,s=t.fragments,o=e.fragments,l=0;if(r<n)e.PTSKnown=!1;else{for(var u=n;u<=r;u++){var h=s[a+u],c=o[u];c&&h&&(l=h.cc-c.cc,isNaN(h.startPTS)||(c.start=c.startPTS=h.startPTS,c.endPTS=h.endPTS,c.duration=h.duration,c.backtracked=h.backtracked,c.dropped=h.dropped,i=c))}if(l)for(Y.b.log("discontinuity sliding from playlist, take drift into account"),u=0;u<o.length;u++)o[u].cc+=l;if(i)g(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS);else if(0<=a&&a<s.length){var d=s[a].start;for(u=0;u<o.length;u++)o[u].start+=d}else Y.b.log("mergeDetails: delta="+a+", oldfragments.length="+s.length);e.PTSKnown=t.PTSKnown,!1===e.PTSKnown&&Y.b.log("mergeDetails: PTSKnown="+e.PTSKnown)}}function c(i,t){t.fragments.forEach(function(t){if(t){var e=t.start+i;t.start=t.startPTS=e,t.endPTS=e+t.duration}}),t.PTSKnown=!0}function v(t,e,i,n){if(!n&&(a=t,o=i,l=!1,(s=e)&&s.details&&o&&(o.endCC>o.startCC||a&&a.cc<o.startCC)&&(l=!0),l)){Y.b.log("alignDiscontinuities: step1");var r=function(t,e){var i=t.fragments,n=e.fragments;if(n.length&&i.length){var r=function(t,e){for(var i=null,n=0;n<t.length;n+=1){var r=t[n];if(r&&r.cc===e){i=r;break}}return i}(i,n[0].cc);return!r||r&&!r.startPTS?(Y.b.log("No frag in previous level to align on. url="+n[0].relurl+", cc="+n[0].cc),void(r&&Y.b.log("prevStartFrag: url="+r.relurl+", sn="+r.sn+", startPTS="+r.startPTS))):r}Y.b.log("No fragments to align")}(e.details,i);r&&(Y.b.log("Adjusting PTS using last level due to CC increase within current level. start="+r.start+". url="+r.relurl),c(r.start,i)),Y.b.log("alignDiscontinuities: step2")}var a,s,o,l;if(!1===i.PTSKnown&&e&&e.details){Y.b.log("alignDiscontinuities: step3");var u=e.details.programDateTime,h=(i.programDateTime-u)/1e3+e.details.fragments[0].start;isNaN(h)||(Y.b.log("adjusting PTS using programDateTime delta, sliding:"+h.toFixed(3)),c(h,i)),Y.b.log("alignDiscontinuities: step4")}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Be,this.regionList=[]}function b(){this.values=Object.create(null)}function _(t,e,i,n){var r=n?t.split(n):[t];for(var a in r)if("string"==typeof r[a]){var s=r[a].split(i);if(2===s.length)e(s[0],s[1])}}function T(e,t,s){function i(){var t=function(t){function e(t,e,i,n){return 3600*(0|t)+60*(0|e)+(0|i)+(0|n)/1e3}var i=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?e(i[1],i[2],i[3].replace(":",""),i[4]):59<i[1]?e(i[1],i[2],0,i[4]):e(0,i[1],i[2],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}var r=e;if(n(),t.startTime=i(),n(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),n(),t.endTime=i(),n(),function(t,e){var a=new b;_(t,function(t,e){switch(t){case"region":for(var i=s.length-1;0<=i;i--)if(s[i].id===e){a.set(t,s[i].region);break}break;case"vertical":a.alt(t,e,["rl","lr"]);break;case"line":var n=e.split(","),r=n[0];a.integer(t,r),a.percent(t,r)&&a.set("snapToLines",!1),a.alt(t,r,["auto"]),2===n.length&&a.alt("lineAlign",n[1],["start",je,"end"]);break;case"position":n=e.split(","),a.percent(t,n[0]),2===n.length&&a.alt("positionAlign",n[1],["start",je,"end","line-left","line-right","auto"]);break;case"size":a.percent(t,e);break;case"align":a.alt(t,e,["start",je,"end","left","right"])}},/:/,/\s/),e.region=a.get("region",null),e.vertical=a.get("vertical","");var i=a.get("line","auto");"auto"===i&&-1===Ge.line&&(i=-1),e.line=i,e.lineAlign=a.get("lineAlign","start"),e.snapToLines=a.get("snapToLines",!0),e.size=a.get("size",100),e.align=a.get("align",je);var n=a.get("position","auto");"auto"===n&&50===Ge.position&&(n="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=n}(e,t)}function E(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function S(t,e,i,n){for(var r,a,s,o,l,u=window.VTTCue||window.TextTrackCue,h=0;h<n.rows.length;h++)if(s=!0,o=0,l="",!(r=n.rows[h]).isEmpty()){for(var c=0;c<r.chars.length;c++)r.chars[c].uchar.match(/\s/)&&s?o++:(l+=r.chars[c].uchar,s=!1);(r.cueStartTime=e)===i&&(i+=1e-4),a=new u(e,i,E(l.trim())),16<=o?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=7<h?h:h+1:a.line=7<h?h-2:h+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(a)}}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t){if(t&&t.cues)for(;0<t.cues.length;)t.removeCue(t.cues[0])}Object.defineProperty(e,"__esModule",{value:!0});var A={};i.d(A,"newCue",function(){return S});var L=i(7),P=i.n(L),M=i(1),U=i(2),Y=i(0),C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x=function(){function r(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,r),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return r.prototype.destroy=function(){this.unregisterListeners()},r.prototype.isEventHandler=function(){return"object"===C(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},r.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if("hlsEventGeneric"===t)throw new Error("Forbidden event name: "+t);this.hls.on(t,this.onEvent)},this)},r.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},r.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},r.prototype.onEventGeneric=function(t,e){try{(function(t,e){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,e)}).call(this,t,e).call()}catch(e){Y.b.error("internal error happened while processing "+t+":"+e.message),this.hls.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},r}(),I=/^(\d+)x(\d+)$/,R=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,X=function(){function i(t){for(var e in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),"string"==typeof t&&(t=i.parseAttrList(t)),t)t.hasOwnProperty(e)&&(this[e]=t[e])}return i.prototype.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},i.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),n=0;n<e.length/2;n++)i[n]=parseInt(e.slice(2*n,2*n+2),16);return i}return null},i.prototype.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},i.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},i.prototype.enumeratedString=function(t){return this[t]},i.prototype.decimalResolution=function(t){var e=I.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},i.parseAttrList=function(t){var e,i={};for(R.lastIndex=0;null!==(e=R.exec(t));){var n=e[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[e[1]]=n}return i},i}(),D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},N=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;r(this,n),this.cdnName=t,this.priority=e,this.bandwidthRate=i,this.bytes=0,this.onlineSpeed=0}return n.prototype.updateBytes=function(t){this.bytes+=t},n.prototype.updateSpeed=function(t){this.onlineSpeed=Math.round(t/1e3)},n.prototype.update=function(t,e){this.bytes+=t,this.onlineSpeed=Math.round(e/1e3)},n}(),O=function(){function t(){r(this,t),this.host=void 0,this.bandwidthRate=1,this.priority=0,this.onlineSpeed=-1,this.lastRetryTime=-1,this.loadedSize=0,this.progressCbCount=0,this.totalBytes=0}return t.prototype.valid=function(){return void 0!==this.host},t.prototype.update=function(t){t.host&&(t.host!==this.host&&(this.host=t.host),t.bandwidthRate!==this.bandwidthRate&&(this.bandwidthRate=t.bandwidthRate),t.priority!==this.priority&&(this.priority=t.priority))},t.prototype.sameHost=function(t){return t.host===this.host},t.prototype.log=function(t){Y.b.info(t+": host="+this.host+", priority="+this.priority+", bandwidthRate="+this.bandwidthRate+", speed="+this.onlineSpeed/1024+" kbps")},t.prototype.updateBasicInfo=function(t,e,i){this.onlineSpeed=t,this.loadedSize=e,this.lastRetryTime=i},t.prototype.updateProgressCbCount=function(t){this.progressCbCount=t},t.prototype.updateTotalBytes=function(t){this.totalBytes+=t},t.prototype.updateLoadedSize=function(t){this.loadedSize=t},t}(),F=function(){function e(t){r(this,e),this.cdnNodes=[],this.startSn=t,this.endSn=void 0,this.currentIndex=-1,this.cdnRetryTimes=0,this.lastCdnSelectTime=0,this.switchingCdnInPorgress=!1,this.minPriority=-1}return e.prototype.valid=function(){return!isNaN(this.startSn)&&!isNaN(this.endSn)},e.prototype.overlap=function(t){var e=!1;return this.valid()&&t.valid()&&(this.endSn<t.startSn||this.startSn>t.endSn||(e=!0)),e},e.prototype.less=function(t){var e=!1;return this.valid()&&t.valid()&&this.endSn<t.startSn&&(e=!0),e},e.prototype.greater=function(t){var e=!1;return this.valid()&&t.valid()&&this.startSn>t.endSn&&(e=!0),e},e.prototype.sameHosts=function(t){var i=!1;return this.valid()&&t.valid()&&this.cdnNodes.length===t.cdnNodes.length&&(i=!0,this.cdnNodes.forEach(function(e){i=i&&t.cdnNodes.some(function(t){return e.sameHost(t)})})),i},e.prototype.updateOverLap=function(t){this.overlap(t)&&(this.endSn!==t.endSn&&(this.endSn=t.endSn),this.sameHosts(t)?this.cdnNodes.forEach(function(e){t.cdnNodes.forEach(function(t){e.sameHost(t)&&e.update(t)})}):(this.cdnNodes=t.cdnNodes,this.currentIndex=-1,this.cdnRetryTimes=0,this.lastCdnSelectTime=0,this.switchingCdnInPorgress=!1,this.minPriority=-1))},e.prototype.located=function(t){var e=!1;return t>=this.startSn&&t<=this.endSn&&(e=!0),e},e.prototype.selectCdn=function(t){var e=this.currentIndex,i=performance.now()-this.lastCdnSelectTime;return!this.switchingCdnInPorgress&&5e3<=i&&(-1===(e=this.selectCdnByTrytime_())&&(e=this.selectCdnByPriority_(t)),-1===e&&(e=this.selectCdnByBitrate_()),-1!==e&&(this.cdnNodes[e].lastRetryTime=performance.now(),this.lastCdnSelectTime=this.cdnNodes[e].lastRetryTime),this.currentIndex=e),-1!==e?this.cdnNodes[e].host:""},e.prototype.getActiveCdn=function(){var t=null;return 0<this.cdnNodes.length&&-1!=this.currentIndex&&(t=this.cdnNodes[this.currentIndex]),t},e.prototype.setSwitching=function(t){this.switchingCdnInPorgress=t},e.prototype.selectCdnByTrytime_=function(){for(var t=-1,e=0,i=0;i<this.cdnNodes.length;i++){var n=this.cdnNodes[i];if(-1===n.lastRetryTime){t=i;break}var r=performance.now()-n.lastRetryTime;6e4<r&&e<r&&(e=r,t=i)}return-1!==t&&Y.b.debug("select cdn by time"),t},e.prototype.selectCdnByPriority_=function(t){var e=-1,i=-1,n=0;this.minPriority=-1;for(var r=0;r<this.cdnNodes.length;r++){var a=this.cdnNodes[r];if(a.onlineSpeed>=t*a.bandwidthRate){if(n+=1,-1===i){i=r,this.minPriority=a.priority;continue}a.priority<this.cdnNodes[i].priority&&(i=r,n=1,this.minPriority=a.priority)}}return 1===n&&-1!==i&&(e=i,Y.b.debug("select cdn by priority")),e},e.prototype.selectCdnByBitrate_=function(){for(var t=-1,e=-1,i=0;i<this.cdnNodes.length;i++){var n=this.cdnNodes[i];-1!==e?-1!==this.minPriority&&this.minPriority!==n.priority||n.onlineSpeed>this.cdnNodes[e].onlineSpeed&&(e=i):-1!==this.minPriority&&this.minPriority!==n.priority||(e=i)}return-1!==e&&(t=e,Y.b.debug("select cdn by bitrate")),t},e.prototype.getPreferCdn=function(t,e,i,n){var r=this.currentIndex,a=1.5*t*e,s=Number.MAX_VALUE;if(0===n){for(var o=0,l=this.cdnNodes.length-1;0<=l;l--)if(l!==this.currentIndex&&0<this.cdnNodes[l].onlineSpeed){var u=2*a/this.cdnNodes[l].onlineSpeed;o+=1,u<s&&(s=u,r=l)}0===o&&(r=(this.currentIndex+1)%this.cdnNodes.length)}else{var h=(a-8*i)/n;if(1.5<=h){for(var c=-1,d=this.cdnNodes.length-1;0<=d;d--){if(d!==this.currentIndex&&0<this.cdnNodes[d].onlineSpeed){var f=2*a/this.cdnNodes[d].onlineSpeed;1,f<s&&(s=f)<=h/2&&(r=d)}-1===c&&-1===this.cdnNodes[d].onlineSpeed&&(c=d)}4<h&&-1!==c&&(r=c)}}return r},e.prototype.log=function(e){Y.b.log(e+": multiNodes: startSn="+this.startSn+", endSn="+this.endSn+", number="+this.cdnNodes.length),this.cdnNodes.forEach(function(t){t.log(e+"\t")})},e.prototype.logSwitchInfo=function(){Y.b.log("switchingCdnInPorgress="+this.switchingCdnInPorgress+", cdnRetryTimes="+this.cdnRetryTimes)},e}(),B=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"main";r(this,e),this.multiCdnNodes=[],this.type=t}return e.prototype.expireNodes_=function(t){for(var e=-1,i=this.multiCdnNodes.length-1;0<=i;i--)if(this.multiCdnNodes[i].endSn<t-10){e=i;break}-1!==e&&this.multiCdnNodes.splice(0,e+1)},e.prototype.updateNodes=function(t,e,i){for(t&&this.expireNodes_(e);!(i.length<=0);){if(0===this.multiCdnNodes.length){this.multiCdnNodes=this.multiCdnNodes.concat(i);break}var n=i[0],r=this.multiCdnNodes[this.multiCdnNodes.length-1];if(n.greater(r)){Y.b.log("There large gap when updating playlist"),this.multiCdnNodes=this.multiCdnNodes.concat(i);break}for(var a=-1,s=this.multiCdnNodes.length-1;0<=s;s--){var o=this.multiCdnNodes[s];n.overlap(o)&&(o.updateOverLap(n),a=s)}if(-1===a)break;if(this.multiCdnNodes.splice(0,a),1<=i.length){i.length<this.multiCdnNodes.length&&Y.b.warn("merge cdn node error");for(s=0;s<this.multiCdnNodes.length;s++)this.multiCdnNodes[s].endSn=i[s].endSn;this.multiCdnNodes=this.multiCdnNodes.concat(i.slice(this.multiCdnNodes.length))}break}},e.prototype.findMultiNode=function(t){for(var e=-1,i=this.multiCdnNodes.length-1;0<=i;i--)if(this.multiCdnNodes[i].located(t)){e=i;break}return e},e.prototype.log=function(){Y.b.log("playlistNode type=: "+this.type+", multiNode number= "+this.multiCdnNodes.length),this.multiCdnNodes.forEach(function(t){t.log(prefix+"\t")})},e}(),G=function(){function e(t){r(this,e),this.hls=t,this.playlistCdnNodes=[],this.live=!1,this.switchInDownloadProgress=!1,this.cdnInfos={}}return e.prototype.destroy=function(){this.hls=null,this.playlistCdnNodes=[],this.live=!1,this.switchInDownloadProgress=!1,this.cdnInfos={}},e.prototype.getPlaylistNode=function(t){var e=this.findPlaylistNode_(t);if(-1===e){var i=new B(t);this.playlistCdnNodes.push(i),e=this.playlistCdnNodes.length-1}return this.playlistCdnNodes[e]},e.prototype.findPlaylistNode_=function(t){for(var e=-1,i=this.playlistCdnNodes.length-1;0<=i;i--)this.playlistCdnNodes[i].type===t&&(e=i);return e},e.prototype.updateCdnInfos_=function(t){t.forEach(function(t){t.cdnNodes.forEach(function(t){null==this.cdnInfos[t.host]&&(this.cdnInfos[t.host]=new N(t.host,t.priorty,t.bandwidthRate))}.bind(this))}.bind(this))},e.prototype.isActive=function(t){return-1!==this.findPlaylistNode_(t)},e.prototype.updateMultiCdnNodes=function(t,e,i,n){this.updateCdnInfos_(n),this.live=e,this.getPlaylistNode(t).updateNodes(e,i,n)},e.prototype.printPlaylistNodes=function(t,e){if(e){var i=this.findPlaylistNode_(t);this.playlistCdnNodes(i).log()}},e.prototype.selectCdn_=function(t,e,i){var n="";do{if(!this.isActive(t))break;if(null==e||null==t)break;var r=this.getPlaylistNode(t),a=r.findMultiNode(e);if(-1===a){Y.b.log("There are no multiNode for this sn");break}var s=r.multiCdnNodes[a];n=s.selectCdn(i),Y.b.debug("selectCdn: startSn="+s.startSn+", endSn="+s.endSn+", host="+n),""==n&&Y.b.debug("cannot find cdn with exist strategy. host is empty");break}while(0);return n},e.prototype.rewriteUrlByCdnCtrls=function(t,e){if(this.isActive(t.type)){var i=this.selectCdn_(t.type,t.sn,e);""!==i&&(t.url=this.reCreateRequestUrl_(i,t.baseurl,t.relurl,!1))}},e.prototype.rewriteImageUrlByCdnCtrls=function(t,e,i){var n=i;if(this.isActive(t)){var r=this.selectCdn_(t,e,0);""!==r&&(n=this.reCreateRequestUrl_(r,i,i,!1))}return n},e.prototype.reCreateRequestUrl_=function(t,e,i,n){var r=i,a=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,s=a.exec(i);if(null===s){var o=(s=a.exec(e))[5].lastIndexOf("/");r=-1===o?s[1]+":"+s[2]+t+"/"+i:s[1]+":"+s[2]+t+"/"+s[5].substr(0,o)+"/"+i}else r=s[1]+":"+s[2]+t+"/"+s[5];return!0===n&&(r=r+"?time="+performance.now()),r},e.prototype.getPreferCdn=function(t,e,i,n,r,a){var s="";do{if(!this.isActive(t)||0==this.switchInDownloadProgress)break;if(null==e||null==t)break;var o=this.getPlaylistNode(t);if(-1===(u=o.findMultiNode(e))){Y.b.log("There are no multiNode for this sn");break}var l=o.multiCdnNodes[u],u=l.getPreferCdn(i,n,r,a);Y.b.debug("getPreferCdn: startSn="+l.startSn+", endSn="+l.endSn+", host="+s),""==(s=-1!==u?l.cdnNodes[u].host:"")&&Y.b.debug("cannot find cdn with exist strategy. host is empty");break}while(0);return s},e.prototype.getMultiCdnNode=function(t,e){var i=null;do{if(!this.isActive(t))break;if(null==e||null==t)break;var n=this.getPlaylistNode(t),r=n.findMultiNode(e);if(-1===r){Y.b.log("There are no multiNode for this sn");break}i=n.multiCdnNodes[r];break}while(0);return i},e.prototype.updateErrLoadInfo=function(t,e){var i=this.getMultiCdnNode(t,e);if(null!=i){var n=i.getActiveCdn();null!=n&&(n.onlineSpeed=0,n.lastRetryTime=performance.now(),n.loadedSize=0,n.progressCbCount=0,null!=this.cdnInfos[n.host]&&this.cdnInfos[n.host].update(n.loadedSize,n.onlineSpeed))}},e.prototype.updateTimeoutLoadInfo=function(t,e,i,n,r,a){var s=this.getMultiCdnNode(t,e);if(null!=s){var o=s.getActiveCdn();null!=o&&(o.onlineSpeed=o.onlineSpeed/20,o.lastRetryTime=performance.now(),o.loadedSize=0,o.progressCbCount=0,null!=this.cdnInfos[o.host]&&this.cdnInfos[o.host].update(o.loadedSize,o.onlineSpeed))}},e.prototype.updateSucLoadInfo=function(t,e,i,n){var r=this.getMultiCdnNode(t,e);if(null!=r){r.cdnRetryTimes=0;var a=r.getActiveCdn();null!=a&&(a.onlineSpeed=i,a.lastRetryTime=performance.now(),a.loadedSize=0,a.progressCbCount=0,a.totalBytes+=n,null!=this.cdnInfos[a.host]&&this.cdnInfos[a.host].update(a.loadedSize,a.onlineSpeed))}},e.prototype.updateProgressLoadInfo=function(t,e,i,n,r){var a=this.getMultiCdnNode(t,e);if(null!=a){var s=a.getActiveCdn();null!=s&&(s.onlineSpeed=-1===i?s.onlineSpeed:i,s.lastRetryTime=-1===r?s.lastRetryTime:r,s.loadedSize=n,s.progressCbCount+=1,null!=this.cdnInfos[s.host]&&this.cdnInfos[s.host].update(s.loadedSize,s.onlineSpeed))}},e.prototype.getCdnsBytes=function(){var e=[];return Object.keys(this.cdnInfos).forEach(function(t){e.push(this.cdnInfos[t])}.bind(this)),e},e}(),j=new RegExp([/Impression\s*=\s*(.+)/.source,/|creativeView\s*=\s*(.+)/.source,/|slotImpression\s*=\s*(.+)/.source,/|defaultImpression\s*=\s*(.+)/.source,/|defaultClick\s*=\s*(.+)/.source,/|trackClick\s*=\s*(.+)/.source,/|slotEnd\s*=\s*(.+)/.source,/|start\s*=\s*(.+)/.source,/|firstQuartile\s*=\s*(.+)/.source,/|midPoint\s*=\s*(.+)/.source,/|thirdQuartile\s*=\s*(.+)/.source,/|complete\s*=\s*(.+)/.source,/|click\s*=\s*(.+)/.source,/|(.+)\s*=\s*(.+)/.source].join(""),"gi"),H=new RegExp([/\s*(start|keep|stop)\s*/.source,/|\s*(PreStart|PostStop)\s*/.source].join(""),"g"),V=function(){function t(){n(this,t),this.clear()}return t.prototype.validate=function(){return null!==this.snBegin},t.prototype.clear=function(){this.snBegin=null,this.snTrackEnd=null,this.snSlotEnd=null,this.snStitchEnd=null,this.trackBegin=null,this.trackEnd=null},t}(),W=function(){function t(){n(this,t),this.clear()}return t.prototype.clear=function(){this.defaultImpression=[],this.impression=[],this.creativeView=[],this.start=[],this.firstQuartile=[],this.midPoint=[],this.thirdQuartile=[],this.complete=[],this.slotImpression=[],this.slotEnd=[],this.defaultClick=[],this.tracktClick=[],this.click=[]},t}(),z=0,K=1,q=2,Z=4,Q=function(){function t(){n(this,t),this.id=null,this.timeline=new V,this.noticeSlices=new W,this.firstInStitch=!1,this.firstInSlot=!1,this.lastInStitch=!1,this.lastInSlot=!1,this.update=K,this.firsted=!1,this.firstQuartiled=!1,this.midPointed=!1,this.thirdQuartiled=!1,this.completed=!1}return t.prototype.clear=function(){this.id=null,this.timeline.clear(),this.noticeSlices.clear(),this.firstInStitch=!1,this.firstInSlot=!1,this.lastInStitch=!1,this.lastInSlot=!1,this.update=K,this.firsted=!1,this.firstQuartiled=!1,this.midPointed=!1,this.thirdQuartiled=!1,this.completed=!1},t.prototype.validate=function(){return null!==this.id&&this.timeline.validate()},t.prototype.merge=function(t){var e=z;return this.id!==t.id?(Y.b.error("merge: different id."),!1):(this.timeline.snBegin=t.timeline.snBegin,this.timeline.snTrackEnd=t.timeline.snTrackEnd,this.timeline.snSlotEnd=t.timeline.snSlotEnd,this.timeline.snStitchEnd=t.timeline.snStitchEnd,this.timeline.trackBegin=t.timeline.trackBegin,this.timeline.trackEnd=t.timeline.trackEnd,this.lastInStitch!==t.lastInStitch&&(this.lastInStitch=t.lastInStitch,this.update+=Z),this.lastInSlot!==t.lastInSlot&&(this.lastInSlot=t.lastInSlot,this.update+=q),e===z)},t.prototype.hasUpdateBit=function(t){return(this.update&~t)===t},t.prototype.recoverUpdateBit=function(t){this.update=~(~this.update|t)},t.prototype.getNotices=function(t,e,i){var n={clearAd:!1,eventAd:[],defaultClickAd:[],trackClickAd:[],clickAd:[],stage:-1,end:"unknown"};if(this.id===t&&e>=this.timeline.snBegin){H.lastIndex=0;var r=H.exec(i.type);if(null!==r)if(r[1])if(this.timeline.snTrackEnd&&e<=this.timeline.snTrackEnd||null===this.timeline.snTrackEnd)if("start"===i.type)this.getStartNotices(n);else if("keep"===i.type){var a=(i.duration-i.timeLeft)/i.duration;(a=100*a.toFixed(2))<=15&&!1===this.firsted?(shaka.log.warning("Fill ad start when keep <= 15"),this.firsted=!0,this.getStartNotices(n),n.end="multitude"):this.getKeepNotices(a,n)}else"stop"===i.type&&this.getStopNotices(n);else if(0===i.duration&&"stop"===i.type){var s=e-1;this.timeline.snStitchEnd&&s===this.timeline.snStitchEnd&&(n.clearAd=!0,n.stage=1,n.end="single")}else Y.b.warn("getNotices: sn error with geob 'start/keep/stop'");else if(r[2])if("PreStart"===i.type);else if("PostStop"===i.type){var o=e-1;this.timeline.snStitchEnd&&o===this.timeline.snStitchEnd&&(n.clearAd=!0,n.stage=1,n.end="single")}}return n},t.prototype.getStartNotices=function(t){if(!1===this.firsted){t.clearAd=!0;var e=[];0<this.noticeSlices.defaultImpression.length&&(e=e.concat(this.noticeSlices.defaultImpression)),0<this.noticeSlices.impression.length&&(e=e.concat(this.noticeSlices.impression)),0<this.noticeSlices.creativeView.length&&(e=e.concat(this.noticeSlices.creativeView)),0<this.noticeSlices.start.length&&(e=e.concat(this.noticeSlices.start)),0<this.noticeSlices.slotImpression.length&&!0===this.firstInSlot&&(e=e.concat(this.noticeSlices.slotImpression)),0<e.length&&t.eventAd.push({type:"0",urls:e}),0<this.noticeSlices.defaultClick.length&&(t.defaultClickAd=this.noticeSlices.defaultClick),0<this.noticeSlices.tracktClick.length&&(t.trackClickAd=this.noticeSlices.tracktClick),0<this.noticeSlices.click.length&&(t.clickAd=this.noticeSlices.click),this.firsted=!0,t.stage=0,t.end="single",Y.b.debug("getNotices: 0 event.")}},t.prototype.getStopNotices=function(t){if(!0===this.firsted){if(!1===this.completed){var e=[];0<this.noticeSlices.complete.length&&(e=e.concat(this.noticeSlices.complete)),0<this.noticeSlices.slotEnd.length&&!0===this.lastInSlot&&(e=e.concat(this.noticeSlices.slotEnd)),this.completed=!0,t.stage=1,0<e.length&&t.eventAd.push({type:"1",urls:e})}t.clearAd=!0,t.end="single",Y.b.debug("getNotices: 1 event.")}else Y.b.warn("getNotices: drop ad stop, because lost ad start")},t.prototype.getKeepNotices=function(t,e){do{if(!0===this.firsted){if(25<=(t=100*t.toFixed(2))&&!1===this.firstQuartiled&&0<this.noticeSlices.firstQuartile.length&&(this.firstQuartiled=!0,e.stage=.25,Y.b.debug("getNotices: 1/4 event."),e.eventAd.push({type:"1/4",urls:this.noticeSlices.firstQuartile}),e.end="single"),50<=t&&!1===this.midPointed&&0<this.noticeSlices.midPoint.length){if("single"===e.end){e.end="multitude";break}this.midPointed=!0,Y.b.debug("getNotices: 1/2 event."),e.stage=.5,e.eventAd.push({type:"1/2",urls:this.noticeSlices.midPoint}),e.end="single"}if(75<=t&&!1===this.thirdQuartiled&&0<this.noticeSlices.thirdQuartile.length){if("single"===e.end){e.end="multitude";break}this.thirdQuartiled=!0,Y.b.debug("getNotices: 3/4 event."),e.stage=.75,e.eventAd.push({type:"3/4",urls:this.noticeSlices.thirdQuartile}),e.end="single"}}else Y.b.warn("drop ad 1 > keep >= 0.15, because lost ad start");break}while(0)},t.prototype.parseNoticeValue=function(t,e){if(null!==this.id||!1!==e){var i=t.trim();j.lastIndex=0;var n=j.exec(i);null!==n&&(n[1]?this.noticeSlices.impression.push(n[1].trim()):n[2]?this.noticeSlices.creativeView.push(n[2].trim()):n[3]?this.noticeSlices.slotImpression.push(n[3].trim()):n[4]?this.noticeSlices.defaultImpression.push(n[4].trim()):n[5]?this.noticeSlices.defaultClick.push(n[5].trim()):n[6]?this.noticeSlices.tracktClick.push(n[6].trim()):n[7]?this.noticeSlices.slotEnd.push(n[7].trim()):n[8]?this.noticeSlices.start.push(n[8].trim()):n[9]?this.noticeSlices.firstQuartile.push(n[9].trim()):n[10]?this.noticeSlices.midPoint.push(n[10].trim()):n[11]?this.noticeSlices.thirdQuartile.push(n[11].trim()):n[12]?this.noticeSlices.complete.push(n[12].trim()):n[13]?this.noticeSlices.click.push(n[13].trim()):Y.b.warn("parseNoticeValue: unknown tag: "+t))}else Y.b.warn("parseNoticeValue: empty track id with track. drop TAG: "+t)},t.prototype.getTrackBeginSn=function(){return this.timeline.snBegin},t.prototype.getTrackEndSn=function(){return this.timeline.snTrackEnd},t.prototype.getSlotEndSn=function(){return this.timeline.snSlotEnd},t.prototype.getStitchEndSn=function(){return this.timeline.snStitchEnd},t.prototype.getTrackBegin=function(){return this.timeline.trackBegin},t.prototype.getTrackEnd=function(){return this.timeline.trackEnd},t.isAdType=function(t){return H.lastIndex=0,null!==H.exec(t)},t}(),J=function(){function t(){n(this,t),this.inStitch=!1,this.inSlot=!1,this.inTrack=!1,this.inStitchCount=0,this.inSlotCount=0,this.inTrackCount=0}return t.prototype.clear=function(){this.inStitch=!1,this.inSlot=!1,this.inTrack=!1,this.inStitchCount=0,this.inSlotCount=0,this.inTrackCount=0},t.prototype.setInStitch=function(t){t&&this.inStitch&&Y.b.warn("AdPlaylistDebug: There are continuous tag EXT-X-CST-AD-STITCH-START."),t||this.inStitch||0===this.inStitchCount||Y.b.warn("AdPlaylistDebug: There are continuous tag EXT-X-CST-AD-STITCH-END."),(this.inStitch=t)&&this.inStitchCount++,!1===t&&(this.inSlot=!1)},t.prototype.setInSlot=function(t){t&&this.inSlot&&Y.b.warn("AdPlaylistDebug: There are continuous tag EXT-X-CST-AD-SLOT-START."),t||this.inSlot||0===this.inSlotCount||Y.b.warn("AdPlaylistDebug: There are continuous tag EXT-X-CST-AD-SLOT-END."),this.inSlot=t,(this.inSlot=t)&&this.inSlotCount++,!1===t&&(this.inTrack=!1)},t.prototype.setInTrack=function(t){this.inTrack=t},t}(),$=function(){function e(t){n(this,e),this.id=t,this.startPostNum=0,this.firstQuartiledPostNum=0,this.midPostNum=0,this.thirdQuartiledPostNum=0,this.endPostNum=0,this.postedEndPostNum=0,this.startTriggerNum=0,this.firstQuartiledTriggerNum=0,this.midTriggerNum=0,this.thirdQuartiledTriggerNum=0,this.endTriggerNum=0,this.postedEndTriggerNum=0}return e.prototype.addNumber=function(t,e){0===t&&(this.startPostNum+=e,this.startTriggerNum+=1),.25===t&&(this.firstQuartiledPostNum+=e,this.firstQuartiledTriggerNum+=1),.5===t&&(this.midPostNum+=e,this.midTriggerNum+=1),.75===t&&(this.thirdQuartiledPostNum+=e,this.thirdQuartiledTriggerNum+=1),1===t&&(this.endPostNum+=e,this.endTriggerNum+=1)},e.prototype.printAdStitistic=function(){Y.b.debug("adId= "+this.id),Y.b.debug("Post startPostNum="+this.startPostNum+", firstQuartiled="+this.firstQuartiledPostNum+", midPostNum="+this.midPostNum+", thirdQuartiledPostNum="+this.thirdQuartiledPostNum+", endPostNum="+this.endPostNum+", postedEndPostNum="+this.postedEndPostNum),Y.b.debug("Trigger startPostNum="+this.startTriggerNum+", firstQuartiled="+this.firstQuartiledTriggerNum+", midTriggerNum="+this.midTriggerNum+", thirdQuartiledTriggerNum="+this.thirdQuartiledTriggerNum+", endTriggerNum="+this.endTriggerNum+", postedEndTriggerNum="+this.postedEndTriggerNum)},e}(),tt={search:function(t,e){for(var i=0,n=t.length-1,r=null,a=null;i<=n;){var s=e(a=t[r=(i+n)/2|0]);if(0<s)i=r+1;else{if(!(s<0))return a;n=r-1}}return null}},et={hexDump:function(t){var e,i="";for(e=0;e<t.length;e++){var n=t[e].toString(16);n.length<2&&(n="0"+n),i+=n}return i}},it=i(11),nt=i.n(it),rt=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),at=function(){function t(){a(this,t),this.lastId=null,this.lastStage=-1,this.lastSn=-1,this.maxDelay=-1,this.maxDelayThreshold=.3,this.addCueCount=0,this.showCueCount=0}return t.prototype.isInit=function(){return null!==this.lastId},t.prototype.clear=function(){this.lastId=null,this.lastStage=-1,this.lastSn=-1,this.maxDelay=-1,this.maxDelayThreshold=.2,this.addCueCount=0,this.showCueCount=0},t.prototype.refresh=function(t,e,i){this.lastId=e,this.lastStage=t,this.lastSn=i},t.prototype.increaseAddCount=function(){this.addCueCount++},t.prototype.increaseShowCount=function(){this.showCueCount++,Y.b.warn("TrackChecker: addCueCount="+this.addCueCount+", showCueCount="+this.showCueCount)},t.prototype.updateMaxDelay=function(t,e){var i=Math.abs(e-t);i>this.maxDelay&&(this.maxDelay=i),this.maxDelay>this.maxDelayThreshold&&Y.b.warn("TrackChecker: delay overflow. currentDelay="+i+", maxDelay="+this.maxDelay+", mediaTime="+t+", cueTime="+e)},t}(),st=function(i){function n(t){a(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.ADVERTISEMENT_LOADED));return e.id3Track=void 0,e.media=void 0,e.adTracks=[],e.adEmptyTracks=[],e.snPremier=null,e.live=!0,e.cueThreshold=1,e.checker=new at,e.timer=null,e.dealAdByInner=!1,e.eventAds={ads:[],others:[]},e.adStatistics={},e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.id3Track=void 0,this.media=void 0,this.adTracks=[],this.adEmptyTracks=[],this.snPremier=null,this.live=!0,this.cueThreshold=1,this.checker=null,this.timer&&(clearTimeout(this.timer),this.timer=null),this.dealAdByInner=!1,this.eventAds={ads:[],others:[]},this.adStatistics={},x.prototype.destroy.call(this)},n.prototype.mergeAdlist=function(t,e,i,n,r,a){this._setSegmentPremier(t),this._expireAdlist(t),this.refresh=a;do{if(r.isolate&&0<this.adTracks.length&&(null===this.adTracks[this.adTracks.length-1].timeline.snStitchEnd&&(this.adTracks[this.adTracks.length-1].timeline.snStitchEnd=r.sn,this.adTracks[this.adTracks.length-1].lastInStitch=!0),null===this.adTracks[this.adTracks.length-1].timeline.snSlotEnd&&(this.adTracks[this.adTracks.length-1].timeline.snSlotEnd=r.sn),null===this.adTracks[this.adTracks.length-1].timeline.snTrackEnd&&(this.adTracks[this.adTracks.length-1].timeline.snTrackEnd=r.sn)),0===e.length||null===e[0].id||null===e[0].timeline.snBegin)break;if(0===this.adTracks.length){this.adTracks=this.adTracks.concat(e);break}var s=e[0],o=this._searchBegin(s);if(!1===o.find){if(s.timeline.snBegin<=this.adTracks[0].timeline.snBegin)s.timeline.snBegin<this.adTracks[0].timeline.snBegin&&Y.b.error("mergeAdlist(Trace ad): merge error. m3u8 loop"),this._expireAdlist(-1);else if(0<this.adTracks.length){var l=this.adTracks[this.adTracks.length-1];l.timeline.snTrackEnd?l.timeline.snTrackEnd<s.timeline.snBegin?Y.b.warn("mergeAdlist(Trace ad): large gap when m3u8 update"):(Y.b.error("mergeAdlist(Trace ad): assert(code error in no find branch)"),this._expireAdlist(-1)):(Y.b.warn("mergeAdlist(Trace ad): meet a long time advertisement, time than dvrduration"),n.isolate?l.timeline.snTrackEnd=n.sn:l.timeline.snTrackEnd=s.timeline.snBegin-1)}this.adTracks=this.adTracks.concat(e)}else{var u=o.targetSeg;Y.b.warn("mergeAdlist(Trace ad): targetSeg. beginSn="+u.timeline.snBegin),u.snTrackEnd&&Y.b.warn("mergeAdlist(Trace ad): targetSeg. endSn="+u.timeline.snTrackEnd);for(var h=!1,c=o.index;c<this.adTracks.length;c++)if(0<e.length){if(e[0].id!==this.adTracks[c].id){Y.b.error("mergeAdlist(Trace ad): assert(id must same)");break}if(!1===h&&(e[0].timeline.snBegin>this.adTracks[c].timeline.beginSn&&(e[0].timeline.snBegin=this.adTracks[c].timeline.beginSn),h=!0),e[0].timeline.snBegin!==this.adTracks[c].timeline.snBegin){Y.b.error("mergeAdlist(Trace ad): assert(code error in find branch)");break}this.adTracks[c].merge(e[0]),e.shift()}0<e.length&&(this.adTracks=this.adTracks.concat(e))}Y.b.warn("mergeAdlist(After merge)(Trace ad): length="+this.adTracks.length),this._printAdlist("mergeAdlist(After merge)(Trace ad)",this.adTracks);break}while(0);this.updateAdRanges(),this.adEmptyTracks=[],this.adEmptyTracks=this.adEmptyTracks.concat(i),this.noticeEmptySlice(),e=[],i=[]},n.prototype.updateAdRanges=function(){if(0<this.adTracks.length){for(var t=[],e=0;e<this.adTracks.length;e++)this.adTracks[e].id&&t.push({id:this.adTracks[e].id,start:this.adTracks[e].timeline.trackBegin/1e3,end:this.adTracks[e].timeline.trackEnd?this.adTracks[e].timeline.trackEnd/1e3:null});this.hls.trigger(M.a.ADVERTISEMENT_RANGE_UPDATE,t)}},n.prototype.noticeEmptySlice=function(){if(0<this.adEmptyTracks.length){var i=[];this.adEmptyTracks.forEach(function(t){var e=[];0<t.noticeSlices.slotImpression.length&&(e=e.concat(t.noticeSlices.slotImpression)),0<t.noticeSlices.slotEnd.length&&(e=e.concat(t.noticeSlices.slotEnd)),i.push({type:"hls",time:t.timeline.trackEnd/1e3,urls:e})}),this.hls.trigger(M.a.EMPTY_ADVERTISEMENT_UPLOAD,i)}},n.prototype._binarySearchBegin=function(e){return tt.search(this.adTracks,function(t){return t.timeline.snBegin>e.timeline.snBegin?-1:e.timeline.snBegin===t.timeline.snBegin?0:1})},n.prototype._searchBegin=function(t){for(var e={find:!1,targetSeg:null,index:-1},i=Number.MAX_VALUE,n=this.adTracks.length-1;0<=n;n--){var r=this.adTracks[n];t.id===r.id&&t.timeline.snBegin>=r.timeline.snBegin&&(null===r.timeline.snTrackEnd||r.timeline.snTrackEnd&&t.timeline.snTrackEnd)&&t.timeline.snBegin-r.timeline.snBegin<i&&(i=t.timeline.snBegin-r.timeline.snBegin,e.find=!0,e.targetSeg=this.adTracks[n],e.index=n)}return e},n.prototype._printAdlist=function(t,e){for(var i=0;i<e.length;i++)Y.b.warn("\t"+t+": adId="+e[i].id+", snBegin="+e[i].timeline.snBegin+", endSn="+e[i].timeline.snTrackEnd)},n.prototype.onMediaAttached=function(t){this.media=t.media,this.media},n.prototype.onMediaDetaching=function(){this.media=void 0},n.prototype.onAdvertisementLoaded=function(){},n.prototype.trigAdvertiseInSegment=function(t,e,i){var n=0;if(this._empty())n=-2;else if("GEOB"===e.key){var r=et.hexDump(e.data),a=this._hexCharCodeToStr(r),s=a.lastIndexOf("<?xml");if(0<=s){var o=a.slice(s),l=nt.a.parse(o);if(void 0!==l["ad-list"]){var u={type:null,adId:null,timeLeft:null,duration:null};l["ad-list"][0].cueType&&(u.type=l["ad-list"][0].cueType),l["ad-list"][0].id&&(u.adId=l["ad-list"][0].id),isNaN(l["ad-list"][0].timeLeft)||(u.timeLeft=l["ad-list"][0].timeLeft),isNaN(l["ad-list"][0].duration)||(u.duration=l["ad-list"][0].duration),Y.b.debug("trigAdvertiseInSegment(Trace ad): startTime="+t+". type="+u.type+". left/duration="+u.timeLeft+"/"+u.duration+". fragmentSn="+i.sn),u.type&&(Q.isAdType(u.type)?(this._createAdvertiseTrack(),this._addCues(t,u,i.sn)):n=-2)}}}return n},n.prototype._addCues=function(t,e,i){var n=this._findTrack(e,i);if(n){Y.b.debug("_addCues(Trace ad): findTrack suc");for(var r=this._addCueForTrigger(n,t,e,i);"multitude"==r.end;)r=this._addCueForTrigger(n,t,e,i)}},n.prototype._addCueForTrigger=function(t,e,i,n){var r=t.getNotices(t.id,n,i);if(this._checkStage(r,t.id,n),0===r.stage){var a={adid:t.id,urls:[]};r.defaultClickAd.forEach(function(t){a.urls.push({type:"defaultClick",url:t})}),r.trackClickAd.forEach(function(t){a.urls.push({type:"trackClick",url:t})}),r.clickAd.forEach(function(t){a.urls.push({type:"click",url:t})}),this._addUploadCue(e,n,t.id,r.stage,{type:"ADSTART",data:a})}return 1===r.stage&&this._addUploadCue(e,n,t.id,r.stage,{type:"ADEND",data:{adid:t.id}}),0<r.eventAd.length&&this._addInnerCue(e,n,t.id,r),this._addAdStatistics(t.id,r),r},n.prototype._addAdStatistics=function(e,i){-1!==i.stage&&e&&(null==this.adStatistics[e]&&(this.adStatistics[e]=new $(e)),Object.keys(i.eventAd).forEach(function(t){this.adStatistics[e].addNumber(i.stage,i.eventAd[t].urls.length)}.bind(this)))},n.prototype._printAdStatistics=function(){Y.b.warn("_printAdStatistics(Trace ad): adLength= "+Object.keys(this.adStatistics).length),Object.keys(this.adStatistics).forEach(function(t){this.adStatistics[t].printAdStitistic()}.bind(this))},n.prototype._addUploadCue=function(t,e,i,n,r){var a=new(window.WebKitDataCue||window.VTTCue||window.TextTrackCue)(t,t+this.cueThreshold,"");a.value="sn="+e+". type=eventAd. start="+t,a.eventAd=r,a.noticed=!1,a.lastNoticeTime=null,a.stage=n,a.trackId=i,a.adType="upload",a.sn=e,this.id3Track.addCue(a),Y.b.debug("_addCues(Trace ad): adType='upload', trackId="+a.trackId+", stage="+a.stage+", startTime="+t)},n.prototype._addInnerCue=function(t,e,i,n){var r=new(window.WebKitDataCue||window.VTTCue||window.TextTrackCue)(t,t+this.cueThreshold,"");r.value="sn="+e+". type=eventAd. start="+t,r.eventAd=n.eventAd,r.noticed=!1,r.lastNoticeTime=null,r.stage=n.stage,r.trackId=i,r.adType="inner",r.sn=e,this.id3Track.addCue(r),Y.b.warn("_addCues(Trace ad): adType='inner', trackId="+r.trackId+", stage="+r.stage+", startTime="+t+", AdSize="+r.eventAd[0].urls.length)},n.prototype._checkStage=function(t,e,i){var n=this.checker;n.isInit()&&-1!==t.stage&&this._printCheckResult(n,e,i,t.stage),-1!==t.stage&&this.checker.refresh(t.stage,e,i)},n.prototype._printCheckResult=function(t,e,i,n){var r=0===n?1:n-.25;(0===n&&e===t.lastId||0!==n&&e!==t.lastId)&&Y.b.warn("_checkStage(Trace ad): ts error. id issue. stage="+n+". lost "+r+" event. last id="+t.lastId+". id="+e+". last sn="+t.lastSn+". sn="+i),t.lastStage!==r&&Y.b.warn("_checkStage(Trace ad): ts error. stage issue. stage="+n+". lost "+r+" event. last id="+t.lastId+". id="+e+". last sn="+t.lastSn+". sn="+i)},n.prototype._findTrack=function(t,e){for(var i=null,n=this.adTracks.length-1;0<=n;n--)if("PreStart"===t.type);else if("PostStop"===t.type){var r=e-1;if(this.adTracks[n].getStitchEndSn()===r){i=this.adTracks[n],!1===this.adTracks[n].completed&&Y.b.warn("_findTrack(Trace ad): error. stop miss. fake stop message");break}}else if("stop"===t.type&&0===t.duration){var a=e-1;if(this.adTracks[n].getStitchEndSn()===a){i=this.adTracks[n],!1===this.adTracks[n].completed&&Y.b.warn("_findTrack(Trace ad): error. stop miss. fake stop message");break}}else{var s=this.adTracks[n].getTrackBeginSn(),o=this.adTracks[n].getTrackEndSn();if(o&&e<=o&&s<=e||null===o&&s<=e){i=this.adTracks[n];break}Y.b.debug("_findTrack(Trace ad): no find. sn="+e),this._printAdlist("_findTrack(Trace ad)",this.adTracks)}return i},n.prototype._createAdvertiseTrack=function(){void 0===this.id3Track&&(this.id3Track=this.media.addTextTrack("metadata","NeulionAdvertisement"),this.id3Track.addEventListener("cuechange",this._onCuechanged.bind(this)))},n.prototype._onCuechanged=function(){if(this.id3Track&&this.id3Track.activeCues)if(0<this.id3Track.activeCues.length){Y.b.debug("_onCuechanged(Trace ad): enter. currentTime="+this.media.currentTime+". activeCues length="+this.id3Track.activeCues.length);for(var t=0;t<this.id3Track.activeCues.length;t++){var e=this.id3Track.activeCues[t];if(Y.b.debug("_onCuechanged: adType="+e.adType),!1===e.noticed){if(e.noticed=!0,e.lastNoticeTime=performance.now(),Y.b.debug("_onCuechanged(Trace ad): select cue. first notice. start="+e.startTime+". currentTime="+this.media.currentTime+". adType="+e.adType),"inner"===e.adType)if(!0===this.dealAdByInner)this.eventAds.ads=this.eventAds.ads.concat(e.eventAd),this.eventAds.others.push({trackId:e.trackId,stage:e.stage,sn:e.sn}),Y.b.warn("_onCuechanged(Trace ad): trackId="+e.trackId+", stage="+e.stage+", startTime="+e.startTime+", AdSize="+e.eventAd[0].urls.length);else{for(var i={type:"ADPOST",data:{adid:e.trackId,urls:[]}},n=e.eventAd.length-1;0<=n;n--)for(var r=e.eventAd[n].urls.length-1;0<=r;r--)i.data.urls.push({type:e.eventAd[n].type,url:e.eventAd[n].urls[r]});0<i.data.urls.length&&this.hls.trigger(M.a.ADVERTISEMENT_UPLOAD,i)}else this.hls.trigger(M.a.ADVERTISEMENT_UPLOAD,e.eventAd);this.checker.updateMaxDelay(this.media.currentTime,e.startTime)}}!0===this.dealAdByInner&&null===this.timer&&(this.timer=setTimeout(this._onAdTimer.bind(this),1))}else Y.b.debug("_onCuechanged(Trace ad): error. active cue lost or dispear")},n.prototype._empty=function(){return 0===this.adTracks.length},n.prototype._setSegmentPremier=function(t){this.snPremier=t},n.prototype._expireAdlist=function(t){if(-1!==t){for(var e=0,i=this.adTracks.length-1;0<=i;i--)if(this.adTracks[i].timeline.snTrackEnd&&this.adTracks[i].timeline.snTrackEnd<this.snPremier){e=i;break}0<=(e-=3)&&this.adTracks.splice(0,e)}else this.adTracks=[]},n.prototype._hexCharCodeToStr=function(t){var e=t.trim(),i="0x"===e.substr(0,2).toLowerCase()?e.substr(2):e,n=i.length;if(n%2!=0)return"";for(var r=void 0,a=[],s=0;s<n;s+=2)r=parseInt(i.substr(s,2),16),a.push(String.fromCharCode(r));return a.join("")},n.prototype._onAdTimer=function(){for(var t=this.eventAds.ads,e=this.eventAds.others,i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.urls.length;r++){var a={type:n.type,url:n.urls[r],loader:null,trackId:e[i].trackId,sn:e[i].sn,stage:e[i].stage};this.hls.trigger(M.a.ADVERTISEMENT_LOADING,a),Y.b.debug("_onAdTimer(Trace ad): url="+n.urls[r])}this.eventAds={ads:[],others:[]},clearTimeout(this.timer),this.timer=null},rt(n,[{key:"refresh",get:function(){return this.live},set:function(t){this.live=t}}]),n}(x),ot=function t(){o(this,t),this.init=!1,this.targetDuration=0,this.absStart=0,this.curAbsStart=0,this.curAbsEnd=0,this.timeRanges=[],this.curTimeRanges=[]},lt=function(i){function n(t){o(this,n);var e=s(this,i.call(this,t,M.a.INIT_PTS_FOUND));e=s(this,i.call(this,t,M.a.INIT_FPS_FOUND));return(e=s(this,i.call(this,t,M.a.LEVEL_LOADED))).playlistTag={init:!1,mbr:!0,live:!0,neulion:!1,stitch:!1,dateTime:!1,floatInf:!1,utcTimeName:!0,byteRange:!1},e.timelineInfos={},e.curInitPTS=null,e.parseCC=!0,e.ccInfos=null,e.thumbnailTimeScale=1e3,e.lteStreamsInfos=[],e.rewindInfos=[],e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.playlistTag={init:!1,mbr:!0,live:!0,neulion:!1,stitch:!1,dateTime:!1,floatInf:!1,utcTimeName:!0,byteRange:!1},this.timelineInfos={},this.curInitPTS=null,this.parseCC=!0,this.ccInfos=null,this.thumbnailTimeScale=1e3,this.lteStreamsInfos=[],this.rewindInfos=[],x.prototype.destroy.call(this)},n.prototype.onInitPtsFound=function(t){t&&(Y.b.log("id="+t.id+", initPTS="+t.initPTS+", url="+t.frag.relurl),"main"===t.id&&(this.curInitPTS=t.initPTS))},n.prototype.onInitFpsFound=function(t){t&&t.fps&&t.frag&&t.fps.fixed_frame_rate_flag&&this.addStreamFPSForLte(t.frag.level,t.fps.time_scale/(2*t.fps.num_units_in_tick))},n.prototype.onLevelLoaded=function(){this._createLteStreamInfos()},n.prototype.setThumbnailTimeScale=function(t){this.thumbnailTimeScale=t},n.prototype.getThumbnailTimeScale=function(){return this.thumbnailTimeScale},n.prototype.getCurInitPts=function(){return this.curInitPTS},n.prototype.playlistTagInited=function(){return this.playlistTag.init},n.prototype.setPlaylistTag=function(t,e){this.playlistTag[String(t)]=e,"init"===t&&(Y.b.debug("Playlist tag:"),Object.keys(this.playlistTag).forEach(function(t){Y.b.debug("key="+t+" value="+this.playlistTag[t])}.bind(this)))},n.prototype.lteForbiddance=function(){return!(!this.playlistTag.floatInf&&!this.playlistTag.stitch&&this.playlistTag.neulion||this.playlistTag.floatInf)},n.prototype.needEditLteString=function(){return!this.lteForbiddance()&&(this.playlistTag.live||this.cvodStream())&&!this.playlistTag.floatInf},n.prototype.needReInitAudioPTS=function(){return this.playlistTag.live&&this.playlistTag.stitch},n.prototype._supportParseTimeFromUrl=function(){var t=!1;return this.playlistTag.init&&(t=this.playlistTag.neulion&&!this.playlistTag.byteRange&&this.playlistTag.utcTimeName),t},n.prototype.needParseTimeFromUrl=function(){var t=!1;return this.playlistTag.init&&(t=!this.playlistTag.floatInf&&this._supportParseTimeFromUrl()&&!this.playlistTag.stitch),t},n.prototype.liveStream=function(){return this.playlistTag.live},n.prototype.neuLiveStream=function(){return this.liveStream()&&this.neuStream()},n.prototype.cvodStream=function(){return!this.playlistTag.live&&this.playlistTag.neulion&&this.playlistTag.dateTime},n.prototype.neuStream=function(){return this.playlistTag.neulion},n.prototype.setHlsCC=function(t,e){this.parseCC=t,this.ccInfos=e},n.prototype.useHlsCC=function(){return this.parseCC},n.prototype.getHlsCC=function(){return this.ccInfos},n.prototype.getTimeline=function(t){var e=this.timelineInfos[t];return null==e&&(e=new ot,this.timelineInfos[t]=e),e},n.prototype._findTimeRanges=function(t,e){for(var i=null,n=t.length-1;0<=n;n--){var r=Math.round(e),a=Math.round(t[n].begin),s=t[n].end?Math.round(t[n].end):null;if(null===s&&a<=r||null!==s&&a<=r&&r<=s){i=t[n];break}}return i},n.prototype._existRewindTime=function(t){for(var e=!1,i=0;i<this.rewindInfos.length;i++)if(Math.abs(t-this.rewindInfos[i].timeMs)<.1){e=!0;break}return e},n.prototype._getRewindTime=function(t){for(var e=-1,i=0;i<this.rewindInfos.length;i++)if(t>=this.rewindInfos[i].timeMs){e=this.rewindInfos[i].timeMs;break}return e},n.prototype._updateRewindInfos=function(t){for(var e=0;e<t.length;e++){var i=1e3*t[e].begin;this.getFlipMod(i)<=16e3&&(this._existRewindTime(i)||(this.rewindInfos.push({timeMs:i}),this.rewindInfos.sort(function(t,e){return t.timeMs-e.timeMs})))}},n.prototype.updateTimeline=function(t,e,i,n){this._updateRewindInfos(e);var r=this._smoothTimeRanges(e);this.liveStream()||this.cvodStream()?this._updateLiveTimeline(t,r,i,n):this._updateVodTimeline(t,r,i,n),this._checkTimeline(t)},n.prototype._checkTimeline=function(t){var e=this.getTimeline(t);if(!e.init&&e.timeRanges&&1<e.timeRanges.length)for(var i=0;i<e.timeRanges.length-1;i++)if(e.timeRanges[i+1].begin<e.timeRanges[i].end){Y.b.warn("checkTimeline failed. next start("+e.timeRanges[i+1].begin+" is less than last end("+e.timeRanges[i].end+")})");break}},n.prototype._updateVodTimeline=function(t,e,i,n){var r=this.getTimeline(t);r.init||(r.targetDuration=i||0,r.absStart=0,r.curAbsStart=0,r.curAbsEnd=n,r.curTimeRanges.push({begin:0,end:n}),r.timeRanges.push({begin:0,end:n}),r.init=!0)},n.prototype._updateLiveTimeline=function(t,e,i,n){var r=this.getTimeline(t);if(r.curTimeRanges=e,r.targetDuration=i||0,0<e.length)for(var a=0;a<e.length;a++){0===a&&!1===r.init&&(r.init=!0,r.absStart=e[a].begin);var s=this._findTimeRanges(r.timeRanges,e[a].begin);null===s?(s={begin:e[a].begin,end:e[a].end},r.timeRanges.push(s)):s.end<e[a].end&&(s.end=e[a].end),0===a&&(r.curAbsStart=e[a].begin),a===e.length-1&&(r.curAbsEnd=e[a].end)}else r.curAbsEnd=n},n.prototype._smoothTimeRanges=function(t){for(var e=[],i=0;i<t.length;i++)if(0<e.length){var n=e[e.length-1];t[i].begin<=n.end&&n.end-t[i].begin<1?n.end=t[i].end:e.push({begin:t[i].begin,end:t[i].end})}else e.push({begin:t[i].begin,end:t[i].end});return e},n.prototype.getProgramDateTime=function(t,e){var i=-1,n=this.getTimeline(t);if(n.init)for(var r=n.timeRanges,a=r.length-1;0<=a;a--)e>r[a].begin&&-1===i&&(i=r[a].begin);return i},n.prototype.logTimeline=function(t,e){var i=this.getTimeline(t);if(i.init){Y.b.log(e+": timeline type="+t+", targetduration="+i.targetDuration+", absStart="+i.absStart+", curAbsStart="+i.curAbsStart+", curAbsEnd="+i.curAbsEnd),Y.b.log(e+": Range length="+i.timeRanges.length);for(var n=0;n<i.timeRanges.length;n++)Y.b.log("\t "+e+": start="+i.timeRanges[n].begin+", end="+i.timeRanges[n].end);Y.b.log(e+": Current range length="+i.curTimeRanges.length);for(var r=0;r<i.curTimeRanges.length;r++)Y.b.log("\t "+e+": start="+i.curTimeRanges[r].begin+", end="+i.curTimeRanges[r].end)}},n.prototype.absTimeToRelTime=function(t,e){var i=this.getTimeline(t),n=-1;if(i.init)for(var r=i.timeRanges,a=i.absStart,s=0,o=0;o<r.length;o++){if(0!==o&&(s+=r[o].begin-r[o-1].end),e>=r[o].begin&&e<=r[o].end){n=e-s-a;break}if(e<r[o].begin){n=r[o].begin-s-a;break}if(0!==o){if(e>r[o-1].end&&e<r[o].begin){n=r[o].begin-s-a;break}if(o===r.length-1&&e>r[o].end){n=r[o].end-s-a;break}}}return n},n.prototype.relTimeToAbsTime=function(t,e){var i=this.getTimeline(t),n=-1;if(i.init)for(var r=i.timeRanges,a=i.absStart,s=0,o=0;o<r.length;o++){0!==o&&(s+=r[o].begin-r[o-1].end);var l=r[o].begin-s-a,u=r[o].end-s-a;if(l<=e&&e<=u){n=e+s+a;break}if(e<l){n=l+s+a;break}if(0!==o){var h=s-(r[o].begin-r[o-1].end);if(r[o-1].end-h-a<e&&e<l){n=l+s+a;break}if(o===r.length-1&&u<e){n=u+s+a;break}}}return n},n.prototype.calcSubtitleInitTime=function(t){var e={initTimeMs:-1,flipDurationOffsetMs:0};return this.playlistTag.live?e=this._getSubtitleInitInfo(t):this.cvodStream()?e=this._getSubtitleInitInfo(t):this.timelineInfos&&this.timelineInfos.main&&(e.initTimeMs=1e3*this.timelineInfos.main.absStart,e.flipDurationOffsetMs=0),e},n.prototype._getTimelineGaps=function(){var t=[],e=this.getTimeline("main");if(1<e.timeRanges.length)for(var i=1;i<e.timeRanges.length;i++){var n=e.timeRanges[i],r=e.timeRanges[i-1],a=Math.abs(n.begin-r.end);.1<Math.abs(a)&&t.push({gapMs:1e3*a,timeMs:1e3*n.begin})}return t},n.prototype._getSubtitleInitInfo=function(t){var e={initTimeMs:-1,flipDurationOffsetMs:0},i=this._getTimelineGaps(),n=0,r=1e3*this.getTimeline("main").absStart,a=this._getRewindTime(t);if(e.initTimeMs=-1!==a?a:r,0<i.length)for(var s=0;s<i.length&&t>=i[s].timeMs;s++)n+=i[s].gapMs,e.initTimeMs=Math.max(i[s].timeMs,e.initTimeMs);return-1!==e.initTimeMs&&(e.flipDurationOffsetMs=e.initTimeMs-r-n),e},n.prototype.getFlipMod=function(t){return t%864e5},n.prototype.calcUtcTimeFromUrl=function(t){var e=this._calcTimeFromUrl(t);return e.result&&"vod"===e.type&&(e.result=!1,e.type="",e.utcTimeMs=-1,e.utcTimeMsStr=""),e},n.prototype._calcTimeFromUrl=function(t){for(var e={utcTimeMs:-1,utcTimeMsStr:"",result:!1,type:""};;){var i=new RegExp([/.*_(\d{4})/.source,/([0-1]{1}\d{1})/.source,/([0-3]{1}\d{1})/.source,/([0-2]{1}\d{1})/.source,/([0-5]{1}\d{1})/.source,/([0-5]{1}\d{1})/.source,/(?:(((\d{3})(\d{3})))|(((?:_(\d{3})))?))/.source].join(""),"g").exec(t);if(i){e.utcTimeMs=new Date(Date.UTC(parseInt(i[1]),parseInt(i[2])-1,parseInt(i[3]),parseInt(i[4]),parseInt(i[5]),parseInt(i[6]),i[9]?parseInt(i[9]):i[13]?parseInt(i[13]):0)).getTime(),e.utcTimeMsStr=i[0],e.type="live",e.result=!0;break}if(i=new RegExp([/.*\/(\d{4})/.source,/([0-1]{1}\d{1})/.source,/([0-3]{1}\d{1})/.source,/\/([0-2]{1}\d{1})/.source,/\/([0-5]{1}\d{1})/.source,/([0-5]{1}\d{1})/.source,/(?:(((\d{3})(\d{3})))|(((?:_(\d{3})))?))/.source].join(""),"g").exec(t)){e.utcTimeMs=new Date(Date.UTC(parseInt(i[1]),parseInt(i[2])-1,parseInt(i[3]),parseInt(i[4]),parseInt(i[5]),parseInt(i[6]),i[9]?parseInt(i[9]):i[13]?parseInt(i[13]):0)).getTime(),e.utcTimeMsStr=i[0],e.type="live",e.result=!0;break}var n=new RegExp([/.*?/.source,/([0-2]{1}\d{1})/.source,/([0-5]{1}\d{1})/.source,/([0-5]{1}\d{1})/.source,/(((\d{3})(\d{3}))|(_(\d{3}))?)/.source].join(""),"g").exec(t);if(n){e.utcTimeMs=36e5*parseInt(n[1])+6e4*parseInt(n[2])+1e3*parseInt(n[3])+parseInt(n[6]?n[6]:n[9]?parseInt(n[9]):0),e.utcTimeMsStr=n[0],e.type="vod",e.result=!0;break}if(n=new RegExp([/.*?/.source,/\/([0-2]{1}\d{1})/.source,/\/([0-5]{1}\d{1})/.source,/([0-5]{1}\d{1})/.source,/(((\d{3})(\d{3}))|(_(\d{3}))?)/.source].join(""),"g").exec(t)){e.utcTimeMs=36e5*parseInt(n[1])+6e4*parseInt(n[2])+1e3*parseInt(n[3])+parseInt(n[6]?n[6]:n[9]?parseInt(n[9]):0),e.utcTimeMsStr=n[0],e.type="vod",e.result=!0;break}break}return e},n.prototype._createLteStreamInfos=function(){var t=this.hls;if(this.lteStreamsInfos.length<=0)for(var e=new RegExp(".*(\\/)(.*\\.m3u8).*|(.*\\.m3u8).*","ig"),i=e.lastIndex=0;i<t.levelController._levels.length;i++){var n=t.levelController._levels[i];e.lastIndex=0;var r=e.exec(n.url);r&&this.lteStreamsInfos.push({url:r[2]?r[2]:r[3],fixFrameOffset:null,frameDuration:null,fps:null,init:!1})}},n.prototype.addStreamFPSForLte=function(t,e){var i=this.hls;i.config.lteMode&&0<i.levelController._levels.length&&0<=t&&(this.lteStreamsInfos[t].fps=e,this.lteStreamsInfos[t].frameDuration=1/e)},n.prototype.addLteStreamInfos=function(t,e){if(this.hls.config.lteMode){var i=this.lteStreamsInfos[t];if(!i.init&&i.fps){var n=1/i.fps;i.fixFrameOffset=Math.round(e/n)*n,i.init=!0}}},n.prototype.getLteStreamInfos=function(t){var e=null;return this.hls.config.lteMode&&this.lteStreamsInfos[t]&&this.lteStreamsInfos[t].init&&(e=this.lteStreamsInfos[t]),e},n}(x),ut=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),ht=/^#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/gm,ct=/#EXT-X-MEDIA:(.*)/g,dt=/#DEBUG(.*)/g,ft=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#EXT-X-NL-CDN:(.+)/.source,/|#(\s*)(?:(?:NeuLion Adaptive)|(?:Endeavor)) Streaming Server(.*)/.source,/|#.*/.source].join(""),"g"),pt=new RegExp([/(#EXTINF:\s*((\d*(?:\.\d+)?)(?:,(?:.*)\s+)?))/.source,/|((?!#)(\S+))/.source,/|(#EXT-X-BYTERANGE:*(.+))/.source,/|(#EXT-X-PROGRAM-DATE-TIME:(.+))/.source,/|(#EXT-X-DISCONTINUITY-SEQUENCE:(\s*\d+\s*))/.source,/|(#EXT-X-DISCONTINUITY)/.source,/|(#EXT-X-MEDIA-SEQUENCE:(\s*(\d+)\s*))/.source,/|(#EXT-X-PLAYLIST-TYPE:(\s*(\w+)\s*))/.source,/|(#EXT-X-ENDLIST)/.source,/|(#.*)/.source].join(""),"g"),gt=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:#EXT-X-NL-(TIMESCALE):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,mt=/(?:(?:NeuLion Adaptive)|(?:Endeavor)) Streaming Server(.*)/gi,vt=new RegExp([/#EXT-X-CST-AD-ID:(.+)/.source,/|#EXT-X-CST-TRACK:(.+)/.source,/|#EXT-X-CST-TRACK2:(.+)/.source,/|(?:#EXT-X-(CST-AD-SLOT-START))/.source,/|(?:#EXT-X-(CST-AD-SLOT-END))/.source,/|(?:#EXT-X-(CST-AD-STITCH-START))/.source,/|(?:#EXT-X-(CST-AD-STITCH-END))/.source].join(""),"g"),yt=/((.*)Stitcher_v(.*))|((.*)StitchServer_v(.*))/gi,bt=function(){function t(){l(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return ut(t,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=P.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),_t=function(){function t(){l(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return t.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},t.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var i=t;return t&&t.method&&t.uri&&!t.iv&&((i=new bt).method=t.method,i.baseuri=t.baseuri,i.reluri=t.reluri,i.iv=this.createInitializationVector(e)),i},t.prototype.cloneObj=function(t){return JSON.parse(JSON.stringify(t))},ut(t,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=P.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var i=this.lastByteRangeEndOffset;t[0]=i||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),t}(),Tt=function(i){function n(t){l(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MANIFEST_LOADING,M.a.LEVEL_LOADING,M.a.AUDIO_TRACK_LOADING,M.a.SUBTITLE_TRACK_LOADING,M.a.THUMBNAILS_TRACK_LOADING,M.a.THUMBNAILS_IMAGE_LOADING));return e.loaders={},e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},x.prototype.destroy.call(this)},n.prototype.onManifestLoading=function(t){this.load(t.url,{type:"manifest"})},n.prototype.onLevelLoading=function(t){this.load(t.url,{type:"level",level:t.level,id:t.id})},n.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:"audioTrack",id:t.id})},n.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:"subtitleTrack",id:t.id})},n.prototype.onThumbnailsTrackLoading=function(t){Y.b.trace("onThumbnailsTrackLoading"),this.load(t.url,{type:"thumbnailTrack",id:t.id,cb:t.cb})},n.prototype.onThumbnailImageLoading=function(t){Y.b.trace("onThumbnailImageLoading"),this.load(t.url,{type:"thumbnailImage",id:t.id,cb:t.cb})},n.prototype.load=function(t,e){var i=this.loaders[e.type];if(void 0!==i){var n=i.context;if(n&&n.url===t)return void Y.b.trace("playlist request ongoing");Y.b.warn("abort previous loader for type:"+e.type),i.abort()}var r=this.hls.config,a=void 0,s=void 0,o=void 0,l=void 0;"manifest"===e.type?(a=r.manifestLoadingMaxRetry,s=r.manifestLoadingTimeOut,o=r.manifestLoadingRetryDelay,l=r.manifestLoadingMaxRetryTimeout):"level"===e.type?(a=0,s=r.levelLoadingTimeOut):(a=r.levelLoadingMaxRetry,s=r.levelLoadingTimeOut,o=r.levelLoadingRetryDelay,l=r.levelLoadingMaxRetryTimeout,Y.b.log("loading playlist for "+e.type+" "+(e.level||e.id))),i=this.loaders[e.type]=e.loader=void 0!==r.pLoader?new r.pLoader(r):new r.loader(r),e.url=t,"thumbnailImage"===e.type?e.responseType="arraybuffer":e.responseType="";var u,h;u={timeout:s,maxRetry:a,retryDelay:o,maxRetryDelay:l},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},i.load(e,u,h)},n.prototype.resolve=function(t,e){return P.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},n.prototype.parseMasterPlaylist=function(t,e){var i=[],n=void 0;for(ht.lastIndex=0;null!=(n=ht.exec(t));){var r={},a=r.attrs=new X(n[1]);r.url=this.resolve(n[2],e);var s=a.decimalResolution("RESOLUTION");s&&(r.width=s.width,r.height=s.height),r.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),r.name=a.NAME,function(i,r){["video","audio"].forEach(function(n){var e=i.filter(function(t){return e=t,!!(i=D[n])&&!0===i[e.slice(0,4)];var e,i});if(e.length){var t=e.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});r[n+"Codec"]=0<t.length?t[0]:e[0],i=i.filter(function(t){return-1===e.indexOf(t)})}}),r.unknownCodecs=i}([].concat((a.CODECS||"").split(/[ ,]+/)),r),r.videoCodec&&-1!==r.videoCodec.indexOf("avc1")&&(r.videoCodec=this.avc1toavcoti(r.videoCodec)),i.push(r)}return i},n.prototype.parseMasterPlaylistMedia=function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],r=void 0,a=[],s=0;ct.lastIndex=0,dt.lastIndex=0;var o=dt.exec(t),l=t;for(null!==o&&(l=t.substr(0,o.index));null!==(r=ct.exec(l));){var u={},h=new X(r[1]);if(h.TYPE===i){if(u.groupId=h["GROUP-ID"],u.name=h.NAME,u.type=i,u.default="YES"===h.DEFAULT,u.autoselect="YES"===h.AUTOSELECT,u.forced="YES"===h.FORCED,u.solution=h.RESOLUTION,h.URI&&(u.url=this.resolve(h.URI,e)),u.lang=h.LANGUAGE,u.name||(u.name=u.lang),n.length){var c=d(n,u.groupId);u.audioCodec=c?c.codec:n[0].codec}u.id=s++,a.push(u)}}return a},n.prototype.avc1toavcoti=function(t){var e,i=t.split(".");return 2<i.length?(e=i.shift()+".",e+=parseInt(i.shift()).toString(16),e+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):e=t,e},n.prototype.parseLevelPlaylist=function(t,e,i,n){var r,a,s=0,o=0,l={type:null,version:null,url:e,fragments:[],live:!0,startSN:0},u=new bt,h=0,c=null,d=new _t,f=this.hls,p=(f.config.lteMode,new J),g=f.advertisementController,m=f.userDataMgr,v=f.thumbnailController,y=[],b=[],_={sn:null,isolate:!1},T={sn:null,isolate:!1},E=null,S=null,w={nextIsSlotEnd:!1,programDateTimeBeforeInf:!0,durationSinceLastProgramDate:0,lastprogramDateTime:0,firstProgramDateTime:null,multiCdnNodes:[],firstSn:-1,endSn:-1,discontinueReset:!1,dateRanges:[],newCdnPeriodStart:!0,utcTimeFromUrlMs:null,durationFromUrlMs:0,utcTimeStrFromUrl:""};for(ft.lastIndex=0;null!==(r=ft.exec(t));){var k=r[1];if(k){d.duration=parseFloat(k);var A=(" "+r[2]).slice(1);d.title=A||null,d.tagList.push(A?["INF",k,A]:["INF",k])}else if(r[3]){if(!isNaN(d.duration)){var L=s++;if(d.type=n,d.start=o,d.levelkey=u,d.sn=L,d.level=i,d.cc=h,d.baseurl=e,d.relurl=(" "+r[3]).slice(1),m.needParseTimeFromUrl()){var P=m.calcUtcTimeFromUrl(d.relurl),C=P.result?P.utcTimeMs:null;if(null!==C&&(d.utcTimeFromUrlMs=C,w.utcTimeFromUrlMs=C,w.durationFromUrlMs=1e3*d.duration,w.utcTimeStrFromUrl=d.relurl),w.discontinueReset)C&&(w.lastprogramDateTime=C),w.discontinueReset=!1;else if(C&&c){var x=(d.utcTimeFromUrlMs-c.utcTimeFromUrlMs)/1e3,I=x-c.duration;c.duration=x,d.start+=I,o+=I,w.durationSinceLastProgramDate+=I}}this.modifyEndSnForCDN(d.sn,w.multiCdnNodes),l.fragments.push(d),o+=(c=d).duration,l.playlistType=n,-1===w.firstSn&&(w.firstSn=d.sn),w.endSn=d.sn,w.durationSinceLastProgramDate+=d.duration,null===S&&(E=d.sn),S=d,w.nextIsSlotEnd&&(w.nextIsSlotEnd=!1,0<y.length&&(y[y.length-1].timeline.trackEnd=w.lastprogramDateTime+1e3*w.durationSinceLastProgramDate)),d=new _t}}else if(r[4]){if(d.rawByteRange=(" "+r[4]).slice(1),c){var R=c.byteRangeEndOffset;R&&(d.lastByteRangeEndOffset=R)}}else if(r[5]){d.rawProgramDateTime=(" "+r[5]).slice(1),d.tagList.push(["PROGRAM-DATE-TIME",d.rawProgramDateTime]);var D=new Date(Date.parse(r[5])),N=w.firstProgramDateTime;if(null==l.programDateTime&&(l.programDateTime=new Date(D-1e3*o),w.firstProgramDateTime=l.programDateTime.getTime(),w.discontinueReset=!0),0!==w.lastprogramDateTime&&(w.durationSinceLastProgramDate,m.needParseTimeFromUrl()&&w.utcTimeFromUrlMs&&w.utcTimeFromUrlMs>w.lastprogramDateTime&&(w.utcTimeFromUrlMs,w.lastprogramDateTime,w.durationFromUrlMs)),null!=N){var O=1e3*w.durationSinceLastProgramDate;m.needParseTimeFromUrl()&&w.utcTimeFromUrlMs&&w.utcTimeFromUrlMs>w.lastprogramDateTime&&(O=w.utcTimeFromUrlMs-w.lastprogramDateTime+w.durationFromUrlMs),w.dateRanges.push({begin:w.lastprogramDateTime/1e3,end:(w.lastprogramDateTime+O)/1e3})}w.lastprogramDateTime=D.getTime(),w.durationSinceLastProgramDate=0,w.utcTimeFromUrlMs=null}else if(r[6])this.parseCdnTag(r[6],s,w);else{var M=!1;if("main"===n&&(M=this.parseAdvertiseTag(r[0],y,b,T,_,S,l.startSN,p,w)),!M){for(r=r[0].match(gt),a=1;a<r.length&&null==r[a];a++);var U=(" "+r[a+1]).slice(1),F=(" "+r[a+2]).slice(1);switch(r[a]){case"#":d.tagList.push(F?[U,F]:[U]);break;case"PLAYLIST-TYPE":l.type=U.toUpperCase();break;case"MEDIA-SEQUENCE":s=l.startSN=parseInt(U);break;case"TARGETDURATION":l.targetduration=parseFloat(U);break;case"VERSION":l.version=parseInt(U);break;case"EXTM3U":break;case"ENDLIST":l.live=!1,"main"===n&&w.firstProgramDateTime&&v.setCvodProgramDataTime(w.firstProgramDateTime),m.setPlaylistTag("live",!1);break;case"DIS":h++,d.tagList.push(["DIS"]),w.discontinueReset=!0,w.newCdnPeriodStart=!0;break;case"DISCONTINUITY-SEQ":h=parseInt(U);break;case"KEY":var B=new X(U),G=B.enumeratedString("METHOD"),j=B.URI,H=B.hexadecimalInteger("IV");G&&(u=new bt,j&&0<=["AES-128","SAMPLE-AES"].indexOf(G)&&(u.method=G,u.baseuri=e,u.reluri=j,u.key=null,u.iv=H));break;case"START":var V=new X(U).decimalFloatingPoint("TIME-OFFSET");isNaN(V)||(l.startTimeOffset=V);break;case"MAP":var W=new X(U);d.relurl=W.URI,d.rawByteRange=W.BYTERANGE,d.baseurl=e,d.level=i,d.type=n,d.sn="initSegment",l.initSegment=d,d=new _t;break;case"TIMESCALE":var z=parseInt(U);m&&m.setThumbnailTimeScale(z);break;default:Y.b.warn("line parsed but not handled: "+r)}}}}if((d=c)&&!d.relurl&&(l.fragments.pop(),o-=d.duration,w.durationSinceLastProgramDate-=d.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=s-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=h,0<l.fragments.length&&this.updateCDNsInfo(n,l.live,w.firstSn,w.multiCdnNodes),"main"===n){if(w.lastprogramDateTime&&w.durationSinceLastProgramDate){var K=1e3*w.durationSinceLastProgramDate;m.needParseTimeFromUrl()&&w.utcTimeFromUrlMs&&w.utcTimeFromUrlMs>w.lastprogramDateTime&&(K=w.utcTimeFromUrlMs-w.lastprogramDateTime+w.durationFromUrlMs),w.dateRanges.push({begin:w.lastprogramDateTime/1e3,end:(w.lastprogramDateTime+K)/1e3})}m.updateTimeline(n,w.dateRanges,l.targetduration,l.totalduration)}return g&&g.refresh&&g.mergeAdlist(E,y,b,T,_,l.live),l},n.prototype.loadsuccess=function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=t.data,a=t.url,s=i.type,o=i.id,l=i.level,u=this.hls;if((this.loaders[s]=void 0)!==a&&0!==a.indexOf("data:")||(a=i.url),e.tload=performance.now(),"thumbnailImage"===s)u.trigger(M.a.THUMBNAIL_IMAGE_LOADED,{content:r,url:a,id:o,cb:i.cb});else if(0===r.indexOf("#EXTM3U"))if(0<r.indexOf("#EXTINF:")){var h="audioTrack"!==s&&"subtitleTrack"!==s&&"thumbnailTrack"!==s,c=isNaN(l)?isNaN(o)?0:o:l,d=r;"manifest"!==s&&"level"!==s&&"audioTrack"!==s||this.preParseLevelList(d,s),d=this.parseLevelListLtePlug(s,r);var f=this.parseLevelPlaylist(d,a,c,"audioTrack"===s?"audio":"subtitleTrack"===s?"subtitle":"thumbnailTrack"===s?"thumbnails":"main");f.tload=e.tload,"manifest"===s&&u.trigger(M.a.MANIFEST_LOADED,{levels:[{url:a,details:f}],audioTracks:[],url:a,stats:e,networkDetails:n}),e.tparsed=performance.now(),f.targetduration?h?u.trigger(M.a.LEVEL_LOADED,{details:f,level:l||0,id:o||0,stats:e,networkDetails:n}):"audioTrack"===s?u.trigger(M.a.AUDIO_TRACK_LOADED,{details:f,id:o,stats:e,networkDetails:n}):"subtitleTrack"===s?u.trigger(M.a.SUBTITLE_TRACK_LOADED,{details:f,id:o,stats:e,networkDetails:n}):"thumbnailTrack"===s&&u.trigger(M.a.THUMBNAILS_TRACK_LOADED,{details:f,id:o,stats:e,networkDetails:n,cb:i.cb}):u.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"invalid targetduration",networkDetails:n})}else{this.preParseMainList(r);var p=this.parseMasterPlaylist(r,a);if(p.length){var g=p.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),m=this.parseMasterPlaylistMedia(r,a,"AUDIO",g),v=this.parseMasterPlaylistMedia(r,a,"SUBTITLES"),y=this.parseMasterPlaylistMedia(r,a,"X-THUMBNAILS"),b=this.parseMasterPlaylistMedia(r,"","CLOSED-CAPTIONS");if(0<b.length&&u.userDataMgr){for(var _={},T=0;T<b.length;T++)_["cc"+(T+1).toString()]={name:b[T].name,lang:b[T].lang};0<b.length&&u.userDataMgr.setHlsCC(!0,_)}if(u.thumbnailController.setThumbnailStreams(y),this.postParseMainListLtePlug(),m.length){var E=!1;m.forEach(function(t){t.url||(E=!0)}),!1===E&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(Y.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main"}))}u.trigger(M.a.MANIFEST_LOADED,{levels:p,audioTracks:m,subtitles:v,url:a,stats:e,networkDetails:n})}else"thumbnailTrack"!==s&&u.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no level found in manifest",networkDetails:n})}else"thumbnailTrack"===s?u.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!1,url:a,reason:"no EXTM3U delimiter",networkDetails:n}):u.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no EXTM3U delimiter",networkDetails:n})},n.prototype.loaderror=function(t,e){var i,n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=e.loader;switch(e.type){case"manifest":i=U.a.MANIFEST_LOAD_ERROR,n=!0;break;case"level":i=U.a.LEVEL_LOAD_ERROR,n=!1;break;case"audioTrack":i=U.a.AUDIO_TRACK_LOAD_ERROR,n=!1;break;case"thumbnailImage":i=U.a.THUMBNAIL_IMAGE_LOAD_ERROR,n=!1;break;case"thumbnailTrack":i=U.a.THUMBNAIL_TRACK_LOAD_ERROR,n=!1;break;case"subtitleTrack":i=U.a.SUBTITLE_TRACK_LOAD_ERROR,n=!1;break;default:i="",n=!1}a&&(a.abort(),this.loaders[e.type]=void 0);var s=t.url;null!=s&&0!==s.indexOf("data:")||(s=e.url),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:i,fatal:n,url:s,loader:a,response:t,context:e,networkDetails:r})},n.prototype.loadtimeout=function(t,e){var i,n,r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,s=e.loader;switch(e.type){case"manifest":i=U.a.MANIFEST_LOAD_TIMEOUT,n=!0;break;case"level":i=U.a.LEVEL_LOAD_TIMEOUT,n=!1;break;case"audioTrack":i=U.a.AUDIO_TRACK_LOAD_TIMEOUT,n=!1;break;case"thumbnailImage":i=U.a.THUMBNAIL_IMAGE_LOAD_TIMEOUT,n=!1;break;case"thumbnailTrack":i=U.a.THUMBNAIL_TRACK_LOAD_TIMEOUT,n=!1}s&&(s.abort(),this.loaders[e.type]=void 0),null!=r&&0!==r.indexOf("data:")||(r=e.url),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:i,fatal:n,url:r,loader:s,context:e,networkDetails:a})},n.prototype._isFloatStr=function(t){return/^-?\d*\.\d+$/.test(t)},n.prototype._parseNeulionMark=function(t){for(mt.lastIndex=0;null!=mt.exec(t);)this.hls.userDataMgr.setPlaylistTag("neulion",!0)},n.prototype._parseStitchMark=function(t){for(yt.lastIndex=0;null!=yt.exec(t);)this.hls.userDataMgr.setPlaylistTag("stitch",!0)},n.prototype.parseCdnTag=function(t,e,i){var n=i.multiCdnNodes,r=i.newCdnPeriodStart;if(0<n.length&&null===n[n.length-1].endSn)Y.b.error("parseCdnTag: parse cnd error");else{if(r&&(n.length<=0||n[n.length-1].endSn<e)){var a=new F(e);n.push(a),r=!1}for(var s=n[n.length-1],o=new O,l=t.replace(/\s+/g,"").split(","),u=l.length-1;0<=u;u--){var h=l[u].split("=");2===h.length&&(h[0].toLowerCase()==="HOST".toLowerCase()?o.host=h[1]:h[0].toLowerCase()==="BANDWIDTH-RATE".toLowerCase()?o.bandwidthRate=parseFloat(h[1]):h[0].toLowerCase()==="PRIORITY".toLowerCase()&&(o.priority=parseInt(h[1])))}null!=o.host&&s.cdnNodes.push(o)}},n.prototype.modifyEndSnForCDN=function(t,e){0<e.length&&(e[e.length-1].endSn=t)},n.prototype.updateCDNsInfo=function(t,e,i,n){if(0<n.length){var r=this.hls.cdnsCtrl;r&&r.updateMultiCdnNodes(t,e,i,n)}},n.prototype.parseAdvertiseTag=function(t,e,i,n,r,a,s,o,l){var u=!1;if(this.hls.advertisementController.refresh){vt.lastIndex=0;var h=vt.exec(t);if(h){if(0===e.length){var c=new Q;e.push(c)}var d=e[e.length-1];if(u=!0,h[1]){var f=h[1].trim();if(f)if(d.id){d.id===f&&Y.b.warn("parseAdvertiseTag: there are continuous same id track"),d.timeline.snTrackEnd=a.sn,d.timeline.trackEnd=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate;var p=new Q;e.push(p),(d=e[e.length-1]).id=f,d.timeline.snBegin=a.sn+1,d.timeline.trackBegin=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate}else d.id=f,d.timeline.snBegin=a?a.sn+1:s,d.timeline.trackBegin=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate;else Y.b.error("parseAdvertiseTag: track id is empty.")}else if(h[2])d.parseNoticeValue(h[2],!1);else if(h[3])if(null!==d.id&&!0===d.lastInSlot){var g=new Q;e.push(g),(d=e[e.length-1]).parseNoticeValue(h[3],!0)}else null===d.id?(d.parseNoticeValue(h[3],!0),Y.b.warn("parseAdvertiseTag: slot appear after track2")):Y.b.error("parseAdvertiseTag: track2 appear with invalid");else if(h[4])if(o.setInSlot(!0),null!==d.id&&!0===d.lastInSlot){var m=new Q;e.push(m),(d=e[e.length-1]).firstInSlot=!0}else null===d.id?d.firstInSlot=!0:Y.b.error("parseAdvertiseTag: slot appear with invalid");else if(h[5])o.setInSlot(!1),d.id?(d.lastInSlot=!0,d.timeline.snSlotEnd=a?a.sn+1:s,null===d.timeline.snTrackEnd&&(d.timeline.snTrackEnd=a?a.sn+1:s,d.timeline.trackEnd=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate,l.nextIsSlotEnd=!0)):!1===n.isolate?(n.isolate=!0,n.sn=a?a.sn:s-1):Y.b.error("parseAdvertiseTag: code error(judge isolateSlotEnd)");else if(h[6]){if(o.setInStitch(!0),d.id&&!0===d.lastInStitch){var v=new Q;e.push(v),d=e[e.length-1]}d.firstInStitch=!0}else h[7]&&(o.setInStitch(!1),d.id?(d.lastInStitch=!0,d.timeline.snStitchEnd=a?a.sn:s,null==d.timeline.snSlotEnd&&(d.timeline.snSlotEnd=d.timeline.snStitchEnd),null==d.timeline.snTrackEnd&&(d.timeline.snTrackEnd=d.timeline.snStitchEnd,d.timeline.trackEnd=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate)):((0<d.noticeSlices.slotImpression.length||0<d.noticeSlices.slotEnd.length)&&!0===d.firstInStitch?(d.timeline.snStitchEnd=a?a.sn+1:s+1,d.timeline.trackBegin=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate,d.timeline.trackEnd=l.lastprogramDateTime+1e3*l.durationSinceLastProgramDate,i.push(d),e.pop()):d.clear(),!1===d.firstInStitch&&!1===r.isolate&&(r.isolate=!0,r.sn=a?a.sn:s-1)))}}return u},n.prototype.parseUtcNameFromUrl=function(t){var e=null,i=this.hls.userDataMgr.calcUtcTimeFromUrl(t);return i.result&&(e=i.utcTimeMsStr),e},n.prototype.preParseMainList=function(t){this._parseNeulionMark(t),this._parseStitchMark(t),this.hls.userDataMgr.setPlaylistTag("mbr",!0)},n.prototype.preParseLevelList=function(t,e){var i=this.hls.userDataMgr;if(!i.playlistTagInited()){var n=null,r=null,a=!0,s=!0,o={inf:!1,url:!1},l=function(){return o.inf&&o.url};for(this._parseNeulionMark(t),this._parseStitchMark(t),ft.lastIndex=0;null!==(n=ft.exec(t));)if(n[1])a=this._isFloatStr(parseFloat(n[1]))&&a,o.inf=!0;else if(n[3]){var u=(" "+n[3]).slice(1);if(s=s&&i.calcUtcTimeFromUrl(u).result,o.url=!0,l())break}else if(n[4]){if(i.setPlaylistTag("byteRange",!0),o.url=!0,l())break}else if(n[5])i.setPlaylistTag("dateTime",!0);else if(n[6]);else{var h=n[0].match(gt);if(h){for(r=1;r<h.length&&null==h[r];r++);"ENDLIST"===h[r]&&i.setPlaylistTag("live",!1)}}(n=/(#EXT-X-ENDLIST)/.exec(t))&&i.setPlaylistTag("live",!1),i.setPlaylistTag("utcTimeName",s),i.setPlaylistTag("floatInf",a),"manifest"===e&&i.setPlaylistTag("mbr",!1),i.setPlaylistTag("init",!0)}},n.prototype.postParseMainListLtePlug=function(){var t=this.hls;t.config.lteMode&&t.thumbnailController.setThumbnailStreams([])},n.prototype.parseLevelListLtePlug=function(t,e){var i=e,n=this.hls;if(n.config.lteMode&&(this._checkLteMode()&&(Y.b.warn("Not support stitch stream in lte mode"),n.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.LTE_PARSE_ERROR,fatal:!0})),this._needEditLteString(t))){var r=this._parseLteString(e);i=r.lteString,r.parseError&&(Y.b.warn("Parse name error(not utcTimeName)"),n.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.LTE_PARSE_ERROR,fatal:!0}))}return i},n.prototype._resetSegment=function(){return{rawUrl:"",rawINF:"",inf:0,utcTimeMs:-1}},n.prototype._getHeadStr=function(t){var e="";return t.forEach(function(t){e=e+t+"\r\n"}),e},n.prototype._getSegmentStr=function(t){return t.rawINF+t.rawUrl+"\r\n"},n.prototype._checkLteMode=function(){var t=!1,e=this.hls;return e.config.lteMode&&(t=e.userDataMgr.lteForbiddance()),t},n.prototype._needEditLteString=function(t){var e=!1,i=this.hls,n=i.userDataMgr;return i.config.lteMode&&"thumbnailTrack"!==t&&(e=n.needEditLteString()),e},n.prototype._parseLteString=function(t){var e=this.hls.userDataMgr,i={lteString:"",parseError:!1},n=null,r="",a=this._resetSegment(),s="",o=[],l=-1,u=-1,h=!0,c=this._resetSegment(),d=[],f=-1,p=-1,g="",m=-1,v=!1,y="",b="",_=!1;for(pt.lastIndex=0;null!==(n=pt.exec(t));)if(n[1])0<a.rawUrl.length&&(s+=this._getSegmentStr(a),0<y.length&&(s+=y,y="")),a.rawINF=n[1],a.inf=parseFloat(n[3]),v=!1;else if(n[4]){var T=e.calcUtcTimeFromUrl(n[4]),E=T.result?T.utcTimeMs:null;if(null===E){i.parseError=!0;break}if(0===g.length){var S=this._getInitSequence(n[4]);-1!==S&&o[u]&&(o[u]="#EXT-X-MEDIA-SEQUENCE:"+S)}if(h&&0!==g.length){var w=0<d.length,k=!1;if(e.getFlipMod(E)<=16e3&&(k=!0),k&&E-(c.utcTimeMs+1e3*c.inf)<=600&&(w=!1,i.lteString+=this._getHeadStr(d),d=[],i.lteString+=this._getSegmentStr(c),i.lteString+=b),w){d[f]=o[l];var A=this._getInitSequence(n[4]);-1===A&&(A=parseInt(m)+1),d[p]="#EXT-X-MEDIA-SEQUENCE:"+A,o=d,l=f,u=p,d=[],f=p=-1,g=n[4],m=(parseInt(m)+1).toString()}}h=!1,0===g.length&&(g=n[4]),a.rawUrl=n[4],a.utcTimeMs=E,v=!0}else{if(n[6]){i.lteString=t;break}if(n[8])o.push(n[8]),l=o.length-1;else if(n[10])o.push(n[10]);else if(n[12]){if(v=!1,c.rawUrl=a.rawUrl,c.rawINF=a.rawINF,c.utcTimeMs=a.utcTimeMs,c.inf=a.inf,b=y,0===i.lteString.length)if(0===s.length)d=(d=[]).concat(o),f=l,p=u;else{var L=this._getInitSequence(g);-1!==L&&o[u]&&(o[u]="#EXT-X-MEDIA-SEQUENCE:"+L),r=this._getHeadStr(o)+s,i.lteString+=r,d=[]}else 0<s.length&&(r=this._getHeadStr(o)+s,i.lteString+=r),d=[];r="",a=this._resetSegment(),u=l=-1,h=!(s=""),(o=[]).push(n[12])}else n[13]?(o.push(n[13]),u=o.length-1,-1===m&&(m=n[15])):n[16]?o.push(n[16]):n[19]?(_=!0,0<s.length&&(r=this._getHeadStr(o)+s,i.lteString+=r,i.lteString+=n[19])):n[20]&&(v?y=y+n[20]+"\r\n":o.push(n[20]))}return _||(0<s.length&&(r=this._getHeadStr(o)+s),i.lteString+=r),i.parseError&&(i.lteString=t),i},n.prototype._getInitSequence=function(t){var e=this.hls,i=e.levelController._levels,n=e.levelController.currentLevelIndex,r=this.parseUtcNameFromUrl(t),a=-1;if(i&&i[n]){var s=i[n];if(s.details&&s.details.fragments)for(var o=s.details.fragments,l=0;l<o.length;l++){if(this.parseUtcNameFromUrl(o[l].relurl)===r){a=o[l].sn;break}}}return a},n}(x),Et=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.FRAG_LOADING));return e.loaders={},e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){var t=this.loaders;for(var e in t){var i=t[e];i&&i.destroy()}this.loaders={},x.prototype.destroy.call(this)},n.prototype.onFragLoading=function(t){var e=t.frag,i=e.type,n=this.loaders[i],r=this.hls.config,a=t.userdata,s=this.hls;e.loaded=0,n&&(Y.b.warn("abort previous fragment loader for type:"+i),n.abort());var o=!1;r.withCredentialsFragmentPattern.forEach(function(t){-1!=e.url.indexOf(t)&&(o=!0)});var l=r.xhrSetup;o||(r.xhrSetup=null),n=this.loaders[i]=e.loader=void 0!==r.fLoader?new r.fLoader(r):new r.loader(r),r.xhrSetup=l;var u,h=void 0,c=void 0;h={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var d=e.byteRangeStartOffset,f=e.byteRangeEndOffset;isNaN(d)||isNaN(f)||(h.rangeStart=d,h.rangeEnd=f),c={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},s.cdnsCtrl.isActive(i)&&(c.timeout=3e3),u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},n.load(h,c,u,a)},n.prototype.loadsuccess=function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=arguments[4],a=t.data,s=i.frag;s.loader=void 0,this.loaders[s.type]=void 0,this.judgeCdn("suc",t,e,i);var o=this.hls.cdnsCtrl;if(o.isActive(s.type)&&s.sn&&s.type){var l=o.getMultiCdnNode(s.type,s.sn);l&&l.setSwitching(!1)}this.hls.trigger(M.a.FRAG_LOADED,{payload:a,frag:s,stats:e,networkDetails:n,userdata:r})},n.prototype.loaderror=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;n&&n.abort(),this.loaders[e.type]=void 0,this.judgeCdn("error",t,void 0,e),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:i})},n.prototype.loadtimeout=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;n&&n.abort(),this.loaders[e.type]=void 0,this.judgeCdn("timeout",void 0,void 0,e),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:i})},n.prototype.loadprogress=function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=e.frag;r.loaded=t.loaded;var a=e.loader;this.judgeCdn("progress",void 0,t,e)?(void 0===a&&(a=e.frag.loader),a.abort(),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.FRAG_LOAD_SLOW,fatal:!1,frag:e.frag})):this.hls.trigger(M.a.FRAG_LOAD_PROGRESS,{frag:r,stats:t,networkDetails:n})},n.prototype.judgeCdn=function(t,e,i,n){var r=this.hls,a=!1,s=r.cdnsCtrl;do{if(null==n||null==n.frag)break;var o=n.frag;if(null==o.sn||null==o.type)break;if(!s.isActive(o.type))break;var l=s.getMultiCdnNode(o.type,o.sn);if(null==l)break;var u=l.getActiveCdn();if(null==u)break;var h=0;if("error"===t){s.updateErrLoadInfo(o.type,o.sn,0,0,performance.now(),0);break}if("timeout"===t){s.updateTimeoutLoadInfo(o.type,o.sn);break}if("suc"===t&&void 0!==i&&void 0!==i.trequest){var c=performance.now()-i.trequest;h=Math.round(8*i.loaded/(c/1e3)),s.updateSucLoadInfo(o.type,o.sn,h,i.loaded);break}if("progress"!==t||(void 0===i||void 0===i.trequest||void 0!==i.aborted)&&!1!==i.aborted)break;var d=performance.now()-i.trequest;h=Math.round(8*i.loaded/(d/1e3));var f=r.streamController;if(null==f||null==f.levels||null==f.fragCurrent||null==f.fragCurrent.duration||null==f.levels[f.level].bitrate)break;var p=!1;if(64e3<i.loaded){var g=f.fragCurrent.duration,m=f.levels[f.level].bitrate,v=s.getPreferCdn(o.type,o.sn,m,g,i.loaded,h),y=o.url;""!==v&&-1===y.search(v)&&(p=a=!0,l.log("judgeCdn::progress: switch cdn because there are preferable cdn "),u.log("\t"))}p?s.updateProgressLoadInfo(o.type,o.sn,h,0,performance.now()):s.updateProgressLoadInfo(o.type,o.sn,-1,i.loaded,-1);break}while(0);return a},n}(x),St=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.KEY_LOADING));return e.loaders={},e.decryptKeyPairs=[],e.pairsMax=20,e.decrypturl=null,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},this.decrypturl=null,this.decryptKeyPairs=[],x.prototype.destroy.call(this)},n.prototype.onKeyLoading=function(t){var e=t.frag,i=e.type,n=this.loaders[i],r=e.decryptdata,a=r.uri,s=t.userdata,o=this.findDecryptKey(a);if(void 0===o.decryptkey&&void 0===o.decrypturl){var l=this.hls.config;n&&(Y.b.warn("abort previous key loader for type:"+i),n.abort()),e.loader=this.loaders[i]=new l.loader(l);var u,h,c;u={url:this.decrypturl=a,frag:e,responseType:"arraybuffer"},h={timeout:l.fragLoadingTimeOut,maxRetry:l.fragLoadingMaxRetry,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(u,h,c,s)}else o.decryptkey&&(r.key=o.decryptkey,this.hls.trigger(M.a.KEY_LOADED,{frag:e,userdata:s}))},n.prototype.loadsuccess=function(t,e,i,n){var r=i.frag;r.decryptdata.key=new Uint8Array(t.data),this.addDecryptKey(this.decrypturl,r.decryptdata.key),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(M.a.KEY_LOADED,{frag:r,userdata:n})},n.prototype.loaderror=function(t,e){var i=e.frag,n=i.loader;n&&n.abort(),this.loaders[e.type]=void 0;var r=e.url;this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.KEY_LOAD_ERROR,fatal:!1,url:r,frag:i,response:t})},n.prototype.loadtimeout=function(t,e){var i=e.frag,n=i.loader;n&&n.abort(),this.loaders[e.type]=void 0;var r=e.url;this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.KEY_LOAD_TIMEOUT,fatal:!1,url:r,frag:i})},n.prototype.findDecryptKey=function(t){var e={};if(t){for(var i=this.decryptKeyPairs.length-1;0<=i;i--)if(this.decryptKeyPairs[i].decrypturl===t){e.decrypturl=this.decryptKeyPairs[i].decrypturl,e.decryptkey=this.decryptKeyPairs[i].decryptkey;break}this.decryptKeyPairs.length>this.pairsMax&&this.decryptKeyPairs.splice(0,this.decryptKeyPairs.length-this.pairsMax)}return e},n.prototype.addDecryptKey=function(t,e){this.decryptKeyPairs.push({decrypturl:t,decryptkey:e})},n}(x),wt={isBuffered:function(t,e){try{if(t)for(var i=t.buffered,n=0;n<i.length;n++)if(e>=i.start(n)&&e<=i.end(n))return!0}catch(t){}return!1},bufferInfo:function(t,e,i){try{if(t){var n,r=t.buffered,a=[];for(n=0;n<r.length;n++)a.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(a,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,i){var n,r,a,s,o,l=[];for(t.sort(function(t,e){return t.start-e.start||e.end-t.end}),o=0;o<t.length;o++){var u=l.length;if(u){var h=l[u-1].end;t[o].start-h<i?t[o].end>h&&(l[u-1].end=t[o].end):l.push(t[o])}else l.push(t[o])}for(n=o=0,r=a=e;o<l.length;o++){var c=l[o].start,d=l[o].end;if(c<=e+i&&e<d)r=c,n=(a=d)-e;else if(e+i<c){s=c;break}}return{len:n,start:r,end:a,nextStart:s}}},kt=i(8),At=i(5),Lt=i.n(At),Pt=i(12),Ct=i.n(Pt),xt=u(),It=function(){function l(i,t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,l),this.hls=i,this.id=t;var r=this.observer=new Lt.a,e=i.config;r.trigger=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];r.emit.apply(r,[t,t].concat(i))},r.off=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];r.removeListener.apply(r,[t].concat(i))};var n=function(t,e){(e=e||{}).frag=this.frag,e.id=this.id,i.trigger(t,e)}.bind(this);r.on(M.a.FRAG_DECRYPTED,n),r.on(M.a.FRAG_PARSING_INIT_SEGMENT,n),r.on(M.a.FRAG_PARSING_DATA,n),r.on(M.a.FRAG_PARSED,n),r.on(M.a.ERROR,n),r.on(M.a.FRAG_PARSING_METADATA,n),r.on(M.a.FRAG_PARSING_USERDATA,n),r.on(M.a.INIT_PTS_FOUND,n);var a={mp4:xt.isTypeSupported("video/mp4"),mpeg:xt.isTypeSupported("audio/mpeg"),mp3:xt.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(e.enableWorker&&"undefined"!=typeof Worker){Y.b.log("demuxing in webworker");var o=void 0;try{o=this.w=Ct()(13),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(t){i.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:a,vendor:s,id:t,config:JSON.stringify(e)})}catch(t){Y.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new kt.a(r,a,e,s),this.w=void 0}}else this.demuxer=new kt.a(r,a,e,s)}return l.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},l.prototype.push=function(t,e,i,n,r,a,s,o){var l=this.w,u=isNaN(r.startDTS)?r.start:r.startDTS,h=r.decryptdata,c=this.frag,d=!(c&&r.cc===c.cc),f=!(c&&r.level===c.level),p=c&&r.sn===c.sn+1,g=!f&&p;if(d&&Y.b.log(this.id+":discontinuity detected"),f&&Y.b.log(this.id+":switch detected"),this.frag=r,l)l.postMessage({cmd:"demux",data:t,decryptdata:h,initSegment:e,audioCodec:i,videoCodec:n,timeOffset:u,discontinuity:d,trackSwitch:f,contiguous:g,duration:a,accurateTimeOffset:s,defaultInitPTS:o},t instanceof ArrayBuffer?[t]:[]);else{var m=this.demuxer;m&&m.push(t,h,e,i,n,u,d,f,g,a,s,o)}},l.prototype.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case M.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},l}(),Rt={toString:function(t){for(var e="",i=t.length,n=0;n<i;n++)e+="["+t.start(n).toFixed(3)+","+t.end(n).toFixed(3)+"]";return e}},Dt=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),Nt="STOPPED",Ot="IDLE",Mt="KEY_LOADING",Ut="FRAG_LOADING",Ft="FRAG_LOADING_WAITING_RETRY",Bt="WAITING_LEVEL",Gt="PARSING",jt="PARSED",Ht="BUFFER_FLUSHING",Vt="ENDED",Wt="ERROR",zt=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.MANIFEST_LOADING,M.a.MANIFEST_PARSED,M.a.LEVEL_LOADED,M.a.KEY_LOADED,M.a.FRAG_LOADED,M.a.FRAG_LOAD_EMERGENCY_ABORTED,M.a.FRAG_PARSING_INIT_SEGMENT,M.a.FRAG_PARSING_DATA,M.a.FRAG_PARSED,M.a.ERROR,M.a.AUDIO_TRACK_SWITCHING,M.a.AUDIO_TRACK_SWITCHED,M.a.BUFFER_CREATED,M.a.BUFFER_APPENDED,M.a.BUFFER_FLUSHED));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e._state=Nt,e.ontick=e.tick.bind(e),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),x.prototype.destroy.call(this),this.state=Nt},n.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=i.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}0<e&&-1===t&&(Y.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=Ot,Y.b.log("startLoad step1: nextLoadPosition="+this.nextLoadPosition+", rawStartPosition="+this.rawStartPosition+", lastCurrentTime="+this.lastCurrentTime+", startPosition="+this.startPosition),this.nextLoadPosition=this.rawStartPosition=this.lastCurrentTime=t,Y.b.log("startLoad step2: nextLoadPosition="+this.nextLoadPosition+", rawStartPosition="+this.rawStartPosition+", lastCurrentTime="+this.lastCurrentTime+", startPosition="+this.startPosition),this.tick()}else this.forceStartLoad=!0,this.state=Nt},n.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Nt,this.forceStartLoad=!1},n.prototype.tick=function(){1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},n.prototype.doTick=function(){switch(this.state){case Ht:this.fragLoadError=0;break;case Ot:this._doTickIdle();break;case Bt:var t=this.levels[this.level];t&&t.details&&(this.state=Ot);break;case Ft:var e=performance.now(),i=this.retryDate;(!i||i<=e||this.media&&this.media.seeking)&&(Y.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=Ot)}this._checkBuffer(),this._checkFragmentChanged()},n.prototype._doTickIdle=function(){var t=this.hls,e=t.config,i=this.media;if(void 0===this.levelLastLoaded||i||!this.startFragRequested&&e.startFragPrefetch){var n;n=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var r=t.nextLoadLevel,a=this.levels[r];if(a){var s=a.bitrate,o=void 0;o=s?Math.max(8*e.maxBufferSize/s,e.maxBufferLength):e.maxBufferLength,o=Math.min(o,e.maxMaxBufferLength);var l=wt.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,n,e.maxBufferHole),u=l.len;if(!(o<=u)){Y.b.trace("buffer length of "+u.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=r;var h=a.details;if(void 0===h||!0===h.live&&this.levelLastLoaded!==r)return void(this.state=Bt);var c=this.fragPrevious;if(!h.live&&c&&!c.backtracked&&c.sn===h.endSN&&!l.nextStart&&Math.min(i.duration,c.start+c.duration)-Math.max(l.end,c.start)<=Math.max(.2,c.duration)){var d={};return this.altAudio&&(d.type="video"),this.hls.trigger(M.a.BUFFER_EOS,d),void(this.state=Vt)}this._fetchPayloadOrEos(n,l,h)}}}},n.prototype._fetchPayloadOrEos=function(t,e,i){var n=this.fragPrevious,r=this.level,a=i.fragments,s=a.length,o=this.hls;if(0!==s){Y.b.log("pos="+t+", levelDetails.level="+i.url),Y.b.log("bufferInfo: length="+e.len+", start="+e.start+", end="+e.end+", nextStart="+e.nextStart+" ");var l=a[0].start,u=a[s-1].start+a[s-1].duration,h=e.end,c=void 0;if(i.initSegment&&!i.initSegment.data)c=i.initSegment;else if(i.live){var d=this.config.initialLiveManifestSize;if(s<d)return void Y.b.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+d);if(null===(c=this._ensureFragmentAtLivePoint(i,h,l,u,n,a,s)))return void Y.b.log("t(loadFrag): _ensureFragmentAtLivePoint is null");c&&Y.b.log("t(loadFrag): _ensureFragmentAtLivePoint suc. frag.sn="+c.sn)}else h<l&&(c=a[0]);c||(Y.b.log("t(loadFrag): start="+l+", fragPrevious.sn="+(n&&n.sn?n.sn:null)),c=this._findFragment(l,n,s,a,h,u,i)),c&&(o.cdnsCtrl.rewriteUrlByCdnCtrls(c,this.levels[r].bitrate),this._loadFragmentOrKey(c,r,i,t,h))}},n.prototype._ensureFragmentAtLivePoint=function(t,e,i,n,r,a,s){var o=this.hls.config,l=this.media,u=void 0,h=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(i-o.maxFragLookUpTolerance,n-h)){var c=this.liveSyncPosition=this.computeLivePosition(i,t);Y.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),e=c,l&&l.readyState&&l.duration>c&&(l.currentTime=c),this.nextLoadPosition=c}if(t.PTSKnown&&n<e&&l&&l.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(r){var d=r.sn+1;if(d>=t.startSN&&d<=t.endSN){var f=a[d-t.startSN];r.cc===f.cc&&(u=f,Y.b.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=tt.search(a,function(t){return r.cc-t.cc}))&&Y.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}u||(u=a[Math.min(s-1,Math.round(s/2))],Y.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u&&Y.b.log("_ensureFragmentAtLivePoint: url="+u.relurl+", sn= "+u.sn),u},n.prototype._findFragment=function(t,e,i,n,r,a,s){var o=this.hls.config,l=void 0,u=void 0,h=o.maxFragLookUpTolerance,c=e?n[e.sn-n[0].sn+1]:void 0,d=function(t){var e=Math.min(h,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-e<=r?1:t.start-e>r&&t.start?-1:0},f=c?c.relurl:"";if(Y.b.log("FindFragments: start="+t+", bufferEnd="+r+", end="+a+", fragNext.url="+f),e&&Y.b.log("FragPrevious is not null. sn="+e.sn+", url="+e.relurl+", start="+e.start+", duration="+e.duration),r<a?(a-h<r&&(h=0),c&&!d(c)?(u=c,Y.b.log("FindFragments: find with fragNext. url="+c.relurl+", sn="+c.sn+", duration="+c.duration)):(u=tt.search(n,d),Y.b.log("FindFragments: find by BinarySearch."))):u=n[i-1],u){if(Y.b.log("Found Frag: relurl="+u.relurl+", start="+u.start+", duration="+u.duration),l=u,this.hls.config.lteMode&&u&&u.sn>n[0].sn){u=tt.search(n,function(t){return t.sn<l.sn-1?1:t.sn>l.sn-1?-1:0}),l&&u&&l.sn!==u.sn&&(Y.b.log("Recalc download frag. newSn = "+u.sn+", url="+u.relurl+", oldSn = "+l.sn+", oldUrl="+l.relurl),l=u)}var p=l.sn-s.startSN,g=e&&l.level===e.level,m=n[p-1],v=n[p+1];if(e&&l.sn===e.sn)if(Y.b.log("t(loadFrag): frag.sn == fragPrevious.sn. sn="+e.sn+", url="+l.relurl),g&&!l.backtracked)if(l.sn<s.endSN){var y=e.deltaPTS;y&&y>o.maxBufferHole&&e.dropped&&p?(l=m,Y.b.warn("t(loadFrag): SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),e.loadCounter--):(l=v,Y.b.log("t(loadFrag): SN just loaded, load next one: sn="+l.sn+", url="+l.relurl))}else l=null,Y.b.log("t(loadFrag): sameLevel: set frag to null");else l.backtracked&&(v&&v.backtracked?(Y.b.warn("t(loadFrag): Already backtracked from fragment "+v.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+v.sn),l=v):(Y.b.warn("t(loadFrag): Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,m?(m.loadCounter&&m.loadCounter--,(l=m).backtracked=!0):p&&(l=null,Y.b.log("t(loadFrag): not sameLevel: set frag to null"))))}return l&&Y.b.log("Findfragment: fragment url="+l.relurl+", start="+l.start+", duration="+l.duration),l},n.prototype._loadFragmentOrKey=function(t,e,i,n,r){var a=this.hls,s=a.config;if(!t.decryptdata||null==t.decryptdata.uri||null!=t.decryptdata.key){if(Y.b.log("t(loadFrag): Loading "+t.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+e+", url "+t.relurl+", currentTime:"+n.toFixed(3)+",bufferEnd:"+r.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;var o=s.fragLoadingLoopThreshold;if(t.loadCounter>o&&Math.abs(this.fragLoadIdx-t.loadIdx)<o)return void a.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;return t.loadIdx=this.fragLoadIdx,t.autoLevel=a.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||t.bitrateTest||(this.nextLoadPosition=t.start+t.duration),a.trigger(M.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new It(a,"main")),void(this.state=Ut)}Y.b.log("Loading key for "+t.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+e),this.state=Mt,a.trigger(M.a.KEY_LOADING,{frag:t})},n.prototype.getBufferedFrag=function(e){return tt.search(this._bufferedFrags,function(t){return e<t.startPTS?-1:e>t.endPTS?1:0})},n.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},n.prototype._checkFragmentChanged=function(){var t,e,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((e=i.currentTime)>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),wt.isBuffered(i,e)?t=this.getBufferedFrag(e):wt.isBuffered(i,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var n=t;if(n!==this.fragPlaying){this.hls.trigger(M.a.FRAG_CHANGED,{frag:n});var r=n.level;this.fragPlaying&&this.fragPlaying.level===r||this.hls.trigger(M.a.LEVEL_SWITCHED,{level:r}),this.fragPlaying=n}}},n.prototype.immediateLevelSwitch=function(){if(Y.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,e=void 0;t?(e=t.paused,Y.b.log("ImmediateLevelSwitch: pause level. currentTime="+t.currentTime),t.pause(),this.previouslyPausedCurrentTime=t.currentTime):e=!0,this.previouslyPaused=e}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,wt.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),Y.b.log("immediateLevelSwitchEnd: set media currentTime="+t.currentTime),this.previouslyPaused||(Y.b.log("immediateLevelSwitchEnd: resume play"),t.play()))},n.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e,i=void 0,n=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),(e=this.getBufferedFrag(t.currentTime))&&1<e.startPTS&&(Y.b.log("Flush: start=0, end="+(e.startPTS-1)),this.flushMainBuffer(0,e.startPTS-1)),t.paused)i=0;else{var r=this.hls.nextLoadLevel,a=this.levels[r],s=this.fragLastKbps;i=s&&this.fragCurrent&&a&&a.bitrate?this.fragCurrent.duration*a.bitrate/(1e3*s)+1:0}if((n=this.getBufferedFrag(t.currentTime+i))&&(n=this.followingBufferedFrag(n))){var o=this.fragCurrent;o&&o.loader&&(o.loader.abort(),Y.b.log("Cacel load frag: url="+o.relurl)),this.fragCurrent=null,Y.b.log("Flush: start="+n.startPTS+", end=infinite"),this.flushMainBuffer(n.maxStartPTS,Number.POSITIVE_INFINITY)}}},n.prototype.flushMainBuffer=function(t,e){this.state=Ht;var i={startOffset:t,endOffset:e};this.altAudio&&(i.type="video"),this.hls.trigger(M.a.BUFFER_FLUSHING,i)},n.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition)},n.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(Y.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=-1);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0,t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},n.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,i=this.config;isNaN(e)||Y.b.log("media seeking to "+e.toFixed(3));var n=this.mediaBuffer?this.mediaBuffer:t,r=wt.bufferInfo(n,e,this.config.maxBufferHole);if(this.state===Ut){var a=this.fragCurrent;if(0===r.len&&a){var s=i.maxFragLookUpTolerance,o=a.start-s,l=a.start+a.duration+s;e<o||l<e?(a.loader&&(Y.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=Ot):Y.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===Vt&&(0===r.len&&(this.fragPrevious=0),this.state=Ot);t&&(this.lastCurrentTime=e),this.state!==Ut&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},n.prototype.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;isNaN(e)||Y.b.log("media seeked to "+e.toFixed(3)),this.tick()},n.prototype.onMediaEnded=function(){Y.b.log("media ended"),this.startPosition=this.lastCurrentTime=-1},n.prototype.onManifestLoading=function(){Y.b.log("trigger BUFFER_RESET"),this.hls.trigger(M.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=-1},n.prototype.onManifestParsed=function(t){var e,i=!1,n=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(i=!0),-1!==e.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=i&&n,this.audioCodecSwitch&&Y.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var r=this.config;if((r.autoStartLoad||this.forceStartLoad)&&(this.hls.startLoad(r.startPosition),this.levels&&1===this.levels.length&&(Y.b.log("onLevelLoaded: startPosition="+this.startPosition+", lastCurrentTime="+this.lastCurrentTime),(-1===this.startPosition||-1===this.lastCurrentTime)&&"number"==typeof this.rawStartPosition&&0<=this.rawStartPosition))){var a=this.levels[0].details;Y.b.log("onLevelLoaded: step init. newDetails.live="+a.live),a.live?(Y.b.log("onLevelLoaded: rawStartPosition="+this.rawStartPosition+", startProgramDateTime="+startProgramDateTime),this.startPosition=this.lastCurrentTime=this.nextLoadPosition=this.rawStartPosition<startProgramDateTime?0:this.rawStartPosition-startProgramDateTime):(Y.b.log("onLevelLoaded: startPosition="+this.startPosition+", lastCurrentTime="+this.lastCurrentTime+", rawStartPosition="+this.rawStartPosition+", nextLoadPosition="+this.nextLoadPosition),this.startPosition=this.lastCurrentTime=this.rawStartPosition,this.startPosition=this.nextLoadPosition=this.rawStartPosition),this.rawStartPosition=null}},n.prototype.onLevelLoaded=function(t){var e=t.details,i=t.level,n=this.levels[this.levelLastLoaded],r=this.levels[i],a=e.totalduration,s=0,o=0;if(!1===t.details.live?this.totalduration=a:this.totalduration=-1,Y.b.log("level "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live){var l=r.details;if(r&&n&&r.level!==n.level&&Y.b.log("onLevelLoaded: error. currentLevel("+r.level+") != lastLevel("+n.level+")"),l&&0<e.fragments.length){if(Y.b.log("before merge details"),m(l,e),Y.b.log("after merge details"),s=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,l),0<l.fragments.length){var u=l.fragments[l.fragments.length-1];void 0!==u.endPTS?this.liveEdge=u.endPTS:u.start&&u.duration&&(this.liveEdge=u.start+u.duration)}if(e.PTSKnown&&!isNaN(s))Y.b.log("live playlist sliding:"+s.toFixed(3));else{Y.b.log("live playlist - outdated PTS, unknown sliding");var h=this.hls.userDataMgr.neuLiveStream();v(this.fragPrevious,n,e,h)}}else{if(0<e.fragments.length&&(o=e.fragments[0].programDateTime?e.fragments[0].programDateTime.getTime():0,o/=1e3,this.hls.userDataMgr&&-1!==this.hls.config.startPosition)){var c=this.hls.userDataMgr.getProgramDateTime("main",this.hls.config.startPosition);0<=c&&(o=c)}e.PTSKnown=!1,this.fragPrevious&&Y.b.log("fragPrevious. url="+this.fragPrevious.relurl+", sn="+this.fragPrevious.sn+", start="+this.fragPrevious.start+", end="+this.fragPrevious.end);var d=this.hls.userDataMgr.neuLiveStream();v(this.fragPrevious,n,e,d)}}else e.PTSKnown=!1;if(r.details=e,this.levelLastLoaded=i,this.hls.trigger(M.a.LEVEL_UPDATED,{details:e,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){if("number"==typeof this.rawStartPosition&&0<=this.rawStartPosition){if(Y.b.log("onLevelLoaded: step init. newDetails.live="+e.live),e.live){Y.b.log("onLevelLoaded: rawStartPosition="+this.rawStartPosition+", startProgramDateTime="+o);var f=0;this.rawStartPosition>=o&&(f=this.hls.userDataMgr.absTimeToRelTime("main",this.rawStartPosition)),this.startPosition=this.lastCurrentTime=this.nextLoadPosition=f}else this.startPosition=this.lastCurrentTime=this.rawStartPosition,this.startPosition=this.nextLoadPosition=this.rawStartPosition;this.rawStartPosition=null}else{var p=e.startTimeOffset;isNaN(p)?e.live?(this.startPosition=this.computeLivePosition(s,e),Y.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(p<0&&(Y.b.log("negative start time offset "+p+", count from end of last fragment"),p=s+a+p),Y.b.log("start time offset found in playlist, adjust startPosition to "+p),this.startPosition=p),Y.b.log("Levelloaded: startPosition="+this.startPosition+", lastCurrentTime="+this.lastCurrentTime+", rawStartPosition="+this.rawStartPosition+", nextLoadPosition="+this.nextLoadPosition)}this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Bt&&(this.state=Ot),this.tick()},n.prototype.onKeyLoaded=function(){this.state===Mt&&(this.state=Ot,this.tick())},n.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag;if(this.state===Ut&&e&&"main"===i.type&&i.level===e.level&&i.sn===e.sn){var n=t.stats,r=this.levels[e.level],a=r.details;if(Y.b.log("Loaded  "+e.relurl+", "+e.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+e.level),this.bitrateTest=!1,this.stats=n,!0===i.bitrateTest&&this.hls.nextLoadLevel)this.state=Ot,this.startFragRequested=!1,n.tparsed=n.tbuffered=performance.now(),this.hls.trigger(M.a.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.tick(),Y.b.log("this is a bitrateTest.");else if("initSegment"===i.sn)this.state=Ot,n.tparsed=n.tbuffered=performance.now(),a.initSegment.data=t.payload,this.hls.trigger(M.a.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.tick(),Y.b.log("this is a init segment.");else{this.state=Gt;var s=a.totalduration,o=e.level,l=e.sn,u=this.config.defaultAudioCodec||r.audioCodec;this.audioCodecSwap&&(Y.b.log("swapping playlist audio codec"),void 0===u&&(u=this.lastAudioCodec),u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,Y.b.log("Parsing "+l+" of ["+a.startSN+" ,"+a.endSN+"],level "+o+", cc "+e.cc);var h=this.demuxer;h||(h=this.demuxer=new It(this.hls,"main"));var c=this.media,d=!(c&&c.seeking)&&(a.PTSKnown||!a.live),f=a.initSegment?a.initSegment.data:[];h.push(t.payload,f,u,r.videoCodec,e,s,d,void 0)}i.loadCounter=1}this.fragLoadError=0},n.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Gt){var n,r,a=t.tracks;if(a.audio&&this.altAudio&&delete a.audio,r=a.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(Y.b.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==r.container&&(s="mp4a.40.2",Y.b.log("Android: force audio codec to "+s)),r.levelCodec=s,r.id=t.id}for(n in(r=a.video)&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=t.id),this.hls.trigger(M.a.BUFFER_CODECS,a),a){r=a[n],Y.b.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var l=r.initSegment;if(l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(M.a.BUFFER_APPENDING,{type:n,data:l,parent:"main",content:"initSegment",startPTS:t.frag.start,url:t.frag.relurl}),this.hls.config.logServer)){var u=RegExp("(http(s)?:\\/\\/)?(.*\\/)?(.*)\\.(ts|aac)").exec(t.frag.relurl);u&&5<=u.length&&u[4]&&this.hls.trigger(M.a.FRAG_REMUXED,{remuxedData:l,name:u[4]+"_init",type:n})}}this.tick()}},n.prototype.onFragParsingData=function(e){var i=this,t=this.fragCurrent,n=e.frag;if(Y.b.log("onFragParsingData: url="+e.frag.relurl+", startPTS="+e.startPTS+", endPTS="+e.endPTS),t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&("audio"!==e.type||!this.altAudio)&&this.state===Gt){var r=this.levels[this.level],a=t;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),Y.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),this.hls.config.lteMode&&"video"===e.type&&e.frag&&(this.hls.userDataMgr.addLteStreamInfos(e.frag.level,parseFloat((e.startPTS-e.startDTS).toFixed(6))),Y.b.log("pts-dts="+(e.startPTS-e.startDTS))),"video"===e.type)if(a.dropped=e.dropped,a.dropped)if(a.backtracked)Y.b.warn("Already backtracked on this fragment, appending with the gap");else{var s=r.details;if(!s||a.sn!==s.startSN)return Y.b.warn("missing video frame(s), backtracking fragment"),a.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=Ot,this.fragPrevious=a,void this.tick();Y.b.warn("missing video frame(s) on first frag, appending with gap")}else a.backtracked=!1;var o=g(r.details,a,e.startPTS,e.endPTS,e.startDTS,e.endDTS),l=this.hls;if(l.trigger(M.a.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:o,type:e.type,start:e.startPTS,end:e.endPTS}),Y.b.log("onFragParsingData: updateFragPTSDTS. url="+n.relurl+", level="+this.level+", drift="+o+", type="+e.type+", start="+e.startPTS+", end="+e.endPTS),l.config.logServer&&e.data1&&0<e.data1.length&&e.data2&&0<e.data2.length){var u=RegExp("(http(s)?:\\/\\/)?(.*\\/)?(.*)\\.(ts|aac)").exec(e.frag.relurl);if(u&&5<=u.length&&u[4]){var h=new Uint8Array(e.data1.length+e.data2.length);h.set(e.data1),h.set(e.data2,e.data1.length),this.hls.trigger(M.a.FRAG_REMUXED,{remuxedData:h,name:u[4],type:e.type})}}[e.data1,e.data2].forEach(function(t){t&&t.length&&i.state===Gt&&(i.appended=!0,i.pendingBuffering=!0,l.trigger(M.a.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data",startPTS:e.startPTS,endPTS:e.endPTS,url:e.frag.relurl}))}),this.tick()}},n.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"main"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Gt&&(Y.b.log("onFragParsed: url="+t.frag.relurl+", endDTS="+t.frag.endPTS+", startPTS="+t.frag.startPTS+", startDTS="+t.frag.startDTS+", endDTS="+t.frag.endDTS),this.hls.trigger(M.a.FRAG_PARSED_EXTEND,{frag:t.frag}),this.stats.tparsed=performance.now(),this.state=jt,this._checkAppendedParsed())},n.prototype.onAudioTrackSwitching=function(t){var e=!!t.url,i=t.id;if(!e){if(this.mediaBuffer!==this.media){Y.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(Y.b.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ot}var r=this.hls;r.trigger(M.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},n.prototype.onAudioTrackSwitched=function(t){var e=t.id,i=!!this.hls.audioTracks[e].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(Y.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},n.prototype.onBufferCreated=function(t){var e=t.tracks,i=void 0,n=void 0,r=!1;for(var a in e){var s=e[a];"main"===s.id?(i=s,"video"===(n=a)&&(this.videoBuffer=e[a].buffer)):r=!0}this.mediaBuffer=r&&i?(Y.b.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),i.buffer):this.media},n.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==Gt&&e!==jt||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed())}},n.prototype._checkAppendedParsed=function(){if(!(this.state!==jt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;Y.b.log("main buffered : "+Rt.toString(e.buffered));var i=this._bufferedFrags.filter(function(t){return wt.isBuffered(e,(t.startPTS+t.endPTS)/2)});i.push(t),this._bufferedFrags=i.sort(function(t,e){return t.startPTS-e.startPTS}),this.fragPrevious=t;var n=this.stats;n.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(M.a.FRAG_BUFFERED,{stats:n,frag:t,id:"main"}),this.state=Ot}this.tick()}},n.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var i=!!this.media&&wt.isBuffered(this.media,this.media.currentTime)&&wt.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:case U.a.FRAG_LOAD_SLOW:case U.a.KEY_LOAD_ERROR:case U.a.KEY_LOAD_TIMEOUT:if(t.fatal)this.state=Wt;else if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);e.loadCounter=0,Y.b.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=Ft}else Y.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Wt;break;case U.a.FRAG_LOOP_LOADING_ERROR:t.fatal||(i?(this._reduceMaxBufferLength(e.duration),this.state=Ot):e.autoLevel&&0!==e.level||(t.fatal=!0,this.state=Wt));break;case U.a.LEVEL_LOAD_ERROR:case U.a.LEVEL_LOAD_TIMEOUT:this.state!==Wt&&(t.fatal?(this.state=Wt,Y.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==Bt||(this.state=Ot));break;case U.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==Gt&&this.state!==jt||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=Ot):(Y.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},n.prototype._reduceMaxBufferLength=function(t){var e=this.config;e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,Y.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*e.fragLoadingLoopThreshold))},n.prototype._checkBuffer=function(){var t=this.media,e=this.config;if(t&&t.readyState){var i=t.currentTime,n=this.mediaBuffer?this.mediaBuffer:t,r=n.buffered;if(!this.loadedmetadata&&r.length){this.loadedmetadata=!0;var a=t.seeking?i:this.startPosition,s=wt.isBuffered(n,a),o=r.start(0),l=!s&&Math.abs(a-o)<e.maxSeekHole;(i!==a||l)&&(Y.b.log("target start position:"+a),l&&(a=o,Y.b.log("target start position not buffered, seek to buffered.start(0) "+a)),Y.b.log("adjust currentTime from "+i+" to "+a),t.currentTime=a)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var u=wt.bufferInfo(t,i,0),h=!(t.paused||t.ended||0===t.buffered.length);if(i!==this.lastCurrentTime)this.stallReported&&(Y.b.warn("playback not stuck anymore @"+i+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(h){var c=performance.now(),d=this.hls;if(this.stalled){var f=c-this.stalled,p=u.len,g=this.nudgeRetry||0;if(p<=.5&&f>1e3*e.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,Y.b.warn("playback stalling in low buffer @"+i),d.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:p}));var m=u.nextStart,v=m-i;if(m&&v<e.maxSeekHole&&0<v){this.nudgeRetry=++g;var y=g*e.nudgeOffset;Y.b.log("adjust currentTime from "+t.currentTime+" to next buffered @ "+m+" + nudge "+y),t.currentTime=m+y,this.stalled=void 0,d.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:m+y-i})}}else if(.5<p&&f>1e3*e.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,Y.b.warn("playback stalling in high buffer @"+i),d.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:p})),this.stalled=void 0,this.nudgeRetry=++g,g<e.nudgeMaxRetry){var b=t.currentTime,_=b+g*e.nudgeOffset;Y.b.log("adjust currentTime from "+b+" to "+_),t.currentTime=_,d.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else Y.b.error("still stuck in high buffer @"+i+" after "+e.nudgeMaxRetry+", raise fatal error"),d.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=c,this.stallReported=!1}}}},n.prototype.onFragLoadEmergencyAborted=function(){this.state=Ot,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},n.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(t){return wt.isBuffered(e,(t.startPTS+t.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=Ot,this.fragPrevious=null},n.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.prototype.computeLivePosition=function(t,e){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-i)},n.prototype.reSetErrToIdle=function(){this.state===Wt&&(this._state=Ot,Y.b.warn("reSetErrToIdle: recover from segment download error."))},Dt(n,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,Y.b.log("main stream:"+e+"->"+t),this.hls.trigger(M.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}},{key:"liveEdge",get:function(){return this._liveEdge},set:function(t){this._liveEdge=t}}]),n}(x),Kt=i(9),Yt=i.n(Kt),Xt=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),qt=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MANIFEST_LOADED,M.a.LEVEL_LOADED,M.a.FRAG_LOADED,M.a.ERROR));return e.canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,e.manifestHost=void 0,e.playlistDelayNum=0,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},n.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},n.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},n.prototype.stopLoad=function(){this.canload=!1,this.resetManifestHost(),this.playlistDelayNum=0},n.prototype.onManifestLoaded=function(t){var e=[],i=void 0,n={},r=null,a=!1,s=!1,o=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=[];if(void 0===this.manifestHost){var u=Yt.a.parseUri(t.url);void 0!==u.host&&(this.manifestHost=u.host)}if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,a=a||!!t.videoCodec,s=s||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),!0===o&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),void 0===(r=n[t.bitrate])?(t.url=[t.url],t.urlId=0,n[t.bitrate]=t,e.push(t)):r.url.push(t.url)}),!0===a&&!0===s&&(e=e.filter(function(t){return!!t.videoCodec})),e=e.filter(function(t){var e=t.audioCodec,i=t.videoCodec;return(!e||p(e))&&(!i||p(i))}),t.audioTracks&&(l=t.audioTracks.filter(function(t){return!t.audioCodec||p(t.audioCodec,"audio")})),0<e.length){i=e[0].bitrate,e.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=e;var h=this.hls.config.startBitrate,c=null;if(h)for(var d=0;d<e.length;d++)if(e[d].bitrate===h){c=d,this._startLevel=d,Y.b.log("manifest loaded,"+e.length+" level(s) found, first bitrate is configStartLevel:"+h);break}if(null===c)for(var f=0;f<e.length;f++)if(e[f].bitrate===i){c=f,Y.b.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+i);break}this._firstLevel=c,this.hls.trigger(M.a.MANIFEST_PARSED,{levels:e,audioTracks:l,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:a,altAudio:0<l.length})}else this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},n.prototype.setLevelInternal=function(t){var e=this._levels,i=this.hls;if(0<=t&&t<e.length){if(this.cleanTimer(),this.currentLevelIndex!==t){Y.b.log("switching to level "+t);var n=e[this.currentLevelIndex=t];n.level=t,i.trigger(M.a.LEVEL_SWITCH,n),i.trigger(M.a.LEVEL_SWITCHING,n)}var r=e[t],a=r.details;if(!1!==i.cdnsCtrl.isActive(r.playlistType)&&a&&!0!==a.live)Y.b.warn("enter use neulion multi cdns");else{var s=r.urlId;i.trigger(M.a.LEVEL_LOADING,{url:r.url[s],level:t,id:s})}}else i.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},n.prototype.onError=function(t){if(!0!==t.fatal){var e=!1,i=!1,n=void 0;switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:case U.a.FRAG_LOAD_SLOW:case U.a.FRAG_LOOP_LOADING_ERROR:case U.a.KEY_LOAD_ERROR:case U.a.KEY_LOAD_TIMEOUT:n=t.frag.level,i=!0;break;case U.a.LEVEL_LOAD_ERROR:case U.a.LEVEL_LOAD_TIMEOUT:n=t.context.level,e=!0;break;case U.a.REMUX_ALLOC_ERROR:n=t.level,e=!0}void 0!==n&&this.recoverLevel(t,n,e,i)}else t.type===U.b.NETWORK_ERROR&&this.cleanTimer()},n.prototype.recoverLevel=function(t,e,i,n){var r=this,a=this.hls.config,s=t.details,o=this._levels[e],l=void 0,u=void 0,h=void 0;o.loadError++;var c=!1;if(!0===(o.fragmentError=n)&&(c=this.recoverLevelByNeulionCdnStrategy(e,t),!0===t.fatal&&(Y.b.warn("level controller, use Neulion cdn strategy and cannot recover from "+s+" error"),-1===this.manualLevelIndex?(h=0===e?this._levels.length-1:e-1,Y.b.warn("level controller, "+s+": switch to "+h),this.hls.nextAutoLevel=this.currentLevelIndex=h):Y.b.warn("level controller, "+s+": reload a fragment"))),!1===c){if(!0===i){if(!(this.levelRetryCount+1<=a.levelLoadingMaxRetry))return Y.b.error("level controller, Cannot recover from "+s+" error. Reach max level retry count("+a.levelLoadingMaxRetry+")"),this.currentLevelIndex=null,this.cleanTimer(),void(t.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return r.loadLevel()},u),t.levelRetry=!0,this.levelRetryCount++,Y.b.warn("level controller, "+s+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}!0!==i&&!0!==n||(1<(l=o.url.length)&&o.loadError<l?(Y.b.warn("level controller, "+s+" for level "+e+": switching to redundant stream id "+o.urlId),o.urlId=(o.urlId+1)%l,o.details=void 0):-1===this.manualLevelIndex?(h=0===e?this._levels.length-1:e-1,Y.b.warn("level controller, "+s+": switch to "+h),this.hls.nextAutoLevel=this.currentLevelIndex=h):!0===n&&(Y.b.warn("level controller, "+s+": reload a fragment"),this.currentLevelIndex=null))}},n.prototype.recoverLevelByNeulionCdnStrategy=function(t,e){var i=!1;do{var n=e.details,r=e.frag;if(null==r||null==r.sn||null==r.type)break;var a=this.hls.cdnsCtrl;if(!1===a.isActive(r.type))break;var s=a.getMultiCdnNode(r.type,r.sn);if(null==s)return;var o=s.cdnNodes.length;1<o&&s.cdnRetryTimes<o-1?(s.currentIndex=(s.currentIndex+1)%o,s.setSwitching(!0),s.cdnRetryTimes++,s.log("level controller,"+n+" for level "+t+": switching begin"),s.getActiveCdn().log()):(s.setSwitching(!1),s.cdnRetryTimes=0,e.fatal=!0,s.log("level controller,"+n+" for level "+t+": switching end")),i=!0,s.logSwitchInfo();break}while(0);return i},n.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var i=this._levels[e.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},n.prototype.onLevelLoaded=function(t){var e=this,i=t.level;if(i===this.currentLevelIndex){var n=this._levels[i];!1===n.fragmentError&&(n.loadError=0,this.levelRetryCount=0);var r=t.details;if(r.live){var a=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),s=n.details;s&&r.endSN===s.endSN&&(a/=2,Y.b.log("same live playlist, reload twice faster")),a-=performance.now()-t.stats.trequest,a=Math.max(1e3,Math.round(a)),Y.b.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},a)}else this.cleanTimer()}},n.prototype.loadLevel=function(){var t=this,e=void 0,i=void 0;null!==this.currentLevelIndex&&!0===this.canload&&(e=this._levels[this.currentLevelIndex],this.hls.config.lteMode&&this.hls.media&&this.hls.media.seeking&&this.playlistDelayNum<=10?(Y.b.log("delay level load, because parsing playlist cost big"),this.playlistDelayNum+=1,this.timer=setTimeout(function(){return t.loadLevel()},300)):void 0!==e&&0<e.url.length&&(i=e.urlId,this.playlistDelayNum=0,this.hls.trigger(M.a.LEVEL_LOADING,{url:e.url[i],level:this.currentLevelIndex,id:i})))},n.prototype.resetManifestHost=function(){this.manifestHost=void 0},Xt(n,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&void 0!==e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),n}(x),Zt=i(3),Qt=i(6),Jt=i.n(Qt),$t=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.FRAG_PARSING_METADATA));return e.id3Track=void 0,e.media=void 0,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){x.prototype.destroy.call(this)},n.prototype.onMediaAttached=function(t){this.media=t.media,this.media},n.prototype.onMediaDetaching=function(){this.media=void 0},n.prototype.onFragParsingMetadata=function(t){var e=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden",this.id3Track.hashId=Jt.a.createHashName("metadata","id3"));for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,r=0;r<i.length;r++){var a=Zt.a.getID3Frames(i[r].data);if(a){var s=i[r].pts,o=r<i.length-1?i[r+1].pts:e.endPTS;s===o&&(o+=1e-4);for(var l=0;l<a.length;l++){var u=a[l];if(!Zt.a.isTimeStampFrame(u))if(Zt.a.isGeobFrame(u)){var h=this.hls.advertisementController.trigAdvertiseInSegment(s,u,e),c=this.hls.browser;if((null==c||"IE"!=c)&&0!==h){var d=new n(s,o,"");d.value=u,this.id3Track.addCue(d)}}else{var f=new n(s,o,"");f.value=u,this.id3Track.addCue(f)}}}}},n}(x),te=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.THUMBNAILS_TRACK_LOADED,M.a.THUMBNAIL_IMAGE_LOADED,M.a.ERROR));return e.config=t.config,e.thumbnailStreams=[],e.baseTime=void 0,e.useNeulionCdns=!1,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.thumbnailStreams=[],this.baseTime=void 0,x.prototype.destroy.call(this)},n.prototype.onThumbnailsTrackLoaded=function(t){var e=null;if(void 0!==t.id){var i=t.id.split("&");if(2===i.length)for(var n=i[0],r=i[1],a=this.thumbnailStreams,s=a.length-1;0<=s;s--)if(a[s].id===n){var o=t.details.url.lastIndexOf("/");if(-1!==o&&-1!==t.details.url.search(/\.m3u8/)){var l=t.details.url.substring(0,o);e=this.setThumbnailStreamVtt(n,t.details.live,l,t.details.fragments,r)}break}}if(null!=e){var u=e.imageUrl;this.useNeulionCdns&&(u=this.hls.cdnsCtrl.rewriteImageUrlByCdnCtrls("thumbnails",e.sn,u)),this.hls.trigger(M.a.THUMBNAILS_IMAGE_LOADING,{url:e.imageUrl,id:t.id+"&"+e.baseTime,cb:t.cb})}else Y.b.log("thumbnail: not find images with the time")},n.prototype.onThumbnailImageLoaded=function(t){var e=null,i=null,n=null,r=null;if(void 0!==t.id){Y.b.log("onThumbnailImageLoaded id="+t.id);var a=t.id.split("&");if(3===a.length){e=a[0],i=a[1],n=a[2];for(var s=this.thumbnailStreams.length-1;0<=s;s--)if(this.thumbnailStreams[s].id===e){var o=-1;if(t&&t.url&&Yt.a.isAbsoluteURL(t.url)){o=t.url.lastIndexOf("/");var l=t.url.substr(0,o);o=l.lastIndexOf("/"),r=l.substr(0,o)}else o=this.thumbnailStreams[s].playlistUrl.lastIndexOf("/"),r=this.thumbnailStreams[s].playlistUrl.substring(0,o);if(this.useNeulionCdns&&t.url){var u=Yt.a.parseUri(t.url),h=Yt.a.parseUri(r);if(u&&h&&void 0!==u.host){var c="";u.protocol&&(c=(c=c.concat(u.protocol)).concat("://")),c=c.concat(u.host),null!=u.port&&(c=(c=c.concat(":")).concat(u.port)),c=c.concat("/"),null!=h.path&&(c=c.concat(h.path)),r=c}}break}}}if(null!=e&&null!=i&&null!=n&&null!=r){var d=this.parseImageVttContent(r,n,t.content);if(0<d.length){var f={images:d,baseTime:n,requestTime:i,streamId:e},p=this.filterThumbnailImages(f);this.hls.trigger(M.a.THUMBNAIL_IMAGE_ASSEMBLED,{thumbnails:p,cb:t.cb})}}},n.prototype.filterThumbnailImages=function(t){var e=null,i=this.hls.userDataMgr;if(i.cvodStream()){var n=i.getTimeline("main");if(n.init){e={images:[],baseTime:t.baseTime,requestTime:t.requestTime-n.absStart,streamId:t.streamId};for(var r=0;r<t.images.length;r++){var a={endTime:t.images[r].endTime,startTime:t.images[r].startTime,height:t.images[r].height,width:t.images[r].width,url:t.images[r].url,topX:t.images[r].topX,topY:t.images[r].topY};0<=a.endTime-n.absStart&&(0<=a.startTime-n.absStart?a.startTime-=n.absStart:a.startTime=0,a.endTime-=n.absStart,e.images.push(a))}}}return null===e&&(e=t),e},n.prototype.onError=function(t){var e=t.frag;e&&"thumbnials"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},n.prototype.clear=function(){this.thumbnailStreams=[]},n.prototype.getThumbnailStreams=function(){for(var t=[],e=0;e<this.thumbnailStreams.length;e++){var i={width:this.thumbnailStreams[e].width,height:this.thumbnailStreams[e].height,id:this.thumbnailStreams[e].id,baseTime:this.baseTime?this.baseTime:void 0};t.push(i)}return t},n.prototype.setThumbnailStreams=function(t){this.clear();for(var e=0;e<t.length;e++)if(void 0!==t[e].solution){var i=t[e].solution.split("x");if(2!==i.length)continue;var n={width:Number(i[0]),height:Number(i[1]),id:t[e].id.toString(),playlistUrl:t[e].url,live:!0,vttCues:[]};this.thumbnailStreams.push(n)}},n.prototype.setThumbnailStreamVtt=function(t,e,i,n,r){for(var a=null,s=0;s<this.thumbnailStreams.length;s++)if(t===this.thumbnailStreams[s].id){this.thumbnailStreams[s].live=e,0<this.thumbnailStreams[s].vttCues.length&&(this.thumbnailStreams[s].vttCues=[]);for(var o=null,l=null,u=this.thumbnailStreams[s].vttCues,h=n.length-1;0<=h;h--){var c={},d=n[h].relurl,f=d.search(/Time=\d+\.vtt/);if(-1!==f){!1===Yt.a.isAbsoluteURL(d)?c.imageUrl=i+"/"+d:c.imageUrl=d;var p=d.substring(f);c.baseTime=Number(p.substring(5,p.length-4))/this.hls.userDataMgr.getThumbnailTimeScale(),c.duration=n[h].duration,c.sn=n[h].sn,u.push(c),h===n.length-1&&(o=c.baseTime+c.duration),(l=c.baseTime)<=r&&r<=o&&(a=c),o=l}}break}return a},n.prototype.getVttUrl=function(t,r){var a=null,s=1/0,e=!1;return 0<=t&&t<this.thumbnailStreams.length&&(this.thumbnailStreams[t].vttCues.forEach(function(t){if(t.baseTime<=r&&t.baseTime+t.duration>=r)return e=!0,a=t}),!1===e&&this.thumbnailStreams[t].vttCues.forEach(function(t){var e=Math.pow(t.baseTime-r,2),i=Math.pow(t.baseTime+t.duration-r,2),n=Math.sqrt(e+i);n<s&&(s=n,a=t)})),Y.b.log(null),a},n.prototype.getThumbnailStreamImages=function(t,e,i){var n={id:null,playlistUrl:null,vttCue:null};if(0<this.thumbnailStreams.length)for(var r=this.thumbnailStreams.length-1;0<=r;r--)if(this.thumbnailStreams[r].id===t){n.playlistUrl=this.thumbnailStreams[r].playlistUrl,this.thumbnailStreams[r].live||(n.vttCue=this.getVttUrl(r,e)),n.id=this.thumbnailStreams[r].id+"&"+e,null!=n.vttCue&&(n.id=n.id+"&"+n.vttCue.baseTime);break}if(Y.b.log("getThumbnailStreamImages: streamid="+t+", time="+e),null!=n.vttCue&&null!=n.vttCue.imageUrl){var a=n.vttCue.imageUrl;Y.b.log("image id="+n.id+", reurl="+a),this.useNeulionCdns&&(a=this.hls.cdnsCtrl.rewriteImageUrlByCdnCtrls("thumbnails",n.vttCue.sn,a)),this.hls.trigger(M.a.THUMBNAILS_IMAGE_LOADING,{url:a,id:n.id,cb:i})}else this.hls.trigger(M.a.THUMBNAILS_TRACK_LOADING,{url:n.playlistUrl,id:n.id,cb:i})},n.prototype.parseImageVttContent=function(a,s,t){function i(t,e,i,n){return 3600*(0|t)+60*(0|e)+(0|i)+(0|n)/1e3}function o(t){var e=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return e?e[3]?i(e[1],e[2],e[3].replace(":",""),e[4]):59<e[1]?i(e[1],e[2],0,e[4]):i(0,e[1],e[2],e[4]):null}var l=[],e=String.fromCharCode.apply(null,new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");if(null!=e){var u=!1,h=null,c=null;e.forEach(function(t){if(-1!==t.toLowerCase().search(/^\s*webvtt\s*$/))u=!0;else if(u&&0<t.length){var e=t.search("--\x3e");if(null===h&&null===c&&-1!==e)r=t,e=(t=!0?r.replace(/\s+/g,""):r.replace(/^\s+/,"")).search("--\x3e"),h=Number(o(t.substr(0,e)))+Number(s),c=Number(o(t.substr(e+3)))+Number(s),null!=h&&null!=c||(c=h=null);else if(-1!==(e=t.search("#xywh="))){var i=t.substring(e+6).split(",");if(4===i.length){var n={url:a+"/"+t.substring(0,e),startTime:h,endTime:c,topX:i[0],topY:i[1],width:i[2],height:i[3]};l.push(n)}c=h=null}}var r})}return l},n.prototype.setCvodProgramDataTime=function(t){null==this.baseTime&&(this.baseTime=t/1e3)},n}(x),ee="PREHEAT",ie="DETECT",ne="DEALING",re="NOERROR",ae="SEGMENTLOSTERR",se=function(){function t(){h(this,t),this.reset()}return t.prototype.initial=function(t,e,i){t&&(this._live=t,this._serverTimeAnchor=e,this._localTimeAnchor=performance.now(),this._clockOffset=this._localTimeAnchor-this._serverTimeAnchor),this._maxDeviation=i},t.prototype.computerTime=function(t){var e=t;return this._live&&0<t-this._serverTimeAnchor-(performance.now()-this._localTimeAnchor)&&(e=this._serverTimeAnchor+this._clockOffset),e},t.prototype.reset=function(){this._clockOffset=0,this._localTimeAnchor=0,this._serverTimeAnchor=0,this._maxDeviation=0,this._live=!1},t}(),oe=function(i){function n(t){h(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.FRAG_PARSED_EXTEND,M.a.ERROR,M.a.FRAG_CHANGED));return e.config=e.hls.config,e.lastLevel=-1,e.timelineCalc=new se,e.parallelErrorCount=0,e.reset(),e.ontick=e.tick.bind(e),e.timer=setInterval(e.ontick,900),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.timer&&(clearInterval(this.timer),this.timer=null),this.reset(),this.config=null,this.timelineCalc=null,this.parallelErrorCount=0,x.prototype.destroy.call(this)},n.prototype.reset=function(){this.errCtrlInited=!1,this.errorState=re,this.errorByTimer=!1,this.ticks=0,this.segmentLostErrorDealState=ee,this.nextSeekOperationTime=Number.MAX_SAFE_INTEGER,this.live=!1,this.maxDeviation=0},n.prototype.tick=function(){1==++this.ticks&&(this.doTick(),this.ticks=0)},n.prototype.doTick=function(){this.nextSeekOperationTime!==Number.MAX_SAFE_INTEGER&&(this.nextSeekOperationTime-=1),this.detectErr(),this.dealErrorsByTimer()},n.prototype.dealErrorsByTimer=function(){switch(this.errorState){case ae:this.dealSegmentLostErrorByTimer();break;case re:this.detectErr()}},n.prototype.dealSegmentLostErrorByTimer=function(){if(this.nextSeekOperationTime<=0){var t=this.hls.streamController,e=this.hls.levelController,i=this.hls.media;if(void 0!==t.nextLoadPosition){var n=this.hls.nextLoadLevel,r=e._levels[n].details;if(r&&r.fragments){var a=r.fragments,s=t.fragPrevious;if(s){var o=s.sn+1;o>=r.startSN&&o<=r.endSN?(t.fragPrevious=a[o-r.startSN],Y.b.info("dealSegmentLostErrorByTimer: seek. lastSn="+(o-1)+", seekToSn="+o+", currentTime="+i.currentTime+", seekTo="+t.nextLoadPosition)):(t.fragPrevious=void 0,Y.b.info("dealSegmentLostErrorByTimer: seek. set fragPrevious to undefined"))}r.PTSKnown=!1,t.reSetErrToIdle(),i.currentTime=t.nextLoadPosition,this.nextSeekOperationTime=Number.MAX_SAFE_INTEGER,this.segmentLostErrorDealState=ie}}this.parallelErrorCount=0}},n.prototype.detectErr=function(){},n.prototype.onError=function(t){this.dealSegmentLostError(t)},n.prototype.dealSegmentLostError=function(t){var e=t.details,i=t.type,n=t.frag,r=this.hls.media;if(i===U.b.NETWORK_ERROR&&void 0!==e&&[U.a.FRAG_LOAD_ERROR,U.a.FRAG_LOAD_TIMEOUT,U.a.FRAG_LOAD_SLOW,U.a.KEY_LOAD_ERROR,U.a.KEY_LOAD_TIMEOUT].some(function(t){return t===e})){if(Y.b.warn("dealSegmentLostError: type="+i+", details="+e+", fatal="+t.fatal),t.fatal)if(this.segmentLostErrorDealState===ie){var a=this.hls.levelController.currentLevelIndex,s=this.hls.config.autoLevelEnabled;void 0!==a&&(this.segmentLostErrorDealState=ne,this.errorByTimer=!0,n.start?this.nextSeekOperationTime=n.start-r.currentTime-1:this.nextSeekOperationTime=this.maxDeviation/3,this.nextSeekOperationTime<=0&&(this.nextSeekOperationTime=1),this.errorState=ae,s&&this.hls.streamController.flushMainBuffer(0,Number.POSITIVE_INFINITY),Y.b.info("dealSegmentLostError: trans error deal to timer. error="+this.errorState))}else Y.b.warn("dealSegmentLostError: not dealing successive error"),this.parallelErrorCount++;t.fatal=!1}},n.prototype.onFragParsedExtend=function(t){var e=t.frag;if(void 0!==this.hls.media){var i=this.hls.levelController.currentLevelIndex;if(!1===this.errCtrlInited&&void 0!==i){var n=this.hls.levelController._levels[i].details,r=e.startDTS;this.live=n.live,this.maxDeviation=n.averagetargetduration,this.timelineCalc.initial(this.live,r,this.maxDeviation),this.errCtrlInited=!0,Y.b.info("onFragParsedExtend: init. live="+this.live+", maxDeviation="+this.maxDeviation)}this.segmentLostErrorDealState===ee&&this.initSegmentLostErrorHandler()}},n.prototype.initSegmentLostErrorHandler=function(){void 0!==this.hls.levelController.currentLevelIndex&&(this.segmentLostErrorDealState=ie)},n.prototype.onFragChanged=function(){-1!==this.lastLevel&&this.lastLevel!==this.hls.currentLevel&&-1===this.hls.levelController.manualLevel&&0===this.parallelErrorCount&&this.reset(),this.lastLevel=this.hls.currentLevel},n}(x),le=/^(http:\/\/.*)|(https:\/\/.*)/,ue=function(e){function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,e.call(this,t,M.a.ADVERTISEMENT_LOADING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,e),i.prototype.destroy=function(){x.prototype.destroy.call(this)},i.prototype.onAdvertisementLoading=function(t){if(null!==le.exec(t.url)){var e=t.url,i=this.hls.config,n=t.loader;if(n&&(Y.b.warn("abort previous fragment loader for url:"+e),n.abort()),(n=new i.loader)&&e){var r,a,s;if(r={url:e,ad:t,loader:n,requestMethod:"GET",responseType:""},a={timeout:i.manifestLoadingTimeOut,maxRetry:i.manifestLoadingMaxRetry,retryDelay:i.manifestLoadingRetryDelay,maxRetryDelay:i.manifestLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},/https:/.exec(e)){0}n.load(r,a,s),Y.b.warn("send request ad: type="+t.type+", trackId="+t.trackId+", sn="+t.sn+", stage="+t.stage+", url="+t.url)}}},i.prototype.loadsuccess=function(t,e,i){var n=i.url,r=i.loader;r&&(r.destroy(),r=null),Y.b.debug("get ad suc: url="+n),this.hls.trigger(M.a.ADVERTISEMENT_LOADED,{url:n})},i.prototype.loaderror=function(t,e){var i=e.url,n=e.loader;n&&(n.abort(),n.destroy(),n=null),Y.b.warn("get ad error: url="+i),this.hls.trigger(M.a.ADVERTISEMENT_LOADED,{url:i})},i.prototype.loadtimeout=function(t,e){var i=e.url,n=e.loader;n&&(n.abort(),n.destroy(),n=null),Y.b.warn("get ad suc: url="+i),this.hls.trigger(M.a.ADVERTISEMENT_LOADED,{url:i})},i}(x),he=function(){function e(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},e}(),ce=function(){function r(t,e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,r),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new he(e),this.fast_=new he(i)}return r.prototype.sample=function(t,e){var i=8e3*e/(t=Math.max(t,this.minDelayMs_)),n=t/1e3;this.fast_.sample(n,i),this.slow_.sample(n,i)},r.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},r.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},r.prototype.destroy=function(){},r}(),de=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),fe=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.FRAG_LOADING,M.a.FRAG_LOADED,M.a.FRAG_BUFFERED,M.a.ERROR));return e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=t,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(e),e.totalLoadedBytes=0,e.onlineSpeed=0,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.clearTimer(),x.prototype.destroy.call(this)},n.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var i=this.hls,n=t.frag.level,r=i.levels[n].details.live,a=i.config,s=void 0,o=void 0;o=r?(s=a.abrEwmaFastLive,a.abrEwmaSlowLive):(s=a.abrEwmaFastVoD,a.abrEwmaSlowVoD),this._bwEstimator=new ce(i,o,s,a.abrEwmaDefaultEstimate)}this.fragCurrent=e}},n.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,i=this.fragCurrent,n=i.loader,r=t.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return Y.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=n.stats;if(e&&a&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&i.autoLevel&&i.level){var s=performance.now()-a.trequest,o=Math.abs(e.playbackRate);if(s>500*i.duration/o){var l=t.levels,u=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/s),h=l[i.level],c=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,d=a.total?a.total:Math.max(a.loaded,Math.round(i.duration*c/8)),f=e.currentTime,p=(d-a.loaded)/u,g=(wt.bufferInfo(e,f,t.config.maxBufferHole).end-f)/o;if(g<2*i.duration/o&&g<p){var m=void 0,v=void 0;for(v=i.level-1;r<v;v--){var y=l[v].realBitrate?Math.max(l[v].realBitrate,l[v].bitrate):l[v].bitrate;if((m=i.duration*y/(6.4*u))<g)break}m<p&&(Y.b.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+m.toFixed(1)+"<"+p.toFixed(1)+":"+g.toFixed(1)),t.nextLoadLevel=v,this._bwEstimator.sample(s,a.loaded),n.abort(),this.clearTimer(),t.trigger(M.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:a}))}}}},n.prototype.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&!isNaN(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[e.level],n=(i.loaded?i.loaded.bytes:0)+t.stats.loaded,r=(i.loaded?i.loaded.duration:0)+t.frag.duration;i.loaded={bytes:n,duration:r},i.realBitrate=Math.round(8*n/r)}if(t.frag.bitrateTest){var a=t.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(t)}}if(t.stats.loaded)if(this.totalLoadedBytes+=t.stats.loaded,t.frag.duration){var s=t.stats.tload-t.stats.trequest;0===s&&(s=1),this.onlineSpeed=Math.round(8e3*t.stats.loaded/s)}else this.onlineSpeed=0},n.prototype.onFragBuffered=function(t){var e=t.stats,i=t.frag;if(!(!0===e.aborted||1!==i.loadCounter||"main"!==i.type||isNaN(i.sn)||i.bitrateTest&&e.tload!==e.tbuffered)){var n=e.tparsed-e.trequest;Y.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(n,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},n.prototype.onError=function(t){switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},n.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},n.prototype._findBestLevel=function(t,e,i,n,r,a,s,o,l){for(var u=r;n<=u;u--){var h,c=l[u].details,d=c?c.totalduration/c.fragments.length:e,f=!!c&&c.live;h=u<=t?s*i:o*i;var p=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,g=p*d/h;if(Y.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(h)+"/"+p+"/"+d+"/"+a+"/"+g),p<h&&(!g||f&&!this.bitrateTestDelay||g<a))return u}return-1},n.prototype.resetTotalLoadedBytes=function(){this.totalLoadedBytes=0},de(n,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var i=this._nextABRAutoLevel;return-1!==t&&(i=Math.min(t,i)),i},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,i=t.levels,n=t.config,r=t.minAutoLevel,a=t.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=(wt.bufferInfo(a,l,n.maxBufferHole).end-l)/u,d=this._findBestLevel(s,o,h,r,e,c,n.abrBandWidthFactor,n.abrBandWidthUpFactor,i);if(0<=d)return d;Y.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var f=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(0===c){var m=this.bitrateTestDelay;m&&(f=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-m,Y.b.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),p=g=1)}return d=this._findBestLevel(s,o,h,r,e,c+f,p,g,i),Math.max(d,0)}}]),n}(x),pe=u(),ge=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHING,M.a.MEDIA_DETACHING,M.a.MANIFEST_PARSED,M.a.BUFFER_RESET,M.a.BUFFER_APPENDING,M.a.BUFFER_CODECS,M.a.BUFFER_EOS,M.a.BUFFER_FLUSHING,M.a.LEVEL_PTS_UPDATED,M.a.LEVEL_UPDATED));return e._msDuration=null,e._levelDuration=null,e._live=null,e._objectUrl=null,e.onsbue=e.onSBUpdateEnd.bind(e),e.onsbe=e.onSBUpdateError.bind(e),e.pendingTracks={},e.tracks={},e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){x.prototype.destroy.call(this)},n.prototype.onLevelPtsUpdated=function(t){var e=t.type,i=this.tracks.audio;if("audio"===e&&i&&"audio/mpeg"===i.container){var n=this.sourceBuffer.audio;if(.1<Math.abs(n.timestampOffset-t.start)){var r=n.updating;try{n.abort()}catch(t){r=!0,Y.b.warn("can not abort audio buffer: "+t)}r?this.audioTimestampOffset=t.start:(Y.b.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+t.start),n.timestampOffset=t.start)}}},n.prototype.onManifestParsed=function(t){var e=t.audio,i=t.video||t.levels.length&&t.audio,n=0;t.altAudio&&(e||i)&&(n=(e?1:0)+(i?1:0),Y.b.log(n+" sourceBuffer(s) expected")),this.sourceBufferNb=n},n.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var i=this.mediaSource=new pe;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(i),this._objectUrl=e.src}},n.prototype.onMediaDetaching=function(){Y.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){Y.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):Y.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(M.a.MEDIA_DETACHED)},n.prototype.onMediaSourceOpen=function(){Y.b.log("media source opened"),this.hls.trigger(M.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},n.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},n.prototype.onMediaSourceClose=function(){Y.b.log("media source closed")},n.prototype.onMediaSourceEnded=function(){Y.b.log("media source ended")},n.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;Y.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var i=this.parent,e=this.segments.reduce(function(t,e){return e.parent===i?t+1:t},0);this.hls.trigger(M.a.BUFFER_APPENDED,{parent:i,pending:e}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},n.prototype.onSBUpdateError=function(t){Y.b.error("sourceBuffer error:",t),this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_APPENDING_ERROR,fatal:!1})},n.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var i=t[e];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},n.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var i=this.mediaSource;i&&"open"===i.readyState&&this.checkPendingTracks()}},n.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;for(var n in t)if(!e[n]){var r=t[n],a=r.levelCodec||r.codec,s=r.container+";codecs="+a;Y.b.log("creating sourceBuffer("+s+")");try{var o=e[n]=i.addSourceBuffer(s);Y.b.log("creating sourceBuffer(name="+n+", mimeType="+s+")"),o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[n]={codec:a,container:r.container},r.buffer=o}catch(t){Y.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:s})}}this.hls.trigger(M.a.BUFFER_CREATED,{tracks:t})},n.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},n.prototype.onBufferAppendFail=function(t){Y.b.error("sourceBuffer error:",t.event),this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_APPENDING_ERROR,fatal:!1})},n.prototype.onBufferEos=function(t){var e=this.sourceBuffer,i=t.type;for(var n in e)i&&n!==i||e[n].ended||(e[n].ended=!0,Y.b.log(n+" sourceBuffer now EOS"));this.checkEos()},n.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var i in t){var n=t[i];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}Y.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){Y.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},n.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},n.prototype.onLevelUpdated=function(t){var e=t.details;0<e.fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._live=e.live,this.updateMediaElementDuration())},n.prototype.updateMediaElementDuration=function(){var t=this.hls.config,e=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer)if(!0===this.sourceBuffer[i].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(Y.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||e===1/0||isNaN(e))&&(Y.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},n.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,i=this.sourceBuffer;try{for(var n in i)e+=i[n].buffered.length}catch(t){Y.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(M.a.BUFFER_FLUSHED)}},n.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,i=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void Y.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(i&&i.length){var n=i.shift();try{var r=n.type,a=e[r];a?a.updating?i.unshift(n):(a.ended=!1,this.parent=n.parent,a.appendBuffer(n.data),Y.b.log("append "+r+" SB, start="+n.startPTS+", end="+n.endPTS+", url="+n.url+", content="+n.content),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){Y.b.error("error while trying to append buffer:"+e.message),i.unshift(n);var s={type:U.b.MEDIA_ERROR,parent:n.parent};if(22===e.code)return this.segments=[],s.details=U.a.BUFFER_FULL_ERROR,s.fatal=!1,void t.trigger(M.a.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=U.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry)return Y.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],s.fatal=!0,void t.trigger(M.a.ERROR,s);s.fatal=!1,t.trigger(M.a.ERROR,s)}}}},n.prototype.flushBuffer=function(t,e,i){var n,r,a,s,o,l,u=this.sourceBuffer;if(Object.keys(u).length){if(Y.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var h in u)if(!i||h===i){if((n=u[h]).ended=!1,n.updating)return Y.b.warn("cannot flush, sb updating in progress"),!1;try{for(r=0;r<n.buffered.length;r++)if(a=n.buffered.start(r),s=n.buffered.end(r),l=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(o=t,e):(o=Math.max(a,t),Math.min(s,e)),.5<Math.min(l,s)-o)return this.flushBufferCounter++,Y.b.log("flush "+h+" ["+o+","+l+"], of ["+a+","+s+"], pos:"+this.media.currentTime),n.remove(o,l),!1}catch(t){Y.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else Y.b.warn("abort flushing too many retries");Y.b.log("buffer flushed")}return!0},n.prototype.logBuffered=function(t){if(this.hls.media){var e=this.hls.media;Y.b.log(t+". Buffered: length="+e.buffered.length+", current="+e.currentTime);for(var i=0;i<e.buffered.length;i++)Y.b.log(t+": index="+i+", start="+e.buffered.start(i)+", end="+e.buffered.end(i)+"}")}},n}(x),me=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),ve=function(e){function r(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,e.call(this,t,M.a.FPS_DROP_LEVEL_CAPPING,M.a.MEDIA_ATTACHING,M.a.MANIFEST_PARSED))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,e),r.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},r.prototype.onFpsDropLevelCapping=function(t){r.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},r.prototype.onMediaAttaching=function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null},r.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],e.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,e.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},r.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},r.prototype.getMaxLevel=function(i){var n=this;if(!this.levels)return-1;var t=this.levels.filter(function(t,e){return r.isLevelAllowed(e,n.restrictedLevels)&&e<=i});return r.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},r.isLevelAllowed=function(t){return-1===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},r.getMaxLevelByMediaSize=function(t,e,i){if(!t||t&&!t.length)return-1;for(var n=t.length-1,r=0;r<t.length;r+=1){var a=t[r];if((a.width>=e||a.height>=i)&&(s=a,!(o=t[r+1])||s.width!==o.width||s.height!==o.height)){n=r;break}}var s,o;return n},me(r,[{key:"mediaWidth",get:function(){var t=void 0,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=r.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=r.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),r}(x),ye=function(e){function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,e.call(this,t,M.a.MEDIA_ATTACHING))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,e),i.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},i.prototype.checkFPS=function(t,e,i){var n=performance.now();if(e){if(this.lastTime){var r=n-this.lastTime,a=i-this.lastDroppedFrames,s=e-this.lastDecodedFrames,o=1e3*a/r,l=this.hls;if(l.trigger(M.a.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),0<o&&a>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;Y.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),0<u&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(M.a.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,l.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=e}},i.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},i}(x),be=function(){function e(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return e.prototype.destroy=function(){this.abort(),this.loader=null},e.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.prototype.load=function(t,e,i,n){this.userdata=n,this.context=t,this.config=e,this.callbacks=i,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.requestMethod=t.requestMethod?t.requestMethod:"GET",this.loadInternal()},e.prototype.loadInternal=function(){var t,e=this.context;t=this.loader=new XMLHttpRequest;var i=this.stats;i.tfirst=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(t,e.url)}catch(i){t.open(this.requestMethod,e.url,!0),n(t,e.url)}t.readyState||t.open(this.requestMethod,e.url,!0)}catch(i){return void this.callbacks.onError({code:t.status,text:i.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},e.prototype.readystatechange=function(t){var e=t.currentTarget,i=e.readyState,n=this.stats,r=this.context,a=this.config;if(!n.aborted&&2<=i)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(performance.now(),n.trequest)),4===i){var s=e.status;if(200<=s&&s<300){n.tload=Math.max(n.tfirst,performance.now());var o=void 0,l=void 0;l="arraybuffer"===r.responseType?(o=e.response).byteLength:(o=e.responseText).length,n.loaded=n.total=l;var u={url:e.responseURL,data:o};this.callbacks.onSuccess(u,n,r,e,this.userdata)}else n.retry>=a.maxRetry||400<=s&&s<499||0===s?(Y.b.error(s+" while loading "+r.url),this.callbacks.onError({code:s,text:e.statusText},r,e)):(Y.b.warn(s+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},e.prototype.loadtimeout=function(){Y.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.prototype.loadprogress=function(t){var e=t.currentTarget,i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total);var n=this.callbacks.onProgress;n&&n(i,this.context,null,e)},e}(),_e=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),Te=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MANIFEST_LOADING,M.a.MANIFEST_PARSED,M.a.AUDIO_TRACK_LOADED,M.a.ERROR));return e.ticks=0,e.ontick=e.tick.bind(e),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.cleanTimer(),x.prototype.destroy.call(this)},n.prototype.cleanTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=null)},n.prototype.tick=function(){1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},n.prototype.doTick=function(){this.updateTrack(this.trackId)},n.prototype.onError=function(t){t.fatal&&t.type===U.b.NETWORK_ERROR&&this.cleanTimer()},n.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},n.prototype.onManifestParsed=function(t){var e=this,i=t.audioTracks||[],n=!1;this.tracks=i,this.hls.trigger(M.a.AUDIO_TRACKS_UPDATED,{audioTracks:i});var r=0,a=this.hls.config.preferredAudioLanguage;""!==a&&i.forEach(function(t){if(t.lang===a)return e.audioTrack=r,void(n=!0);r++}),r=0,!1===n&&i.forEach(function(t){if(t.default)return e.audioTrack=r,void(n=!0);r++}),!1===n&&i.length&&(Y.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},n.prototype.onAudioTrackLoaded=function(t){t.id<this.tracks.length&&(Y.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&this.cleanTimer())},n.prototype.setAudioTrackInternal=function(t){if(0<=t&&t<this.tracks.length){this.cleanTimer(),this.trackId=t,Y.b.log("switching to audioTrack "+t);var e=this.tracks[t],i=this.hls,n=e.type,r=e.url,a={id:t,type:n,url:r};i.trigger(M.a.AUDIO_TRACK_SWITCH,a),i.trigger(M.a.AUDIO_TRACK_SWITCHING,a);var s=e.details;!r||void 0!==s&&!0!==s.live||(Y.b.log("(re)loading playlist for audioTrack "+t),i.trigger(M.a.AUDIO_TRACK_LOADING,{url:r,id:t}))}},n.prototype.updateTrack=function(t){if(0<=t&&t<this.tracks.length){this.cleanTimer(),this.trackId=t,Y.b.log("updating audioTrack "+t);var e=this.tracks[t],i=e.url,n=e.details;!i||void 0!==n&&!0!==n.live||(Y.b.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(M.a.AUDIO_TRACK_LOADING,{url:i,id:t}))}},_e(n,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.trackId===t&&void 0!==this.tracks[t].details||this.setAudioTrackInternal(t)}}]),n}(x),Ee=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),Se="STOPPED",we="STARTING",ke="IDLE",Ae="PAUSED",Le="KEY_LOADING",Pe="FRAG_LOADING",Ce="FRAG_LOADING_WAITING_RETRY",xe="WAITING_TRACK",Ie="PARSING",Re="PARSED",De="BUFFER_FLUSHING",Ne="ENDED",Oe="ERROR",Me="WAITING_INIT_PTS",Ue=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.AUDIO_TRACKS_UPDATED,M.a.AUDIO_TRACK_SWITCHING,M.a.AUDIO_TRACK_LOADED,M.a.KEY_LOADED,M.a.FRAG_LOADED,M.a.FRAG_PARSING_INIT_SEGMENT,M.a.FRAG_PARSING_DATA,M.a.FRAG_PARSED,M.a.ERROR,M.a.BUFFER_RESET,M.a.BUFFER_CREATED,M.a.BUFFER_APPENDED,M.a.BUFFER_FLUSHED,M.a.INIT_PTS_FOUND));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e._state=Se,e.ontick=e.tick.bind(e),e.initPTS=[],e.waitingFragment=null,e.videoTrackCC=null,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),x.prototype.destroy.call(this),this.state=Se},n.prototype.onInitPtsFound=function(t){var e=t.id,i=t.frag.cc,n=t.initPTS;"main"===e&&(this.initPTS[i]=n,this.videoTrackCC=i,Y.b.log("InitPTS for cc:"+i+" found from video track:"+n),this.state===Me&&this.tick())},n.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,this.state=0<e&&-1===t?(Y.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),ke):(this.lastCurrentTime=this.startPosition?this.startPosition:t,we),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=Se},n.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Se},n.prototype.tick=function(){1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},n.prototype.doTick=function(){var t,e,i,n,r,a=this.hls,s=a.config;switch(this.state){case Oe:case Ae:case De:break;case we:this.state=xe,this.loadedmetadata=!1;break;case ke:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!s.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var l=this.mediaBuffer?this.mediaBuffer:this.media,u=this.videoBuffer?this.videoBuffer:this.media,h=wt.bufferInfo(l,t,s.maxBufferHole),c=wt.bufferInfo(u,t,s.maxBufferHole),d=h.len,f=h.end,p=this.fragPrevious,g=Math.max(s.maxBufferLength,c.len),m=this.audioSwitch,v=this.trackId;if((d<g||m)&&v<o.length){if(void 0===(i=o[v].details)){this.state=xe;break}if(!m&&!i.live&&p&&p.sn===i.endSN&&!h.nextStart&&(!this.media.seeking||this.media.duration-f<p.duration/2)){this.hls.trigger(M.a.BUFFER_EOS,{type:"audio"}),this.state=Ne;break}var y=i.fragments,b=y.length,_=y[0].start,T=y[b-1].start+y[b-1].duration,E=void 0;if(m)if(i.live&&!i.PTSKnown)Y.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),f=0;else if(f=t,i.PTSKnown&&t<_){if(!(h.end>_||h.nextStart))return;Y.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=_+.05}if(i.initSegment&&!i.initSegment.data)E=i.initSegment;else if(f<=_){var S=0;if(i.live&&!i.PTSKnown&&(S=this.reCalcIndex(i)),E=y[S],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(n=y,r=this.videoTrackCC,E=tt.search(n,function(t){return t.cc<r?1:t.cc>r?-1:0})),null===E&&(E=y[S]),i.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var w=h.nextStart?h.nextStart:_;return Y.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(w+.05)),void(this.media.currentTime=w+.05)}}else{var k=void 0,A=s.maxFragLookUpTolerance,L=p?y[p.sn-y[0].sn+1]:void 0,P=function(t){var e=Math.min(A,t.duration);return t.start+t.duration-e<=f?1:t.start-e>f&&t.start?-1:0};(k=f<T?(T-A<f&&(A=0),L&&!P(L)?L:tt.search(y,P)):y[b-1])&&(_=(E=k).start,p&&E.level===p.level&&E.sn===p.sn&&(E.sn<i.endSN?(E=y[E.sn+1-i.startSN],Y.b.log("SN just loaded, load next one: "+E.sn)):E=null))}if(E)if(E.decryptdata&&null!=E.decryptdata.uri&&null==E.decryptdata.key)Y.b.log("Loading key for "+E.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+v),this.state=Le,a.trigger(M.a.KEY_LOADING,{frag:E});else{if(Y.b.log("Loading "+E.sn+", cc: "+E.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+v+", currentTime:"+t+",bufferEnd:"+f.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,E.loadCounter){E.loadCounter++;var C=s.fragLoadingLoopThreshold;if(E.loadCounter>C&&Math.abs(this.fragLoadIdx-E.loadIdx)<C)return void a.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:E})}else E.loadCounter=1;E.loadIdx=this.fragLoadIdx,this.fragCurrent=E,this.startFragRequested=!0,isNaN(E.sn)||(this.nextLoadPosition=E.start+E.duration),E&&a.cdnsCtrl.rewriteUrlByCdnCtrls(E,0),a.trigger(M.a.FRAG_LOADING,{frag:E}),this.state=Pe}}break;case xe:(e=this.tracks[this.trackId])&&e.details&&(this.state=ke);break;case Ce:var x=performance.now(),I=this.retryDate,R=(l=this.media)&&l.seeking;(!I||I<=x||R)&&(Y.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ke);break;case Me:var D=this.videoTrackCC;if(void 0===this.initPTS[D])break;var N=this.waitingFragment;if(N){var O=N.frag.cc;D!==O?(e=this.tracks[this.trackId]).details&&e.details.live&&(Y.b.warn("Waiting fragment CC ("+O+") does not match video track CC ("+D+")"),this.waitingFragment=null,this.state=ke):(this.state=Pe,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=ke}},n.prototype.reCalcIndex=function(t){var e=this.hls,i=e.config,n=t.fragments,r=e.streamController,a=5*n[0].duration,s=0;if(isNaN(i.maxBufferLength)||(a=parseInt(i.maxBufferLength)),void 0!==r.fragCurrent||null!==r.fragCurrent){var o=r.fragCurrent.relurl;if(void 0!==o){var l=/(.*_(\d{14})|.*_(\d{14}_\d{3})|.*_(\d{14}_\d{3}_\d{3}))\.ts/gi,u=l.exec(o);if(u){for(var h=0;h<n.length;h++){l.lastIndex=0;var c=l.exec(n[h].relurl);if(void 0!==c&&(void 0!==c[2]&&c[2]===u[2]||void 0===c[2]&&c[3]===u[3])){s=h;break}}(s-=Math.floor(a/n[0].duration))<0&&(s=0)}}}return s},n.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},n.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(Y.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.tracks;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},n.prototype.onMediaSeeking=function(){this.state===Ne&&(this.state=ke),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},n.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.prototype.onAudioTracksUpdated=function(t){Y.b.log("audio tracks updated"),this.tracks=t.audioTracks},n.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=Ae,this.waitingFragment=null,e?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=ke,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},n.prototype.onAudioTrackLoaded=function(t){var e=t.details,i=t.id,n=this.tracks[i],r=e.totalduration,a=0;if(Y.b.log("track "+i+" loaded ["+e.startSN+","+e.endSN+"],duration:"+r),e.live){var s=n.details;s&&0<e.fragments.length?(m(s,e),a=e.fragments[0].start,e.PTSKnown?Y.b.log("live audio playlist sliding:"+a.toFixed(3)):Y.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,Y.b.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(n.details=e,!this.startFragRequested){if(-1===this.startPosition){var o=e.startTimeOffset;isNaN(o)?this.startPosition=0:(Y.b.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o)}this.nextLoadPosition=this.startPosition}this.state===xe&&(this.state=ke),this.tick()},n.prototype.onKeyLoaded=function(){this.state===Le&&(this.state=ke,this.tick())},n.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag;if(this.state===Pe&&e&&"audio"===i.type&&i.level===e.level&&i.sn===e.sn){var n=this.tracks[this.trackId],r=n.details,a=r.totalduration,s=e.level,o=e.sn,l=e.cc,u=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",h=this.stats=t.stats;if("initSegment"===o)this.state=ke,h.tparsed=h.tbuffered=performance.now(),r.initSegment.data=t.payload,this.hls.trigger(M.a.FRAG_BUFFERED,{stats:h,frag:e,id:"audio"}),this.tick();else{this.state=Ie,this.appended=!1,this.demuxer||(this.demuxer=new It(this.hls,"audio"));var c=this.initPTS[l],d=r.initSegment?r.initSegment.data:[],f=this.hls.userDataMgr;f.needReInitAudioPTS()&&f.getCurInitPts()&&(c=this.hls.userDataMgr.getCurInitPts()),r.initSegment||void 0!==c?(this.pendingBuffering=!0,Y.b.log("Demuxing "+o+" of ["+r.startSN+" ,"+r.endSN+"],track "+s+" ,initPTS="+c),this.demuxer.push(t.payload,d,u,null,e,a,!1,c)):(Y.b.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+r.startSN+" ,"+r.endSN+"],track "+s),this.waitingFragment=t,this.state=Me)}this.fragLoadError=0}},n.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,i=t.frag;if(e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Ie){var n=t.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec=r.codec,r.id=t.id,this.hls.trigger(M.a.BUFFER_CODECS,n),Y.b.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;if(a){var s={type:"audio",data:a,parent:"audio",content:"initSegment"};if(this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(M.a.BUFFER_APPENDING,s)),this.hls.config.logServer){var o=RegExp("(http(s)?:\\/\\/)?(.*\\/)?(.*)\\.(ts|aac)").exec(t.frag.relurl);o&&5<=o.length&&o[4]&&this.hls.trigger(M.a.FRAG_REMUXED,{remuxedData:a,name:o[4]+"_init",type:"audio"})}}this.tick()}}},n.prototype.onFragParsingData=function(e){var i=this,t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&"audio"===e.type&&n.sn===t.sn&&n.level===t.level&&this.state===Ie){var r=this.trackId,a=this.tracks[r],s=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),Y.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),g(a.details,t,e.startPTS,e.endPTS);var o=this.audioSwitch,l=this.media,u=!1;if(o&&l)if(l.readyState){var h=l.currentTime;Y.b.log("switching audio track : currentTime:"+h),h>=e.startPTS&&(Y.b.log("switching audio track : flushing all audio"),this.state=De,s.trigger(M.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,s.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:r}))}else this.audioSwitch=!1,s.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:r});var c=this.pendingData;if(!this.audioSwitch){if(s.config.logServer&&e.data1&&0<e.data1.length&&e.data2&&0<e.data2.length){var d=RegExp("(http(s)?:\\/\\/)?(.*\\/)?(.*)\\.(ts|aac)").exec(e.frag.relurl);if(d&&5<=d.length&&d[4]){var f=new Uint8Array(e.data1.length+e.data2.length);f.set(e.data1),f.set(e.data2,e.data1.length),this.hls.trigger(M.a.FRAG_REMUXED,{remuxedData:f,name:d[4],type:e.type})}}[e.data1,e.data2].forEach(function(t){t&&t.length&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!u&&c.length&&(c.forEach(function(t){i.state===Ie&&(i.pendingBuffering=!0,i.hls.trigger(M.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)}this.tick()}},n.prototype.onFragParsed=function(t){var e=this.fragCurrent,i=t.frag;e&&"audio"===t.id&&i.sn===e.sn&&i.level===e.level&&this.state===Ie&&(this.stats.tparsed=performance.now(),this.state=Re,this._checkAppendedParsed())},n.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},n.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},n.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==Ie&&e!==Re||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed())}},n.prototype._checkAppendedParsed=function(){if(!(this.state!==Re||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,i=this.hls;if(t){this.fragPrevious=t,e.tbuffered=performance.now(),i.trigger(M.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;Y.b.log("audio buffered : "+Rt.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ke}this.tick()}},n.prototype.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:if(!t.fatal){var i=this.fragLoadError;i?i++:i=1;var n=this.config;if(i<=n.fragLoadingMaxRetry){this.fragLoadError=i,e.loadCounter=0;var r=Math.min(Math.pow(2,i-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);Y.b.warn("audioStreamController: frag loading failed, retry in "+r+" ms"),this.retryDate=performance.now()+r,this.state=Ce}else Y.b.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Oe}break;case U.a.FRAG_LOOP_LOADING_ERROR:case U.a.AUDIO_TRACK_LOAD_ERROR:case U.a.AUDIO_TRACK_LOAD_TIMEOUT:case U.a.KEY_LOAD_ERROR:case U.a.KEY_LOAD_TIMEOUT:this.state!==Oe&&(this.state=t.fatal?Oe:ke,Y.b.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case U.a.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===Ie||this.state===Re)){var a=this.mediaBuffer,s=this.media.currentTime;if(a&&wt.isBuffered(a,s)&&wt.isBuffered(a,s+.5)){var o=this.config;o.maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,Y.b.warn("audio:reduce max buffer length to "+o.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*o.fragLoadingLoopThreshold),this.state=ke}else Y.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=De,this.hls.trigger(M.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},n.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(Y.b.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(M.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=Re):(this.state=ke,this.fragPrevious=null,this.tick())},Ee(n,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,Y.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}]),n}(x),Fe=function(){function _(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}function T(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(t,e,i){var n=this,r=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),a={};r?n=document.createElement("custom"):a.enumerable=!0,n.hasBeenReset=!1;var s="",o=!1,l=t,u=e,h=i,c=null,d="",f=!0,p="auto",g="start",m=50,v="middle",y=50,b="middle";if(Object.defineProperty(n,"id",T({},a,{get:function(){return s},set:function(t){s=""+t}})),Object.defineProperty(n,"pauseOnExit",T({},a,{get:function(){return o},set:function(t){o=!!t}})),Object.defineProperty(n,"startTime",T({},a,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"endTime",T({},a,{get:function(){return u},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");u=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"text",T({},a,{get:function(){return h},set:function(t){h=""+t,this.hasBeenReset=!0}})),Object.defineProperty(n,"region",T({},a,{get:function(){return c},set:function(t){c=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"vertical",T({},a,{get:function(){return d},set:function(t){var e,i="string"==typeof(e=t)&&!!E[e.toLowerCase()]&&e.toLowerCase();if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");d=i,this.hasBeenReset=!0}})),Object.defineProperty(n,"snapToLines",T({},a,{get:function(){return f},set:function(t){f=!!t,this.hasBeenReset=!0}})),Object.defineProperty(n,"line",T({},a,{get:function(){return p},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"lineAlign",T({},a,{get:function(){return g},set:function(t){var e=_(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"position",T({},a,{get:function(){return m},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"positionAlign",T({},a,{get:function(){return v},set:function(t){var e=_(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"size",T({},a,{get:function(){return y},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"align",T({},a,{get:function(){return b},set:function(t){var e=_(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),n.displayState=void 0,r)return n}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var E={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};return t.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},t}(),Be=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};b.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var n=0;n<i.length;++n)if(e===i[n]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(e=parseFloat(e))&&e<=100)&&(this.set(t,e),!0)}};var Ge=new Fe(0,0,0),je="middle"===Ge.align?"middle":"center";y.prototype={parse:function(t){function e(){var t=n.buffer,e=0;for(t=E(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,n.buffer=t.substr(e),i}var n=this;t&&(n.buffer+=n.decoder.decode(t,{stream:!0}));try{var i;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;var r=(i=e()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var a=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(a?a=!1:i=e(),n.state){case"HEADER":/:/.test(i)?_(i,function(t,e){switch(t){case"Region":console.log("parse region",e)}},/:/):i||(n.state="ID");continue;case"NOTE":i||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){n.state="NOTE";break}if(!i)continue;if(n.cue=new Fe(0,0,""),n.state="CUE",-1===i.indexOf("--\x3e")){n.cue.id=i;continue}case"CUE":try{T(i,n.cue,n.regionList)}catch(t){n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var s=-1!==i.indexOf("--\x3e");if(!i||s&&(a=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=i;continue;case"BADCUE":i||(n.state="ID");continue}}}catch(t){"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return this.onflush&&this.onflush(),this}};var He=y,Ve={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},We=function(t){var e=t;return Ve.hasOwnProperty(t)&&(e=Ve[t]),String.fromCharCode(e)},ze={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ke={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ye={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Xe={25:2,26:4,29:6,30:8,31:10,27:13,28:15},qe=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Ze={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){var i=this.verboseFilter[t];this.verboseLevel>=i&&console.log(this.time+" ["+t+"] "+e)}},Qe=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e},Je=function(){function a(t,e,i,n,r){w(this,a),this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=n||"black",this.flash=r||!1}return a.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var n=e[i];t.hasOwnProperty(n)&&(this[n]=t[n])}},a.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},a.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},a.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),$e=function(){function s(t,e,i,n,r,a){w(this,s),this.uchar=t||" ",this.penState=new Je(e,i,n,r,a)}return s.prototype.reset=function(){this.uchar=" ",this.penState.reset()},s.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},s.prototype.setPenState=function(t){this.penState.copy(t)},s.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},s.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},s.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},s}(),ti=function(){function e(){w(this,e),this.chars=[];for(var t=0;t<100;t++)this.chars.push(new $e);this.pos=0,this.currPenState=new Je}return e.prototype.equals=function(t){for(var e=!0,i=0;i<100;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},e.prototype.copy=function(t){for(var e=0;e<100;e++)this.chars[e].copy(t.chars[e])},e.prototype.isEmpty=function(){for(var t=!0,e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(Ze.log("ERROR","Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(Ze.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},e.prototype.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.prototype.insertChar=function(t){144<=t&&this.backSpace();var e=We(t);100<=this.pos?Ze.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(t){var e;for(e=t;e<100;e++)this.chars[e].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var t=[],e=!0,i=0;i<100;i++){var n=this.chars[i].uchar;" "!==n&&(e=!1),t.push(n)}return e?"":t.join("")},e.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},e}(),ei=function(){function e(){w(this,e),this.rows=[];for(var t=0;t<15;t++)this.rows.push(new ti);this.currRow=14,this.nrRollUpRows=null,this.reset()}return e.prototype.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},e.prototype.equals=function(t){for(var e=!0,i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},e.prototype.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},e.prototype.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},e.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.prototype.setCursor=function(t){Ze.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.prototype.setPAC=function(t){Ze.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<15;i++)this.rows[i].clear();var n=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){var a=r.rows[n].cueStartTime;if(a&&a<Ze.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[e-this.nrRollUpRows+s+1].copy(r.rows[n+s])}}this.currRow=e;var o=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,u=Math.max(l-1,0);o.setCursor(t.indent),t.color=o.chars[u].penState.foreground}var h={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(h)},e.prototype.setBkgData=function(t){Ze.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},e.prototype.rollUp=function(){if(null!==this.nrRollUpRows){Ze.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),Ze.log("INFO","Rolling up")}else Ze.log("DEBUG","roll_up but nrRollUpRows not set yet")},e.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],i="",n=-1,r=0;r<15;r++){var a=this.rows[r].getTextString();a&&(n=r+1,t?e.push("Row "+n+": '"+a+"'"):e.push(a.trim()))}return 0<e.length&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i},e.prototype.getTextAndFormat=function(){return this.rows},e}(),ii=function(){function i(t,e){w(this,i),this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new ei,this.nonDisplayedMemory=new ei,this.lastOutputScreen=new ei,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return i.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},i.prototype.getHandler=function(){return this.outputFilter},i.prototype.setHandler=function(t){this.outputFilter=t},i.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},i.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},i.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,Ze.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},i.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";Ze.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(Ze.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},i.prototype.ccRCL=function(){Ze.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},i.prototype.ccBS=function(){Ze.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},i.prototype.ccAOF=function(){},i.prototype.ccAON=function(){},i.prototype.ccDER=function(){Ze.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},i.prototype.ccRU=function(t){Ze.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},i.prototype.ccFON=function(){Ze.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},i.prototype.ccRDC=function(){Ze.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},i.prototype.ccTR=function(){Ze.log("INFO","TR"),this.setMode("MODE_TEXT")},i.prototype.ccRTD=function(){Ze.log("INFO","RTD"),this.setMode("MODE_TEXT")},i.prototype.ccEDM=function(){Ze.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},i.prototype.ccCR=function(){Ze.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},i.prototype.ccENM=function(){Ze.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},i.prototype.ccEOC=function(){if(Ze.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,Ze.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},i.prototype.ccTO=function(t){Ze.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},i.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=46<=t,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}Ze.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},i.prototype.outputDataUpdate=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=Ze.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},i.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},i}(),ni=function(){function n(t,e,i){w(this,n),this.field=t||1,this.outputs=[e,i],this.channels=[new ii(1,e),new ii(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return n.prototype.getHandler=function(t){return this.channels[t].getHandler()},n.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},n.prototype.addData=function(t,e){var i,n,r,a=!1;this.lastTime=t,Ze.setTime(t);for(var s=0;s<e.length;s+=2)if(n=127&e[s],r=127&e[s+1],0!==n||0!==r){if(Ze.log("DATA","["+Qe([e[s],e[s+1]])+"] -> ("+Qe([n,r])+")"),(i=this.parseCmd(n,r))||(i=this.parseMidrow(n,r)),i||(i=this.parsePAC(n,r)),i||(i=this.parseBackgroundAttributes(n,r)),!i&&(a=this.parseChars(n,r)))if(this.currChNr&&0<=this.currChNr){this.channels[this.currChNr-1].insertChars(a)}else Ze.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,Ze.log("WARNING","Couldn't parse cleaned data "+Qe([n,r])+" orig: "+Qe([e[s],e[s+1]])))}else this.dataCounters.padding+=2},n.prototype.parseCmd=function(t,e){var i;if(!((20===t||28===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&33<=e&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,Ze.log("DEBUG","Repeated command ("+Qe([t,e])+") is dropped"),!0;i=20===t||23===t?1:2;var n=this.channels[i-1];return 20===t||28===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},n.prototype.parseMidrow=function(t,e){var i=null;return(17===t||25===t)&&32<=e&&e<=47&&((i=17===t?1:2)!==this.currChNr?(Ze.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(e),Ze.log("DEBUG","MIDROW ("+Qe([t,e])+")"),!0))},n.prototype.parsePAC=function(t,e){var i,n;if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);i=t<=23?1:2,n=64<=e&&e<=95?1===i?ze[t]:Ye[t]:1===i?Ke[t]:Xe[t];var r=this.interpretPAC(n,e);return this.channels[i-1].setPAC(r),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},n.prototype.interpretPAC=function(t,e){var i,n={color:null,italics:!1,indent:null,underline:!1,row:t};return i=95<e?e-96:e-64,n.underline=1==(1&i),i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((i-16)/2),n},n.prototype.parseChars=function(t,e){var i=null,n=null,r=null;if(17<=(r=25<=t?(i=2,t-8):(i=1,t))&&r<=19){var a;a=17===r?e+80:18===r?e+112:e+144,Ze.log("INFO","Special char '"+We(a)+"' in channel "+i),n=[a]}else 32<=t&&t<=127&&(n=0===e?[t]:[t,e]);if(n){var s=Qe(n);Ze.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n},n.prototype.parseBackgroundAttributes=function(t,e){var i,n,r;return!(!((16===t||24===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&45<=e&&e<=47)||(i={},16===t||24===t?(n=Math.floor((e-32)/2),i.background=qe[n],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0)),r=t<24?1:2,this.channels[r-1].setBkgData(i),this.lastCmdA=null,this.lastCmdB=null))},n.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},n.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},n}(),ri=function(){function i(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,i),this.timelineController=t,this.track=e,this.startTime=null,this.endTime=null,this.screen=null}return i.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},i.prototype.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.track)},i}(),ai=function(t,e,i){return t.substr(i||0,e.length)===e},si=function(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()},oi={parse:function(t,s,n,r,e,i){var a=Object(Zt.b)(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),o="00:00.000",l=0,u=0,h=0,c=[],d=void 0,f=!0,p=new He;p.oncue=function(t){var e=n[r],i=n.ccOffset;"neulion"===n.type?(t.startTime+=n.ccDurationSec+h,t.endTime+=n.ccDurationSec+h):(e&&e.new&&(void 0!==u?i=n.ccOffset=e.start:function(t,e,i){var n=t[e],r=t[n.prevCC];if(!r||!r.new&&n.new)return t.ccOffset=t.presentationOffset=n.start,n.new=!1;for(;r&&r.new;)t.ccOffset+=n.start-r.start,n.new=!1,r=t[(n=r).prevCC];t.presentationOffset=i}(n,r,h)),h&&(i=h+n.ccOffset-n.presentationOffset),t.startTime+=i-u,t.endTime+=i-u),t.id=si(t.startTime.toString())+si(t.endTime.toString())+si(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),0<t.endTime&&c.push(t)},p.onparsingerror=function(t){d=t},p.onflush=function(){d&&i?i(d):e(c)},a.forEach(function(e){if(f){if(ai(e,"X-TIMESTAMP-MAP=")){f=!1,e.substr(16).split(",").forEach(function(t){ai(t,"LOCAL:")?o=t.substr(6):ai(t,"MPEGTS:")&&(l=parseInt(t.substr(7)))});try{l-=s=s<0?s+8589934592:s,t=o,i=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),r=parseInt(t.substr(-9,2)),a=9<t.length?parseInt(t.substr(0,t.indexOf(":"))):0,u=(isNaN(i)||isNaN(n)||isNaN(r)||isNaN(a)?-1:(i+=1e3*n,i+=6e4*r,i+=36e5*a))/1e3,h=l/9e4,-1===u&&(d=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){d=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(f=!1)}var t,i,n,r,a;p.parse(e+"\n")}),p.flush()}},li=!!document.documentMode,ui=!li&&!!window.StyleMedia,hi=function(r){function a(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,r.call(this,t,M.a.MEDIA_ATTACHING,M.a.MEDIA_DETACHING,M.a.FRAG_PARSING_USERDATA,M.a.FRAG_DECRYPTED,M.a.MANIFEST_LOADING,M.a.MANIFEST_LOADED,M.a.FRAG_LOADED,M.a.LEVEL_SWITCHING,M.a.INIT_PTS_FOUND));if(e.hls=t,e.config=t.config,e.enabled=!0,e.Cues=t.config.cueHandler,e.textTracks=[],e.tracks=[],e.unparsedVttFrags=[],e.initPTS=void 0,e.cueRanges=[],e.config.enableCEA708Captions){var i=new ri(e,1),n=new ri(e,2);e.cea608Parser=new ni(0,i,n)}return e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,r),a.prototype.addCues=function(t,e,i,n){for(var r=this.cueRanges,a=!1,s=r.length;s--;){var o=r[s],l=(u=o[0],h=o[1],c=e,d=i,Math.min(h,d)-Math.max(u,c));if(0<=l&&(o[0]=Math.min(o[0],e),o[1]=Math.max(o[1],i),a=!0,.5<l/(i-e)))return}var u,h,c,d;a||r.push([e,i]),this.Cues.newCue(this[t],e,i,n)},a.prototype.onInitPtsFound=function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},a.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var n=e.textTracks[i];if(!0===n["textTrack"+t])return n}return null},a.prototype.sendAddTrackEvent=function(t,e){var i=null;try{i=new window.Event("addtrack")}catch(t){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)},a.prototype.createCaptionsTrack=function(t){var e="textTrack"+t;if(!this[e]){var i=this.getExistingTrack(t);if(i)this[e]=i,k(this[e]),null==this[e].hashId&&(this[e].hashId=Jt.a.createHashName("captions",this.config["captionsTextTrack"+t+"LanguageCode"]),this[e].mode="hidden"),this.sendAddTrackEvent(this[e],this.media);else{var n=this.createTextTrack("captions",this.config["captionsTextTrack"+t+"Label"],this.config.captionsTextTrack1LanguageCode);n&&(n[e]=!0,this[e]=n,this[e].hashId=Jt.a.createHashName("captions",this.config["captionsTextTrack"+t+"LanguageCode"]))}}},a.prototype.createTextTrack=function(t,e,i){var n=this.media;if(n)return n.addTextTrack(t,e,i)},a.prototype.clearCueTracks=function(){this.textTrack1=void 0,this.textTrack2=void 0},a.prototype.destroy=function(){this.clearCueTracks(),x.prototype.destroy.call(this)},a.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks(),this.media&&this.media.addEventListener("seeked",this.onMediaSeeked.bind(this))},a.prototype.onMediaDetaching=function(){k(this.textTrack1),k(this.textTrack2)},a.prototype.onMediaSeeked=function(){(li||ui)&&this._cleanTracks()},a.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks(),this.neuVttCCs={ccOffset:0,presentationOffset:0,type:"neulion",ccDurationSec:0}},a.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)k(e[i])}},a.prototype.onManifestLoaded=function(t){var n=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=t.subtitles||[],this.tracks.forEach(function(t,e){var i=void 0;i||((i=n.createTextTrack("subtitles",t.name,t.lang)).hashId=t.hashId),i.mode=t.default?"showing":"hidden",n.textTracks.push(i)}))},a.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},a.prototype.onFragLoaded=function(t){var e=t.frag,i=t.payload;if("main"===e.type){var n=e.sn;if(n!==this.lastSn+1){var r=this.cea608Parser;r&&r.reset()}this.lastSn=n}else if("subtitle"===e.type)if(i.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);var a=e.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._neuParseVTTs(e,i)}else this.hls.trigger(M.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},a.prototype._neuParseVTTs=function(t,e){var i,n={initTimeMs:-1,flipDurationOffsetMs:0},r=null,a=0,s={result:!1,utcTimeMs:null},o=this.hls.userDataMgr;if(o.needParseTimeFromUrl()){var l=t.relurl?t.relurl:t._url;s=o.calcUtcTimeFromUrl(l)}i=s.result?s.utcTimeMs:o.liveStream()||o.cvodStream()?1e3*o.relTimeToAbsTime("main",t.start):1e3*t.start,-1!==(n=o.calcSubtitleInitTime(i)).initTimeMs?(n.initTimeMs=90*o.getFlipMod(n.initTimeMs),a=0,(r=this.neuVttCCs).ccDurationSec=n.flipDurationOffsetMs/1e3,r[a]={start:n.initTimeMs/1e3,prevCC:this.prevCC,new:!0}):(n.initTimeMs=this.initPTS,a=t.cc,(r=this.vttCCs)[t.cc]||(r[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc)),this._parseVTTs(t,e,n,r,a)},a.prototype._parseVTTs=function(e,t,i,n,r){var a=this.textTracks,s=this.hls;oi.parse(t,i.initTimeMs,n,r,function(t){var n=a[e.trackId];t.forEach(function(e){if(!n.cues.getCueById(e.id))try{n.addCue(e)}catch(t){var i=new window.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}}),s.trigger(M.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){Y.b.log("Failed to parse VTT cue: "+t),s.trigger(M.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},a.prototype.onFragDecrypted=function(t){var e=t.payload,i=t.frag;if("subtitle"===i.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);this._neuParseVTTs(i,e)}},a.prototype.onFragParsingUserdata=function(t){if(this.hls.userDataMgr.useHlsCC()&&this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var i=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,i)}},a.prototype.extractCea608Data=function(t){for(var e,i,n,r=31&t[0],a=2,s=[],o=0;o<r;o++)e=t[a++],i=127&t[a++],n=127&t[a++],0===i&&0===n||0!=(4&e)&&0===(3&e)&&(s.push(i),s.push(n));return s},a}(x),ci=i(14),di=i.n(ci),fi=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),pi=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.MANIFEST_LOADING,M.a.MANIFEST_LOADED,M.a.SUBTITLE_TRACK_LOADED));return e.tracks=[],e.trackId=-1,e.media=void 0,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=function(t){for(var e=[],i=0;i<t.length;i++)"subtitles"===t[i].kind&&e.push(t[i]);return e}(this.media.textTracks),i=0;i<e.length;i++)"showing"===e[i].mode&&e[i].hashId&&(t=e[i].hashId);this.subtitleTrack=t}},n.prototype.destroy=function(){x.prototype.destroy.call(this)},n.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},n.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},n.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},n.prototype.onManifestLoaded=function(t){var e=this,i=t.subtitles||[],n=!1;this.tracks=i,this.trackId=-1;for(var r=i.length-1;0<=r;r--)i[r].hashId=Jt.a.createHashName("subtitles",i[r].lang,i[r].name);this.hls.trigger(M.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i});var a=this.hls.config.preferredTextLanguage;""!==a&&i.forEach(function(t){di.a.normalize(t.lang)===di.a.normalize(a)?(e.subtitleTrack=t.hashId,!1===n?(t.default=!0,n=!0):t.default=!1):t.default=!1}),!1===n&&i.forEach(function(t){t.default&&(e.media?(e.subtitleTrack=t.hashId,n=!0):e.queuedDefaultTrack=t.hashId)})},n.prototype.onTick=function(){var t=this.trackId,e=this.findSubtitle(t);if(-1!==e){var i=this.tracks[e],n=i.details;void 0!==n&&!0!==n.live||(Y.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(M.a.SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))}},n.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(Y.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},n.prototype.setSubtitleTrackInternal=function(t){var e=this.findSubtitle(t);if(-1!==e){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,this.showSubtitleInNative(t),Y.b.log("switching to subtitle track "+e);var i=this.tracks[e];this.hls.userDataMgr,i.details&&i.details.live&&(i.details=void 0,Y.b.log("setSubtitleTrackInternal: clear live/live dvr track id="+this.trackId));var n=i.details;Y.b.log("setSubtitleTrackInternal: subtitle track switch begin"),this.hls.trigger(M.a.SUBTITLE_TRACK_SWITCH,{id:e}),Y.b.log("setSubtitleTrackInternal: subtitle track switch end"),void 0!==n&&!0!==n.live||(Y.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(M.a.SUBTITLE_TRACK_LOADING,{url:i.url,id:e}))}else-1!==(e=this.findCCTrackInNative(t))&&this.showSubtitleInNative(t)},n.prototype.findSubtitle=function(t){for(var e=-1,i=this.tracks.length-1;0<=i;i--)this.tracks[i].hashId&&this.tracks[i].hashId===t&&(e=i);return e},n.prototype.findCCTrackInNative=function(t){var e=-1;if(!this.media||!this.media.textTracks)return e;for(var i=this.media.textTracks.length-1;0<=i;i--){var n=this.media.textTracks[i];"captions"===n.kind&&n.hashId===t&&(e=i)}return e},n.prototype.showSubtitleInNative=function(t){if(this.media&&this.media.textTracks)for(var e=this.media.textTracks.length-1;0<=e;e--){var i=this.media.textTracks[e];"disabled"!==i.mode&&(i.hashId===t?i.mode="showing":i.mode="hidden")}},fi(n,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),n}(x),gi=i(4),mi="STOPPED",vi="IDLE",yi="KEY_LOADING",bi="FRAG_LOADING",_i=function(i){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,i.call(this,t,M.a.MEDIA_ATTACHING,M.a.MEDIA_ATTACHED,M.a.ERROR,M.a.KEY_LOADED,M.a.FRAG_LOADED,M.a.SUBTITLE_TRACKS_UPDATED,M.a.SUBTITLE_TRACK_SWITCH,M.a.SUBTITLE_TRACK_LOADED,M.a.SUBTITLE_FRAG_PROCESSED));return e.config=t.config,e.vttFragSNsProcessed={},e.vttFragQueues=void 0,e.currentlyProcessing=null,e.state=mi,e.currentTrackId=-1,e.ticks=0,e.decrypter=new gi.a(t.observer,t.config),e.media=null,e.useNeulionCdns=!1,e.cmdIndex=0,e.startIndex=-1,e.lastMediaTimes={},e.needStartInited={},e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,i),n.prototype.destroy=function(){x.prototype.destroy.call(this),this.state=mi,this.media&&this.media.removeEventListener("seeked",this.onMediaSeeked.bind(this)),this.media=null,this.useNeulionCdns=!1,this.cmdIndex=0,this.startIndex=-1,this.lastMediaTimes={},this.needStartInited={}},n.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},n.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&-1<this.currentTrackId&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=t,this.useNeulionCdns&&t&&this.hls.cdnsCtrl.rewriteUrlByCdnCtrls(t,0),this.hls.trigger(M.a.FRAG_LOADING,{frag:t}),this.state=bi}},n.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=vi,this.nextFrag()},n.prototype.onMediaAttaching=function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null},n.prototype.onMediaAttached=function(){this.state=vi,this.media&&this.media.addEventListener("seeked",this.onMediaSeeked.bind(this))},n.prototype.onMediaSeeked=function(){Y.b.log("subtitle: reInitSubtitleTrack in onMediaSeeked"),this.reInitSubtitleTrack(),this.tick()},n.prototype.reInitSubtitleTrack=function(){var t=this.media,e=t?t.currentTime:void 0;isNaN(e)||Y.b.log("media seeked to "+e.toFixed(3));var i=this.tracks;if(void 0!==i){var n,r=this.currentTrackId;if(!(r<0))r<i.length&&(n=i[r].details),void 0!==n&&void 0!==e&&(this.vttFragQueues[r]=[],this.vttFragSNsProcessed[r]=[],this.currentlyProcessing=null,this.state=vi,this.cmdIndex++,this.startIndex=-1,this.lastMediaTimes[r]=e,this.startIndex=this.calcInitSubtitleIndex(n,e),this.needStartInited[r]=!0)}},n.prototype.calcInitSubtitleIndex=function(t,e){var i=this.hls.userDataMgr,n=i.relTimeToAbsTime("main",e),r=0;Y.b.log("Subtitle: currentTime="+e+", absTime="+n),i.logTimeline("main","subtitle");var a=t.fragments;if(-1===n){if(!i.liveStream()&&a)for(var s=0,o=0;o<a.length;o++){if(e-40<=s){r=o;break}s+=a[o].duration}}else{var l=t.fragments,u=n-40;if(Y.b.log("subtitle: (absTime-40)="+u),l)for(var h=0,c=0;c<l.length;c++){if(l[c].rawProgramDateTime&&(h=new Date(l[c].rawProgramDateTime).getTime()/1e3,Y.b.log("Subtitle: Init subtitle beginTime="+h)),n-40<=h){r=c;break}h+=l[c].duration}}return r},n.prototype.onError=function(t){var e=t.frag;e&&"subtitle"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},n.prototype.tick=function(){var t=this;1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(function(){t.tick()},1),this.ticks=0)},n.prototype.doTick=function(){switch(this.state){case vi:var t=this.tracks,e=this.currentTrackId;this.needStartInited[e]||(Y.b.log("subtitle: reInitSubtitleTrack in dotick"),this.reInitSubtitleTrack());var i,n=this.vttFragSNsProcessed[e],r=this.vttFragQueues[e],a=this.currentlyProcessing?this.currentlyProcessing.sn:-1;if(!t)break;if(e<t.length&&(i=t[e]?t[e].details:void 0),void 0===i)break;if(-1!=this.startIndex)for(var s=this.startIndex;s<i.fragments.length;s++){var o=i.fragments[s];l=o,-1<n.indexOf(l.sn)||o.sn===a||function(e){return r.some(function(t){return t.sn===e.sn})}(o)||(o.decryptdata&&null!=o.decryptdata.uri&&null==o.decryptdata.key?(Y.b.log("Loading key for "+o.sn),this.state=yi,this.hls.trigger(M.a.KEY_LOADING,{frag:o,userdata:{cmdIndex:this.cmdIndex}})):(o.trackId=e,r.push(o),this.nextFrag()))}}var l},n.prototype.onSubtitleTracksUpdated=function(t){var e=this;Y.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]}),this.needStartInited={},this.tracks.forEach(function(t){e.needStartInited[t.id]=!1,e.lastMediaTimes[t.id]=Number.MAX_VALUE})},n.prototype.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,this.tracks&&-1!==this.currentTrackId){this.abortFragLoading();var e=this.tracks[this.currentTrackId];e&&e.details&&(this.clearVttFragQueues(),Y.b.log("subtitle: reInitSubtitleTrack in onSubtitleTrackSwitch"),this.reInitSubtitleTrack(),this.tick())}else Y.b.log("subtitle: currentTrackId="+this.currentTrackId)},n.prototype.onSubtitleTrackLoaded=function(){Y.b.log("subtitle: ticks="+this.ticks+", state="+this.state),this.tick()},n.prototype.onKeyLoaded=function(t){var e=t&&t.userdata&&t.userdata.cmdIndex?t.userdata.cmdIndex:null;null!=e&&"subtitle"===t.frag.type&&e===this.cmdIndex&&this.state===yi&&(this.state=vi,this.tick())},n.prototype.onFragLoaded=function(t){var e=this.fragCurrent,i=t.frag.decryptdata,n=t.frag,r=this.hls;if(this.state===bi&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn){if(null==(t&&t.userdata&&t.userdata.cmdIndex?t.userdata.cmdIndex:null))return;if(this.fragCurrent=null,0<t.payload.byteLength&&null!=i&&null!=i.key&&"AES-128"===i.method){var a;try{a=performance.now()}catch(t){a=Date.now()}this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}r.trigger(M.a.FRAG_DECRYPTED,{frag:n,payload:t,stats:{tstart:a,tdecrypt:e}})})}}},n.prototype.abortFragLoading=function(t){var e=this.fragCurrent;e&&e.loader&&(e.loader.abort(),Y.b.log("subtitle abort downloading frag. url="+e.relurl)),this.fragCurrent=null,this.state=vi},n}(x),Ti={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.34,liveSyncDurationCount:4,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:15,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:be,fLoader:void 0,withCredentialsFragmentPattern:[],pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:fe,bufferController:ge,capLevelController:ve,fpsController:ye,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,preferredAudioLanguage:"",preferredTextLanguage:"",lteMode:!0};Ti.subtitleStreamController=_i,Ti.subtitleTrackController=pi,Ti.timelineController=hi,Ti.cueHandler=A,Ti.enableCEA708Captions=!0,Ti.enableWebVTT=!0,Ti.captionsTextTrack1Label="English",Ti.captionsTextTrack1LanguageCode="en",Ti.captionsTextTrack2Label="Spanish",Ti.captionsTextTrack2LanguageCode="es",Ti.audioStreamController=Ue,Ti.audioTrackController=Te;var Ei=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),Si=function(){function b(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,b);var i=b.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in i)n in t||(t[n]=i[n]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(Y.a)(t.debug),this.config=t,this._autoLevelCapping=-1;var r=this.observer=new Lt.a;r.trigger=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];r.emit.apply(r,[t,t].concat(i))},r.off=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];r.removeListener.apply(r,[t].concat(i))},this.on=r.on.bind(r),this.off=r.off.bind(r),this.trigger=r.trigger.bind(r);var a=this.abrController=new t.abrController(this),s=new t.bufferController(this),o=new t.capLevelController(this),l=new t.fpsController(this),u=new Tt(this),h=new Et(this),c=new St(this),d=new $t(this),f=[this.levelController=new qt(this),this.streamController=new zt(this)],p=t.audioStreamController;p&&f.push(new p(this)),this.networkControllers=f;var g=[u,h,c,a,s,o,l,d];if(p=t.audioTrackController){var m=new p(this);this.audioTrackController=m,g.push(m)}if(p=t.subtitleTrackController){var v=new p(this);this.subtitleTrackController=v,g.push(v)}if([t.subtitleStreamController].forEach(function(t){t&&g.push(new t(e))}),p=t.timelineController){var y=new p(this);this.timelineController=y,g.push(y)}this.coreComponents=g,this.thumbnailController=new te(this),this.errorController=new oe(this),this.advertisementController=new st(this),this.advertisementLoader=new ue(this),this.cdnsCtrl=new G(this),this.userDataMgr=new lt(this)}return b.isSupported=function(){return t=u(),e=window.SourceBuffer||window.WebKitSourceBuffer,i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!i&&!!n;var t,e,i,n},Ei(b,null,[{key:"version",get:function(){return"0.8.9-20190416"}},{key:"Events",get:function(){return M.a}},{key:"ErrorTypes",get:function(){return U.b}},{key:"ErrorDetails",get:function(){return U.a}},{key:"DefaultConfig",get:function(){return b.defaultConfig?b.defaultConfig:Ti},set:function(t){b.defaultConfig=t}}]),b.prototype.destroy=function(){Y.b.log("destroy"),this.trigger(M.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.userDataMgr.destroy(),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1,this.errorController.destroy(),this.advertisementController.destroy(),this.advertisementLoader.destroy(),this.cdnsCtrl.destroy()},b.prototype.attachMedia=function(t){Y.b.log("attachMedia"),this.media=t,this.trigger(M.a.MEDIA_ATTACHING,{media:t})},b.prototype.detachMedia=function(){Y.b.log("detachMedia"),this.trigger(M.a.MEDIA_DETACHING),this.media=null},b.prototype.loadSource=function(t){t=P.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),Y.b.log("loadSource:"+t),this.url=t,this.trigger(M.a.MANIFEST_LOADING,{url:t})},b.prototype.startLoad=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;Y.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},b.prototype.stopLoad=function(){Y.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()}),this.abrController.resetTotalLoadedBytes(),this.errorController.reset()},b.prototype.swapAudioCodec=function(){Y.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.prototype.recoverMediaError=function(){Y.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},b.prototype.getThumbnailStreams=function(){return Y.b.log("getThumbnailStreams"),this.thumbnailController.getThumbnailStreams()},b.prototype.getThumbnailStreamImages=function(t,e,i){Y.b.log("getThumbnailStreamImages"),this.thumbnailController.getThumbnailStreamImages(t,e,i)},b.prototype.reInitErrorCtrl=function(){this.errorController.reset()},b.prototype.setSysInfo=function(t,e){this._browserType=t,this._osName=e},b.prototype.getLteStreamInfos=function(t){return this.userDataMgr.getLteStreamInfos(t)},b.prototype.getHlsCC=function(){return this.userDataMgr.getHlsCC()},Ei(b,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return-1!==this.streamController.currentLevel?this.streamController.currentLevel:this.loadLevel},set:function(t){Y.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){Y.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){Y.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){Y.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){Y.b.log("set startLevel:"+t);-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){Y.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,i=t?t.length:0,n=0;n<i;n++)if((t[n].realBitrate?Math.max(t[n].realBitrate,t[n].bitrate):t[n].bitrate)>e)return n;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel?this.abrController.nextAutoLevel:0,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"cdnsLoadBytes",get:function(){var t=[];if(void 0!==this.cdnsCtrl&&0<this.cdnsCtrl.playlistCdnNodes.length)t=this.cdnsCtrl.getCdnsBytes();else{var e={};e.cdnName=void 0===this.levelController.manifestHost?"undefined":this.levelController.manifestHost,e.bytes=this.abrController.totalLoadedBytes,e.onlineSpeed=Math.round(this.abrController.onlineSpeed/1e3),e.priority=0,e.bandwidthRate=0,t.push(e)}return t}},{key:"vodDuration",get:function(){return this.streamController.totalduration}},{key:"liveEdge",get:function(){return this.streamController.liveEdge}},{key:"os",get:function(){return this._osName}},{key:"browser",get:function(){return this._browserType}},{key:"adStitistics",get:function(){return this.advertisementController.adStatistics}},{key:"timelineInfo",get:function(){return this.userDataMgr.getTimeline("main")}},{key:"isCVodStream",get:function(){return this.userDataMgr.cvodStream()}}]),b}();e.default=Si},function(t,e){var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c={parse:function(e){try{void 0!==Titanium.XML&&(e=Titanium.XML.parseString(e))}catch(t){e=(new DOMParser).parseFromString(e,"text/xml")}return this._xml_to_json(e.getElementsByTagName("plist").item(0))},_xml_to_json:function(t){for(var e=t,i=e.nodeName,n=[],r=0;r<e.childNodes.length;++r){"#text"!=(h=e.childNodes.item(r)).nodeName&&n.push(h)}switch(i){case"plist":if(1<n.length){var a=[];for(r=0;r<n.length;++r)a.push(this._xml_to_json(n[r]));return a}return this._xml_to_json(n[0]);case"dict":var s,o,l={};for(r=0;r<n.length;++r){"#text"==(h=n[r]).nodeName||("key"==h.nodeName?s=c._textValue(h.firstChild):(o=this._xml_to_json(h),l[s]=o))}return l;case"array":var u=[];for(r=0;r<n.length;++r){var h=n[r];u.push(this._xml_to_json(h))}return u;case"string":return c._textValue(e);case"date":return c._parseDate(c._textValue(e)).toString();case"integer":return parseInt(c._textValue(e),10);case"real":return parseFloat(c._textValue(e));case"data":return c._textValue(e);case"true":return!0;case"false":return!1}},_textValue:function(t){return t.text?t.text:t.textContent},_parseDate:function(t){var e=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(t);if(e)return new Date(Date.UTC(+e[1],+e[2]-1,+e[3],+e[4],+e[5],+e[6]))},serialize:function(t){try{if(void 0!==t.toSource&&void 0===t.callee)return t.toSource()}catch(t){}switch(void 0===t?"undefined":h(t)){case"number":case"boolean":case"function":return t;case"string":return"'"+t+"'";case"object":var e;if(t.constructor===Array||void 0!==t.callee){e="[";var i,n=t.length;for(i=0;i<n-1;i++)e+=c.serialize(t[i])+",";e+=c.serialize(t[i])+"]"}else{var r;for(r in e="{",t)t.hasOwnProperty(r)&&(e+=r+":"+c.serialize(t[r])+",");e=e.replace(/\,$/,"")+"}"}return e;default:return"UNKNOWN"}},toPlist:function(t){var e=document.createElement("xml"),i=document.createElement("plist");i.setAttribute("version","1.0"),e.appendChild(i);var n=document.createElement("dict");i.appendChild(n);var u=function(t,e,i){for(var n in e)i(t,n,e[n])};return u(n,t,function t(e,i,n){var r=document.createElement("key");if(r.innerHTML=i,e.appendChild(r),"object"==(void 0===n?"undefined":h(n)))if(n instanceof Date){var a=document.createElement("date");a.innerHTML=function(t){function e(t){return t<10?"0"+t:t}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"}(n),e.appendChild(a)}else{var s=document.createElement("dict");u(s,n,t),e.appendChild(s)}else if("boolean"==typeof n){var o=document.createElement(n.toString());e.appendChild(o)}else{var l=document.createElement("string");l.innerHTML=n,e.appendChild(l)}}),'<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">'+e.innerHTML}};t.exports=c},function(t,e,f){function l(i){function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r={};n.m=i,n.c=r,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var t=n(n.s=ENTRY_MODULE);return t.default||t}function p(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(t,e,i){var n={};n[i]=[];var r,a=e.toString(),s=a.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!s)return n;for(var o,l=s[1],u=new RegExp("(\\\\n|\\W)"+p(l)+v,"g");o=u.exec(a);)"dll-reference"!==o[3]&&n[i].push(o[3]);for(u=new RegExp("\\("+p(l)+'\\("(dll-reference\\s('+m+'))"\\)\\)'+v,"g");o=u.exec(a);)t[o[2]]||(n[i].push(o[1]),t[o[2]]=f(o[1]).m),n[o[2]]=n[o[2]]||[],n[o[2]].push(o[4]);for(var h=Object.keys(n),c=0;c<h.length;c++)for(var d=0;d<n[h[c]].length;d++)r=n[h[c]][d],!isNaN(1*r)&&(n[h[c]][d]=1*n[h[c]][d]);return n}function g(i){return Object.keys(i).reduce(function(t,e){return t||0<i[e].length},!1)}var m="[\\.|\\-|\\+|\\w|/|@]+",v="\\((/\\*.*?\\*/)?s?.*?("+m+").*?\\)";t.exports=function(t,e){e=e||{};var i={main:f.m},n=e.all?{main:Object.keys(i.main)}:function(t,e){for(var i={main:[e]},n={main:[]},r={main:{}};g(i);)for(var a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o].pop();if(r[o]=r[o]||{},!r[o][l]&&t[o][l]){r[o][l]=!0,n[o]=n[o]||[],n[o].push(l);for(var u=d(t,t[o][l],o),h=Object.keys(u),c=0;c<h.length;c++)i[h[c]]=i[h[c]]||[],i[h[c]]=i[h[c]].concat(u[h[c]])}}return n}(i,t),r="";Object.keys(n).filter(function(t){return"main"!==t}).forEach(function(e){for(var t=0;n[e][t];)t++;n[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+e+" = ("+l.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),r=r+"new (("+l.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n.main.map(function(t){return JSON.stringify(t)+": "+i.main[t].toString()}).join(",")+"}))(self);";var a=new window.Blob([r],{type:"text/javascript"});if(e.bare)return a;var s=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),o=new window.Worker(s);return o.objectURL=s,o}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(8),o=i(1),l=i(0),n=i(5),u=i.n(n);e.default=function(r){var a=new u.a;a.trigger=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];a.emit.apply(a,[t,t].concat(i))},a.off=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];a.removeListener.apply(a,[t].concat(i))};var n=function(t,e){r.postMessage({event:t,data:e})};r.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var i=JSON.parse(e.config);r.demuxer=new s.a(a,e.typeSupported,i,e.vendor);try{Object(l.a)(!0===i.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":r.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),a.on(o.a.FRAG_DECRYPTED,n),a.on(o.a.FRAG_PARSING_INIT_SEGMENT,n),a.on(o.a.FRAG_PARSED,n),a.on(o.a.ERROR,n),a.on(o.a.FRAG_PARSING_METADATA,n),a.on(o.a.FRAG_PARSING_USERDATA,n),a.on(o.a.INIT_PTS_FOUND,n),a.on(o.a.INIT_FPS_FOUND,n),a.on(o.a.FRAG_PARSING_DATA,function(t,e){var i=[],n={event:t,data:e};e.data1&&(n.data1=e.data1.buffer,i.push(e.data1.buffer),delete e.data1),e.data2&&(n.data2=e.data2.buffer,i.push(e.data2.buffer),delete e.data2),r.postMessage(n,i)})}},function(t,e){var n=1,r=2,a={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"},i={match:function(t,e,i){return i===e||n<=t&&i===e.split("-")[0]||r<=t&&i.split("-")[0]===e.split("-")[0]},normalize:function(t){var e=t.toLowerCase().split("-"),i=e[0],n=a[i];return n&&(e[0]=n),e.join("-")}};t.exports=i}]).default}.apply(e,[]))||(t.exports=n)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),p=i(11),a=i(75),s=y(i(74)),l=i(142),o=i(34),u=i(46),h=i(28),c=i(369),d=(n=c)&&n.__esModule?n:{default:n},f=i(76),g=i(372),m=i(45),v=y(i(143));function y(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var b=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i._url="",i._drmConfig=null,i._ccConfig={label:"English",language:"en"},i._drmManager=null,i._startTime=null,i._seekToStartTime=!1,i.type=p.AdaptivePlayer.PlayerType.NATIVE,i.streamType=p.AdaptivePlayer.StreamType.HTTP_VIDEO,i._useExternalM3U8Parser=u.Settings.BASICPLAYER.USE_EXTERNAL_M3U8_PARSER,i._hlsPlaylistParser=null,i._gapToLiveEdge=0,i._gapToDVREnd=0,i._dvrDuration=null,i._thumbnailsStreams=[],i._thumbnailImagesCb=null,i._advertisements=[],i._emptyAdvertisements=[],i._adBeginTime=null,i._playlistUpdateTimer=null,i._timeToleranceMs=200,i._adStatistics={},i._lastAdvertise=null,i._timeline={init:!1,targetDuration:0,absStart:0,curAbsStart:0,curAbsEnd:0,timeRanges:[]},i._levelResquestIndex=0,i._levelResponseIndex=0,i._lastUpdateTime=0,i._seekEnded=!0,i._state="stop",i.vodType="vod",i._thumbnailTimeScale=1e3,i.print(p.AdaptivePlayer.LogLevel.INFO,"BasicPlayer","Instance created!"),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,a.PlayerBase),r(n,[{key:"destroy",value:function(){return this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","destroy called!"),this.unload(),this._drmManager&&this._drmManager.destroy(),Promise.resolve()}},{key:"configure",value:function(t){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","configure called!"),(this._config=t)&&(t.useExternalM3U8Parser&&(this._useExternalM3U8Parser=t.useExternalM3U8Parser),t.drm&&(this._drmConfig=t.drm),t.preferredAudioLanguage&&(this._config.preferredAudioLanguage=t.preferredAudioLanguage.toLowerCase()),t.preferredTextLanguage&&(this._config.preferredTextLanguage=t.preferredTextLanguage.toLowerCase()),this._config.closedCaption&&(this._config.closedCaption.label&&(this._ccConfig.label=t.closedCaption.label),this._config.closedCaption.language&&(this._ccConfig.language=t.closedCaption.language)))}},{key:"load",value:function(t,e){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","load called!"),this._url=t,"m3u8"===s.getExtension(t)||"m3u"===s.getExtension(t)?this.streamType=p.AdaptivePlayer.StreamType.HLS:this.streamType=p.AdaptivePlayer.StreamType.HTTP_VIDEO,this.streamType===p.AdaptivePlayer.StreamType.HLS&&(this._useExternalM3U8Parser&&(this._hlsPlaylistParser=new d.default,this._hlsPlaylistParser.setErrorCb(this._onError.bind(this)),this._hlsPlaylistParser.setPlayHeadCB(this._onPlayHeadTimeCallback.bind(this)),this._hlsPlaylistParser.setThumbnailCb(this._onThumbnailCallback.bind(this)),this._hlsPlaylistParser.setThumbnailImageCb(this._onThumbnailImageCallback.bind(this)),this._hlsPlaylistParser.setAdStitchCb(this._onAdsInfosCallback.bind(this)),this._hlsPlaylistParser.loadPlaylist(t,{type:"master"})),this._drmConfig&&this._drmConfig.fairplay&&this._drmConfig.fairplay.server&&this._drmConfig.fairplay.serverCertificate&&(this._drmManager||(this._drmManager=new g.FairPlayDRM),this._drmManager&&(this._drmManager.configure(this._drmConfig.fairplay.server,this._drmConfig.fairplay.serverCertificate,this._drmConfig.params),this._drmManager.init(this._video,this._onError.bind(this))))),this._eventManager=new m.EventManager,this._video.textTracks&&(this._video.textTracks.addEventListener?this._eventManager.listen(this._video.textTracks,"addtrack",this._onTextTrackAdded.bind(this)):this._video.textTracks.onaddtrack=this._onTextTrackAdded.bind(this)),null!==p.AdaptivePlayer.browserType.match(/IE/i)&&this._eventManager.listen(this._video,"loadedmetadata",function(t){this.notifyProfileChanged({id:0,videoHeight:t.target.videoHeight,videoWidth:t.target.videoWidth})}.bind(this));var i=t;return(!e||e<0)&&(e=0),0<e&&(this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","load called set startTime="+e),null===p.AdaptivePlayer.browserType.match(/.*Safari.*/i)?(i=t+"#t="+e,this._startTime=e,this._eventManager.listen(this._video,"loadedmetadata",function(){this._seekToStartTime=!0,this.currentTime=this._startTime;var t=this._video.play();null!=t&&t.then(function(){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","auto play started!"),this._eventHandler.dispatchEvent(new o.FakeEvent(p.AdaptivePlayer.EventType.AutoPlayStatus,{details:{autoplay:!0}}))}.bind(this)).catch(function(){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","auto play prevented!"),this._eventHandler.dispatchEvent(new o.FakeEvent(p.AdaptivePlayer.EventType.AutoPlayStatus,{details:{autoplay:!1}}))}.bind(this))}.bind(this))):(this._startTime=e,this._eventManager.listen(this._video,"loadedmetadata",function(){this._video.currentTime=e}.bind(this))),this._video.pause()),this._video.src=i,Promise.resolve()}},{key:"isLive",value:function(){return this._video.duration===1/0}},{key:"gotoLive",value:function(){if(this.isLive()){var t=this._getRelEndLimit(),e=v.relTimeToAbsTime(t,this._timeline.timeRanges,this._timeline.absStart);e>this.currentTime&&(this.currentTime=e)}}},{key:"unload",value:function(){if(this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","unload called!"),this._useExternalM3U8Parser=u.Settings.BASICPLAYER.USE_EXTERNAL_M3U8_PARSER,this._hlsPlaylistParser=null,this._gapToLiveEdge=0,this._gapToDVREnd=0,this._startTime=null,this._seekToStartTime=!1,this._thumbnailsStreams=[],this._thumbnailImagesCb=null,this._playlistUpdateTimer&&(clearTimeout(this._playlistUpdateTimer),this._playlistUpdateTimer=null),this._timeToleranceMs=200,this._advertisements=[],this._emptyAdvertisements=[],this._adBeginTime=null,this._adStatistics={},this._lastAdvertise=null,this._adTimer=null,this.vodType="vod",this._timeline={init:!1,targetDuration:0,absStart:0,curAbsStart:0,curAbsEnd:0,timeRanges:[]},this._state="stop",this._levelResquestIndex=0,this._levelResponseIndex=0,this._lastUpdateTime=0,this._thumbnailTimeScale=1e3,this._eventManager&&this._eventManager.destroy(),this._drmManager&&this._drmManager.reset(),this._video.textTracks){this._video.textTracks.removeEventListener?this._video.textTracks.removeEventListener("addtrack",this._onTextTrackAdded.bind(this)):this._video.textTracks.onaddtrack=null;for(var t=0;t<this._video.textTracks.length;t++){var e=this._video.textTracks[t];"metadata"===e.kind&&(e.oncuechange=null)}return this._video&&""!==this._video.src&&2<=this._video.readyState&&(this._video.currentTime=0,this._video.src=""),Promise.resolve()}}},{key:"audioTracks",value:function(){var t=[];if(this._video.audioTracks)for(var e=0;e<this._video.audioTracks.length;e++){var i=this._video.audioTracks[e];""===i.label&&""===i.language||t.push(new f.NLTrack(p.AdaptivePlayer.Kind.AUDIO,i,p.AdaptivePlayer.PlayerType.NATIVE,{id:e,player:this._video}))}return t}},{key:"ccTracks",value:function(){for(var t=[],e=0;e<this._video.textTracks.length;e++){var i=this._video.textTracks[e];"captions"!==i.kind&&"subtitles"!==i.kind||i.label===u.Settings.DASHPLAYER.DEFAULT_SUBTITLE_TRACK_NAME||t.push(i)}return t}},{key:"textTracks",value:function(){for(var t=[],e=0;e<this._video.textTracks.length;e++){var i=this._video.textTracks[e];"captions"!==i.kind&&"subtitles"!==i.kind||i.label===u.Settings.DASHPLAYER.DEFAULT_SUBTITLE_TRACK_NAME||null!=i.hashId||t.push(new f.NLTrack(p.AdaptivePlayer.Kind.TEXT,i,p.AdaptivePlayer.PlayerType.NATIVE,{id:e,player:this,ccInfos:this._hlsPlaylistParser?this._hlsPlaylistParser.getHlsCC():null}))}return t}},{key:"selectTrack",value:function(t){if(t)if(t.active=!0,"TEXT"===t.kind){for(var e=this._video.textTracks,i=0;i<e.length;i++)"disabled"!==e[i].mode&&(e[i].mode="hidden");t.base.mode="showing"}else if("AUDIO"===t.kind){for(var n=this._video.audioTracks,r=0;r<n.length;r++)n[r].enabled=!1;t.base.enabled=!0}}},{key:"getThumbnailStreams",value:function(){this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","getThumbnailStreams!");var t=[];if(this._hlsPlaylistParser)for(var e=0;e<this._thumbnailsStreams.length;e++){var i={id:this._thumbnailsStreams[e].id,width:this._thumbnailsStreams[e].width,height:this._thumbnailsStreams[e].height};t.push(i)}return t}},{key:"getThumbnailStreamImages",value:function(t,e,i){if(this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","getThumbnailStreamImages!"),this._hlsPlaylistParser){null==this._thumbnailImagesCb&&(this._thumbnailImagesCb=i);var n=this._thumbnailsStreams[t];if(n){var r=0;this.isCVodStream()&&(e+=this._timeline.absStart,r=this._timeline.absStart),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","getThumbnailStreamImages: time="+e+" absStart="+r),this.isLive()?this._hlsPlaylistParser.loadPlaylist(n.uri,{type:"thumbnail",index:t,time:e,baseTime:0,requestTime:(new Date).getTime()}):this.isCVodStream()?null==n.vttCueSegments?this._hlsPlaylistParser.loadPlaylist(n.uri,{type:"thumbnail",index:t,time:e,baseTime:r,requestTime:(new Date).getTime()}):this._loadVtt(Number(t),e):null==n.vttCueSegments?this._hlsPlaylistParser.loadPlaylist(n.uri,{type:"thumbnail",index:t,time:e,baseTime:0,requestTime:(new Date).getTime()}):this._loadVtt(Number(t),e),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","time="+e+" absStart="+r)}}}},{key:"notifyPlayStarted",value:function(){if(this._state="canplay",this._timeline&&0<this._timeline.timeRanges.length&&0<this._timeline.absStart){var t={start:this._timeline.absStart,end:this._timeline.timeRanges[this._timeline.timeRanges.length-1].end,ranges:this._timeline.timeRanges};this._eventHandler.dispatchEvent(new o.FakeEvent(p.AdaptivePlayer.EventType.SeekRangeChange,{details:t,data:t})),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","Fired SeekRangeChange for CVOD: ["+JSON.stringify(t)+"]")}if(this._config.preferredAudioLanguage){var e=this.audioTracks().filter(function(t){return t.language===this._config.preferredAudioLanguage}.bind(this));e&&0<e.length&&!e[0].active&&this.selectTrack(e[0])}if(this._config.preferredTextLanguage){var i=this.textTracks().filter(function(t){return t.language===this._config.preferredTextLanguage}.bind(this));i&&0<i.length&&!i[0].active&&this.selectTrack(i[0])}}},{key:"setThumbnailTimeScale",value:function(t){this._thumbnailTimeScale=t}},{key:"isCVodStream",value:function(){var t=!1;return this.isLive()||0===this._timeline.absStart||(t=!0),t}},{key:"_onError",value:function(t){var e=t.error,i=6e3<=e.code?h.NLError.SeverityLevel.Warning:h.NLError.SeverityLevel.Fatal,n=0,r=this._url;switch(e.code){case h.NLError.Basic.M3U8.MANIFEST_LOAD_ERROR.code:case h.NLError.Basic.M3U8.MANIFEST_PARSING_ERROR.code:case h.NLError.Basic.M3U8.GET_PLAYHEADTIME_FAILED.code:n=h.NLError.Code.Get_Primary_Manifest_Failed+(t.code?t.code:h.NLError.NetworkDetailCode.Content_Error),t.code&&(404===t.code?(i=h.NLError.SeverityLevel.Fatal,n=h.NLError.Code.Get_Primary_Manifest_Failed+h.NLError.NetworkDetailCode.Http_Error,e.message="404 from external parser"):0===t.code?(i=h.NLError.SeverityLevel.Fatal,n=h.NLError.Code.Get_Primary_Manifest_Failed+h.NLError.NetworkDetailCode.Connect_Failed,e.message="connection error from external parser"):403===t.code&&(i=h.NLError.SeverityLevel.Warning,n=h.NLError.Code.Get_Primary_Manifest_Failed+h.NLError.NetworkDetailCode.Connect_Failed,e.message="connection error from external parser",this._basic_externalParser_403_found=!0));break;case h.NLError.Basic.M3U8.GET_THUMBNAIL_FAILED.code:case h.NLError.Basic.M3U8.GET_VTT_FAILED.code:case h.NLError.Basic.M3U8.PARSE_VTT_FAILED.code:n=h.NLError.Code.Get_Single_Bitrate_Manifest_Failed,t.code?404===t.code?(i=h.NLError.SeverityLevel.Warning,n+=h.NLError.NetworkDetailCode.Http_Error,e.message="404 from external parser"):0===t.code?(i=h.NLError.SeverityLevel.Warning,n+=h.NLError.NetworkDetailCode.Connect_Failed,e.message="connection error from external parser"):403===t.code?(i=h.NLError.SeverityLevel.Warning,n+=h.NLError.NetworkDetailCode.Connect_Failed,e.message="connection error from external parser",this._basic_externalParser_403_found=!0):n+=t.code:n+=h.NLError.NetworkDetailCode.Content_Error;break;case h.NLError.Basic.DRM.NOT_SUPPORTED.code:n=h.NLError.Code.DRM_Not_Supported;break;case h.NLError.Basic.DRM.INVALID_PARAMS.code:case h.NLError.Basic.DRM.KEY_SESSION_CREATE_ERROR.code:case h.NLError.Basic.DRM.CERTIFICATE_ERROR.code:case h.NLError.Basic.DRM.CERTIFICATE_OVERFLOW_ERROR.code:n=h.NLError.Code.DRM_Init_Failed;break;case h.NLError.Basic.DRM.LICENSE_ERROR.code:case h.NLError.Basic.DRM.KEY_ERROR.code:n=h.NLError.Code.Get_Key_License_Failed+(t.code?t.code:h.NLError.NetworkDetailCode.Content_Error)}var a=h.NLError.create(n,i,r,e.message);this._statisticManager.reportError(a),i=6e3<=e.code?p.AdaptivePlayer.LogLevel.WARNING:p.AdaptivePlayer.LogLevel.ERROR,this.print(i,"BasicPlayer","Fired streaming error: "+e.message)}},{key:"_onTimeUpdate",value:function(t){if(this.isLive()&&250<Date.now()-this._lastUpdateTime){var e={start:this._timeline.curAbsStart,end:this._timeline.curAbsEnd,ranges:this._timeline.curTimeRanges};this._eventHandler.dispatchEvent(new o.FakeEvent(p.AdaptivePlayer.EventType.SeekRangeChange,{data:e,details:e})),this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","Fired SeekRangeChange: ["+JSON.stringify(e)+"]"),this._lastUpdateTime=Date.now()}return null!==p.AdaptivePlayer.browserType.match(/.*Safari.*/i)&&!this._seekToStartTime&&this._startTime&&0<this._startTime&&(!this.isLive()||this.isLive()&&this._timeline.init&&"canplay"===this._state)&&(this._seekToStartTime=!0,this.currentTime=this._startTime),Promise.resolve()}},{key:"_onTextTrackAdded",value:function(t){if(this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","addtrack triggered!"),"metadata"===t.track.kind){var e=t.track;e.mode="hidden",e.addEventListener?(this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","register cuechange event!"),e.addEventListener("cuechange",this._cuechange.bind(this))):e.oncuechange=this._cuechange.bind(this)}}},{key:"_onplaylistUpdateTimer",value:function(){if(this._hlsPlaylistParser){var t=this._hlsPlaylistParser.getLevelUrl();t&&(this._levelResquestIndex+=1,this._hlsPlaylistParser.loadPlaylist(t,{type:"level",index:this._levelResquestIndex}))}}},{key:"_onPlayHeadTimeCallback",value:function(t,e){if(t&&t.endList){if(0===t.dateTimeStrings.length)return void(this.vodType="vod");if("cvod"===this.vodType)return;this.vodType="cvod"}if(!(null!==e&&e<this._levelResponseIndex))if(this._levelResponseIndex=e,this._mergeProgrameTime(t),"cvod"===this.vodType)this._onplaylistUpdateTimer();else if(null==this._playlistUpdateTimer){var i=1e3;t&&t.targetDuration&&2<t.targetDuration&&(i=1e3*t.targetDuration/2),this._playlistUpdateTimer=setInterval(this._onplaylistUpdateTimer.bind(this),i)}}},{key:"_mergeProgrameTime",value:function(t){var e=t.dateRanges,i=this._timeline,n=t&&t.targetDuration?t.targetDuration:0,r=0<t.dateTimeObjects.length?t.playlistDuration:0;v.mergeProgrameTime(i,e,n,r)}},{key:"_getRelStartLimit",value:function(){return v.absTimeToRelTime(this._timeline.curAbsStart,this._timeline.timeRanges,this._timeline.absStart)}},{key:"_getRelEndLimit",value:function(){var t=v.absTimeToRelTime(this._timeline.curAbsEnd,this._timeline.timeRanges,this._timeline.absStart)-2*this._timeline.targetDuration;return this._video.currentTime>t&&(t=this._video.currentTime),t}},{key:"_getBufferedEndLimit",value:function(){for(var t=-1,e=this._video.buffered.length-1;0<=e;e--)this._video.buffered.end(e)>t&&(t=this._video.buffered.end(e));return t}},{key:"_printTimeline",value:function(){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","Print timeline:"),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","\tabsStart="+this._timeline.absStart+" curAbsStart="+this._timeline.curAbsStart+" curAbsEnd="+this._timeline.curAbsEnd);for(var t=this._timeline.timeRanges.length-1;0<=t;t--)this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","\t\t begin="+this._timeline.timeRanges[t].begin+" end="+this._timeline.timeRanges[t].end)}},{key:"_onThumbnailCallback",value:function(t,e,i){if(0<t.length&&this._thumbnailsStreams.length<=0)this._thumbnailsStreams=t;else if(null!=e&&null!=e.manifest&&null!=i){var n=i.index;if(0<this._thumbnailsStreams.length&&null!=n){var r=this._thumbnailsStreams[n];r&&((this.isLive()||null==r.vttCueSegments)&&(this.isLive()&&r.vttCueSegments&&(r.vttCueSegments=null),e.manifest&&e.manifest.segments&&(r.vttCueSegments=e.manifest.segments)),i.time&&this._loadVtt(n,i.time))}}}},{key:"_loadVtt",value:function(t,e){var i=this._findVtt(Number(t),e);if(i){var n=this._hlsPlaylistParser.getAbsUrl(i.uri),r=new RegExp(".*Time=(\\d*)\\.vtt").exec(n),a=0;null!=r&&(a=Number(r[1])/this._thumbnailTimeScale),this._hlsPlaylistParser.loadVtts(n,{type:"vtts",index:Number(t),time:e,baseTime:a,requestTime:(new Date).getTime()})}}},{key:"_findVtt",value:function(t,r){var a=null,s=1/0;if(0<=t&&0<this._thumbnailsStreams.length&&t<this._thumbnailsStreams.length){var e=this._thumbnailsStreams[t],i=!1;e&&e.vttCueSegments&&(e.vttCueSegments.forEach(function(t){if(t.beginTime<=r&&t.endTime>=r)return i=!0,a=t}),!1===i&&e.vttCueSegments.forEach(function(t){var e=Math.pow(t.beginTime-r,2),i=Math.pow(t.endTime-r,2),n=Math.sqrt(e+i);n<s&&(s=n,a=t)}))}return a}},{key:"_onThumbnailImageCallback",value:function(t,e){if(this._thumbnailImagesCb&&t&&0<t.images.length)if(this.isCVodStream()){for(var i={images:[],baseTime:t.baseTime,requestTime:t.requestTime-this._timeline.absStart,streamId:t.streamId},n=0;n<t.images.length;n++)0<=t.images[n].endTime-this._timeline.absStart&&(0<=t.images[n].startTime-this._timeline.absStart?t.images[n].startTime-=this._timeline.absStart:t.images[n].startTime=0,t.images[n].endTime-=this._timeline.absStart,i.images.push(t.images[n]));this._thumbnailImagesCb(i)}else this._thumbnailImagesCb(t)}},{key:"_onAdsInfosCallback",value:function(t){this._mergeAdlist(t)}},{key:"_mergeAdlist",value:function(t){var e=t.firstTsBeginTime,i=t.adTracks,n=t.adEmptyTracks,r=t.isolateSlotEnd,a=t.isolateStitchEnd;this._setAdSegmentPremier(e),this._expireAdlist(e);do{if(a.isolate&&0<this._advertisements.length&&null===this._advertisements[this._advertisements.length-1].timeline.timeStitchEnd&&(this._advertisements[this._advertisements.length-1].timeline.timeStitchEnd=a.timeStitchEnd,this._advertisements[this._advertisements.length-1].lastInStitch=!0),0===i.length||null===i[0].id||null===i[0].getTrackBeginTime())break;if(0===this._advertisements.length){this._advertisements=this._advertisements.concat(i);break}var s=i[0],o=this._searchAdBegin(s);if(!1===o.find){if(this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","mergeAdlist(Search): not find"),s.getTrackBeginTime()<=this._advertisements[0].getTrackBeginTime())s.getTrackBeginTime()<this._advertisements[0].getTrackBeginTime()&&this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","mergeAdlist: merge error. m3u8 loop"),this._expireAdlist(-1);else if(0<this._advertisements.length){var l=this._advertisements[this._advertisements.length-1];l.getTrackEndTime()?l.getTrackEndTime()<s.getTrackBeginTime()?this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","mergeAdlist: large gap when m3u8 update"):(this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","mergeAdlist: assert(code error in no find branch)"),this._expireAdlist(-1)):(this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","mergeAdlist: meet a long time advertisement, time than dvrduration"),r.isolate?l.setTrackEndTime(r.timeSlotEnd):l.setTrackEndTime(s.getTrackBeginTime()))}this._advertisements=this._advertisements.concat(i)}else{var u=o.targetSeg,h=null,c=null;u.getTrackBeginTime()&&(h=new Date).setTime(1e3*u.getTrackBeginTime()),u.getTrackEndTime()&&(c=new Date).setTime(1e3*u.getTrackEndTime()),this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","mergeAdlist(Search): i="+o.index+", id="+u.id+", timeBegin="+u.getTrackBeginTime()+"("+(h?h.toString():h)+"), endTime="+u.getTrackEndTime()+"("+(c?c.toString():c)+")");for(var d=!1,f=o.index;f<this._advertisements.length;f++)if(0<i.length){if(i[0].id!==this._advertisements[f].id){this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","mergeAdlist: assert(id must same)");break}if(!1===d&&(i[0].getTrackBeginTime()>this._advertisements[f].getTrackBeginTime()&&i[0].setTrackBeginTime(this._advertisements[f].getTrackBeginTime()),d=!0),i[0].getTrackBeginTime()!==this._advertisements[f].getTrackBeginTime()){this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","mergeAdlist: assert(code error in find branch)");break}this._advertisements[f].merge(i[0]),i.shift()}0<i.length&&(this._advertisements=this._advertisements.concat(i))}this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","---- mergeAdlist(After merge): length="+this._advertisements.length+"----------"),this._printAdlist("_mergeAdlist: After merge. local Ad list=",this._advertisements,!1);break}while(0);this._updateAdRanges(),this._emptyAdvertisements=[],this._emptyAdvertisements=this._emptyAdvertisements.concat(n),this._noticeEmptySlice(),i=[]}},{key:"_noticeEmptySlice",value:function(){if(0<this._emptyAdvertisements.length){var i=[];this._emptyAdvertisements.forEach(function(t){var e=[];0<t.noticeSlices.slotImpression.length&&(e=e.concat(t.noticeSlices.slotImpression)),0<t.noticeSlices.slotEnd.length&&(e=e.concat(t.noticeSlices.slotEnd)),i.push({type:"hls",time:t.timeline.timeEnd,urls:e})}),this._eventHandler.dispatchEvent(new o.FakeEvent("emptyAdPost",i))}}},{key:"_updateAdRanges",value:function(){if(0<this._advertisements.length){var e=[];this._advertisements.forEach(function(t){t.id&&e.push({id:t.id,start:t.timeline.timeBegin,end:t.timeline.timeEnd})}),this._eventHandler._onAdRangesUpdate(e)}}},{key:"_setAdSegmentPremier",value:function(t){this._adBeginTime=t}},{key:"_expireAdlist",value:function(t){if(-1!==t){for(var e=0,i=this._advertisements.length-1;0<=i;i--)if(this._advertisements[i].getTrackEndTime()&&this._advertisements[i].getTrackEndTime()<this._adBeginTime){e=i;break}0<=(e-=3)&&this._advertisements.splice(0,e)}else this._advertisements=[]}},{key:"_searchAdBegin",value:function(t){for(var e={find:!1,targetSeg:null,index:-1},i=Number.MAX_VALUE,n=this._advertisements.length-1;0<=n;n--){var r=this._advertisements[n];t.id===r.id&&t.getTrackBeginTime()>=r.getTrackBeginTime()&&(null===r.getTrackEndTime()||r.getTrackEndTime()&&t.getTrackEndTime())&&t.getTrackBeginTime()-r.getTrackBeginTime()<i&&(i=t.getTrackBeginTime()-r.getTrackBeginTime(),e.find=!0,e.targetSeg=this._advertisements[n],e.index=n)}return e}},{key:"_printAdlist",value:function(t,e,i){if(!(i&&e.length<=0)){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer",t);for(var n=0;n<e.length;n++){var r=null,a=null;e[n].getTrackBeginTime()&&(r=new Date).setTime(1e3*e[n].getTrackBeginTime()),e[n].getTrackEndTime()&&(a=new Date).setTime(1e3*e[n].getTrackEndTime()),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer",t+"\tadId="+e[n].id+", timeBegin="+e[n].getTrackBeginTime()+"("+(r?r.toString():r)+"), endTime="+e[n].getTrackEndTime()+"("+(a?a.toString():a)+")")}}}},{key:"_findAdvertisement",value:function(t,e){var i=null;this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._findAdvertisement: adId="+t.id+", adType="+t.cueType+", adTime="+e),this._printAdlist("_findAdvertisement",this._advertisements,!0);for(var n=(this._timeToleranceMs/1e3).toFixed(2),r=this._advertisements.length-1;0<=r;r--){var a=this._advertisements[r];if("PreStart"===t.cueType);else if("PostStop"===t.cueType||"stop"===t.cueType){if(null==a.getTrackEndTime())continue;if(a.getTrackEndTime()-n<=e&&a.hasHitStarted()&&!a.hasHitCompleted()){i=a,null==t.id?this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","trace ad._findAdvertisement: stream stop miss. fake stop message"):this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._findAdvertisement: Receive stream stop.");break}}else if(this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","_findAdvertisement:, playerCurrentTime="+this.currentTime+", videoCurrentTime="+this._video.currentTime),a.hitAdTrack(t.id,e,n)){i=a,this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","_findAdvertisement: tarckId="+t.id),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","_findAdvertisement: min="+a.getTrackBeginTime()+" , max="+(null===a.getTrackEndTime()?null:a.getTrackEndTime()+n)+", cueStartTime="+e+", trackId="+a.id+", cueId="+t.id+", beginOffset="+(a.getTrackBeginTime()-e)+", endOffset="+(null===a.getTrackEndTime()?null:a.getTrackEndTime()-e)+", playerCurrentTime="+this.currentTime+", cueType="+t.cueType);break}}return this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._findAdvertisement: leave _findAdvertisement. tarckId="+(i?i.id:null)),i}},{key:"_cuechange",value:function(t){var e=t.currentTarget,i=null;if(e.activeCues.length&&(i=e.activeCues[0]),null!=i){var n=null,r=!1,a=null;if("Edge"===p.AdaptivePlayer.browserType){var s=new Uint8Array(i.data);(n=new l.ID3(s))._dict&&n._dict.key&&"GEOB"===n._dict.key&&this._isValidAdMetadata(n._dict)&&(this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","currentTime="+this._video.currentTime+"startTime="+i.startTime+" endTime="+i.endTime+"cueType="+n._dict.cueType+" id="+n._dict.id),r=!0,a=n._dict)}else n=i.value.data["ad-list"]?i.value.data["ad-list"][0]:i.value,this._isValidAdMetadata(n)&&(r=!0,a=n);var o=v.relTimeToAbsTime(i.startTime?i.startTime:0,this._timeline.timeRanges,this._timeline.absStart);o&&(i.startTime=o,i.endTime=o,i.startTime=i.endTime=o,this._cuepointManager.onNativeID3(i),r&&a&&this._addAdvertiseCues(o,a))}}},{key:"_addAdvertiseCues",value:function(t,e){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._addAdvertiseCues: geobId="+e.id+", cueType="+e.cueType+", duration="+e.duration+", timeLeft="+e.timeLeft+", cueStartTime="+t);var i=this._findAdvertisement(e,t);if(this.forceEndLastAd(e,t,i),i){var n=this._addCueForTrigger(i,t,e);for(this._printAdEvent(n);;){if("multitude"!==n.end)break;n=this._addCueForTrigger(i,t,e),this._printAdEvent(n)}this._lastAdvertise=i,"keep"===e.cueType&&this._createAdTimer()}}},{key:"forceEndLastAd",value:function(t,e,i){if(this._lastAdvertise&&(null==i||i&&this._lastAdvertise.id!==i.id||"stop"===t.cueType&&null==t.id)){var n=this._lastAdvertise.forceEndAdvertisement(e);1===n.stage&&(this.print(p.AdaptivePlayer.LogLevel.TRACE,"trace ad.BasicPlayer","forceEndLastAd: fake stop msg. id="+this._lastAdvertise.id),this._uploadAdStop(this._lastAdvertise.id),0<n.eventAd.length&&this._postAdvertisement(t,n),this._addAdStatistics(this._lastAdvertise.id,n),this._lastAdvertise=null)}}},{key:"_printAdEvent",value:function(t){if(t){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","clearAd="+t.clearAd+" stage="+t.stage+" end="+t.end+" defaultClickAd.length="+t.defaultClickAd.length+" trackClickAd.length="+t.trackClickAd.length+" clickAd.length="+t.clickAd.length+" eventAd.length="+t.eventAd.length);for(var e=t.eventAd.length-1;0<=e;e--)this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","type="+t.eventAd[e].type+" urls.length"+t.eventAd[e].urls.length)}}},{key:"_addCueForTrigger",value:function(t,e,i){var n=t.getNotices(t.id,e,i,(this._timeToleranceMs/1e3).toFixed(2));return-1!==n.stage&&(this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._cuechange: stage="+n.stage+", notice length="+n.eventAd.length),0===n.stage&&this._uploadAdStart(t.id,n),1===n.stage&&this._uploadAdStop(t.id),0<n.eventAd.length&&this._postAdvertisement(i,n),this._addAdStatistics(t.id,n)),n}},{key:"_addAdStatistics",value:function(e,i){-1!==i.stage&&e&&(null==this._adStatistics[e]&&(this._adStatistics[e]={id:e,startPostNum:0,firstQuartiledPostNum:0,midPostNum:0,thirdQuartiledPostNum:0,endPostNum:0,postedEndPostNum:0,startTriggerNum:0,firstQuartiledTriggerNum:0,midTriggerNum:0,thirdQuartiledTriggerNum:0,endTriggerNum:0,postedEndTriggerNum:0}),Object.keys(i.eventAd).forEach(function(t){this._addNumber(this._adStatistics[e],i.stage,i.eventAd[t].urls.length)}.bind(this)))}},{key:"_printAdStatistics",value:function(){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","_printAdStatistics: adLength="+Object.keys(this._adStatistics).length),Object.keys(this._adStatistics).forEach(function(t){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","adId=",this._adStatistics[t].id),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","Post startPostNum="+this._adStatistics[t].startPostNum+" firstQuartiled="+this._adStatistics[t].firstQuartiledPostNum+" midPostNum="+this._adStatistics[t].midPostNum+" thirdQuartiledPostNum="+this._adStatistics[t].thirdQuartiledPostNum+" endPostNum="+this._adStatistics[t].endPostNum+" postedEndPostNum="+this._adStatistics[t].postedEndPostNum),this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","Trigger startPostNum="+this._adStatistics[t].startTriggerNum+" firstQuartiled="+this._adStatistics[t].firstQuartiledTriggerNum+" midTriggerNum="+this._adStatistics[t].midTriggerNum+" thirdQuartiledTriggerNum="+this._adStatistics[t].thirdQuartiledTriggerNum+" endTriggerNum="+this._adStatistics[t].endTriggerNum+" postedEndTriggerNum="+this._adStatistics[t].postedEndTriggerNum)}.bind(this))}},{key:"_addNumber",value:function(t,e,i){0===e&&(t.startPostNum+=i,t.startTriggerNum+=1),.25===e&&(t.firstQuartiledPostNum+=i,t.firstQuartiledTriggerNum+=1),.5===e&&(t.midPostNum+=i,t.midTriggerNum+=1),.75===e&&(t.thirdQuartiledPostNum+=i,t.thirdQuartiledTriggerNum+=1),1===e&&(t.endPostNum+=i,t.endTriggerNum+=1)}},{key:"_uploadAdStart",value:function(t,e){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._uploadAdStart: adId="+t);var i={adid:t,urls:[]};e.defaultClickAd.forEach(function(t){i.urls.push({type:"defaultClick",url:t})}),e.trackClickAd.forEach(function(t){i.urls.push({type:"trackClick",url:t})}),e.clickAd.forEach(function(t){i.urls.push({type:"click",url:t})});var n={type:"ADSTART",data:i};this._eventHandler._onAdvertisement(n)}},{key:"_uploadAdStop",value:function(t){this.print(p.AdaptivePlayer.LogLevel.DEBUG,"BasicPlayer","trace ad._uploadAdStop: adId="+t);var e={type:"ADEND",data:{adid:t}};this._eventHandler._onAdvertisement(e),this._clearAdTimer()}},{key:"_createAdTimer",value:function(){this._clearAdTimer(),this._adTimer=window.setTimeout(this._uploadAdStopCb.bind(this),1500)}},{key:"_uploadAdStopCb",value:function(){this._lastAdvertise&&(this.print(p.AdaptivePlayer.LogLevel.WARNING,"BasicPlayer","trace ad.ad timeout fake stop: adId="+this._lastAdvertise.id),this._uploadAdStop(this._lastAdvertise.id))}},{key:"_clearAdTimer",value:function(){this._adTimer&&(window.clearTimeout(this._adTimer),this._adTimer=null)}},{key:"_postAdvertisement",value:function(t,i){for(var n=this,r={type:"ADPOST",data:{adid:t.id,urls:[]}},e=function(e){i.eventAd[e].urls.forEach(function(t){r.data.urls.push({type:i.eventAd[e].type,url:t})}),n._eventHandler._onAdvertisement(r)},a=0;a<i.eventAd.length;a++)e(a)}},{key:"_isValidAdMetadata",value:function(t){var e=!1;return t.cueType&&(t.id&&("start"!==t.cueType&&"stop"!==t.cueType&&"keep"!==t.cueType||void 0!==t.duration&&void 0!==t.timeLeft&&(e=!0)),"PreStart"!==t.cueType&&"PostStop"!==t.cueType&&"stop"!==t.cueType||(e=!0)),e}},{key:"currentTime",get:function(){var t=this._video.currentTime,e=v.relTimeToAbsTime(t,this._timeline.timeRanges,this._timeline.absStart);this.isLive()?this._timeline&&this._timeline.curAbsStart&&this._timeline.curAbsEnd&&t===e&&v.absTimeToRelTime(this._timeline.curAbsEnd,this._timeline.timeRanges,this._timeline.absStart)<t&&(e=this._timeline.curAbsEnd):"cvod"===this.vodType&&(e=this._video.currentTime);return e},set:function(t){var e=v.absTimeToRelTime(t,this._timeline.timeRanges,this._timeline.absStart);-1!==e&&"cvod"!==this.vodType||(e=t),this._video.currentTime=e;var i=0,n=function(){this._seekEnded=!1,this._video?1<=i++?this._seekEnded=!0:2<Math.abs(this._video.currentTime-e)?(this._video.currentTime=e,this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","retry times="+i+" currentTime="+this._video.currentTime+" relTime="+e),setTimeout(n,100)):this._seekEnded=!0:this._seekEnded=!0}.bind(this);this._seekEnded=!1,setTimeout(n,100),this._video&&this.print(p.AdaptivePlayer.LogLevel.TRACE,"BasicPlayer","get time in set="+this._video.currentTime)}}]),n}();(e.default=b).version="v2.0.0"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),h=l(i(74)),r=l(i(57)),a=i(370),s=i(28),o=i(371);function l(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._playHeadTimeCb=null,this._errorCb=null,this._thumbnailCb=null,this._thumbnailImageCb=null,this._adCb=null,this._masterUrl=null,this._baseUrl=null,this._levelUrl=null,this._levelRedundantUrls=[],this._levelIndex=-1,this._ccInfos=null}return n(t,[{key:"destroy",value:function(){this._playHeadTimeCb=null,this._errorCb=null,this._thumbnailCb=null,this._thumbnailImageCb=null,this._adCb=null,this._masterUrl=null,this._baseUrl=null,this._levelUrl=null,this._levelRedundantUrls=[],this._levelIndex=-1,this._ccInfos=null}},{key:"loadPlaylist",value:function(t,e){return null==this._masterUrl&&(this._masterUrl=t,this._baseUrl=h.getPath(t)),r.createXHREx({url:t},e).then(function(e){var t=new a.Parser;if(t.push(e.response),t.end(),e.userdata&&"master"===e.userdata.type&&t.isMasterPlaylist())try{this._parseMasterPlaylist(t)}catch(t){this._onError(s.NLError.Basic.M3U8.MANIFEST_PARSING_ERROR,t)}if(e.userdata&&("level"===e.userdata.type||"master"===e.userdata.type)&&t.isLevelPlaylist()){"master"===e.userdata.type&&(this._levelUrl=this._masterUrl);try{this._parseLevelPlaylist(t,e.userdata.index)}catch(t){"level"===e.userdata.type&&0<=this._levelIndex&&this._levelIndex<this._levelRedundantUrls.length?(this._levelIndex+=1,this._levelUrl=this._levelRedundantUrls[this._levelIndex]):this._onError(s.NLError.Basic.M3U8.GET_PLAYHEADTIME_FAILED,t)}}if(e.userdata&&"thumbnail"===e.userdata.type&&t.isLevelPlaylist())try{this._parseThumbnailPlaylist(t,e.userdata)}catch(t){this._onError(s.NLError.Basic.M3U8.GET_THUMBNAIL_FAILED,t)}}.bind(this)).catch(function(t){this._onError(s.NLError.Basic.M3U8.MANIFEST_LOAD_ERROR,t.response)}.bind(this))}},{key:"loadVtts",value:function(t,i){return r.createXHREx({url:t},i).then(function(t){if(i&&t.userdata&&"vtts"===t.userdata.type){var e=(new o.WebVTTParser).parse(t.response,"metadata");try{this._parseVttPlaylist(e,t.userdata)}catch(t){this._onError(s.NLError.Basic.M3U8.PARSE_VTT_FAILED,t)}}}.bind(this)).catch(function(t){this._onError(s.NLError.Basic.M3U8.GET_VTT_FAILED,t.response)}.bind(this))}},{key:"setPlayHeadCB",value:function(t){this._playHeadTimeCb=t}},{key:"setErrorCb",value:function(t){this._errorCb=t}},{key:"setThumbnailCb",value:function(t){this._thumbnailCb=t}},{key:"setThumbnailImageCb",value:function(t){this._thumbnailImageCb=t}},{key:"setAdStitchCb",value:function(t){this._adCb=t}},{key:"getAbsUrl",value:function(t){var e=t;return!h.isAbsoluteUrl(t)&&this._baseUrl&&(e=this._baseUrl+t),e}},{key:"getLevelUrl",value:function(){return this._levelUrl}},{key:"getHlsCC",value:function(){return this._ccInfos}},{key:"_onError",value:function(t,e){this._errorCb&&this._errorCb({error:t,code:e})}},{key:"_parseMasterPlaylist",value:function(t){if(t.manifest&&t.manifest.mediaGroups&&t.manifest.mediaGroups["CLOSED-CAPTIONS"]&&t.manifest.mediaGroups["CLOSED-CAPTIONS"].ccs){var e=t.manifest.mediaGroups["CLOSED-CAPTIONS"].ccs;if(e&&0<Object.keys(e).length)for(var i in this._ccInfos={},e)this._ccInfos["cc"+1..toString()]={name:i,lang:e[i].language}}for(var n=0;n<t.manifest.playlists.length;n++){var r=t.manifest.playlists[n].uri;h.isAbsoluteUrl(r)||(r=this._baseUrl+r),null==this._levelUrl&&(this._levelUrl=r,this._levelIndex=n),this._levelRedundantUrls.push(r)}this.loadPlaylist(this._levelUrl,{type:"level",index:0});var a=t.getThumbnailsStreams();if(0<a.length&&this._thumbnailCb){for(var s=[],o=0;o<a.length;o++){var l=a[0].uri;h.isAbsoluteUrl(l)||(l=this._baseUrl+l);var u={id:o,width:a[0].width,height:a[0].height,uri:l};s.push(u)}this._thumbnailCb(s)}}},{key:"_parseLevelPlaylist",value:function(t,e){this._playHeadTimeCb&&this._playHeadTimeCb(t.manifest,e),this._adCb&&this._adCb(t.adsInfos)}},{key:"_parseThumbnailPlaylist",value:function(t,e){this._thumbnailCb&&this._thumbnailCb([],t,e)}},{key:"_parseVttPlaylist",value:function(t,e){var i=e.index,n=e.time,r=e.baseTime,a=e.requestTime,s={images:[],baseTime:r,requestTime:n,streamId:i};if(this._thumbnailImageCb&&t.cues&&0<t.cues.length){for(var o=0;o<t.cues.length;o++){var l=t.cues[o].text.split("#xywh=");if(null!=l&&2===l.length){var u=l[1].split(",");if(null==u||4!==u.length)continue;var h={url:this.getAbsUrl(l[0]),startTime:r+t.cues[o].startTime,endTime:r+t.cues[o].endTime,topX:u[0],topY:u[1],width:u[2],height:u[3]};s.images.push(h)}}this._thumbnailImageCb(s,a)}}}]),t}();e.default=u},function(t,e,i){t.exports=function r(a,s,o){function l(e,t){if(!s[e]){if(!a[e]){if(u)return u(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=s[e]={exports:{}};a[e][0].call(n.exports,function(t){return l(a[e][1][t]||t)},n,n.exports,r,a,s,o)}return s[e].exports}for(var u=!1,t=0;t<o.length;t++)l(o[t]);return l}({1:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=new RegExp([/Impression\s*=\s*(.+)/.source,/|creativeView\s*=\s*(.+)/.source,/|slotImpression\s*=\s*(.+)/.source,/|defaultImpression\s*=\s*(.+)/.source,/|defaultClick\s*=\s*(.+)/.source,/|trackClick\s*=\s*(.+)/.source,/|slotEnd\s*=\s*(.+)/.source,/|start\s*=\s*(.+)/.source,/|firstQuartile\s*=\s*(.+)/.source,/|midPoint\s*=\s*(.+)/.source,/|thirdQuartile\s*=\s*(.+)/.source,/|complete\s*=\s*(.+)/.source,/|click\s*=\s*(.+)/.source,/|(.+)\s*=\s*(.+)/.source].join(""),"gi"),l=new RegExp([/\s*(start|keep|stop)\s*/.source,/|\s*(PreStart|PostStop)\s*/.source].join(""),"g"),s=function(){function t(){n(this,t),this.clear()}return r(t,[{key:"validate",value:function(){return null!==this.timeBegin}},{key:"clear",value:function(){this.timeBegin=null,this.timeEnd=null,this.timeSlotEnd=null,this.timeStitchEnd=null}}]),t}(),o=function(){function t(){n(this,t),this.clear()}return r(t,[{key:"clear",value:function(){this.defaultImpression=[],this.impression=[],this.creativeView=[],this.start=[],this.firstQuartile=[],this.midPoint=[],this.thirdQuartile=[],this.complete=[],this.slotImpression=[],this.slotEnd=[],this.defaultClick=[],this.tracktClick=[],this.click=[]}}]),t}(),u={UPDATE_NONE:0,UPDATE_TRACK:1,UPDATE_SLOT_END:2,UPDATE_STITCH_END:4},h=function(){function t(){n(this,t),this.id=null,this.timeline=new s,this.noticeSlices=new o,this.firstInStitch=!1,this.firstInSlot=!1,this.lastInStitch=!1,this.lastInSlot=!1,this.update=u.UPDATE_TRACK,this.startHitTimeMs=null,this.firstQuarterHitTimeMs=null,this.midPointHitTimeMs=null,this.thirdQuarterHitTime=null,this.completHitTimeMs=null}return r(t,[{key:"clear",value:function(){this.id=null,this.timeline.clear(),this.noticeSlices.clear(),this.firstInStitch=!1,this.firstInSlot=!1,this.lastInStitch=!1,this.lastInSlot=!1,this.update=u.UPDATE_TRACK,this.startHitTimeMs=null,this.firstQuarterHitTimeMs=null,this.midPointHitTimeMs=null,this.thirdQuarterHitTime=null,this.completHitTimeMs=null}},{key:"validate",value:function(){return null!==this.id&&this.timeline.validate()}},{key:"merge",value:function(t){var e=u.UPDATE_NONE;return this.id===t.id&&(this.timeline.timeBegin=t.timeline.timeBegin,this.timeline.timeEnd=t.timeline.timeEnd,this.timeline.timeSlotEnd=t.timeline.timeSlotEnd,this.timeline.timeStitchEnd=t.timeline.timeStitchEnd,this.lastInStitch!==t.lastInStitch&&(this.lastInStitch=t.lastInStitch,this.update+=u.UPDATE_STITCH_END),this.lastInSlot!==t.lastInSlot&&(this.lastInSlot=t.lastInSlot,this.update+=u.UPDATE_SLOT_END),e===u.UPDATE_NONE)}},{key:"hasUpdateBit",value:function(t){return(this.update&~t)===t}},{key:"recoverUpdateBit",value:function(t){this.update=~(~this.update|t)}},{key:"getNotices",value:function(t,e,i,n){var r={clearAd:!1,eventAd:[],defaultClickAd:[],trackClickAd:[],clickAd:[],stage:-1,end:"unknown"};if(this.timeline.timeBegin&&this.id===t&&e>=this.timeline.timeBegin-n){l.lastIndex=0;var a=i.cueType.toLowerCase(),s=l.exec(a);if(null!==s)if(s[1]){if(this.timeline.timeEnd&&e<=this.timeline.timeEnd+n||null===this.timeline.timeEnd)if("start"===a)this.getStartNotices(r);else if("keep"===a){var o=(i.duration-i.timeLeft)/i.duration;(o=100*o.toFixed(2))<=15&&null===this.startHitTimeMs?(this.getStartNotices(r),this.startHitTimeMs=Date.now(),r.end="multitude"):this.getKeepNotices(o,r)}else"stop"===a&&(0==i.duration?(r.clearAd=!0,r.stage=1,r.end="single"):this.getStopNotices(r))}else s[2]&&("prestart"===a||"poststop"===a&&(r.clearAd=!0,r.stage=1,r.end="single"))}return r}},{key:"getStartNotices",value:function(t){var e=Date.now();if(null===this.startHitTimeMs){t.clearAd=!0;var i=[];0<this.noticeSlices.defaultImpression.length&&(i=i.concat(this.noticeSlices.defaultImpression)),0<this.noticeSlices.impression.length&&(i=i.concat(this.noticeSlices.impression)),0<this.noticeSlices.creativeView.length&&(i=i.concat(this.noticeSlices.creativeView)),0<this.noticeSlices.start.length&&(i=i.concat(this.noticeSlices.start)),0<this.noticeSlices.slotImpression.length&&!0===this.firstInSlot&&(i=i.concat(this.noticeSlices.slotImpression)),0<i.length&&t.eventAd.push({type:"0",urls:i}),0<this.noticeSlices.defaultClick.length&&(t.defaultClickAd=this.noticeSlices.defaultClick),0<this.noticeSlices.tracktClick.length&&(t.trackClickAd=this.noticeSlices.tracktClick),0<this.noticeSlices.click.length&&(t.clickAd=this.noticeSlices.click),this.startHitTimeMs=e,t.stage=0,t.end="single"}}},{key:"getStopNotices",value:function(t){var e=Date.now();if(this.startHitTimeMs){if(null===this.completHitTimeMs){var i=[];0<this.noticeSlices.complete.length&&(i=i.concat(this.noticeSlices.complete)),0<this.noticeSlices.slotEnd.length&&!0===this.lastInSlot&&(i=i.concat(this.noticeSlices.slotEnd)),this.completHitTimeMs=e,t.stage=1,0<i.length&&t.eventAd.push({type:"1",urls:i})}t.clearAd=!0,t.end="single"}}},{key:"getKeepNotices",value:function(t,e){var i=Date.now();do{if(this.startHitTimeMs){if(25<=t&&null===this.firstQuarterHitTimeMs&&0<this.noticeSlices.firstQuartile.length&&(this.firstQuarterHitTimeMs=i,e.stage=.25,e.eventAd.push({type:"1/4",urls:this.noticeSlices.firstQuartile}),e.end="single"),50<=t&&null===this.midPointHitTimeMs&&0<this.noticeSlices.midPoint.length){if("single"===e.end){e.end="multitude";break}this.midPointHitTimeMs=i,e.stage=.5,e.eventAd.push({type:"1/2",urls:this.noticeSlices.midPoint})}if(75<=t&&null===this.thirdQuarterHitTime&&0<this.noticeSlices.thirdQuartile.length){if("single"===e.end){e.end="multitude";break}this.thirdQuarterHitTime=i,e.stage=.75,e.eventAd.push({type:"3/4",urls:this.noticeSlices.thirdQuartile}),e.end="single"}}break}while(0)}},{key:"forceEndAdvertisement",value:function(t){var e={clearAd:!1,eventAd:[],defaultClickAd:[],trackClickAd:[],clickAd:[],stage:-1,end:"unknown"},i=Date.now(),n=this.timeline;return n.timeBegin&&n.timeEnd&&this.startHitTimeMs&&t>=n.timeEnd&&(this.getStopNotices(e),null===this.firstQuarterHitTimeMs&&(this.firstQuarterHitTimeMs=i),null===this.midPointHitTimeMs&&(this.midPointHitTimeMs=i),null===this.thirdQuarterHitTime&&(this.thirdQuarterHitTime=i),null===this.completHitTimeMs&&(this.completHitTimeMs=i)),e}},{key:"hasHitStarted",value:function(){var t=!1,e=this.timeline;return e.timeBegin&&e.timeEnd&&(t=null!=this.startHitTimeMs),t}},{key:"hasHitCompleted",value:function(){var t=!1,e=this.timeline;return e.timeBegin&&e.timeEnd&&(t=null!=this.completHitTimeMs),t}},{key:"parseNoticeValue",value:function(t,e){if(null!==this.id||!1!==e){var i=t.trim();a.lastIndex=0;var n=a.exec(i);null!==n&&(n[1]?this.noticeSlices.impression.push(n[1].trim()):n[2]?this.noticeSlices.creativeView.push(n[2].trim()):n[3]?this.noticeSlices.slotImpression.push(n[3].trim()):n[4]?this.noticeSlices.defaultImpression.push(n[4].trim()):n[5]?this.noticeSlices.defaultClick.push(n[5].trim()):n[6]?this.noticeSlices.tracktClick.push(n[6].trim()):n[7]?this.noticeSlices.slotEnd.push(n[7].trim()):n[8]?this.noticeSlices.start.push(n[8].trim()):n[9]?this.noticeSlices.firstQuartile.push(n[9].trim()):n[10]?this.noticeSlices.midPoint.push(n[10].trim()):n[11]?this.noticeSlices.thirdQuartile.push(n[11].trim()):n[12]?this.noticeSlices.complete.push(n[12].trim()):n[13]&&this.noticeSlices.click.push(n[13].trim()))}}},{key:"getTrackBeginTime",value:function(){return this.timeline.timeBegin}},{key:"setTrackBeginTime",value:function(t){this.timeline.timeBegin=t}},{key:"getTrackEndTime",value:function(){return this.timeline.timeEnd}},{key:"setTrackEndTime",value:function(t){this.timeline.timeEnd=t}},{key:"getSlotEndTime",value:function(){return this.timeline.timeSlotEnd}},{key:"setSlotEndTime",value:function(t){this.timeline.timeSlotEnd=t}},{key:"getStitchEndTime",value:function(){return this.timeline.timeStitchEnd}},{key:"setStitchEndTime",value:function(t){this.timeline.timeStitchEnd=t}},{key:"hitAdTrack",value:function(t,e,i){var n=!1;if(t===this.id){var r=this.timeline;r.timeEnd?r.timeEnd+i>=e&&r.timeBegin-i<=e&&(n=!0):r.timeBegin&&r.timeBegin-i<=e&&(n=!0)}return n}}],[{key:"isAdType",value:function(t){return l.lastIndex=0,null!==l.exec(t)}}]),t}();i.AdTimeline=s,i.AdNoticeSlices=o,i.AdTrackUpdate=u,i.AdTrack=h},{}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=t("./stream"),s=(n=a)&&n.__esModule?n:{default:n},o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.buffer="",t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"push",value:function(t){var e=void 0;for(this.buffer+=t,e=this.buffer.indexOf("\n");-1<e;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)}}]),e}(s.default);i.default=o},{"./stream":5}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,h=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=t("./stream"),s=(n=a)&&n.__esModule?n:{default:n},c=function(t){for(var e=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},n=e.length,r=void 0;n--;)""!==e[n]&&((r=/([^=]*)=(.*)/.exec(e[n]).slice(1))[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),i[r[0]]=r[1]);return i},o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"push",value:function(t){var e=void 0,i=void 0;if(0!==(t=t.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"")).length){if("#"!==t[0])return void this.trigger("data",{type:"uri",uri:t});if(0!==t.indexOf("#EXT"))return void this.trigger("data",{type:"comment",text:t.slice(1)});if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))return void this.trigger("data",{type:"tag",tagType:"m3u"});if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return i={type:"tag",tagType:"inf"},e[1]&&(i.duration=parseFloat(e[1])),e[2]&&(i.title=e[2]),void this.trigger("data",i);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"targetduration"},e[1]&&(i.duration=parseInt(e[1],10)),void this.trigger("data",i);if(e=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"totalduration"},e[1]&&(i.duration=parseInt(e[1],10)),void this.trigger("data",i);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"version"},e[1]&&(i.version=parseInt(e[1],10)),void this.trigger("data",i);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"media-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void this.trigger("data",i);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void this.trigger("data",i);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return i={type:"tag",tagType:"playlist-type"},e[1]&&(i.playlistType=e[1]),void this.trigger("data",i);if(e=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"byterange"},e[1]&&(i.length=parseInt(e[1],10)),e[2]&&(i.offset=parseInt(e[2],10)),void this.trigger("data",i);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return i={type:"tag",tagType:"allow-cache"},e[1]&&(i.allowed=!/NO/.test(e[1])),void this.trigger("data",i);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"map"},e[1]){var n=c(e[1]);if(n.URI&&(i.uri=n.URI),n.BYTERANGE){var r=n.BYTERANGE.split("@"),a=h(r,2),s=a[0],o=a[1];i.byterange={},s&&(i.byterange.length=parseInt(s,10)),o&&(i.byterange.offset=parseInt(o,10))}}return void this.trigger("data",i)}if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"stream-inf"},e[1]){if(i.attributes=c(e[1]),i.attributes.RESOLUTION){var l=i.attributes.RESOLUTION.split("x"),u={};l[0]&&(u.width=parseInt(l[0],10)),l[1]&&(u.height=parseInt(l[1],10)),i.attributes.RESOLUTION=u}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}return void this.trigger("data",i)}if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return i={type:"tag",tagType:"media"},e[1]&&(i.attributes=c(e[1])),void this.trigger("data",i);if(e=/^#EXT-X-ENDLIST/.exec(t))return void this.trigger("data",{type:"tag",tagType:"endlist"});if(e=/^#EXT-X-DISCONTINUITY/.exec(t))return void this.trigger("data",{type:"tag",tagType:"discontinuity"});if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return i={type:"tag",tagType:"program-date-time"},e[1]&&(i.dateTimeString=e[1],i.dateTimeObject=new Date(e[1])),void this.trigger("data",i);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return i={type:"tag",tagType:"key"},e[1]&&(i.attributes=c(e[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void this.trigger("data",i);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return i={type:"tag",tagType:"start"},e[1]&&(i.attributes=c(e[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void this.trigger("data",i);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-out-cont"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-out"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-in"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-CST-AD-ID:?(.+)?$/.exec(t))return i={type:"tag",tagType:"ad-id"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-CST-TRACK:(.+)$/.exec(t))return i={type:"tag",tagType:"ad-track"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-CST-TRACK2:(.+)$/.exec(t))return i={type:"tag",tagType:"ad-track2"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-(CST-AD-SLOT-START)?$/.exec(t))return i={type:"tag",tagType:"ad-slot-start"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-(CST-AD-SLOT-END)?$/.exec(t))return i={type:"tag",tagType:"ad-slot-end"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-(CST-AD-STITCH-START)?$/.exec(t))return i={type:"tag",tagType:"ad-stitch-start"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);if(e=/^#EXT-X-(CST-AD-STITCH-END)?$/.exec(t))return i={type:"tag",tagType:"ad-stitch-end"},e[1]?i.data=e[1]:i.data="",void this.trigger("data",i);this.trigger("data",{type:"tag",data:t.slice(4)})}}}]),e}(s.default);i.default=o},{"./stream":5}],4:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=t("./stream"),s=n(a),o=t("./line-stream"),p=n(o),l=t("./parse-stream"),g=n(l),m=t("./advertisement"),u=function(t){function i(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));t.lineStream=new p.default,t.parseStream=new g.default,t.lineStream.pipe(t.parseStream);var e=t,s=[],o={},l=void 0,u=void 0,h={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{},"X-THUMBNAILS":{}},c=0;t.manifest={allowCache:!0,discontinuityStarts:[],segments:[],playlists:[],endList:!1,dateTimeStrings:[],dateTimeObjects:[],dateRanges:[],playlistDuration:0},t.adsInfos={adTracks:[],adEmptyTracks:[],isolateStitchEnd:{timeStitchEnd:null,isolate:!1},isolateSlotEnd:{timeSlotEnd:null,isolate:!1},firstTsBeginTime:null,lastTsEndTime:null,newDateTimeObject:!1,newSlotEnd:!1,newStitchEnd:!1};var d=null;return t.parseStream.on("data",function(n){var r=void 0,a=void 0;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=n.allowed,"allowed"in n||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in n&&((o.byterange=t).length=n.length,"offset"in n||(this.trigger("info",{message:"defaulting offset to zero"}),n.offset=0)),"offset"in n&&((o.byterange=t).offset=n.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),0<n.duration&&(o.duration=n.duration),0===n.duration&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),0<this.manifest.dateRanges.length&&(this.manifest.dateRanges[this.manifest.dateRanges.length-1].end+=o.duration),this.manifest.segments=s},key:function(){return n.attributes?"NONE"===n.attributes.METHOD?void(u=null):n.attributes.URI?(n.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),u={method:n.attributes.METHOD||"AES-128",uri:n.attributes.URI},void(void 0!==n.attributes.IV&&(u.iv=n.attributes.IV))):void this.trigger("warn",{message:"ignoring key declaration without URI"}):void this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(n.number)?this.manifest.mediaSequence=n.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+n.number})},"discontinuity-sequence":function(){isFinite(n.number)?(this.manifest.discontinuitySequence=n.number,c=n.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+n.number})},"playlist-type":function(){/VOD|EVENT/.test(n.playlistType)?this.manifest.playlistType=n.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+n.playlist})},map:function(){l={},n.uri&&(l.uri=n.uri),n.byterange&&(l.byterange=n.byterange)},"stream-inf":function(){this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||h,n.attributes?(o.attributes||(o.attributes={}),f(o.attributes,n.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||h,n.attributes&&n.attributes.TYPE&&n.attributes["GROUP-ID"]&&n.attributes.NAME){var t=this.manifest.mediaGroups[n.attributes.TYPE];if(t[n.attributes["GROUP-ID"]]=t[n.attributes["GROUP-ID"]]||{},r=t[n.attributes["GROUP-ID"]],(a={default:/yes/i.test(n.attributes.DEFAULT)}).default?a.autoselect=!0:a.autoselect=/yes/i.test(n.attributes.AUTOSELECT),n.attributes.LANGUAGE&&(a.language=n.attributes.LANGUAGE),n.attributes.URI&&(a.uri=n.attributes.URI),n.attributes["INSTREAM-ID"]&&(a.instreamId=n.attributes["INSTREAM-ID"]),n.attributes.CHARACTERISTICS&&(a.characteristics=n.attributes.CHARACTERISTICS),n.attributes.FORCED&&(a.forced=/yes/i.test(n.attributes.FORCED)),n.attributes.RESOLUTION){var e=n.attributes.RESOLUTION,i=e.split("x");i[0]&&(a.width=parseInt(i[0],10)),i[1]&&(a.height=parseInt(i[1],10))}r[n.attributes.NAME]=a}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){c+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time":function(){var t=n.dateTimeObject.getTime(),e=!1;if(0<this.manifest.dateRanges.length&&(t-this.manifest.dateRanges[this.manifest.dateRanges.length-1]).toFixed(2)<=.5&&(e=!0),!1===e){this.manifest.dateTimeStrings.push(n.dateTimeString),this.manifest.dateTimeObjects.push(n.dateTimeObject);var i={begin:n.dateTimeObject.getTime()/1e3,end:n.dateTimeObject.getTime()/1e3};this.manifest.dateRanges.push(i),this.adsInfos.newDateTimeObject=!0}},targetduration:function(){!isFinite(n.duration)||n.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+n.duration}):this.manifest.targetDuration=n.duration},totalduration:function(){!isFinite(n.duration)||n.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+n.duration}):this.manifest.totalDuration=n.duration},"cue-out":function(){o.cueOut=n.data},"cue-out-cont":function(){o.cueOutCont=n.data},"cue-in":function(){o.cueIn=n.data},"ad-id":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1];var e=n.data.trim();if(e){if(d.id){d.id===e&&this.trigger("info",{message:"there are continuous same id track"}),d.timeline.timeEnd=this.adsInfos.lastTsEndTime;var i=new m.AdTrack;this.adsInfos.adTracks.push(i),d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]}d.id=e}},"ad-track":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).parseNoticeValue(n.data,!1)},"ad-track2":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}if(null!==(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).id&&!0===d.lastInSlot){var e=new m.AdTrack;this.adsInfos.adTracks.push(e),(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).parseNoticeValue(n.data,!0)}else null===d.id?(d.parseNoticeValue(n.data,!0),this.trigger("info",{message:"slot appear after track2"})):this.trigger("warning",{message:"track2 appear with invalid"})},"ad-slot-start":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}if(null!==(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).id&&!0===d.lastInSlot){var e=new m.AdTrack;this.adsInfos.adTracks.push(e),(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).firstInSlot=!0}else null===d.id?d.firstInSlot=!0:this.trigger("warning",{message:"slot appear with invalid"})},"ad-slot-end":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).id?(d.lastInSlot=!0,this.adsInfos.newSlotEnd=!0):!1===this.adsInfos.isolateSlotEnd.isolate?this.adsInfos.isolateSlotEnd.isolate=!0:this.trigger("warning",{message:"code error(judge isolateSlotEnd)"})},"ad-stitch-start":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}if((d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).id&&!0===d.lastInStitch){var e=new m.AdTrack;this.adsInfos.adTracks.push(e)}(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).firstInStitch=!0},"ad-stitch-end":function(){if(0===this.adsInfos.adTracks.length){var t=new m.AdTrack;this.adsInfos.adTracks.push(t)}(d=this.adsInfos.adTracks[this.adsInfos.adTracks.length-1]).id?(this.adsInfos.newStitchEnd=!0,d.lastInStitch=!0,d.timeline.timeStitchEnd=this.adsInfos.lastTsEndTime?this.adsInfos.lastTsEndTime:this.adsInfos.firstTsBeginTime,null==d.timeline.timeSlotEnd&&(d.timeline.timeSlotEnd=d.timeline.timeStitchEnd),null==d.timeline.timeEnd&&(d.timeline.timeEnd=d.timeline.timeStitchEnd)):((0<d.noticeSlices.slotImpression.length||0<d.noticeSlices.slotEnd.length)&&!0===d.firstInStitch?(d.timeline.timeStitchEnd=this.adsInfos.lastTsEndTime?this.adsInfos.lastTsEndTime:this.adsInfos.firstTsBeginTime,d.timeline.timeBegin=o&&o.endTime?o.endTime:0,d.timeline.timeEnd=o&&o.endTime?o.endTime:0,this.adsInfos.adEmptyTracks.push(d),this.adsInfos.adTracks.pop()):d.clear(),!1===d.firstInStitch&&!1===this.adsInfos.isolateStitchEnd.isolate&&(this.adsInfos.isolateStitchEnd.isolate=!0,this.adsInfos.isolateStitchEnd.timeStitchEnd=this.adsInfos.lastTsEndTime?this.adsInfos.lastTsEndTime:this.adsInfos.firstTsBeginTime))}}[n.tagType]||function(){}).call(e)},uri:function(){if(o.uri=n.uri,!this.manifest.targetDuration||"duration"in o||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),this.manifest.playlistDuration+=o.duration,this.adsInfos.newDateTimeObject){var t=this.manifest.dateRanges[this.manifest.dateRanges.length-1];o.beginTime=t.begin,o.endTime=o.beginTime+o.duration,this.adsInfos.newDateTimeObject=!1}else{if(0<this.manifest.segments.length){var e=this.manifest.segments[this.manifest.segments.length-1];o.beginTime=e.endTime}else o.beginTime=0;o.endTime=o.beginTime+o.duration}if(null===this.adsInfos.firstTsBeginTime&&(this.adsInfos.firstTsBeginTime=o.beginTime),d&&d.id&&null===d.timeline.timeBegin)if(0===this.manifest.segments.length)d.timeline.timeBegin=this.adsInfos.firstTsBeginTime;else{var i=this.manifest.segments[this.manifest.segments.length-1];d.timeline.timeBegin=i.endTime}this.adsInfos.newSlotEnd&&(d.timeline.lastInSlot=!0,d.timeline.timeSlotEnd=o.endTime,null===d.timeline.timeEnd&&(d.timeline.timeEnd=o.endTime),this.adsInfos.newSlotEnd=!1),this.adsInfos.newStitchEnd&&(d.timeline.lastInStitch=!0,d.timeline.timeStitchEnd=o.beginTime,null===d.timeline.timeSlotEnd&&(d.timeline.lastInSlot=!0,d.timeline.timeSlotEnd=d.timeline.timeStitchEnd,null===d.timeline.timeEnd&&(d.timeline.timeEnd=d.timeline.timeStitchEnd)),this.adsInfos.newStitchEnd=!1),this.adsInfos.isolateSlotEnd.isolate&&(this.adsInfos.isolateSlotEnd.timeSlotEnd=o.endTime),this.adsInfos.isolateStitchEnd.isolate&&(this.adsInfos.isolateStitchEnd.timeStitchEnd=o.beginTime),this.adsInfos.lastTsEndTime=o.endTime,u&&(o.key=u),o.timeline=c,l&&(o.map=l),s.push(o),o={}},comment:function(){}})[n.type].call(e)}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,t),r(i,[{key:"push",value:function(t){this.lineStream.push(t)}},{key:"end",value:function(){this.lineStream.push("\n")}},{key:"isMasterPlaylist",value:function(){return this.manifest&&this.manifest.playlists&&0<this.manifest.playlists.length}},{key:"isLevelPlaylist",value:function(){return this.manifest&&this.manifest.segments&&0<this.manifest.segments.length}},{key:"getThumbnailsStreams",value:function(){var e=[],t=this.manifest;if(t&&t.mediaGroups["X-THUMBNAILS"]&&t.mediaGroups["X-THUMBNAILS"].thumbs){var i=t.mediaGroups["X-THUMBNAILS"].thumbs;Object.keys(i).forEach(function(t){e.push(i[t])})}return e}},{key:"isLive",value:function(){return!this.manifest.endList}}]),i}(s.default);i.default=u},{"./advertisement":1,"./line-stream":2,"./parse-stream":3,"./stream":5}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),r=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.listeners={}}return n(t,[{key:"on",value:function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t].splice(i,1),-1<i}},{key:"trigger",value:function(t){var e=this.listeners[t],i=void 0,n=void 0,r=void 0;if(e)if(2===arguments.length)for(n=e.length,i=0;i<n;++i)e[i].call(this,arguments[1]);else for(r=Array.prototype.slice.call(arguments,1),n=e.length,i=0;i<n;++i)e[i].apply(this,r)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(e){this.on("data",function(t){e.push(t)})}}]),t}();i.default=r},{}],6:[function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var r=t("./line-stream"),a=n(r),s=t("./parse-stream"),o=n(s),l=t("./parser"),u=n(l);e.exports={LineStream:a.default,ParseStream:o.default,Parser:u.default}},{"./line-stream":2,"./parse-stream":3,"./parser":4}]},{},[6])(6)},function(t,n,e){!function(){var e=function(){this.parse=function(t,e){var i=Date.now(),n=0,r=t.split(/\r\n|\r|\n/),a=!1,s=[],o=[];function l(t,e){o.push({message:t,line:n+1,col:e})}var u=r[n],h=u.length,c=0,d="WEBVTT".length;for("\ufeff"===u[0]&&(d+=c=1),(h<d||u.indexOf("WEBVTT")!==0+c||d<h&&" "!==u[d]&&"\t"!==u[d])&&l('No valid signature. (File needs to start with "WEBVTT".)'),n++;""!=r[n]&&null!=r[n];){if(l("No blank line after the signature."),-1!=r[n].indexOf("--\x3e")){a=!0;break}n++}for(;null!=r[n];){for(var f;!a&&""==r[n];)n++;if(!a&&null==r[n])break;f={id:"",startTime:0,endTime:0,pauseOnExit:!1,direction:"horizontal",snapToLines:!0,linePosition:"auto",textPosition:50,size:100,alignment:"middle",text:"",tree:null};var p=!0;if(-1==r[n].indexOf("--\x3e")){if(f.id=r[n],/^NOTE($|[ \t])/.test(f.id)){for(n++;""!=r[n]&&null!=r[n];)-1!=r[n].indexOf("--\x3e")&&l("Cannot have timestamp in a comment."),n++;continue}if(""==r[++n]||null==r[n]){l("Cue identifier cannot be standalone.");continue}-1==r[n].indexOf("--\x3e")&&(p=!1,l("Cue identifier needs to be followed by timestamp."))}a=!1;var g=new y(r[n],l),m=0;if(0<s.length&&(m=s[s.length-1].startTime),!p||g.parse(f,m)){for(n++;""!=r[n]&&null!=r[n];){if(-1!=r[n].indexOf("--\x3e")){l("Blank line missing before cue."),a=!0;break}""!=f.text&&(f.text+="\n"),f.text+=r[n],n++}var v=new b(f.text,l,e);f.tree=v.parse(f.startTime,f.endTime),s.push(f)}else for(f=null,n++;""!=r[n]&&null!=r[n];){if(-1!=r[n].indexOf("--\x3e")){a=!0;break}n++}}return s.sort(function(t,e){return t.startTime<e.startTime?-1:t.startTime>e.startTime?1:t.endTime>e.endTime?-1:t.endTime<e.endTime?1:0}),{cues:s,errors:o,time:Date.now()-i}}},y=function(a,e){var u=/[\u0020\t\f]/,i=/[^\u0020\t\f]/,s=(a=a,0),h=function(t){e(t,s+1)};function n(t){for(;null!=a[s]&&t.test(a[s]);)s++}function o(t){for(var e="";null!=a[s]&&t.test(a[s]);)e+=a[s],s++;return e}function r(){var t,e,i,n,r="minutes";if(null!=a[s])if(/\d/.test(a[s]))if((2<(t=o(/\d/)).length||59<parseInt(t,10))&&(r="hours"),":"==a[s])if(s++,2==(e=o(/\d/)).length){if("hours"==r||":"==a[s]){if(":"!=a[s])return void h("No seconds found or minutes is greater than 59.");if(s++,2!=(i=o(/\d/)).length)return void h("Must be exactly two digits.")}else i=e,e=t,t="0";if("."==a[s])if(s++,3==(n=o(/\d/)).length)if(59<parseInt(e,10))h("You cannot have more than 59 minutes.");else{if(!(59<parseInt(i,10)))return 60*parseInt(t,10)*60+60*parseInt(e,10)+parseInt(i,10)+parseInt(n,10)/1e3;h("You cannot have more than 59 seconds.")}else h("Milliseconds must be given in three digits.");else h('No decimal separator (".") found.')}else h("Must be exactly two digits.");else h("No time unit separator found.");else h("Timestamp must start with a character in the range 0-9.");else h("No timestamp found.")}this.parse=function(t,e){if(n(u),t.startTime=r(),null!=t.startTime)if(t.startTime<e&&h("Start timestamp is not greater than or equal to start timestamp of previous cue."),i.test(a[s])&&h("Timestamp not separated from '--\x3e' by whitespace."),n(u),"-"==a[s])if("-"==a[++s])if(">"==a[++s]){if(s++,i.test(a[s])&&h("'--\x3e' not separated from timestamp by whitespace."),n(u),t.endTime=r(),null!=t.endTime)return t.endTime<=t.startTime&&h("End timestamp is not greater than start timestamp."),i.test(a[s])&&!1,n(u),function(t,e){for(var i=t.split(u),n=[],r=0;r<i.length;r++)if(""!=i[r]){var a=i[r].indexOf(":"),s=i[r].slice(0,a),o=i[r].slice(a+1);if(-1!=n.indexOf(s)&&h("Duplicate setting."),n.push(s),""==o)return h("No value for setting defined.");if("vertical"==s){if("rl"!=o&&"lr"!=o){h("Writing direction can only be set to 'rl' or 'rl'.");continue}e.direction=o}else if("line"==s){if(!/\d/.test(o)){h("Line position takes a number or percentage.");continue}if(-1!=o.indexOf("-",1)){h("Line position can only have '-' at the start.");continue}if(-1!=o.indexOf("%")&&o.indexOf("%")!=o.length-1){h("Line position can only have '%' at the end.");continue}if("-"==o[0]&&"%"==o[o.length-1]){h("Line position cannot be a negative percentage.");continue}if("%"==o[o.length-1]){if(100<parseInt(o,10)){h("Line position cannot be >100%.");continue}e.snapToLines=!1}e.linePosition=parseInt(o,10)}else if("position"==s){if("%"!=o[o.length-1]){h("Text position must be a percentage.");continue}if(100<parseInt(o,10)){h("Size cannot be >100%.");continue}e.textPosition=parseInt(o,10)}else if("size"==s){if("%"!=o[o.length-1]){h("Size must be a percentage.");continue}if(100<parseInt(o,10)){h("Size cannot be >100%.");continue}e.size=parseInt(o,10)}else if("align"==s){var l=["start","middle","end","left","right"];if(-1==l.indexOf(o)){h("Alignment can only be set to one of "+l.join(", ")+".");continue}e.alignment=o}else h("Invalid setting.")}}(a.substring(s),t),!0}else h("No valid timestamp separator found.");else h("No valid timestamp separator found.");else h("No valid timestamp separator found.")},this.parseTimestamp=function(){var t=r();if(null==a[s])return t;h("Timestamp must not have trailing characters.")}},b=function(h,e,c){h=h;var d=0,f=function(t){"metadata"!=c&&e(t,d+1)};function p(){for(var t="data",e="",i="",n=[];null!=h[d-1]||0==d;){var r=h[d];if("data"==t)if("&"==r)i=r,t="escape";else if("<"==r&&""==e)t="tag";else{if("<"==r||null==r)return["text",e];e+=r}else if("escape"==t)if("&"==r)f("Incorrect escape."),e+=i,i=r;else if(/[abglmnsprt]/.test(r))i+=r;else if(";"==r)"&amp"==i?e+="&":"&lt"==i?e+="<":"&gt"==i?e+=">":"&lrm"==i?e+="‎":"&rlm"==i?e+="‏":"&nbsp"==i?e+=" ":(f("Incorrect escape."),e+=i+";"),t="data";else{if("<"==r||null==r)return f("Incorrect escape."),["text",e+=i];f("Incorrect escape."),e+=i+r,t="data"}else if("tag"==t)if("\t"==r||"\n"==r||"\f"==r||" "==r)t="start tag annotation";else if("."==r)t="start tag class";else if("/"==r)t="end tag";else if(/\d/.test(r))e=r,t="timestamp tag";else{if(">"==r||null==r)return">"==r&&d++,["start tag","",[],""];e=r,t="start tag"}else if("start tag"==t)if("\t"==r||"\f"==r||" "==r)t="start tag annotation";else if("\n"==r)i=r,t="start tag annotation";else if("."==r)t="start tag class";else{if(">"==r||null==r)return">"==r&&d++,["start tag",e,[],""];e+=r}else if("start tag class"==t)if("\t"==r||"\f"==r||" "==r)n.push(i),i="",t="start tag annotation";else if("\n"==r)n.push(i),i=r,t="start tag annotation";else if("."==r)n.push(i),i="";else{if(">"==r||null==r)return">"==r&&d++,n.push(i),["start tag",e,n,""];i+=r}else if("start tag annotation"==t){if(">"==r||null==r)return">"==r&&d++,["start tag",e,n,i=i.split(/[\u0020\t\f\r\n]+/).filter(function(t){if(t)return!0}).join(" ")];i+=r}else if("end tag"==t){if(">"==r||null==r)return">"==r&&d++,["end tag",e];e+=r}else if("timestamp tag"==t){if(">"==r||null==r)return">"==r&&d++,["timestamp",e];e+=r}else f("Never happens.");d++}}this.parse=function(t,e){var i={children:[]},n=i,r=[];function a(t){n.children.push({type:"object",name:t[1],classes:t[2],children:[],parent:n}),n=n.children[n.children.length-1]}function s(t){for(var e=n;e;){if(e.name==t)return!0;e=e.parent}}for(;null!=h[d];){var o=p();if("text"==o[0])n.children.push({type:"text",value:o[1],parent:n});else if("start tag"==o[0]){"chapters"==c&&f("Start tags not allowed in chapter title text.");var l=o[1];"v"!=l&&"lang"!=l&&""!=o[3]&&f("Only <v> and <lang> can have an annotation."),"c"==l||"i"==l||"b"==l||"u"==l||"ruby"==l?a(o):"rt"==l&&"ruby"==n.name?a(o):"v"==l?(s("v")&&f("<v> cannot be nested inside itself."),a(o),n.value=o[3],o[3]||f("<v> requires an annotation.")):"lang"==l?(a(o),n.value=o[3]):f("Incorrect start tag.")}else if("end tag"==o[0])"chapters"==c&&f("End tags not allowed in chapter title text."),o[1]==n.name?n=n.parent:"ruby"==o[1]&&"rt"==n.name?n=n.parent.parent:f("Incorrect end tag.");else if("timestamp"==o[0]){"chapters"==c&&f("Timestamp not allowed in chapter title text.");var u=new y(o[1],f).parseTimestamp();null!=u&&((u<=t||e<=u)&&f("Timestamp must be between start timestamp and end timestamp."),0<r.length&&r[r.length-1]>=u&&f("Timestamp must be greater than any previous timestamp."),n.children.push({type:"timestamp",value:u,parent:n}),r.push(u))}}for(;n.parent;)"v"!=n.name&&f("Required end tag missing."),n=n.parent;return i}},i=function(){function n(t){return t.startTime+" "+t.endTime+"\n"+function t(e){for(var i="",n=0;n<e.length;n++){var r=e[n];if("text"==r.type)i+=r.value;else if("object"==r.type){if(i+="<"+r.name,r.classes)for(var a=0;a<r.classes.length;a++)i+="."+r.classes[a];r.value&&(i+=" "+r.value),i+=">",r.children&&(i+=t(r.children)),i+="</"+r.name+">"}else i+="<"+r.value+">"}return i}(t.tree.children)+"\n\n"}this.serialize=function(t){for(var e="",i=0;i<t.length;i++)e+=n(t[i]);return e}};function t(t){t.WebVTTParser=e,t.WebVTTCueTimingsAndSettingsParser=y,t.WebVTTCueTextParser=b,t.WebVTTSerializer=i}"undefined"!=typeof window&&t(window),t(n)}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FairPlayDRM=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),r=i(28),a=i(373),s=i(374),o=i(45);e.FairPlayDRM=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._clear(),this._certManager=new a.ServerCertificateManager,this._eventManager=new o.EventManager,this._sessionManager=new s.KeySessionManager}return n(t,[{key:"configure",value:function(t,e,i){this._licenseUrl=t,this._certUrl=e,this._params=i}},{key:"init",value:function(t,e){this._video=t,this._onError=e,this._sessionManager.init(this._licenseUrl,this._params,e),void 0!==this._video.onwebkitneedkey?this._eventManager.listen(this._video,"webkitneedkey",this._onNeedKey.bind(this)):this._onError({error:r.NLError.Basic.DRM.NOT_SUPPORTED})}},{key:"reset",value:function(){this._clear(),this._eventManager&&this._eventManager.removeAll(),this._sessionManager&&this._sessionManager.reset()}},{key:"destroy",value:function(){this._clear(),this._eventManager&&this._eventManager.destroy(),this._certManager&&this._certManager.destroy(),this._sessionManager&&this._sessionManager.destroy()}},{key:"_clear",value:function(){this._video=null,this._licenseUrl="",this._certUrl="",this._params=null,this._onError=null}},{key:"_onNeedKey",value:function(e){if(!this._licenseUrl||!this._certUrl)return this.reset(),void this._onError({error:r.NLError.Basic.DRM.INVALID_PARAMS});this._certManager.load(this._certUrl,this._params.token).then(function(t){this._sessionManager.createSession(this._video,e.initData,t)}.bind(this),function(t){this._onError({error:r.NLError.Basic.DRM.CERTIFICATE_ERROR,code:t})}.bind(this))}},{key:"_onKeyError",value:function(t){this._onError({error:r.NLError.Basic.DRM.KEY_ERROR})}}]),t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ServerCertificateManager=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),a=l(i(57)),s=l(i(52)),r=l(i(56)),o=i(28);function l(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}e.ServerCertificateManager=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.MAX_COUNT=2,this._cache=[]}return n(t,[{key:"load",value:function(t,e){if(this._pendingCount()>=this.MAX_COUNT)return Promise.reject(o.NLError.Basic.CERTIFICATE_OVERFLOW_ERROR);var i=this._hasCert(t);if(i)return i.value?Promise.resolve(i.value):i.async;var n={};n.CustomData=e,n.Authorization=e;var r=a.createXHR({url:t,headers:n}).then(function(t){return i.value=s.base64DecodeUint8Array(t.replace(/(\r\n|\n|\r)/gm,"")),delete i.async,i.value}).catch(function(t){return this._removeSession(i),Promise.reject(t)}.bind(this));return i={key:t,async:r},this._pushSession(i),r}},{key:"destroy",value:function(){this._cache.forEach(function(t){var e=t.async;e&&e.abort&&e.abort()})}},{key:"_hasCert",value:function(t){return r.find(this._cache,"key",t)}},{key:"_pendingCount",value:function(){for(var t=this._cache.length,e=0,i=0;i<t;i++)this._cache[i].async&&e++;return e}},{key:"_pushSession",value:function(t){this._cache.length>=this.MAX_COUNT&&this._cache.shift(),this._cache.push(t)}},{key:"_removeSession",value:function(t){var e=this._cache.indexOf(t);0<=e&&this._cache.splice(e,1)}}]),t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.KeySessionManager=void 0;var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),l=s(i(375)),r=i(45),a=s(i(56)),u=s(i(52)),h=s(i(57)),c=s(i(104)),d=i(28);function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}e.KeySessionManager=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.KEY_SYSTEM_NAME="com.apple.fps.1_0",this._licenseUrl="",this._onError=null,this._params=null,this._eventManager=new r.EventManager,this._sessions=[]}return n(t,[{key:"init",value:function(t,e,i){this._licenseUrl=t,this._params=e,this._onError=i,this._eventManager.removeAll(),this._clearSession(),this._sessions=[]}},{key:"createSession",value:function(t,e,i){if(i){var n=l.extractContentId(e),r=l.concatInitDataIdAndCertificate(e,n,new Uint8Array(i));t.webkitSetMediaKeys(new WebKitMediaKeys(this.KEY_SYSTEM_NAME));var a=t.webkitKeys.createSession("video/mp4",r);a?(this._eventManager.listen(a,"webkitkeymessage",this._onKeyMessage.bind(this)),this._eventManager.listen(a,"webkitkeyerror",this._onKeyError.bind(this)),this._sessions.push({keySession:a,contentId:n})):this._onError({error:d.NLError.Basic.DRM.KEY_SESSION_CREATE_ERROR})}}},{key:"reset",value:function(){this.init("",null,null)}},{key:"destroy",value:function(){this.reset(),this._eventManager.destroy(),this._video=null}},{key:"_onKeyMessage",value:function(t){var i=t.target,n=this._getSession(i),e=u.base64EncodeUint8Array(t.message),r=this._licenseUrl,a={},s="";this._params&&(s='{"content_id":"'+n.contentId+'","device_id":"'+c.getDeviceId()+'","challenge":"'+e+'","client":"'+(this._params.provider||"NeuLion")+'","cro":"'+this._params.token+'"}',a["Content-type"]="application/x-www-form-urlencoded",a["Content-Type"]="application/x-www-form-urlencoded",a.Accept="application/json, text/plain, */*");var o=h.createXHR({url:r,method:"POST",headers:a,params:s});o.then(function(t){var e=l.parseLicense(t);e.result?(delete n.async,i.update(e.result)):this._onError({error:{code:d.NLError.Basic.DRM.LICENSE_ERROR.code,message:d.NLError.Basic.DRM.LICENSE_ERROR.message+e.message}})}.bind(this)).catch(function(t){delete n.async,this._onError({error:d.NLError.Basic.DRM.LICENSE_ERROR,code:t})}.bind(this)),n.async=o}},{key:"_onKeyError",value:function(t){this._onError({error:d.NLError.Basic.DRM.KEY_ERROR})}},{key:"_getSession",value:function(t){return a.find(this._sessions,"keySession",t)}},{key:"_clearSession",value:function(){!this._sessions||this._sessions.length<=0||this._sessions.forEach(function(t){t.async&&t.async.abort(),t.keySession&&t.keySession.close()})}}]),t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseLicense=e.concatInitDataIdAndCertificate=e.extractContentId=void 0;var o=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(52));e.extractContentId=function(t){var e=o.arrayToString(t);"s"!==e[0]&&(e=e.substr(1,e.length));var i=document.createElement("a");return i.href=e,i.hostname},e.concatInitDataIdAndCertificate=function(t,e,i){"string"==typeof e&&(e=o.stringToArray(e));var n=0,r=new ArrayBuffer(t.byteLength+4+e.byteLength+4+i.byteLength),a=new DataView(r);new Uint8Array(r,n,t.byteLength).set(t),n+=t.byteLength,a.setUint32(n,e.byteLength,!0),n+=4;var s=new Uint16Array(r,n,e.length);return s.set(e),n+=s.byteLength,a.setUint32(n,i.byteLength,!0),n+=4,new Uint8Array(r,n,i.byteLength).set(i),new Uint8Array(r,0,r.byteLength)},e.parseLicense=function(t){var e=JSON.parse(t);return e?e.status.ok?{result:o.base64DecodeUint8Array(e.body.response),message:"ok"}:{result:null,message:e.status.user_msg}:{result:null,message:"response parse failed!"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=i(11),a=i(75),o=i(45),l=i(46),u=i(76),h=i(34),c=i(28);var n=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i._tracks=[],i._bitrate=0,i._config={},i.type=s.AdaptivePlayer.PlayerType.WEBRTC,i.streamType=s.AdaptivePlayer.StreamType.WEBRTC,i._wsCodeNormalClosed=l.Settings.WEBRTCPLAYER.WS_NORMAL_CLOSE,i._eventManager=new o.EventManager,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,a.PlayerBase),r(n,[{key:"configure",value:function(t){this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","configure called!"),this._config={iceServers:l.Settings.WEBRTCPLAYER.DEFAULT_ICE_SERVERS,abr:{enabled:!0}},t.iceServers&&(this._config.iceServers=t.iceServers),this._config.abr=t.abr}},{key:"load",value:function(t,e){this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","load called!"),this._url=t,this._websocket?this._websocket.close(this._wsCodeNormalClosed):(this._websocket=new WebSocket(this._url),this._eventManager.listen(this._websocket,"open",this._onWSOpened.bind(this)),this._eventManager.listen(this._websocket,"message",this._onWSMessage.bind(this)),this._eventManager.listen(this._websocket,"close",this._onWSClose.bind(this)),this._eventManager.listen(this._websocket,"error",this._onWSError.bind(this)))}},{key:"isLive",value:function(){return this._video.duration===1/0}},{key:"unload",value:function(){return this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","unload called!"),this._eventManager&&this._eventManager.removeAll(),this._peer_connection&&this._peer_connection.close(),this._video.captureStream&&this._video.captureStream().getTracks().forEach(function(t){t.stop()}),this._video.srcObject=null,this._url="",this._current_bw=0,this._bitrate=0,this._tracks=[],Promise.resolve()}},{key:"destroy",value:function(){return this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","destroy called!"),this.unload(),this._eventManager&&this._eventManager.destroy(),Promise.resolve()}},{key:"getStats",value:function(){return{bytesLoaded:NaN,bandwidth:this._current_bw/1e3,bitrate:this._bitrate/1e3,switchInfo:NaN,switchHistory:NaN,isAutoSwitch:!!this._config.abr.enabled,livePointOffest:-1}}},{key:"videoTracks",value:function(){return this._tracks}},{key:"selectTrack",value:function(t){if(t){var e={type:"user_bitrate",payload:{}};e.payload.bitrate=parseInt(t.bandwidth/1e3);var i=JSON.stringify(e);this._websocket.send(i),this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","auto quality switch status changed to manual"),this._bitrate=parseInt(t.base),this._config.abr.enabled=!1}}},{key:"setAdaptation",value:function(t){if(this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","auto quality switch status changed to auto"),this._config.abr.enabled=t){var e={type:"user_bitrate",payload:{}};e.payload.bitrate=parseInt(0);var i=JSON.stringify(e);this._websocket.send(i)}}},{key:"notifyProfileChanged",value:function(t){for(var e=0;e<this._tracks.length;e++)if(this._tracks[e].active=!1,this._tracks[e].bandwidth===this._bitrate){this._tracks[e].active=!0;var i={id:e,videoWidth:t.videoWidth,videoHeight:t.videoHeight};this._eventHandler.dispatchEvent(new h.FakeEvent(s.AdaptivePlayer.EventType.ProfileChange,{details:i})),this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","Fired ProfileChange: "+JSON.stringify(i))}}},{key:"_onWSOpened",value:function(t){this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","ws opened"),this._peer_connection=new RTCPeerConnection(this._config),this._peer_connection.ontrack=function(t){this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","track added")}.bind(this),this._peer_connection.onaddstream=function(t){this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","stream added"),this._video.srcObject=t.stream}.bind(this)}},{key:"_onWSMessage",value:function(t){this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","message : "+t.data);var e=JSON.parse(t.data);switch(e.type){case"offer":this._peer_connection.setRemoteDescription({type:"offer",sdp:e.payload}),this._peer_connection.onicecandidate=function(t){t.candidate&&this._websocket.send(JSON.stringify({type:"ice",payload:t.candidate}))}.bind(this),this._peer_connection.createAnswer().then(function(t){this._peer_connection.setLocalDescription(t),this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","answer : "+JSON.stringify(t)),this._websocket.send(JSON.stringify({type:"answer",payload:t}))}.bind(this));break;case"ice":this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","ice candidate : "+JSON.stringify(e.payload)),this._peer_connection.addIceCandidate(new RTCIceCandidate(e.payload)).catch(function(t){this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","add ice failed "+t),this._onError(t)});break;case"available_qualities":this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","available qualities: "+JSON.stringify(e.bitrates));var i=e.bitrates;this._tracks=[];for(var n=0;n<i.length;n++)this._tracks.push(new u.NLTrack("VIDEO",1e3*i[n].bitrate,s.AdaptivePlayer.PlayerType.WEBRTC,n,this)),this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","available qualities : "+JSON.stringify(i[n].bitrate+" Kbit"));this._websocket.send(JSON.stringify({type:"hello"})),this._bitrate=1e3*i[0].bitrate;break;case"current_net_bw":this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","Current Network Bandwidth: "+e.bitrate+"Kbit"),this._current_bw=1e3*e.bitrate;break;case"current_quality":this.print(s.AdaptivePlayer.LogLevel.TRACE,"WebRTCPlayer","current quality: "+JSON.stringify(e.bitrate)),this._bitrate=1e3*e.bitrate}}},{key:"_onWSClose",value:function(t){t.code===n.WS_NORMAL_CLOSE?this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","ws closed"):(this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","ws connection error"),this._onError(t)),this._websocket=null}},{key:"_onWSError",value:function(t){1===this._websocket.readyState&&this.print(s.AdaptivePlayer.LogLevel.DEBUG,"WebRTCPlayer","ws normal error: "+t.type)}},{key:"_onError",value:function(t){var e=c.NLError.SeverityLevel.Fatal,i=c.NLError.Code.Get_Primary_Manifest_Failed+c.NLError.NetworkDetailCode.Connect_Failed,n=this._url,r="WebRTC closeEvent ";if(1e3===t.code);else if(1001===t.code)r+="Going Away";else if(1002===t.code)r+="Protocol Error";else if(1003===t.code)r+="Protocol Error";else if(1004===t.code)r+="Protocol Error";else if(1005===t.code)r+="No Status Recvd";else if(1006===t.code)r+="Abnormal Closure";else if(1007===t.code)r+="Invalid frame payload data";else if(1008===t.code)r+="Policy Violation";else if(1009===t.code)r+="Message too big";else if(1010===t.code)r+="Missing Extension";else if(1011===t.code)r+="Internal Error";else if(1012===t.code)r+="Service Restart ";else if(1013===t.code)r+="Try Again Later";else if(1014===t.code)r+="Bad Gateway";else{if(1015!==t.code)return;r+="TLS Handshake"}var a=c.NLError.create(i,e,n,r,t.code);this._statisticManager.reportError(a),this.print(s.AdaptivePlayer.LogLevel.ERROR,"WebRTCPlayer","Fired streaming error: "+r)}}]),n}();(e.default=n).version="v0.0.1"}]));